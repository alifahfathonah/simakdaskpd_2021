<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');


class Rka extends CI_Controller {
	function __construct()
	{	
		parent::__construct();
	}       

function get_ip() {          
    $ipaddress = ''; 
    if (isset($_SERVER['HTTP_CLIENT_IP']))
        $ipaddress = $_SERVER['HTTP_CLIENT_IP'];
    else if(isset($_SERVER['HTTP_X_FORWARDED_FOR']))
        $ipaddress = $_SERVER['HTTP_X_FORWARDED_FOR'];
    else if(isset($_SERVER['HTTP_X_FORWARDED']))
        $ipaddress = $_SERVER['HTTP_X_FORWARDED'];
    else if(isset($_SERVER['HTTP_FORWARDED_FOR']))
        $ipaddress = $_SERVER['HTTP_FORWARDED_FOR'];
    else if(isset($_SERVER['HTTP_FORWARDED']))
        $ipaddress = $_SERVER['HTTP_FORWARDED'];
    else if(isset($_SERVER['REMOTE_ADDR']))
        $ipaddress = $_SERVER['REMOTE_ADDR'];
    else
        $ipaddress = 'IP tidak dikenali';
    return $ipaddress;
}
  
function get_browser() {
    $browser = '';
    if(strpos($_SERVER['HTTP_USER_AGENT'], 'Netscape'))
        $browser = 'Netscape';
    else if (strpos($_SERVER['HTTP_USER_AGENT'], 'Firefox'))
        $browser = 'Firefox';
    else if (strpos($_SERVER['HTTP_USER_AGENT'], 'Chrome'))
        $browser = 'Chrome';
    else if (strpos($_SERVER['HTTP_USER_AGENT'], 'Opera'))
        $browser = 'Opera';
    else if (strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE'))
        $browser = 'Internet Explorer';
    else
        $browser = 'Other';
    return $browser;
}      
function rka0() 
	{	
	 $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0','');
	}
function rka1()
	{	
	 $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1','');
	} 
function rka21() 
	{	
	 $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21','');
	}
function rka22()   
	{	
	 $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 2','rka22','');
	}
    
    function rka221_murni(){
    $skpd     = $this->session->userdata('kdskpd');
    $id         =  $this->session->userdata('pcNama');

    if($id=='anggaran'){       
        $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221_murni','');
    }else{   
        $this->index2('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221_murni',$skpd);
        } 
    }
    
function rka221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221','');
	}
function rka0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd','');
	}
function rka1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd','');
	}
function rka21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd','');
	}
function rka31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31','');
	}
function rka32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32','');
	}
function dpa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0','');
	}
 
function dppa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0','');
	}
function dppa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd','');
	}
function dpa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1','');
	}
function dppa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1','');
	}
function dppa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd','');
	}
function dpa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21','');
	}
function dppa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21','');
	}
function dppa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd','');
	}
function dpa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22','');
	}
function dppa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22','');
	}
function dpa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 221','dpa221','');
	}
function dppa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221','');
	}
function dpa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0 PPKD','dpa0pkd','');
	}
function dpa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1 PPKD','dpa1pkd','');
	}
function dpa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21 PPKD','dpa21pkd','');
	}
function dpa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 31 PPKD','dpa31','');
	}
function dppa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31','');
	}
function dpa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 32 PPKD','dpa32','');
	}
function dppa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32','');
	}    
function perda_1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN I','perda_1','');
	}
 function perda_III()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN III','perda_III','');
	}
 function perkada_II()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_II','');
	}    
 function perkada_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah','');
	}   
 function perda_1_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda_1_ubah','');
	}

function perda_III_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah','');
	}  

function posting_ang()
    {
        $data['page_title']= 'POSTING';
        $this->template->set('title', 'POSTING');   
        $this->template->load('template','anggaran/rka/posting_ang',$data) ; 
    }

	
function index($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)

 //$this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0','');
	{
		$data['page_title'] = "CETAK $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->master_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->master_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
 
		$config['base_url']		= site_url("rka/".$list);
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	    
         if(empty($lccari)){     
		 $kd_skpd = $this->session->userdata('kdskpd');
		 $sqltpk ="SELECT * FROM ms_skpd WHERE kd_skpd = '$kd_skpd'";
		 $data['list']=$this->db->query($sqltpk);
		 
		//$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit, $offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$data['sikap'] = 'list';
		$this->template->set('title', 'CETAK RKA');
		$this->template->load('template', "anggaran/rka/".$list, $data);
	}
	
function pengesahan_dpa()
    {
        $data['page_title']= 'Pengesahan DPA & DPPA';
        $this->template->set('title', 'Pengesahan DPA & DPPA');   
        $this->template->load('template','anggaran/rka/pengesahan_dpa',$data) ; 
    }
    
function spd_btl()
    {
        $data['page_title']= 'SPD Belanja Tidak Langsung';
        $this->template->set('title', 'SPD Belanja Tidak Langsung');   
        $this->template->load('template','anggaran/rka/spd_btl',$data) ; 
    }

function get_status2($skpd){
        $n_status = '';
        
        $sql = "select case when status_ubah='1' then 'nilai_ubah' 
                    when status_sempurna='1' then 'nilai_sempurna' 
                    when statu='1' 
                    then 'nilai' else 'nilai' end as anggaran from trhrka where kd_skpd ='$skpd'";
        
        $q_trhrka = $this->db->query($sql);
        $num_rows = $q_trhrka->num_rows();
        
        foreach ($q_trhrka->result() as $r_trhrka){
             $n_status = $r_trhrka->anggaran;                   
        }    
        return $n_status;                         
    }     
    
function spd_bl()
    {
        $data['page_title']= 'SPD Belanja Langsung';
        $this->template->set('title', 'SPD Belanja Langsung');   
        $this->template->load('template','anggaran/rka/spd_bl',$data) ; 
    }           
    
function load_pengesahan_dpa(){
		$kd_skpd = $this->session->userdata('kdskpd');
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where =" WHERE kd_skpd='$kd_skpd'";
        if ($kriteria <> ''){                               
            $where="WHERE kd_skpd='$kd_skpd'";           
        }
		
        $sql = "SELECT count(*) as tot from trhrka $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhrka $where order by kd_skpd";
		
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'kd_skpd' => $resulte['kd_skpd'],        
                        'statu' => $resulte['statu'],
						'status_sempurna' => $resulte['status_sempurna'],
                        'status_ubah' => $resulte['status_ubah'],
						'no_dpa' => $resulte['no_dpa'],        
                        'tgl_dpa' => $resulte['tgl_dpa'],
                        'no_dpa_ubah' => $resulte['no_dpa_ubah'],
						'tgl_dpa_ubah' => $resulte['tgl_dpa_ubah'],
						//'status_sempurna' => $resulte['status_sempurna'],
                        'no_dpa_sempurna' => $resulte['no_dpa_sempurna'],
						'tgl_dpa_sempurna' => $resulte['tgl_dpa_sempurna']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);	   
	}
     function simpan_pengesahan(){
        $kdskpd = $this->input->post('kdskpd');
        $sdpa = $this->input->post('stdpa');
        $sdppa = $this->input->post('stdppa');
        $nodpa = $this->input->post('no');
        $tanggal1 = $this->input->post('tgl');
        $nodppa = $this->input->post('no2');
        $tanggal2 = $this->input->post('tgl2');
		$sdpasempurna = $this->input->post('stsempurna');
		$nosempurna = $this->input->post('no3');
        $tanggal3 = $this->input->post('tgl3');
        
        if ($kdskpd == '1.20.05.01'){
                $field ='nilai_ubah';
                $rek ='4';
                $rek1 ='5';
                $rek3 ='61';
                $rek4 ='62';
                
                $ang4 = $this->rka_model->get_ang($field,$rek,$kdskpd);
                $ang5 = $this->rka_model->get_ang($field,$rek1,$kdskpd);
                //$ang6 = $this->rka_model->get_ang($field,$rek2,$kdskpd);
                $ang61 = $this->rka_model->get_ang2($field,$rek3,$kdskpd);
                $ang62 = $this->rka_model->get_ang2($field,$rek4,$kdskpd);
                $ang4_61 = $ang4+$ang61;
                $ang5_62 = $ang5+$ang62;
                $perubahan_sal =$ang4_61-$ang5_62;
        		$sql = "delete from trhrka where kd_skpd = '$kdskpd'";
        		$asg = $this->db->query($sql);
                
                $sql2 = "insert into trhrka(kd_skpd,statu,status_sempurna,status_ubah,no_dpa,tgl_dpa,no_dpa_ubah,tgl_dpa_ubah,no_dpa_sempurna,tgl_dpa_sempurna)
				values('$kdskpd','$sdpa','$sdpasempurna','$sdppa','$nodpa','$tanggal1','$nodppa','$tanggal2','$nosempurna','$tanggal3')";
                $asg = $this->db->query($sql2);
                
                
        		$this->db->query("delete from trhju_ppkd where no_voucher = '$nodpa'");
                $this->db->query("delete from trdju_ppkd where no_voucher = '$nodpa'");
                
                $this->db->query("insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                                values('$nodpa','$tanggal1','','','','$kdskpd','','$ang4_61','$ang4_61','9')");
                                
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
                                values('$nodpa','','','3120101','Estimasi Pendapatan','$ang4','0','D','','0','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120201','Estimasi Penerimaan Pembiayaan','$ang61','0','D','','1','9') ");
                	
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120501','Estimasi Perubahan SAL','0','$perubahan_sal','K','','0','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120301','Apropriasi Belanja','0','$ang5','K','','1','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120401','Apropriasi Pengeluaran Pembiayaan','0','$ang62','K','','2','9') ");
                
                
          } else {
                $field ='nilai_ubah';
                $rek ='4';
                $rek1 ='5';
                
                $ang4 = $this->rka_model->get_ang($field,$rek,$kdskpd);
                $ang5 = $this->rka_model->get_ang($field,$rek1,$kdskpd);
                $ang5_4 = $ang4-$ang5;
                $d = $ang4+$ang5_4;
        		$sql = "delete from trhrka where kd_skpd = '$kdskpd'";
        		$asg = $this->db->query($sql);
                
                $sql2 = "insert into trhrka(kd_skpd,statu,status_sempurna,status_ubah,no_dpa,tgl_dpa,no_dpa_ubah,tgl_dpa_ubah,no_dpa_sempurna,tgl_dpa_sempurna)
				values('$kdskpd','$sdpa','$sdpasempurna','$sdppa','$nodpa','$tanggal1','$nodppa','$tanggal2','$nosempurna','$tanggal3')";
                $asg = $this->db->query($sql2);
                
                
        		$this->db->query("delete from trhju_pkd where tabel = '9' and kd_skpd='$kdskpd'");
                $this->db->query("delete from trdju_pkd where no_voucher = '$nodpa' and pos = '9'");
                if ($sdpa=='1'){
                $this->db->query("insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                                values('$nodpa','$tanggal1','','','','$kdskpd','','$d','$d','9')");
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
                                values('$nodpa','','','3120101','Estimasi Pendapatan','$ang4','0','D','','0','9') ");
                if ($ang5_4<0){
                    $ang5_4=$ang5_4*-1;
                    $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120501','Estimasi Perubahan SAL','$ang5_4','','D','','1','9') ");
                }else{
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120501','Estimasi Perubahan SAL','0','$ang5_4','K','','1','9') ");
                }	
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120301','Apropriasi Belanja','0','$ang5','K','','3','9') ");
                }
                
            }
     }	
	
	
function index2($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)
	{
		$data['page_title'] = "CETAK $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->master_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->master_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
 
		$config['base_url']		= site_url("rka/".$list);
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	    
         if(empty($lccari)){
		 $kd_skpd = $this->session->userdata('kdskpd');
		 $kd_skpd2 = $this->left($kd_skpd,7);
		 //$sqltpk ="SELECT * FROM ms_skpd WHERE left(kd_skpd,7) = '$kd_skpd2'";
		 $sqltpk ="SELECT * FROM ms_skpd WHERE kd_skpd = '$kd_skpd'";
		 $data['list']=$this->db->query($sqltpk);
		 
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit, $offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$data['sikap'] = 'list';
		$this->template->set('title', 'CETAK RKA');
		$this->template->load('template', "anggaran/rka/".$list, $data);
	}
    
   
    
    function  tanggal_format_indonesia($tgl){
        $tanggal  = explode('-',$tgl); 
        $bulan  = $this-> getBulan($tanggal[1]);
        $tahun  =  $tanggal[0];
        return  $tanggal[2].' '.$bulan.' '.$tahun;
	}
    
 
    function  getBulan($bln){
        switch  ($bln){
        case  1:
        return  "Januari";
        break;
        case  2:
        return  "Februari";
        break;
        case  3:
        return  "Maret";
        break;
        case  4:
        return  "Maret";
        break;
        case  5:
        return  "Mei";
        break;
        case  6:
        return  "Juni";
        break;
        case  7:
        return  "Juli";
        break;
        case  8:
        return  "Agustus";
        break;
        case  9:
        return  "September";
        break;
        case  10:
        return  "Oktober";
        break;
        case  11:
        return  "November";
        break;
        case  12:
        return  "Desember";
        break;
    }
    }

    function cek_anggaran_detail()
    {
        $data['page_title']= 'Cek Header dan Rincian';
        $this->template->set('title', 'Cek Header dan Rincian');   
        $this->template->load('template','anggaran/rka/cek_anggaran_detail',$data) ; 
    }

    function load_cek_anggaran_detail(){
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('kriteria_init');
        $kriteria_skpd = $this->input->post('kriteria_skpd');
        
        $init ='';
        if ($kriteria <> ''){                               
            
            if($kriteria=="1"){
                $init= "";
            }else if($kriteria=="2"){
                $init= "_sempurna";
            }else{
                $init= "_ubah";
            }                                        
        }
        
        $sql = "select count(x.kd_kegiatan) as tot  from(
                select kd_kegiatan,nm_kegiatan,sum(nilai$init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                select kd_kegiatan,sum(total$init) as nilai_detail from trdpo 
                where substring(kd_kegiatan,6,7)=substring('$kriteria_skpd',6,7)
                group by kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan
                " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "select x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_detail,case when z.nilai_detail = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum(nilai$init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                select kd_kegiatan,sum(total$init) as nilai_detail from trdpo 
                where substring(kd_kegiatan,6,7)=left('$kriteria_skpd',7)                
                group by kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan 
                order by x.kd_kegiatan,x.nm_kegiatan
                ";
                
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],        
                        'nilai_ang' => number_format($resulte['nilai_ang'],2),
                        'nilai_detail' => number_format($resulte['nilai_detail'],2),
                        'status_hasil' => $resulte['hasil']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);     
    } //end load_cek_anggaran_detail

    function preview_cetakan_cek_anggaran_detail(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $status_ang = $this->uri->segment(5);


    
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
     
        
        $cRet='';
       $Xret1 = '';
       $Xret1.="<table style=\"font-size:30px;border-left:solid 0px black;border-top:solid 0px black;border-right:solid 0px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td align=\"center\" colspan=\"5\" style=\"font-size:22px;border: solid 0px white;\"><b>LAPORAN PERBANDINGAN<br>NILAI HEADER DAN NILAI RINCIAN</b></td>
                        
                    </tr>
                 </table>";

       $Xret2 = '';
       $Xret3 = ''; 
       
       $Xret2.="<table style=\"border-collapse:collapse;font-size:14px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td colspan=\"3\" width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret3.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>
                 </table>";       
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:15 px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">

                     <thead >                       
                        <tr>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center \"><b>Kode Kegiatan</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"50%\" align=\"center\"><b>Nama Kegiatan</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center\"><b>Nilai Header</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center\"><b>Nilai Detail</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"5%\" align=\"center\"><b>Hasil</b></td>
                         </tr>
                     </thead>
                     
                   
                        ";
            $stt='';
        if($status_ang=='1'){
            $stt='';
        }else if($status_ang=='2'){
            $stt='_sempurna';
        }else if($status_ang=='3'){
            $stt='_ubah';
        }

                $sql1="select x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum(nilai".$stt.") as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$id',7)
                and substring(kd_kegiatan,17,2) !='00'
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                select kd_kegiatan,sum(total".$stt.") as nilai_kas from trdpo 
                where substring(kd_kegiatan,6,7)=left('$id',7)                
                and substring(kd_kegiatan,17,2) !='00'
                group by kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan 
                where substring(x.kd_kegiatan,17,2) !='00' order by x.kd_kegiatan,x.nm_kegiatan
  
                        ";
  

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $giat=rtrim($row->kd_kegiatan);
                    $nm_giat=rtrim($row->nm_kegiatan);
                    $hasil=rtrim($row->hasil);
                    $nilai_ang=($row->nilai_ang);
                    $nilai_angx = number_format($nilai_ang,2,',','.');
                    $nilai_kas=($row->nilai_kas);
                    $nilai_kasx = number_format($nilai_kas,2,',','.');

                            if($hasil=='SAMA'){


                      $cRet    .= " <tr>                                
                                        <td align=\"center\" style=\"vertical-align:middle; \" >$giat</td>
                                        <td align=\"left\" style=\"vertical-align:middle; \" >$nm_giat</td>
                                        <td align=\"right\" style=\"vertical-align:middle; \" >$nilai_ang</td>
                                        <td align=\"right\" style=\"vertical-align:middle; \" >$nilai_kas</td>
                                        <td align=\"center\" style=\"vertical-align:middle; \" >$hasil</td>
                                    </tr> 
                                   
                                    ";
    
                            }else{
                

                      $cRet    .= " <tr>                                
                                        <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"vertical-align:middle;\" >$giat</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"left\" style=\"vertical-align:middle;\" >$nm_giat</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"right\" style=\"vertical-align:middle;\" >$nilai_ang</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"right\" style=\"vertical-align:middle;\">$nilai_kas</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"vertical-align:middle;\">$hasil</td>
                                    </tr> 
                                   
                                    ";

                            }

                }

 
        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Lap Perbandingan Anggaran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= cek_anggaran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }//end preview_cetakan_cek_anggaran_detail
 
    function right($value, $count){
    return substr($value, ($count*-1));
    }

    function left($string, $count){
    return substr($string, 0, $count);
    }

    function  dotrek($rek){
				$nrek=strlen($rek);
				switch ($nrek) {
                case 1:
				$rek = $this->left($rek,1);								
       			 break;
    			case 2:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1);								
       			 break;
    			case 3:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1);								
       			 break;
    			case 5:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2);								
        		break;
    			case 7:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2).'.'.substr($rek,5,2);								
        		break;
    			default:
				$rek = "";	
				}
				return $rek;
    }
		
		function cbidang(){
    
         $skpd = $this->session->userdata('kdskpd');        
        $cek = explode(".",$skpd);
        $ck = $cek[3];  
        
        if($ck=="00"){
            $par = "where kd_skpd='$skpd'";
        }else{
            $par = "where kd_bidskpd='$skpd'";
        }
        
        $sql = "select * from ms_bidang $par order by kd_skpd,kd_bidang";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'kd_bidskpd' => $resulte['kd_bidskpd'],						
                        'kd_bidang' => $resulte['kd_bidang'],						
						'nm_bidang' => $resulte['nm_bidang']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   function pbidang($skpd=''){
    
        //$skpd = $this->session->userdata('kdskpd');
        $sql = "select * from ms_bidang where kd_skpd='$skpd' order by kd_skpd,kd_bidang";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'kd_bidskpd' => $resulte['kd_bidskpd'],						
                        'kd_bidang' => $resulte['kd_bidang'],						
						'nm_bidang' => $resulte['nm_bidang']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
		
	 function preview_rka0(){
        $idx = $this->uri->segment(3);
        $id = substr($idx,0,7);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        $ttd2x= $this->uri->segment(8);
        $tgl2= $this->uri->segment(7);
        $statttd= $this->uri->segment(9);
        $ttd1x= $this->uri->segment(10);
        $ttd_tgl = $this->tukd_model->tanggal_format_indonesia($tgl2);
        $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        //$ttd2= $_REQUEST['ttd2'];        
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $n_trdrka  =   '';
            $kdrka ='RKA';
        
        
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,left(a.kd_skpd,7) as kd_skp,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)=left('$id',7) and right(kd_skpd,2)='00'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }
        //echo "$sqldns";

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
         
        $sqlurusan1="SELECT top 1 * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                    
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


       if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }       
        
        
        $cRet='';
    $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"></td>
                         <td width=\"65%\" align=\"center\"><strong>$judulrka</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>$kdrka - PD<br></strong></td>
                    </tr>

                    <tr>
                         <td  style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>PERANGKAT DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>
                  <table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                  <tr>
                                        <td><strong>&emsp;Urusan Pemerintahan</strong></td>
                                        <td ><strong>: </strong></td>
                                        <td><strong> $kd_urusan1 - $nm_urusan1</strong></td>
                                    </tr>";        
                  
      /* if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                   <tr>
                        <td><strong>&emsp;Unit Organisasi</stong></td>
                        <td><strong>: $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                </table>";
        }ELSE{*/  $sql1=" SELECT  TOP 1 a.kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where left(kd_skpd,7) ='$id' AND LEFT(a.kd_skpd,4) = LEFT (b.kd_urusan, 4)
                 group by left(kd_kegiatan,4),kd_skpd,nm_urusan";
                 //echo($sql1);
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
                        

                        $cRet    .= "
                                      	<tr>
                 					    	<td width=\"22%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        					<td width=\"3%\"><strong>: </stong></td>
                        					<td width=\"80%\"><strong> $urus - $nm_urus</stong></td>
                    					</tr>
                 ";
                }
            $cRet .="
                    <tr>
                        <td><strong>&emsp;Unit Organisasi </stong></td>
                        <td ><strong>: </stong></td>
                        <td><strong> $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                </table>";            
        //}            
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                            
                         <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"10%\" align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"70%\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"20%\" align=\"center\"><strong>3</strong></td></tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$this->dotrek(rtrim($row->kd_rek));
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                    
                    if(strlen($coba1)>3){                                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1 </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba1</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba3</strong></td></tr>";                        
                    }
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka$n_trdrka WHERE LEFT(kd_rek5,2)='41' and $a$skpd$b='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                    
                    if ($cob1!=0){                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba4</strong></td></tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    } 
                 }     

                 
         
         
               $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$this->dotrek(rtrim($row1->kd_rek));
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    
                    if(strlen($coba5)>3){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                    }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka$n_trdrka WHERE (LEFT(kd_rek5,2)='51' or LEFT(kd_rek5,2)='52') and $a$skpd$b='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba8</strong></td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                    $x1="("; 
                    $suplus=$suplus*-1;
                    $y1=")";}
                  else {
                    $x1="";
                    $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$x1$surp$y1</strong></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";

                    if ($id == 'ppkd' || $id == 'ppkd1'){
                        //PENERIMAAN PEMBIAYAAN
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
        
                       $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpen = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                    
                        $totpen1=number_format($totpen,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENERIMAAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpen1</strong></td></tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                    

                        //PENGELUARAN PEMBIAYAAN
        
                        $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpeng = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                        
                        $jbiaya = $totpen - $totpeng;
                        
                         $jbiaya = $this->rp_minus($jbiaya);
                        
                       $totpeng=number_format($totpeng,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENGELUARAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpeng</strong></td></tr>";
                     //perbaiki totpeng dan jbiaya
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                                                         
                       $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$jbiaya</strong></td></tr>";


                    }
                    
  
   
                    
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Anggaran<br>Perangkat Daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td width=\"4%\" style=\"text-align: center;\"><strong>1</strong> </td>
                                <td width=\"23%\" style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>3</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>4</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>5</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>6</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
                                                        
  
                    //Pendapatan
                    $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                    
 

                   //Belanja Operasi
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro a
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,2)='51' and kd_skpd='$idx'
                            ";

                                //echo($qtriw);
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Operasi</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Belanja Modal
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro a
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,2)='52' and kd_skpd='$idx'
                            ";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Modal</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
 
                        //Belanja Tidak Terduga
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro a
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,2)='53'and kd_skpd='$idx'
                            ";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.3</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Tidak Terduga</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>"; 

                        //Belanja transfer
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro a
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,2)='54' and kd_skpd='$idx'
                            ";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.4</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Transfer</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>"; 
                  
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.003' AND $a a.$skpd$b='$id'";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
                                <table border=\"0\" width=\"100%\">
                                <tr>
                                <td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
                                <br>&nbsp;
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;  
                                </td>
                                <td width=\"30%\" align=\"center\">$daerah,$ttd_tgl 
                                <br>$jdlnip1
                                <br>$jabatan1
                                <p>&nbsp;</p>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br><strong><ins>$nama1</ins></strong>
                                <br>$nip1 
                                </td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }//preview_rka0(
	
	 function preview_rka0_rinci(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ids = substr($id,0,7);
        
        $bidang = $this->session->userdata('kdskpd');
        $cek = explode(".",$bidang);
        $ckbid = $cek[3];
        $nmbid = "";
        
        if($ckbid=="00"){
           $id = $id;
           $nmbid = "";     
           $andd = "and left(b.kd_skpd,7)='$ids'";
        }else{
           $id = $id;
           
           $sql = $this->db->query("select nm_bidang from ms_bidang where kd_bidskpd='$bidang'")->row();
           $sqll = $sql->nm_bidang;
           $andd = "and b.kd_skpd='$bidang'";
           $nmbid = $sqll;
        } 
        
        $nmbid = strtoupper($nmbid);
        
        
        
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)= '$ids' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)= '$ids' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr> <td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"19%\">Urusan Pemerintahan </td>
                        <td width=\"81%\">$kd_urusan - $nm_urusan</td>
                    </tr>					
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>";                             
        $cRet .="
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)='41' $andd  GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)='41' $andd GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)='41' $andd GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(b.nilai) AS totp FROM trdrka b WHERE LEFT(b.kd_rek5,2)='41' $andd";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>
								  <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') $andd 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') $andd GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') $andd GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       UNION ALL 
                       SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                       ON a.kd_rek4=LEFT(b.kd_rek5,(len(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') $andd GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                       UNION ALL 
                       SELECT RTRIM(a.kd_rek5) AS kd_rek,a.kelompok AS rek,a.nm_rek5 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                       ON a.kd_rek5=b.kd_rek5 WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') $andd GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    //$coba5=$row1->rek;
                    $coba5=$this->dotrek($row1->kd_rek);
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(b.nilai) AS totb FROM trdrka b WHERE (LEFT(b.kd_rek5,3)='511' or LEFT(b.kd_rek5,2)='52') $andd";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    
					$kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				 if ((($kd_ttd=='01') && ($kd_kepala!='1.20.03'))|| ($id=='1.20.03.00')){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\">
								<tr>
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
								<br>
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,$tanggal_ttd
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
					 $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"5\" align=\"center\">Tim Anggaran Pemerintah Daerah </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tanda Tangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $judul         = 'RKA0';
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;  
		echo ("<title>RKA 0</title>");
    	echo($cRet);
        break;
        }
                
    }
	
	
	function preview_rka0_all(){
        $id = $this->uri->segment(3);
		$kd_skpd = $this->left($id,7);
        $cetak = $this->uri->segment(4);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(a.kd_skpd,7)='$kd_skpd' GROUP BY kd_u";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
					$kd_urusan=$rowdns->kd_u;                    
					$nm_urusan= $rowdns->nm_u;
					$kd_skpd1  = $rowdns->kd_sk;
					$nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd1 - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)='41' and left(b.kd_skpd,7)='$kd_skpd' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)='41' and left(b.kd_skpd,7)='$kd_skpd' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)='41' and left(b.kd_skpd,7)='$kd_skpd' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and left(kd_skpd,7)='$kd_skpd'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND left(b.kd_skpd,7)='$kd_skpd' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND left(b.kd_skpd,7)='$kd_skpd' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND left(b.kd_skpd,7)='$kd_skpd' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and left(kd_skpd,7)='$kd_skpd'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    
					if ($ttd2==''){
					
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br>$nama2
                				<br>NIP. $nip2 
								</td>
																
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $judul         = 'RKA 0';
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) { 
        case 1;
			echo($cRet);
             //$this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            //$this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
                
    }
    
    
function preview_dppa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal    = $this->tanggal_format_indonesia($tgl);
                    $kabx       = $rowsc->kab_kota;
                    $daerah     = $rowsc->daerah;
                    $thn        = $rowsc->thn_ang;
                    $kab        = strtoupper($kabx);
                }
        
		$sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - PD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Perangkat Daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"font-size:11px;border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td style=\"font-size:10px;\" bgcolor=\"#CCCCCC\"  align=\"center\" rowspan=\"2\" ><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\"  align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\"  align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\"  align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" >&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,'.',',');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td></tr>";
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '2.2' AS NO ,'Belanja langsung' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)<>'00' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,'.',',');
                    $triw2= number_format($triw->triw2,2,'.',',');
					$triw3= number_format($triw->triw3,2,'.',',');
					$triw4= number_format($triw->triw4,2,'.',',');
					$total= number_format($triw->jumlah,2,'.',',');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_dppa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" rowspan=\"2\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"46%\" align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"46%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518')) and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,',','.');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $rek=$row2->rek;
                    $uraian=$row2->nm_rek;
                    $nilai= number_format($row2->nilai,"2",",",".");
                    $nilai_u= number_format($row2->nilai_u,"2",",",".");
                    $n=$row2->nilai;
                    $n_u=$row2->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                    $pm_u=$rowpm->totpm_u;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                    $pk_u=$rowpk->totpk_u;
                   
                 }
                    
                  $pmnetto=$pm-$pk;
                  $pmnett=number_format($pmnetto,2,',','.');
                  $pmnetto_u=$pm_u-$pk_u;
                  $pmnett_u=number_format($pmnetto_u,2,',','.');
                  $netto= $pmnetto_u - $pmnetto;
                  if ($netto < 0){
                	$a1="(";
                	$netto=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettoo=number_format($netto,2,',','.');
                    $pers   = ($netto!=0)?($netto / $pmnetto ) * 100:0; 
                    $p= number_format($per1,"2",".",","); 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$a1$nettoo$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$p</td>
                                     </tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     </tr>";
                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"25%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"71%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"14%\" style=\"text-align: center;\">I </td>
                                <td width=\"14%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '3.1' AS NO ,'Pembiayaan Masuk' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.03' AND kd_skpd='$id'
                    UNION
                    SELECT '3.2' AS NO ,'Pembiayaan Keluar' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_rka0pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Ringkasan Anggaran Pendapatan dan Belanja PPKD</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 }
                 
                 $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                 
                 $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                foreach ($sqlpm->result() as $rowpm)
                {
                    $pm=$rowpm->totpm;
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                foreach ($sqlpk->result() as $rowpk)
                {
                    $pk=$rowpk->totpk;
                }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $netto=number_format($pmnetto,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                   
                    
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                   
                 }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $netto=number_format($pmnetto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                              UNION
                              SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                              UNION
                              SELECT '3.1' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'
                              UNION
                              SELECT '3.2' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    
   function preview_rka1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttd1x = $this->uri->segment(9);
        $ttd2x = $this->uri->segment(10);
        $statttd = $this->uri->segment(11);
        //$ttd = $this->uri->segment(10);       
        $tgl2 = $this->uri->segment(8);
        $tgl_ttd = $this->tukd_model->tanggal_format_indonesia($tgl2);
      //  $ttd1= $_REQUEST['ttd1'];
      //  $ttd2= $_REQUEST['ttd2'];
        $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $judulrka2 = 'Rencana Kerja dan Anggaran';
            $n_trdrka  =   '';
            $kdrka ='RKA';
        


        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
        
        $cRet='';
    $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>$judulrka<br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"25%\" align=\"center\" colspan=\"5\"><strong>NOMOR $kdrka PD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka 1 - PD<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>01</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"5%\" align=\"center\"><strong>4</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>
                  <table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                  <tr>
                                        <td><strong>&emsp;Urusan Pemerintahan</strong></td>
                                        <td ><strong>: </strong></td>
                                        <td><strong> $kd_urusan1 - $nm_urusan1</strong></td>
                                    </tr>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $sql1="select a.kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where kd_skpd ='$id' AND LEFT(a.kd_skpd,4) = LEFT (b.kd_urusan, 4)
                 group by left(kd_kegiatan,4),kd_skpd,nm_urusan";
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
       $Xret1.="
                    
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$urus - $nm_urus</strong></td>
                    </tr>";
                }

       $Xret2.= "
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_skpd - $nm_skpd</strong></td>
                    </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>$judulrka2<br>Pendapatan Perangkat Daerah</strong></td>
                    </tr>
                    </table>";          
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";
                
 

                $sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,6)='00.001' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.001'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,6)='00.001' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                            a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,6)='00.001' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==' '){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
                    
                }

                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";
        $cRet    .= "</table>";
     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

                             $cRet .=" 
                                            <tr>
                                            <td></td>
                                                <td align=\"center\">
                                                </td>
                                                <td  align=\"center\" valign=\"top\">
                                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </td>

                                                <td  align=\"center\" valign=\"top\"> 
                                                $daerah, $tgl_ttd
                                                    <br>$jabatan1
                                                    <br>$jdlnip1 
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>
                                                    <b><u>$nama1</u></b>
                                                    <br>$nip1
                                         </td>
                                                
                                            </tr>";

                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"4\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>
                                </table>";                                       
        $cRet    .= "</table>"; 

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-1</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    } //end preview_rka1
	
	function preview_rka1_all(){
        $id = $this->uri->segment(3);
		$kd_skpd2 = $this->left($id,7);
        $tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE a.kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd1  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip,' ',''))='$ttd1'";
		
				 
				 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd1 - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND left(a.kd_skpd,7)='$kd_skpd2'
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.tvolume AS volume,concat(a.satuan1,if(len(a.satuan2)=0,'',','),a.satuan2,if(len(a.satuan3)=0,'',','),a.satuan3) AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)='$kd_skpd2' AND SUBSTR(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id";
                 
                $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND left(kd_skpd,7)='$kd_skpd2'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 }
				 if ($ttd2==''){
					
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b>$nama2</b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }



							 
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> &nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					}

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        
                
    }
	
	
	
	
    
    
function preview_dppa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttdsetda = $this->uri->segment(7);
        
        $ttd1= $_REQUEST['ttd1'];   
        //$ttd2= $_REQUEST['ttd2'];
        $tgltt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1);
        //$ttd2 = str_replace('a',' ',$ttd2);

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                        <td  colspan=\"8\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>PERANGKAT DAERAH</strong></td>
                        <td  colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPPA - PD 1<br></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;border-bottom: hidden;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong> </td>
                    </tr>    
                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td ><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td ><strong>: $kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong>: $kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td > <strong>: $kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong>: $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"left\"><strong>Latar belakang perubahan/dianggarkan pendapatan dalam APBD :</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan<br>Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td width=\"7%\" rowspan=\"3\"  align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"31%\" rowspan=\"3\"  align=\"center\"><b>Uraian</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Sebelum</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Setelah</b></td>
                            <td width=\"20%\" colspan=\"2\"  align=\"center\"><b>Bertambah/(Berkurang)</b></td>        
                        </tr>
 
                        <tr>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\"  align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"15%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">(Rp.)</td>
                            <td width=\"5%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">%</td>
                        </tr>                            
    
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>

                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9) </td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td colspan=\"12\" style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";
                $angg_n1 = 'nilai';
                $angg_n2 = 'nilai_ubah';
                $rangg_n1 = 'total';        
                $rangg_n2 = 'total_ubah';
                $v1 = 'volume1';
                $v2 = 'volume_ubah1';
                $s1 = 'satuan1';
                $s2 = 'satuan_ubah1';
                $h1 = 'harga1';
                $h2 = 'harga_ubah1';
                
                $sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,6)='00.001' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.001'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga,SUM(a.$angg_n2) AS nilai2,
                            '3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$rangg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$rangg_n2) AS nilai2,
                            '6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,6)='00.001' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,
                            a.$v1 AS volume,a.$s1 AS satuan,a.$h1 AS harga,a.$rangg_n1 AS nilai,
                            a.$v2 AS volume2,a.$s2 AS satuan2,a.$h2 AS harga2,a.$rangg_n2 AS nilai2,
                            '6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,6)='00.001' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                
                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                                                                                 
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        
                        if($rek==' '){ 
                            $uraian='- ' .$row->nama;
                            $volum=$row->volume;
                            $volum2=$row->volume2;                            
                        }else{
                            $uraian=$row->nama;
                            $volum=' ';
                            $volum2=' ';
                        }
                        
                        $sat=$row->satuan;
                        $sat2=$row->satuan2;

                        $nila = $row->nilai;
                        $nila2 = $row->nilai2;
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nila2;
                        }
                        
                        $selisih = $this->rp_minus($nila2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nila2 - $nila)/$nila)*100);
                        }else{
                            if($nila2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 

                        
                        $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                        $hrg2= empty($row->harga2) || $row->harga2 == 0 ? '' :number_format($row->harga2,2,',','.');

                        $nila= number_format($nila,"2",",",".");
                        $nila2= number_format($nila2,"2",",",".");
                        
                        if (strlen($row->rek1)>6) {
                            $bold = "";
                            $fontr = "font-size: ".$font." px;";                        
                        }else{
                            $bold = "font-weight:bold;";
                            $fontr = "font-size: ".$font1." px;";
                        }

                        $cRet    .= " <tr>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$reke</td>                                     
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" > $uraian </td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                     </tr>
                                     ";
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" lign=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>

                                     ";
                    
                }



            
                    $totp=number_format($totp,"2",",",".");
                    $totp2=number_format($totp2,"2",",",".");

                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


        $cRet    .= "</table>";
     $tanggaltt = $this->tanggal_format_indonesia($tgltt);
     if($ttdsetda == '0'){
         $jdlnip3 = '';
         $jabatan3 = '';
         $nama3 = '';
         $pangkat3 = '';
         $nip3='';        
     }else{   
         $jdlnip3 = 'Menyetujui,';
         $jabatan3 = 'Sekretaris';
         $nama3 = 'Dr. M. Zeet Hamdy Assovie, MTM';
         $pangkat3 = 'Pembina Utama';
         $nip3='19620815 1991031011';
     }

     $qtriw = " SELECT distinct isnull( a.triw1_ubah,0) AS triw1,isnull( a.triw2_ubah,0) AS triw2,isnull( a.triw3_ubah,0) 
                                AS triw3,isnull( a.triw4_ubah,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triwa1 = number_format($triw1,2,',','.');
        $triwa2= number_format($triw2,2,',','.');
        $triwa3= number_format($triw3,2,',','.');
        $triwa4= number_format($triw4,2,',','.');
        $totala = number_format($total,2,',','.');

     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;border-left: solid 1px black;font-size:10 px;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"4\">";

                             $cRet .=" 
                                            <tr>
                                                <td width=\"70%\" colspan=\"2\"><br>Rencana Penarikan Dana per Triwulan
                                                <td width=\"30%\" align=\"center\"><br>
                                            </tr>

                                            <tr>

                                                <td width=\"15%\" align=\"left\" valign=\"top\">
                                                    <br>
                                                    <br>Triwulan I
                                                    <br>Triwulan II
                                                    <br>Triwulan III
                                                    <br>Triwulan IV
                                                    <br>
                                                    <br>Jumlah
                                                </td>

                                                <td width=\"35%\" align=\"left\" valign=\"top\">
                                                    <br> 
                                                    <br>: $triwa1
                                                    <br>: $triwa2
                                                    <br>: $triwa3
                                                    <br>: <u>$triwa4&nbsp;&nbsp;</u>+
                                                    <br>
                                                    <br>&nbsp;$totala
                                                </td>
                                                <td width=\"30%\" align=\"center\">$daerah,$tanggaltt<br>
                                                $jdlnip1   
                                                    <br>$jabatan1
                                                    <br>$pangkat1
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u></u>$nama1</b>
                                                    <br>$nip1
                                                </td>
                                            </tr>  
                                </table>";                                       
        $cRet    .= "</table>"; 


      

        
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-1 perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',3);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-1-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
    
        function rp_minus($nilai){
        if($nilai<0){
            $nilai = $nilai * (-1);
            $nilai = '('.number_format($nilai,"2",",",".").')';    
        }else{
            $nilai = number_format($nilai,"2",",","."); 
        }
        
        return $nilai;
    }
    
    function preview_dppa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka1pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Rincian Anggaran Pendapatan Ppejabat Pengelola Keuangan Daerah</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    foreach ($sqltapd->result() as $rowtim)
                    $no=1;
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - ppkd 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENDAPATAN
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
    }
    

    function preview_rka21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttd1x = $this->uri->segment(9);
        $ttd2x = $this->uri->segment(10);
        $statttd = $this->uri->segment(11);
        $tgl2 = $this->uri->segment(8);       
        $tgl_ttd2 = $this->tukd_model->tanggal_format_indonesia($tgl2);
//        $ttd1= $_REQUEST['ttd1'];
  //      $ttd2= $_REQUEST['ttd2'];
                
         $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
       
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $judulrka2 = 'Rencana Kerja dan Anggaran';
            $n_trdrka  =   '';
            $kdrka ='RKA';
       



        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $kd_pd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='$kd_skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

           if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
      
        $k2 = substr($kd_skpd,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>$judulrka<br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR $kdrka PD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka - <br>PD - 2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>
                  <table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                  <tr>
                                        <td><strong>&emsp;Urusan Pemerintahan</strong></td>
                                        <td ><strong>: </strong></td>
                                        <td><strong> $kd_urusan1 - $nm_urusan1</strong></td>
                                    </tr>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $sql1="select a.kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where kd_skpd ='$id' AND LEFT(a.kd_skpd,4) = LEFT (b.kd_urusan, 4)
                 group by left(kd_kegiatan,4),kd_skpd,nm_urusan";
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
       $Xret1.="
                    
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$urus - $nm_urus</strong></td>
                    </tr>
                    ";
                    }
       $Xret2.= "<tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_pd - $nm_skpd</strong></td>
                    </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>$judulrka2<br>Belanja Tidak Langsung Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"6\"></td>
                         </tr>
                     </tfoot>   
                        ";


            IF ($id == 'ppkd'){                    
                $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and a.total<>0
                            ) 
                        a ORDER BY a.rek1,a.id";
            }else{
                if($id == 'ppkd1'){
                    $sql1="SELECT * FROM(
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
                            union all
                            
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id 
                            FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,6)='00.002' and substring(a.no_trdrka,34,3) not in ('514','515')
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        
                            UNION ALL 
                            SELECT 0 header, a.no_urut [no_po],RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) in ('514','515') and a.total<>0
                            union all
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) not in ('514','515') 
                            ) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
                }else{
                    $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' ) 
                        a ORDER BY a.rek1,a.id";
                }
            }       

                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    }
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
                    
                }


                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";

                    $cRet .="   <tr>
                                    <td  width=\"100%\" align=\"left\" colspan=\"6\">
                                        <table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;
                                                &emsp;&emsp;&emsp;&emsp;&emsp;
                                                $daerah, $tgl_ttd2
                                            </tr>
                                            <tr>
                                                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\" valign=\"top\">
                                                    <br>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><ins></ins></b>
                                                    <br>
                                                    <br>
                                                </td>
                                                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\">$jdlnip1  
                                                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1 
                                                </td>
                                            </tr>
                                        </table>
                                    </td>       
                                </tr>";
                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>";                                       

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <tr>
                    <td style=\"border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"left\" colspan=\"6\">
                    <table  border=\"0\" width=\"100%\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    </table>
                    </td>       
                </tr>                    
                </table>";    

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-21</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA21.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

	
	function preview_rka21_all(){
        $id = $this->uri->segment(3);
		$kd_skpd2 = $this->left($id,7);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
		$sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(a.kd_skpd,7)='$kd_skpd2' GROUP BY kd_u";
       // $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE left(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH </td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND left(a.kd_skpd,7)='$kd_skpd2'
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511'
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND left(a.kd_skpd,7)='$kd_skpd2'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.tvolume AS volume,concat(a.satuan1,if(len(a.satuan2)=0,'',','),a.satuan2,if(len(a.satuan3)=0,'',','),a.satuan3) AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)='$kd_skpd2' AND SUBSTR(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND left(kd_skpd,7)='$kd_skpd2'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
				 if ($ttd2==''){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b>$nama2</b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }

                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                    $no=$no+1;               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
	
	
	
	
	
   
    
    function preview_dppa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);

       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $tglt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1); 
        $ttd2 = str_replace('a',' ',$ttd2);        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan1 = str_replace('PENGGUNA','',$jabatan1);
                    $jabatan1 = str_replace('ANGGARAN','',$jabatan1);
                    $jabatan1 = str_replace('Pengguna','',$jabatan1);
                    $jabatan1 = str_replace('Anggaran','',$jabatan1);
 
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan2 = str_replace('PENGGUNA','',$jabatan2);
                    $jabatan2 = str_replace('ANGGARAN','',$jabatan2);

                    $jabatan2 = str_replace('Pengguna','',$jabatan2);
                    $jabatan2 = str_replace('Anggaran','',$jabatan2);
 
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td colspan=\"2\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SKPD</strong></td>
                         <td colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"6\" align=\"center\"><strong>FORMULIR DPPA - <br>PD - 2.1</strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Latar belakang penyempurnaan/dianggarkan dalam penyempurnaan APBD</strong></td>
                    </tr>          
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >

                     <tr>
                        <td rowspan=\"3\"  width=\"5%\" align=\"center\"><b>KODE REKENING</b></td>                            
                        <td rowspan=\"3\"  width=\"21%\" align=\"center\"><b>Uraian</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Setelah Perubahan</b></td>
                        <td colspan=\"2\"  width=\"15%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                     </tr>
                        <tr>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"10%\" align=\"center\">(Rp.)</td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"5%\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
                            
                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10-6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"12\"></td>
                         </tr>
                     </tfoot>   
                        ";
/*
                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id a";
*/

            IF ($id == $this->ppkd){                    
                $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,                         
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan, 
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_ubah1 AS volume_ubah1,
                            a.satuan1 AS satuan,
                            a.satuan_ubah1 AS satuan_ubah1,
                            a.harga1  AS harga,
                            a.harga_ubah1 AS harga_ubah1,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            0 AS volume_ubah,
                            '' AS satuan,
                            '' AS satuan_ubah,
                            0  AS harga,
                            0 AS harga_ubah,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002'
                            ) 
                        a ORDER BY a.rek1,a.id";
            }else{
                if($id == $this->ppkd1){
                    $sql1="SELECT * FROM(
                            SELECT
                                0 header,
                                0 no_po,
                                LEFT (a.kd_rek5, 1) AS rek1,
                                LEFT (a.kd_rek5, 1) AS rek,
                                b.nm_rek1 AS nama,
                                0 AS volume,
                                0 as volume_ubah,
                                ' ' AS satuan,
                                ' ' AS satuan_ubah,
                                0 AS harga,
                                0 AS harga_ubah,
                                SUM (a.nilai) AS nilai,
                                SUM (a.nilai_ubah) AS nilai_ubah,
                                '1' AS id
                            FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT
                0 header,
                0 no_po,
                LEFT (a.kd_rek5, 2) AS rek1,
                LEFT (a.kd_rek5, 2) AS rek,
                b.nm_rek2 AS nama,
                0 AS volume,
                0 AS volume_ubah,
                ' ' AS satuan,
                ' ' AS satuan_ubah,
                0 AS harga,
                0 AS harga_ubah,
                SUM (a.nilai) AS nilai,
                SUM (a.nilai_ubah) AS nilai_ubah,
                '2' AS id
                            FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT
                    0 header,
                    0 no_po,
                    LEFT (a.kd_rek5, 3) AS rek1,
                    LEFT (a.kd_rek5, 3) AS rek,
                    b.nm_rek3 AS nama,
                    0 AS volume,
                    0 AS volume_ubah,
                    ' ' AS satuan,
                    ' ' AS satuan_ubah,
                    0 AS harga,
                    0 AS harga_ubah,
                    SUM (a.nilai) AS nilai,
                    SUM (a.nilai_ubah) AS nilai_ubah,
                    '3' AS id           
                            FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT
                        0 header,
                        0 no_po,
                        LEFT (a.kd_rek5, 5) AS rek1,
                        LEFT (a.kd_rek5, 5) AS rek,
                        b.nm_rek4 AS nama,
                        0 AS volume,
                        0 AS volume_ubah,
                        ' ' AS satuan,
                        ' ' AS satuan_ubah,
                        0 AS harga,
                        0 AS harga_ubah,
                        SUM (a.nilai) AS nilai,
                        SUM (a.nilai_ubah) AS nilai_ubah,
                        '4' AS id
                    
                            FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                        SELECT
                            0 header,
                            0 no_po,
                            a.kd_rek5 AS rek1,
                            a.kd_rek5 AS rek,
                            b.nm_rek5 AS nama,
                            0 AS volume,
                            0 AS volume_ubah,
                            ' ' AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM (a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id
                                                    


                            FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
                            union all
                            
                            SELECT * FROM (SELECT
                                        b.header,
                                        b.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        ' ' AS rek,
                                        b.uraian AS nama,
                                        0 AS volume,
                                        0 AS volume_ubah,
                                        ' ' AS satuan,
                                        ' ' AS satuan_ubah,
                                        0 AS harga,
                                        0 AS harga_ubah,
                                        SUM (a.total) AS nilai,
                                        SUM (a.total_ubah) AS nilai_ubah,
                                        '6' AS id
                                    
                            FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,6)='00.002' and substring(a.no_trdrka,34,3) not in ('514','515')
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        
                            UNION ALL 
                            SELECT
                                    0 header,
                                    a.no_urut [no_po],
                                    RIGHT (a.no_trdrka, 7) AS rek1,
                                    '' AS rek,
                                    a.penerima + ' ,alamat:' + a.alamat AS nama,
                                    0 AS volume,
                                    0 AS volume_ubah,
                                    '' AS satuan,
                                    '' AS satuan_ubah,
                                    0 AS harga,
                                    0 AS harga_ubah,
                                    a.total AS nilai,
                                    a.total_ubah AS nilai_ubah,
                                    '6' AS id
                                
                            FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) in ('514','515')
                            union all
                            SELECT
                                        a.header,
                                        a.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        '' AS rek,
                                        a.uraian AS nama,
                                        a.volume1 AS volume,
                                        a.volume_ubah1 AS volume_ubah1,
                                        a.satuan1 AS satuan,
                                        a.satuan_ubah1 AS satuan_ubah1,
                                        a.harga1 AS harga,
                                        a.harga_ubah1 AS harga_ubah1,
                                        a.total AS nilai,
                                        a.total_ubah AS nilai_ubah,
                                        '6' AS id
                                    
                            
                            FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) not in ('514','515') 
                            ) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
                }else{
                    $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan, 
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_ubah1 AS volume_ubah1,
                            a.satuan1 AS satuan,
                            a.satuan_ubah1 AS satuan_ubah1,
                            a.harga1  AS harga,
                            a.harga_ubah1 AS harga_ubah1,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' ) 
                        a ORDER BY a.rek1,a.id";
                }
            }       

                $totp = 0;
                $totps = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                        $volume_ubah=$row->volume_ubah;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                        $volume_ubah=' ';
                    }
                    
                    if ($reke<>''){
                        $volum='';
                        $volume_ubah='';
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                        $volume_ubah=empty($row->volume_ubah) || $row->volume_ubah == 0 ? '' :number_format($row->volume_ubah,2,',','.');
                    }
                    
                    $sat=$row->satuan;
                    $satuan_ubah=$row->satuan_ubah;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $hrg_ubah= empty($row->harga_ubah) || $row->harga_ubah == 0 ? '' :number_format($row->harga_ubah,2,',','.');
                    $nil_ = $row->nilai;
                    $nil_se_ = $row->nilai_ubah;
                    $nila= number_format($row->nilai,"2",",",".");
                    $nilai_ubah= number_format($row->nilai_ubah,"2",",",".");
                    
                    $ab = $nil_se_ - $nil_;
                    $jml1 = $this->rp_minus($ab);
                    
                    if($nil_ != 0 AND $nil_se_ !=0){
                        $persen = (($nil_se_-$nil_)/$nil_)*100;
                        $persen1 = $this->rp_minus($persen);
                    }else if($nil_ == 0 AND $nil_se_ ==0){
                        $persen = 0;
                        $persen1 = $this->rp_minus($persen);
                    } else {
                        $persen = 100;
                        $persen1 = $this->rp_minus($persen);
                    }
                    
                    
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                       $totps = $totps +  $row->nilai_ubah;
                    }
                    
                    

                    
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" > $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volume_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$satuan_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nilai_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$jml1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$satuan_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nilai_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jml1</strong></td>
                                      <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persen1</strong></td>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     
                                     </tr>
                                     ";
                    
                }


                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   $totps=number_format($totps,"2",",",".");
                   
    $qtriw = "SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_ubah,0) AS triwa1,isnull( a.triw2_ubah,0) AS triwa2,isnull( a.triw3_ubah,0) AS triwa3,isnull( a.triw4_ubah,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,6)='00.002' AND $a$skpd$b='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id'";

        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
                            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
                            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
                            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
            $triwa3= 0;
            $triwa4= 0;
            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
        $triwa3= number_format($triwa3,2,',','.');
        $triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totps</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $tanggaltt = $this->tanggal_format_indonesia($tglt);
                    $cRet .="   <tr>
                                    <td  width=\"100%\" align=\"left\" colspan=\"12\">
                                        <table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\"><br>Rencana Penarikan Dana per Triwulan
                                                <td width=\"40%\" align=\"center\"><br>$daerah,$tanggaltt
                                            </tr>
                                            <tr>
                                                <td width=\"10%\" align=\"left\">Triwulan I<br>
                                                    Triwulan II<br>
                                                    Triwulan III<br>
                                                    Triwulan IV<br>
                                                    <br> 
                                                    Total<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\">: Rp $triwa1<br>
                                                    : Rp $triwa2<br>
                                                    : Rp $triwa3<br>
                                                    : <u>Rp $triwa4&nbsp;&nbsp;</u>+<br>
                                                    <br> 
                                                    : Rp $totala<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\">$jdlnip1  
                                                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$pangkat1
                                                    <br>$nip1 
                                                </td>
                                            </tr>
                                        </table>
                                    </td>       
                                </tr></table>";



        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-21-perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-21-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
    
    function preview_dppa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka21pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";    
                    $no=$no+1;           
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA TIDAK LANGSUNG
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka22_all(){
        $id = $this->uri->segment(3);
        $kd_skpd2 = $this->left($id,7);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
		$sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(a.kd_skpd,7)='$kd_skpd2' GROUP BY kd_u";
                  $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE LEFT(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE LEFT(kd_skpd,7)='$kd_skpd2' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 22  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td width=\"100%\" align=\"center\" colspan=\"2\">Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"36%\" align=\"center\"><b>Tahun n</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Tahun n+1</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Belanja Pegawai</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Barang & Jasa</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Modal</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT
						  a.kd_program AS prog,
						  a.kd_program AS prog1,
						  ' ' AS giat,
						  b.nm_program AS uraian,
						  ' ' AS lokasi,
						  ' 'AS target,
						  SUM(IF(LEFT(x.kd_rek5,3)='521',x.nilai,0)) AS bljpeg,
						  SUM(IF(LEFT(x.kd_rek5,3)='522',x.nilai,0)) AS bljbrg,
						  SUM(IF(LEFT(x.kd_rek5,3)='523',x.nilai,0)) AS bljmdl,
						  SUM(x.nilai) AS jumlah
						FROM
						  trdrka x
						  LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
						  INNER JOIN m_prog b ON a.kd_program1=b.kd_program
						WHERE
						  RIGHT(a.kd_program,2)<>'00' AND
						  LEFT(x.kd_skpd,7)='$kd_skpd2'
						GROUP BY
						  a.kd_program

						UNION

						SELECT
						  a.kd_program AS prog,
						  ' ' AS prog1,
						  a.kd_kegiatan AS giat,
						  a.nm_kegiatan AS uraian,
						  ' ' AS lokasi,
						  ' 'AS target,
						  SUM(IF(LEFT(x.kd_rek5,3)='521',x.nilai,0)) AS bljpeg,
						  SUM(IF(LEFT(x.kd_rek5,3)='522',x.nilai,0)) AS bljbrg,
						  SUM(IF(LEFT(x.kd_rek5,3)='523',x.nilai,0)) AS bljmdl,
						  SUM(x.nilai) AS jumlah
						FROM
						  trdrka x
						  LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
						  INNER JOIN m_prog b ON a.kd_program1=b.kd_program
						WHERE
						  RIGHT(a.kd_program,2)<>'00' AND
						  LEFT(x.kd_skpd,7)='$kd_skpd2'
						GROUP BY
						  a.kd_kegiatan

						ORDER BY prog,giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }
                
                $sql1="SELECT kd_skpd ,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND  LEFT(kd_skpd,7)='$kd_skpd2') AS bljpeg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND  LEFT(kd_skpd,7)='$kd_skpd2')  AS bljbrg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND  LEFT(kd_skpd,7)='$kd_skpd2') AS bljmdl,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_skpd='$id' and LEFT(kd_rek5,2)='52' ) AS jumlah 
						FROM trdrka WHERE LEFT(kd_skpd,7)='$kd_skpd2' GROUP BY kd_skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                   
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }
		
		if ($ttd2==''){
					
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"10\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"10\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br>$nama2
                				<br>NIP. $nip2 
								</td>
								
								
								
								
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
                          
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"10\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"10\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
				 $cRet    .= "</table>";      
				 
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
                    
            
        
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
	

    
    function preview_dppa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        
        $ttd1= $_REQUEST['ttd1'];
        //$ttd2= $_REQUEST['ttd2'];
        $tgltt= $_REQUEST['tgl_ttd'];

        $ttd1 = str_replace('a',' ',$ttd1); 
       // $ttd2 = str_replace('a',' ',$ttd2);     
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;

                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       
     
        
        $cRet='';

     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"66%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPPA - PD <br><h3>2.2</h3></strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>";        

      


       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td > <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA LANGSUNG BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode<br>Program</b></td>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode<br>Kegiatan</b></td>  
                            <td width=\"20%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"11%\"  rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:9px;\"  align=\"center\"><b>Target Kinerja (Kuantitatif)</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"22%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td width=\"15%\" colspan=\"2\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Sebelum</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Setelah</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">(Rp)</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">%</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">9 = 8 - 7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">10</td>
                         </tr>
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"10\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT 
                            a.kd_program AS prog,
                            a.kd_program AS prog1,
                            ' ' AS giat,
                            a.nm_program AS uraian,
                            ' ' AS lokasi,
                            ' ' AS target,
                            '' [sumber_dana],
                            isnull(sum(nilai),0) [susun],isnull(sum(nilai_ubah),0) [nilai2]
                        FROM
                            trdrka x
                        LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
                        AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                            RIGHT (a.kd_program, 2) <> '00'
                        AND left(x.kd_skpd,7) = left('$id',7)
                        GROUP BY
                            a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                                a.kd_program AS prog,
                                ' ' AS prog1,
                                a.kd_kegiatan AS giat,
                                a.nm_kegiatan AS uraian,
                                a.lokasi AS lokasi,
                                a.tk_kel_ubah AS target,
                                isnull(x.sumber,'') [sumber_dana],
                                isnull(sum(nilai),0) [susun],isnull(sum(nilai_ubah),0) [nilai2] 
                            FROM
                                trdrka x
                                LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
                            WHERE
                                RIGHT(a.kd_program,2)<>'00' AND
                                left(x.kd_skpd,7)=left('$id',7)
                            GROUP BY
                                a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel_ubah,a.triw1,a.triw2,a.triw3,a.triw4,x.sumber 
                                            ORDER BY prog,giat  
                        ";
  

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giatx=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $nilai = $row->susun;
                    $nilai2 = $row->nilai2;
                    $selisih = $nilai2-$nilai;
                    if($nilai != 0){
                        $persen = (($nilai2-$nilai)/$nilai)*100;
                    }else{
                        $persen = 100;
                    } 
                    //iif(apbdsusun <> 0 ,((abs(apbdubah-apbdsusun))/apbdsusun)*100,100) 
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $totnilai = $totnilai +  $nilai;
                        $tnilai2 = $tnilai2 + $nilai2;
                        $tselisih = $tselisih + $selisih;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $nilai1 = number_format($nilai,2,',','.');
                    $nilai2a = number_format($nilai2,2,',','.');
                    $selisih = $this->rp_minus($selisih);
                    $persen = $this->rp_minus($persen);

                      $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  align=\"left\">$prog</td>                                     
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$giatx</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$target</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai2a</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$persen</td>
                                    </tr> 
                                    
                                   
                                    ";
 
                }

                if($totnilai != 0){
                    $tpersen = (($tnilai2-$totnilai)/$totnilai)*100;
                }else{
                    $tpersen = 100;
                } 
 
                $totnilai = number_format($totnilai,2,',','.');
                $tnilai2 = number_format($tnilai2,2,',','.');
                $tselisih = $this->rp_minus($tselisih);
                $tpersen = $this->rp_minus($tpersen);
                
                 $cRet    .= " <tr>
                                    <td colspan=\"6\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totnilai</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tnilai2</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tselisih</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tpersen</td>
                                </tr>
                                 ";
            

 
$tanggaltt = $this->tanggal_format_indonesia($tgltt);


                             $cRet .="<tr>
                                        <td colspan=\"10\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"center\">$daerah,$tanggaltt</td>
                                                </tr>
                                                <tr>
                                                    <td align=\"center\" valign=\"top\">
                                                        <br>
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><ins></ins></b>
                                                        <br>
                                                        <br> 
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\" valign=\"top\">&nbsp;&nbsp;
                                                        <br>&nbsp;&nbsp;&nbsp;
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b>&nbsp;&nbsp;&nbsp;&nbsp;</b>
                                                        <br>&nbsp;&nbsp;&nbsp;&nbsp;
                                                        <br>&nbsp;&nbsp;&nbsp;
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\">$jdlnip1  
                                                        <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><u>$nama1</u></b>
                                                        <br>$pangkat1
                                                        <br>$nip1 
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";


        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-22 perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-22-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
    
    function preview_dppa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Masuk </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='61' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dpa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENGELUARAN PEMBIAYAAN  </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='72' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='72'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='72'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='72'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='72'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='72') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 3.2  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Keluar</strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='62' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    
    function daftar_kegiatan($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);  
		//pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan/$id");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= "400";//$config['per_page'];  
		$offset         		= $this->uri->segment(4);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list', $data);
	}
    
     function daftar_kegiatan_ubah($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);  
		//pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan/$id");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= "400";//$config['per_page'];  
		$offset         		= $this->uri->segment(4);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan Ubah');
		$this->template->load('template', 'anggaran/rka/list_ubah', $data);
	}
    
    function daftar_kegiatan1($offset=0)
    {
        $id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
        
        $total_rows = $this->rka_model->get_count($id);
  
        // pagination        
 
        $config['base_url']     = site_url("rka/daftar_kegiatan1/$id");
        $config['total_rows']   = $total_rows;
        $config['per_page']     = '10';
        $config['uri_segment']  = 3;
        $config['num_links']    = 5;
        $config['full_tag_open'] = '<ul class="page-navi">';
        $config['full_tag_close'] = '</ul>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="current">';
        $config['cur_tag_close'] = '</li>';
        $config['prev_link'] = '&lt;';
        $config['prev_tag_open'] = '<li>';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&gt;';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_link'] = 'Last';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['first_link'] = 'First';
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $limit                  = $config['per_page'];  
        $offset                 = $this->uri->segment(4);  
        $offset                 = ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
          
        if(empty($offset))  
        {  
            $offset=0;  
        }
    
        $data['list']       = $this->rka_model->getAll($limit, $offset,$id);
        $data['num']        = $offset;
        $data['total_rows'] = $total_rows;
        $data['kode_skpd'] = $id;
        
                $this->pagination->initialize($config);
        
        $this->template->set('title', 'Master Data kegiatan');
        $this->template->load('template', 'anggaran/rka/list_dpa', $data);
    }
 function daftar_kegiatan_murni($offset=0)
    {
        $id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
        
        $total_rows = $this->rka_model->get_count($id);
  
        // pagination        
 
        $config['base_url']     = site_url("rka/daftar_kegiatan_murni/$id");
        $config['total_rows']   = $total_rows;
        $config['per_page']     = '10';
        $config['uri_segment']  = 3;
        $config['num_links']    = 5;
        $config['full_tag_open'] = '<ul class="page-navi">';
        $config['full_tag_close'] = '</ul>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="current">';
        $config['cur_tag_close'] = '</li>';
        $config['prev_link'] = '&lt;';
        $config['prev_tag_open'] = '<li>';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&gt;';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_link'] = 'Last';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['first_link'] = 'First';
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $limit                  = $config['per_page'];  
        $offset                 = $this->uri->segment(4);  
        $offset                 = ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
          
        if(empty($offset))  
        {  
            $offset=0;  
        }
    
        $data['list']       = $this->rka_model->getAll_murni($limit, $offset,$id);
        $data['num']        = $offset;
        $data['total_rows'] = $total_rows;
        $data['kode_skpd'] = $id;
        
                $this->pagination->initialize($config);
        
        $this->template->set('title', 'Master Data kegiatan');
        $this->template->load('template', 'anggaran/rka/list_rka_murni', $data);
    }
 


 function preview_rka221_murni(){
       $id = $this->uri->segment(3);
       $id2 = substr($id,0,7);
       $giat = $this->uri->segment(4);
       $cetak = $this->uri->segment(5);
       $chkpa = $this->uri->segment(6);
       $cell = $this->uri->segment(7); 
       
        $tgl2= $_REQUEST['tgl_ttd'];
        $ttd1x= $_REQUEST['ttd1'];
        $ttd2x= $_REQUEST['ttd2'];
        $ttd1=  str_replace('x',' ',$ttd1x);
        $ttd2=  str_replace('x',' ',$ttd2x);
        $tgl_ttd = $this->tukd_model->tanggal_format_indonesia($tgl2);
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            

            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $n_trdrka  =   '';
            $kdrka ='RKA';


        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT kd_org,nm_org FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT kd_urusan1,nm_urusan1 FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

      
      if($chkpa==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttd1' and kode='agr'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttd2'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nipx=$rowttd->nip;                    
                    $namax= $rowttd->nm;
                    $jabatanx  = $rowttd->jab;
                }
                 
         $sqlorg="SELECT left(a.kd_skpd,1)kd_urusan1,o.nm_urusan1,f.kd_urusan,f.nm_urusan,f.kd_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,z.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,rtrim(d.sumber) [sumber] ,a.sasaran_giat,a.ang_lalu, a.ang_depan,a.waktu_giat FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN m_prog z ON a.kd_program=z.kd_program
								INNER JOIN ms_urusan1 o ON left(a.kd_skpd,1)=o.kd_urusan1
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
                f.nm_urusan,
                a.kd_skpd,
                e.nm_skpd,
                a.kd_program,
                z.nm_program,
                a.kd_kegiatan,
                c.nm_kegiatan,
                a.tu_capai,
                a.tu_mas,
                a.tu_kel,
                a.tu_has,
                a.tk_capai,
                a.tk_mas,
                a.tk_kel,
                a.tk_has,
                a.lokasi,
                d.sumber,
                a.sasaran_giat,
                a.ang_lalu,a.waktu_giat,o.nm_urusan1,a.ang_depan";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_urusan1=$roworg->kd_urusan1;                    
                    $nm_urusan1= $roworg->nm_urusan1;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                    $wak_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;
                    $ang_depan = $roworg->ang_depan;

                    
                }
        $kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
        $nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
        $kd_urusan1= empty($roworg->kd_urusan1) || ($roworg->kd_urusan1) == '' ? '' : ($roworg->kd_urusan1);
        $nm_urusan1= empty($roworg->nm_urusan1) || ($roworg->nm_urusan1) == '' ? '' : ($roworg->nm_urusan1);
        $nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
        $kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
        $nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
        $kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
        $nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
        $lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
        $tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
        $tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
        $tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
        $tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
        $tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
        $tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
        $tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
        $tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
        $sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
        $ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);
        $ang_depan= empty($roworg->ang_depan) || ($roworg->ang_depan) == '' || ($roworg->ang_depan) == 'Null' ? 0 : ($roworg->ang_depan);
        $wak_giat= empty($roworg->waktu_giat) || ($roworg->waktu_giat) == '' || ($roworg->waktu_giat) == 'Null' ? '' : ($roworg->waktu_giat);
        $sumber= empty($roworg->sumber) || ($roworg->sumber) == '' || ($roworg->sumber) == 'Null' ? '' : ($roworg->sumber);
        $org = substr($kd_skpd,0,7);
        switch($sumber){
            case 'DAU';
                $sumber = 'Dana Alokasi Umum (DAU)';
            break;
            case 'PAD';
                $sumber = 'Pendapatan Asli Daerah (PAD)';
            break;            
            case 'DAK';
                $sumber = 'Dana Alokasi Khusus (DAK)';
            break;           
        }
        
  
       $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",",",".");
                   $totp1 =number_format($rowb->totb*1.1,"2",",",".");
                }
                $ang_lalu =number_format($roworg->ang_lalu,"2",",",".");
                $ang_depan =number_format($roworg->ang_depan,"2",",",".");


		$sqlsum="select sumber,sumber_2,
						case
						when sumber is null and sumber_2 is null then ''
						when sumber ='' and sumber_2 is not null then sumber_2
						when sumber is null and sumber_2 is not null then sumber_2
						when sumber=sumber_2 then sumber
						when sumber_2 is null and sumber is not null then sumber
						when sumber is not null and sumber_2 is not null then 
						rtrim(sumber)+', '+rtrim(sumber_2) end as sumber_dana 
						from(
						select top 1 kd_kegiatan,sumber,
						(select top 1 sumber from trdrka where kd_kegiatan ='$giat' and len(sumber) > 2
						group by sumber
						order by sumber desc) as sumber_2
						from trdrka where kd_kegiatan ='$giat'
						group by kd_kegiatan,sumber
						order by sumber asc
						)x
						order by sumber";

                 $sqlsum=$this->db->query($sqlsum);
                 foreach ($sqlsum->result() as $rowbx)
                {
					//$sumberxxx=$rowbx->sumber_dana;
					$sumberxxx= empty($rowbx->sumber_dana) || ($rowbx->sumber_dana) == '' || ($rowbx->sumber_dana) == NULL ? '' : ($rowbx->sumber_dana);
					//$sumberxxx = $rowbx->sumber_dana;
				}
				
        $cRet='';

 
        $k2 = substr($id,0,7);
        $k3 = substr($kd_prog,-2,2);
        $k4 = substr($kd_giat,19,3);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"66%\" align=\"center\" colspan=\"7\" ><strong>$judulrka<br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:14;border-left: solid 1px black; border-bottom: solid 1px black;\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka - SKPD <br>2.1<br></strong></td>

                    </tr>

                   
                    <tr>
                         <td align=\"center\" width=\"20%\" style=\"border-top: solid 1px black;\"><strong>&nbsp;</strong> </td>
                         <td align=\"center\" colspan=\"7\" width=\"80%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                        <td align=\"center\" width=\"20%\" style=\"border-bottom: solid 1px black;\"><strong>&nbsp;</strong> </td>
                         <td align=\"center\" colspan=\"7\" width=\"80%\" style=\"border-bottom: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td style=\"border-left:solid 1px black;\"  width=\"20%\"><strong>&nbsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\"><strong>&nbsp;Sub Urusan</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\"><strong>&nbsp;Organisasi</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\"> <strong>$org - $nm_org</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Program</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">$kd_prog   - $nm_prog</td>
                    </tr>
                    <tr><td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Kegiatan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">
						
						<table width=\"100%\" border:none;>
						<tr>
							<td align=\"left\" width=\"27%\">$kd_giat - </td>
							<td align=\"left\">$nm_giat</td>
						</tr>
						</table>
						</td>
                    </tr> 
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Lokasi Kegiatan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">$lokasi</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun<br>&nbsp;n-1</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">Rp $ang_lalu</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun<br>&nbsp;n 1</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">Rp $totp</td>
                    </tr>
                    <tr>
                        <td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun<br>&nbsp;n+1</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">Rp $ang_depan</td>
                    </tr>
                    <tr><td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;</td>
                        <td width=\"3%\" align=\"center\"></td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\"></td>
                    </tr>
                    <tr><td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Waktu Pelaksanaan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">$wak_giat</td>                      
                    </tr>
					<tr><td style=\"border-left:solid 1px black;\" width=\"20%\" align=\"left\">&nbsp;Sumber Dana</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td style=\"border-right:solid 1px black;\" colspan=\"7\" width=\"77%\" align=\"left\">$sumberxxx</td>
                    </tr>
                </table>";         
 
        $cRet .= "<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"9\"  align=\"center\">Indikator & Tolok Ukur Kinerja Belanja</td>
                    </tr>";
        $cRet .="<tr>
                 <td colspan=\"2\" align=\"center\">Indikator </td>
                 <td colspan=\"3\" align=\"center\">Tolok Ukur Kinerja </td>
                 <td colspan=\"4\" align=\"center\">Target Kinerja </td>
                </tr>";       
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Dampak Sasaran</td>
                    <td colspan=\"3\">$tu_capai</td>
                    <td colspan=\"4\">$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Hasil Program</td>
                    <td colspan=\"3\">$tu_has</td>
                    <td colspan=\"4\">$tk_has</td>
                  </tr>";
        /*$cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Masukan </td>
                    <td colspan=\"3\">$tu_mas</td>
                    <td colspan=\"4\">Rp. $totp </td>
                </tr>";*/
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Keluaran Kegiatan</td>
                    <td colspan=\"3\">$tu_kel</td>
                    <td colspan=\"4\">$tk_kel</td>
                  </tr>";
        
        $cRet .= "<tr>
                    <td colspan=\"9\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"9\" align=\"center\">Rincian Anggaran Belanja<br>menurut Program dan Per Kegiatan Satuan Kerja Perangkat Daerah</td>
                  </tr>";
                    
        $cRet .="</table>";


        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE<br>REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" colspan=\"3\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td colspan=\"2\" style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: solid 1px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: solid 1px black; border-bottom: none;border-right: none;border-left: none;\" colspan=\"9\"></hr></td>
                         </tr>
                     </tfoot>   
                        ";

                $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.nilai != 0 and a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL  
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume2,' ' AS satuan2, 0 AS harga2,isnull(SUM(a.total_sempurna),0) AS nilai2,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' and nilai <> 0
                        UNION ALL 
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume2,a.satuan_sempurna1 AS satuan2, a.harga_sempurna1 AS harga2,
                        a.total_sempurna AS nilai2,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null) and a.total != 0
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                $totbl = 0;
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $nopo = $row->no_po;
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :$row->volume;

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilaibl = empty($row->nilai)  ? 0 : $row->nilai;
                    
                    if(strlen($row->rek1) <= '5' ){
                        $bold = 'font-weight:bold;';
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                    }else{
                        $bold ='';
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    if(strlen($row->rek1) == '1' ){
                        $totbl = $totbl + $nilaibl;
                    }            
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;$bold $lbawah $latas  \" width=\"40%\">&nbsp;$uraian</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"center\">$sat</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;$bold $lbawah $latas \" width=\"14%\" align=\"right\">$hrg</td>
                                     <td colspan=\"3\" style=\"vertical-align:top;$bold $lbawah $latas \" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                             
                }

                   $totbl=number_format($totbl,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$totbl</strong></td>
                                     </tr>";

                             $cRet .="
                                        <tr>
                                        <td colspan=\"9\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"50%\" colspan=\"2\">&emsp;
                                                    <td width=\"10%\" >
                                                </tr>
                                                <tr>
                                                    <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\" valign=\"top\">&nbsp;
                                                    <br>&nbsp;
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><ins>&nbsp;</ins></b>
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    </td>
                                                    <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\">$daerah, $tgl_ttd 
                                                    <br>Mengesahkan,
                                                    <br>$jabatanx
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$namax</u></b>
                                                    <br>$nipx
                                                   </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                            
                                    ";

   
        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        
        $tapdy = "";
		$tapdx ="
		
		
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Keterangan</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">:</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Tanggal Pembahasan</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">:</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Catatan Hasil<br>pembahasan</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">:</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">1.</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">&nbsp;</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">2.</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">&nbsp;</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"8\" align=\"left\">&nbsp;</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px white;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"9\" align=\"center\">Tim Anggaran Pemerintah Daerah:</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\">No</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">Nama</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">Nip</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">Jabatan</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">TTD</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\">1</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\">2</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
                     </tr>
					 <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
						<td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" align=\"center\">&nbsp;</td>
                     </tr>
		
		";

        $cRet  .=" 
                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"9\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                     </tr>

                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"9\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;
                            <table border=\"0\" width=\"100%\">
                                <tr>
                                    <td width=\"15%\" align=\"left\">&emsp;Triwulan I</td>
                                    <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                                    <td width=\"10%\" align=\"right\">&emsp;$triw1</td>
                                    <td width=\"65%\" align=\"left\">&emsp;</td>

                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan II</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw2</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan III</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw3</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan IV</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"right\">&emsp;Jumlah</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$total</td>
                                    <td align=\"left\">&emsp;</td>

                                </tr>                           
                            </table>
                        </td>
                     </tr>
                    
                    
                    $tapdy
                    
                </table>";    

                                                                       
                $jdla=$giat;
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-2.2.1</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA-221-$jdla.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;
               $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'0');
        break;
        
        }    
    } 
//end ctk_rka221_murni 
    
function preview_rka221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        
        $bidang = $this->session->userdata('kdskpd');
        $cek = explode(".",$bidang);
        $ckbid = $cek[3];
        $nmbid = "";                
        $idss = substr($bidang,0,7);
        
        /*if($ckbid=="00"){
           $id = $id;
           $nmbid = "";     
           $whree = "a.kd_subkegiatan='$giat'";
        }else{
           $id = $id;                                             
           $sql = $this->db->query("select nm_bidang from ms_bidang where kd_bidskpd='$bidang'")->row();
           $sqll = $sql->nm_bidang;
           $nmbid = $sqll;
           $cek1 = substr($giat,0,4);
           $cek2 = substr($giat,16,8);
           $ck = $cek1.".".$bidang.".".$cek2;
           //$whree = "SUBSTRING(a.kd_bidsubkegiatan,6,10)='$ck'"; 
           $whree = "a.kd_bidsubkegiatan='$ck'";          
        }*/ 
        
        $id = $id;
        $nmbid = "";     
        $whree = "a.kd_kegiatan='$giat'";
        $nmbid = strtoupper($nmbid);        
        
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = '';//$this->tanggal_format_indonesia($tgl_ttd);
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE left(kd_skpd,7)= '$idss' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip; 
                    $pangkat=$rowttd->pangkat;
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE left(kd_skpd,7)= '$idss' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;
                    $pangkat2=$rowttd2->pangkat;
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
                
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,d.sumber,a.sasaran_giat,a.ang_lalu FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where $whree 
                GROUP BY f.kd_urusan,
				f.nm_urusan,
				a.kd_skpd,
				e.nm_skpd,
				a.kd_program,
				a.nm_program,
				a.kd_kegiatan,
				c.nm_kegiatan,
				a.tu_capai,
				a.tu_mas,
				a.tu_kel,
				a.tu_has,
				a.tk_capai,
				a.tk_mas,
				a.tk_kel,
				a.tk_has,
				a.lokasi,
				d.sumber,
				a.sasaran_giat,
				a.ang_lalu";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                  //  $kd_subgiat  = $roworg->kd_subkegiatan;
                  //  $nm_subgiat  = $roworg->nm_subkegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                }
		$kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
		$nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
		$kd_skpd= empty($roworg->kd_skpd) || ($roworg->kd_skpd) == '' ? '' : ($roworg->kd_skpd);
		$nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
		$kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
		$nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
		$kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
		$nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
        //$kd_subgiat= empty($roworg->kd_subkegiatan) || ($roworg->kd_subkegiatan) == '' ? '' : ($roworg->kd_subkegiatan);
		//$nm_subgiat= empty($roworg->nm_subkegiatan) || ($roworg->nm_subkegiatan) == '' ? '' : ($roworg->nm_subkegiatan);
		$lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
		$tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
		$tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
		$tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
		$tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
		$tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
		$tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
		$tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
		$tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
		$sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
		$ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);
        
        $n_status = $this->get_status2($bidang);
        $field= 'a.'.$n_status;
        $sqltp="SELECT SUM($field) AS totb FROM trdrka a WHERE $whree AND a.kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",".",",");
                   $totp1 =number_format($rowb->totb*1.1,"2",".",",");
                }
                
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                         <td colspan=\"4\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 221  </strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"4\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"4\" align=\"center\"><strong>".strtoupper($kab)."</strong> </td>
                    </tr>
                    <tr>
                         <td colspan=\"4\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td colspan=\"6\" align=\"left\">
						<table border=\"0\">
					<tr>
						<td colspan=\"1\"  align=\"left\">&nbsp;Urusan Pemerintahan</td>
						<td colspan=\"5\"  align=\"left\">: $kd_urusan - $nm_urusan</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Organisasi</td>
						<td colspan=\"5\" align=\"left\">: $kd_skpd   - $nm_skpd</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Program</td>
						<td colspan=\"5\" align=\"left\">: $kd_prog   - $nm_prog</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Kegiatan</td>
						<td colspan=\"5\" align=\"left\">: $kd_giat   - $nm_giat</td>
					</tr>
                    <tr>
                    	<td colspan=\"1\" align=\"left\">&nbsp;</td>
						<td colspan=\"5\" align=\"left\"></td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Lokasi Kegiatan</td>
						<td colspan=\"5\" align=\"left\">: $lokasi</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Jumlah Tahun n - 1</td>
						<td colspan=\"5\" align=\"left\">: Rp. ".number_format($ang_lalu,"2",".",",")." (".$this->rka_model->terbilang($ang_lalu*1)." rupiah)</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Jumlah Tahun</td>
						<td colspan=\"5\" align=\"left\">: Rp. $totp (".$this->rka_model->terbilang($rowb->totb*1)." rupiah)</td>
					</tr>
					<tr>
						<td colspan=\"1\" align=\"left\">&nbsp;Jumlah Tahun n + 1</td>
						<td colspan=\"5\" align=\"left\">: Rp. $totp1 (".$this->rka_model->terbilang($rowb->totb*1.1)." rupiah)</td>
					</tr>
						</table>
						
					</td>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belanja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td colspan=\"2\" align=\"center\">Indikator </td>
                 <td colspan=\"2\" align=\"center\">Tolak Ukur Kerja </td>
                 <td colspan=\"2\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Capaian Program </td>
                    <td colspan=\"2\">$tu_capai</td>
                    <td colspan=\"2\">$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Masukan </td>
                    <td colspan=\"2\">$tu_mas</td>
                    <td colspan=\"2\">Rp. $totp </td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Keluaran </td>
                    <td colspan=\"2\">$tu_kel</td>
                    <td colspan=\"2\">$tk_kel</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Hasil </td>
                    <td colspan=\"2\">$tu_has</td>
                    <td colspan=\"2\">$tk_has</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                          <thead>                 
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
                    </thead> 
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\"  align=\"center\">&nbsp; </td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" >&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" >&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" >&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" >&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" >&nbsp;</td></tr>
                        ";
                 
                 if($n_status=='nilai'){
                    $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume2,' ' AS satuan2, 0 AS harga2,isnull(SUM(a.total_sempurna),0) AS nilai2,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume2,a.satuan_sempurna1 AS satuan2, a.harga_sempurna1 AS harga2,
                        a.total_sempurna AS nilai2,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null)
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 }else{
                    $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM($field) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM($field) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM($field) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM($field) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM($field) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total_sempurna) AS nilai,0 AS volume2,' ' AS satuan2, 0 AS harga2,isnull(SUM(a.total_sempurna),0) AS nilai2,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume_sempurna1 AS volume,a.satuan_sempurna1 AS satuan,
                        a.harga_sempurna1 AS harga,a.total_sempurna AS nilai,a.volume_sempurna1 AS volume2,a.satuan_sempurna1 AS satuan2, a.harga_sempurna1 AS harga2,
                        a.total_sempurna AS nilai2,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null)
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 }           
                        
                 
                 
                    $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$totp</td></tr>
									 </table>";
                  
                         $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";

				 $kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				 if ((($kd_ttd=='01') && ($kd_kepala!='1.20.03'))){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$pangkat2 
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
         $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> 1. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 2. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 3. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 4. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					}

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
		$judul='RKA-221_'.$id.'';
		switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
		case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $kd_giat-$nm_giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 0;  
		 echo ("<title>RKA 221</title>");
			echo($cRet);
        break;
        }
	}
	
	
	
	
	
	   function preview_dppa221_ubah(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $statttd = $this->uri->segment(6);
        $tang= $_REQUEST['tgl_ttd'];
        $tanggal = $this->tanggal_format_indonesia($tang);
        $tanggalhariini = date('d - M - Y');
        $ttdpa=  str_replace('x',' ',$_REQUEST['ttd1']);
        $ttdpax= str_replace('x',' ',$_REQUEST['ttd2']);
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }

                $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($date);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        if($statttd==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdpa'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdpa'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.waktu_giat,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,
                a.tu_mas,a.tu_kel,a.tu_has,a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.lokasi,d.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd,f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.waktu_giat,d.sumber";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    //$nm_giatx  = str_replace('/',' ',$roworg->nm_kegiatan);
                    $lokasi  = $roworg->lokasi;
                    $tk_has  = $roworg->tk_has;
                    $tu_capai= $roworg->tu_capai;
                    $tu_mas = $roworg->tu_mas;
                    $tu_kel = $roworg->tu_kel;
                    $tu_has = $roworg->tu_has;
                    $tk_capai = $roworg->tk_capai;
                    $tk_mas = $roworg->tk_mas;
                    $tk_kel = $roworg->tk_kel;
                    $tk_has_ubah  = $roworg->tk_has_ubah;
                    $tu_capai_ubah= $roworg->tu_capai_ubah;
                    $tu_mas_ubah = $roworg->tu_mas_ubah;
                    $tu_has_ubah = $roworg->tu_has_ubah;
                    $tu_kel_ubah = $roworg->tu_kel_ubah;
                    $tk_capai_ubah = $roworg->tk_capai_ubah;
                    $tk_mas_ubah = $roworg->tk_mas_ubah;
                    $tk_kel_ubah = $roworg->tk_kel_ubah;
                    $org = substr($kd_skpd,0,7);
                    $waktu_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;
                    
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN</strong></td>
                         <td colspan=\"6\" align=\"center\"><strong>NOMOR DPA PD</strong></td>
                         <td rowspan=\"4\" colspan=\"3\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPPA - PD<br>2.2.1  </strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>PERANGKAT DAERAH</strong></td>
                         <td align=\"center\">$kd_urusan</td>
                         <td colspan=\"2\" align=\"center\">$org</td>
                         <td align=\"center\">00</td>
                         <td align=\"center\">5</td>
                         <td align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Urusan Pemerintahan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_urusan - $nm_urusan</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Organisasi</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$org - $nm_org</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Program</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_prog - $nm_prog</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_giat - $nm_giat<br></td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Waktu Pelaksanaan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$waktu_giat</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Lokasi Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$lokasi</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;\" align=\"left\">Sumber Dana</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;\" align=\"left\">:&nbsp;$sumber</td>
                         </tr>
                        
                    ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>
                 </table>";


        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                <thead>                       
                        <tr><td rowspan=\"2\" colspan=\"2\" width=\"20%\" align=\"center\"><b>Indikator</b></td>                            
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Tolak Ukur Kerja </b></td>
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Target Kinerja</b></td>
                        </tr>
                        <tr>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Perubahan</b></td>                            
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Capaian Program</td>
                            <td colspan=\"3\" align=\"center\">$tu_capai</td>
                            <td colspan=\"2\" align=\"center\">$tu_capai_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_capai</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Masukan</td>
                            <td colspan=\"3\" align=\"center\">$tu_mas</td>
                            <td colspan=\"2\" align=\"center\">$tu_mas_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_mas</td>
                            <td colspan=\"2\" align=\"center\">$tk_mas_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Keluaran</td>
                            <td colspan=\"3\" width=\"20%\" align=\"center\">$tu_kel</td>
                            <td colspan=\"2\" width=\"20%\" align=\"center\">$tu_kel_ubah</td>
                            <td colspan=\"3\" width=\"20%\" align=\"center\">$tk_kel</td>
                            <td colspan=\"2\" width=\"20%\" align=\"center\">$tk_kel_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Hasil</td>
                            <td colspan=\"3\" align=\"center\">$tu_has</td>
                            <td colspan=\"2\" align=\"center\">$tu_has_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_has</td>
                            <td colspan=\"2\" align=\"center\">$tk_has_ubah</td>
                        </tr>
                     </thead>
                ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"12\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN BELANJA LANGSUNG<br>PROGRAM DAN PERKEGIATAN PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">12</td>                        
                        </tr> 
                     </thead>

                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume_u,' ' AS satuan_u, 0 AS harga_u,isnull(SUM(a.total_ubah),0) AS nilai_u,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' 
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u, a.harga_ubah1 AS harga_u,
                        a.total_ubah AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null)
                        and (a.total_ubah != 0 or a.total !=0)
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
               //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.'); 
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    $volum_u= empty($row->volume_u) || $row->volume_u == 0 ? '' :number_format($row->volume_u,2,',','.');                   
                    $nila= number_format($row->nilai,"2",".",",");                    
               //     $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;\" align=\"right\">&nbsp;</td>
                                                                  </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                </tr>";
                 }                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Penarikan Dana per Triwulan</td>
                            </tr>";
                 
               
                          
        $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1_ubah AS triw1,triw2_ubah AS triw2,triw3_ubah AS triw3,triw4_ubah AS triw4 ,(triw1_ubah+triw2_ubah+triw3_ubah+triw4_ubah) AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
        $qtriw1=$this->db->query($qtriw);
                 foreach ($qtriw1->result() as $rowtriw)
                {
                    $resttriw1= empty($rowtriw->triw1) || $rowtriw->triw1 == 0 ? '' :number_format($rowtriw->triw1,2,',','.');
                    $resttriw2= empty($rowtriw->triw2) || $rowtriw->triw2 == 0 ? '' :number_format($rowtriw->triw2,2,',','.');
                    $resttriw3= empty($rowtriw->triw3) || $rowtriw->triw3 == 0 ? '' :number_format($rowtriw->triw3,2,',','.');
                    $resttriw4= empty($rowtriw->triw4) || $rowtriw->triw4 == 0 ? '' :number_format($rowtriw->triw4,2,',','.');                    
                    $resttriw5= empty($rowtriw->jumlah) || $rowtriw->jumlah == 0 ? '' :number_format($rowtriw->jumlah,2,',','.');                    
                }


               $cRet .="<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">
                                <table border=\"0\">
                                <tr>
                                <td width=\"150px\" align=\"left\">&nbsp;<br>
                                &nbsp;<br>
                                Triwulan I<br>
                                Triwulan II<br>
                                Triwulan III<br>
                                Triwulan IV <br>
                                &nbsp;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah    
                                </td>
                                <td width=\"100px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                &nbsp;<br>
                                Rp  
                                </td>
                                <td width=\"200px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                $resttriw1<br>
                                $resttriw2<br>
                                $resttriw3<br>
                                $resttriw4<br>
                                ---------------------------------------------<br>
                                $resttriw5                          
                                </td>
                                <td width=\"650px\"  colspan=\"3\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br>
                                &nbsp;  
                                </td>
                                <td width=\"400px\" colspan=\"3\" align=\"center\">
                                $daerah ,$tanggal 
                                <br>
                                Mengesahkan,
                                <br>
                                $jabatan
                                &nbsp;<br>
                                <br><br><br>&nbsp;
                                <u>$nama</u><br>
                                NIP.$nip
                                </td>
                              <td>&nbsp;</td>
                              </tr>
                              </table></td></tr>
                                ";
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 3;
             $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'1');
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221-PERUBAHAN-$giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 0;
                echo ("<title>DPPA 221</title>");
                echo($cRet);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        break;
        
        }
        
                
    }
	
	function preview_rka221_all(){
        $id = $this->uri->segment(3);
        //$giat = $this->uri->segment(4);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        //echo"$giat";
        //$sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
//                 $sqlskpd=$this->db->query($sqldns);
//                 foreach ($sqlskpd->result() as $rowdns)
//                {
//                   
//                    $kd_urusan=$rowdns->kd_u;                    
//                    $nm_urusan= $rowdns->nm_u;
//                    $kd_skpd  = $rowdns->kd_sk;
//                    $nm_skpd  = $rowdns->nm_sk;
//                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
				
		 $sqltps="SELECT TOP 2 kd_kegiatan from trdrka where kd_skpd='$id'  ";
                 $sqlbs=$this->db->query($sqltps);
                 foreach ($sqlbs->result() as $rowbs)
                {
                   $giat = $rowbs->kd_kegiatan;
				  
                		
				
				
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber,a.sasaran_giat FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
				f.nm_urusan,
				a.kd_skpd,
				e.nm_skpd,
				a.kd_program,
				a.nm_program,
				a.kd_kegiatan,
				c.nm_kegiatan,
				a.tu_capai,
				a.tu_mas,
				a.tu_kel,
				a.tu_has,
				a.tk_capai,
				a.tk_mas,
				a.tk_kel,
				a.tk_has,
				a.lokasi,
				a.sumber,
				a.sasaran_giat";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                }
        $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",".",",");
                   $totp1 =number_format($rowb->totb*1.1,"2",".",",");
                }
                
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 221  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Jumlah Tahun n - 1<br>&nbsp;
								Jumlah Tahun <br>&nbsp;
								<br> &nbsp;
								Jumlah Tahun n + 1
								<br>
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								<br>
								: $lokasi<br>
								: Rp.<br>
								: Rp. $totp (".$this->rka_model->terbilang($rowb->totb)." rupiah)<br>
								: Rp. $totp1 (".$this->rka_model->terbilang($rowb->totb*1.1)." rupiah)
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belanja Langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td>$tu_capai</td>
                    <td>$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td>$tu_mas</td>
                    <td>$tk_mas</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td>$tu_kel</td>
                    <td>$tk_kel</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td>$tu_has</td>
                    <td>$tk_has</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                                          
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
						GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
						 UNION ALL 
						 SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
						 UNION ALL  
						 SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
						 UNION ALL 
						 SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
						 UNION ALL 
						 SELECT a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY a.kd_rek5,b.nm_rek5
						 UNION ALL 
						 SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
						a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :$row->volume;

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                  
                 
                 if ($ttd2==''){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							$cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
               if($no<=4)
					{
					 for ($i = $no; $i <= 4; $i++) 
					  {
						$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
						}                                                   
				}
        
                    

        $cRet .=       " </table>";
				}
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }


	


	

    
    
    function daftar_kegiatan2($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dppa', $data);
	}
    
 function preview_dppa221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $statttd = $this->uri->segment(6);
        $tang= $_REQUEST['tgl_ttd'];
        $tanggal = $this->tanggal_format_indonesia($tang);
        $tanggalhariini = date('d - M - Y');
        $ttdppkd=  str_replace('123456789',' ',$_REQUEST['ttd1']);
        $ttdpa= str_replace('123456789',' ',$_REQUEST['ttd2']);
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }

                $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($date);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        if($statttd==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdppkd'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdpa'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.waktu_giat,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,
                a.tu_mas,a.tu_kel,a.tu_has,a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.lokasi,d.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd,f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.waktu_giat,d.sumber";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tk_has  = $roworg->tk_has;
                    $tu_capai= $roworg->tu_capai;
                    $tu_mas = $roworg->tu_mas;
                    $tu_kel = $roworg->tu_kel;
                    $tu_has = $roworg->tu_has;
                    $tk_capai = $roworg->tk_capai;
                    $tk_mas = $roworg->tk_mas;
                    $tk_kel = $roworg->tk_kel;
                    $tk_has_ubah  = $roworg->tk_has_ubah;
                    $tu_capai_ubah= $roworg->tu_capai_ubah;
                    $tu_mas_ubah = $roworg->tu_mas_ubah;
                    $tu_has_ubah = $roworg->tu_has_ubah;
                    $tu_kel_ubah = $roworg->tu_kel_ubah;
                    $tk_capai_ubah = $roworg->tk_capai_ubah;
                    $tk_mas_ubah = $roworg->tk_mas_ubah;
                    $tk_kel_ubah = $roworg->tk_kel_ubah;
                    $org = substr($kd_skpd,0,7);
                    $waktu_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;
                    
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN</strong></td>
                         <td colspan=\"6\" align=\"center\"><strong>NOMOR DPPA PD</strong></td>
                         <td rowspan=\"4\" colspan=\"3\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPPA - PD<br>2.2.1  </strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>PERANGKAT DAERAH</strong></td>
                         <td align=\"center\">$kd_urusan</td>
                         <td colspan=\"2\" align=\"center\">$org</td>
                         <td align=\"center\">00</td>
                         <td align=\"center\">5</td>
                         <td align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Urusan Pemerintahan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_urusan - $nm_urusan</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Organisasi</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$org - $nm_org</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Program</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_prog - $nm_prog</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_giat - $nm_giat<br></td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Waktu Pelaksanaan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$waktu_giat</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Lokasi Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$lokasi</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;\" align=\"left\">Sumber Dana</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;\" align=\"left\">:&nbsp;$sumber</td>
                         </tr>
                        
                    ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>
                 </table>";


        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                <thead>                       
                        <tr><td rowspan=\"2\" colspan=\"2\" width=\"20%\" align=\"center\"><b>Indikator</b></td>                            
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Tolak Ukur Kerja </b></td>
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Target Kinerja</b></td>
                        </tr>
                        <tr>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Perubahan</b></td>                            
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Capaian Program</td>
                            <td colspan=\"3\" align=\"center\">$tu_capai</td>
                            <td colspan=\"2\" align=\"center\">$tu_capai_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_capai</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Masukan</td>
                            <td colspan=\"3\" align=\"center\">$tu_mas</td>
                            <td colspan=\"2\" align=\"center\">$tu_mas_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_mas</td>
                            <td colspan=\"2\" align=\"center\">$tk_mas_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Keluaran</td>
                            <td colspan=\"3\" width=\"20%\" align=\"center\">$tu_kel</td>
                            <td colspan=\"2\" width=\"20%\" align=\"center\">$tu_kel_ubah</td>
                            <td colspan=\"3\" width=\"20%\" align=\"center\">$tk_kel</td>
                            <td colspan=\"2\" width=\"20%\" align=\"center\">$tk_kel_ubah</td>
                        </tr>
                        <tr>
                            <td colspan=\"2\" align=\"center\">Hasil</td>
                            <td colspan=\"3\" align=\"center\">$tu_has</td>
                            <td colspan=\"2\" align=\"center\">$tu_has_ubah</td>
                            <td colspan=\"3\" align=\"center\">$tk_has</td>
                            <td colspan=\"2\" align=\"center\">$tk_has_ubah</td>
                        </tr>
                     </thead>
                ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"12\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN BELANJA LANGSUNG<br>PROGRAM DAN PERKEGIATAN PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">12</td>                        
                        </tr> 
                     </thead>

                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT '' as no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u,
                        0 AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1), b.nm_rek1 
                        UNION ALL 
                        SELECT '' as no_po, LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u,
                        0 AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2) ,b.nm_rek2
                        UNION ALL  
                        SELECT '' as no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u,
                        0 AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3) ,b.nm_rek3
                        UNION ALL 
                        SELECT '' as no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u,
                        0 AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                        UNION ALL 
                        SELECT '' as no_po, a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u,
                        0 AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5 ,b.nm_rek5
                        UNION ALL
                        SELECT a.no_po, RIGHT (a.no_trdrka, 7) AS rek1,' ' AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,a.harga1 AS harga,a.total AS nilai,
                        a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id
                        FROM trdpo a where a.kd_kegiatan ='$giat') a ORDER BY a.rek1,a.id ,a.no_po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
               //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.'); 
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    $volum_u= empty($row->volume_u) || $row->volume_u == 0 ? '' :number_format($row->volume_u,2,',','.');                   
                    $nila= number_format($row->nilai,"2",".",",");                    
               //     $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;\" align=\"right\">&nbsp;</td>
                                                                  </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                </tr>";
                 }                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Penarikan Dana per Triwulan</td>
                            </tr>";
                 
               
                          
        $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1_ubah AS triw1,triw2_ubah AS triw2,triw3_ubah AS triw3,triw4_ubah AS triw4 ,(triw1+triw2+triw3+triw4) AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
        $qtriw1=$this->db->query($qtriw);
                 foreach ($qtriw1->result() as $rowtriw)
                {
                    $resttriw1= empty($rowtriw->triw1) || $rowtriw->triw1 == 0 ? '' :number_format($rowtriw->triw1,2,',','.');
                    $resttriw2= empty($rowtriw->triw2) || $rowtriw->triw2 == 0 ? '' :number_format($rowtriw->triw2,2,',','.');
                    $resttriw3= empty($rowtriw->triw3) || $rowtriw->triw3 == 0 ? '' :number_format($rowtriw->triw3,2,',','.');
                    $resttriw4= empty($rowtriw->triw4) || $rowtriw->triw4 == 0 ? '' :number_format($rowtriw->triw4,2,',','.');                    
                    $resttriw5= empty($rowtriw->jumlah) || $rowtriw->jumlah == 0 ? '' :number_format($rowtriw->jumlah,2,',','.');                    
                }


               $cRet .="<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">
                                <table border=\"0\">
                                <tr>
                                <td width=\"150px\" align=\"left\">&nbsp;<br>
                                &nbsp;<br>
                                Triwulan I<br>
                                Triwulan II<br>
                                Triwulan III<br>
                                Triwulan IV <br>
                                &nbsp;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah    
                                </td>
                                <td width=\"100px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                &nbsp;<br>
                                Rp  
                                </td>
                                <td width=\"200px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                $resttriw1<br>
                                $resttriw2<br>
                                $resttriw3<br>
                                $resttriw4<br>
                                ---------------------------------------------<br>
                                $resttriw5                          
                                </td>
                                <td width=\"650px\"  colspan=\"3\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br>
                                &nbsp;  
                                </td>
                                <td width=\"400px\" colspan=\"3\" align=\"center\">
                                $daerah ,$tanggal 
                                <br>
                                Mengesahkan,
                                <br>
                                $jabatan
                                &nbsp;<br>
                                <br><br><br>&nbsp;
                                <u>$nama</u><br>
                                NIP.$nip
                                </td>
                              <td>&nbsp;</td>
                              </tr>
                              </table></td></tr>
                                ";
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 0;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221-PERUBAHAN-$giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka31(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 31  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENERIMAAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='61') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Penerimaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);            
               
    }
    
    function preview_rka32(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENGELUARAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2) ='62') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
       
    }
    
    function preview_perda1dns(){
      
      
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    function tes(){

            $data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            $lc = "select kd_skpd,nm_skpd from ms_skpd order by kd_skpd";
            $query = $this->db->query($lc);
            $data["skpd"]=$query->result();
            
        
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/tes',$data);
        
                
    }
    
     function preview_perda1(){
       $id = $this->uri->segment(3);
       
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
         function preview_perda1pdf(){
       $id = $this->uri->segment(3);
      
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
           
      
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>BUPATI/WALIKOTA,
      							<p>&nbsp;</p>
                				<br>JAKA SONJAYA
                				<br>NIP. 30707
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
    function preview_perda1_skpd(){
      $id = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
      // echo "$cetak";
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                /*
                $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                $query3 = $this->db->query($sql3);
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
              
        
        */
        
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA'); 
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perda1_skpd',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perda1_skpd', $data);
        break;
        }
        
                
    }
    
         function preview_perda1_skpdpdf(){
 $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>BUPATI/WALIKOTA,
      							<p>&nbsp;</p>
                				<br>JAKA SONJAYA
                				<br>NIP. 30707
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    
    
    function preview_perdaII(){
        $kd_skpd = $this->session->userdata('kdskpd');
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">TIDAK LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND kd_skpd='$kd_skpd') AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND kd_skpd='$kd_skpd') AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND kd_skpd='$kd_skpd') AS jumlah FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 WHERE b.kd_skpd ='$kd_skpd' GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION                        
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd='$kd_skpd') AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd='$kd_skpd') AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd='$kd_skpd') AS jumlah  FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan WHERE b.kd_skpd ='$kd_skpd' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd='$kd_skpd') AS pendapatan,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd='$kd_skpd') AS btl, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd='$kd_skpd')AS jumlah FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd ='$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->pendapatan,"2",".",",");
                    $btl= number_format($row->btl,"2",".",",");
                    $bl= number_format($row->bl,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaII',$data);
        
                
    }
    
    function preview_perdaIIpdf(){
       $kd_skpd = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">TIDAK LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">LANGSUNG</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                 
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"38%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND kd_skpd='$kd_skpd') AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND kd_skpd='$kd_skpd') AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND kd_skpd='$kd_skpd') AS jumlah FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 WHERE b.kd_skpd ='$kd_skpd' GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION                        
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd='$kd_skpd') AS pendapatan
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd='$kd_skpd') AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd='$kd_skpd') AS jumlah  FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan WHERE b.kd_skpd ='$kd_skpd' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd='$kd_skpd') AS pendapatan,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd='$kd_skpd') AS btl, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd='$kd_skpd')AS jumlah FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd ='$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->pendapatan,"2",".",",");
                    $btl= number_format($row->btl,"2",".",",");
                    $bl= number_format($row->bl,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaII',$data);
        
                
    }
    
    function preview_perdaIII(){
      $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,a.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a 
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,a.nm_kegiatan 
                        UNION 
                        SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION 
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->kd_rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,a.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a 
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,a.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->kd_rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,a.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai FROM trskpd a 
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(len(a.kd_program))) WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,a.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,a.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a 
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,a.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,a.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a 
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,a.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->kd_rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,a.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a 
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,a.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->kd_rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                 }  
                  
                  //$netto=$cob3-$cob4; 
//                  if ($netto < 0){
//                	$a1="(";
//                	$suplus=$netto*-1;
//                	$b1=")";}
//                  else {
//                	$a1="";
//	                $b1="";}
//                 $nett=number_format($netto,2,',','.');  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
//                    $silpa=($cob1+$cob3)-($cob+$cob4);
//                     if ($silpa < 0){
//                	$c1="(";
//                	$silpa=$silpa*-1;
//                	$d1=")";}
//                    else {
//                	$c1="";
//	                $d1="";}
//                 $silp=number_format($silpa,2,',','.');                  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
       
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaIII',$data);
        
                
    }
    
    function preview_perdaIIIpdf(){
      $id = $this->session->userdata('kdskpd');//$this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                               
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT '' AS kd_rek,UPPER(c.nm_kegiatan) AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->kd_rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->kd_rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(len(a.kd_program))) WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                
                /*
                $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                $sqlbl=$this->db->query($sqltbl);
                foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 */
                 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
                  
                    
                 /*
                 $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->kd_rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->kd_rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                 }
                 */  
                  
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        
                
    }
    
    function preview_perdaIV(){
        $kd_skpd = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd='$kd_skpd') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd='$kd_skpd')AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd='$kd_skpd') AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_kegiatan,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_kegiatan,4)=a.kd_urusan WHERE b.kd_skpd='$kd_skpd' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd= '$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00' AND b.kd_skpd='$kd_skpd' GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00' AND b.kd_skpd='$kd_skpd' GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        ) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->bpeg,"2",".",",");
                    $btl= number_format($row->bbj,"2",".",",");
                    $bl= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaIV',$data);
        
                
    }
    

    function preview_perdaIVpdf(){
        $kd_skpd = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH BELANJA</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                    </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd='$kd_skpd') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd='$kd_skpd')AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd='$kd_skpd') AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$kd_skpd') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_kegiatan,1)=a.kd_urusan1 
                        where kd_skpd='$kd_skpd' GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_kegiatan,4)=a.kd_urusan WHERE b.kd_skpd='$kd_skpd' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd= '$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00' AND b.kd_skpd='$kd_skpd' GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00' AND b.kd_skpd='$kd_skpd' GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        ) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->bpeg,"2",".",",");
                    $btl= number_format($row->bbj,"2",".",",");
                    $bl= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaIV',$data);
        
                
    }
    
    function preview_perdaV(){
        $kd_skpd = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">LAINNYA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi WHERE a.kd_skpd='$kd_skpd' GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd='$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=number_format($row->bbtl,"2",".",",");
                    $bppkd= number_format($row->bppkd,"2",".",",");
                    $bpeg= number_format($row->bpeg,"2",".",",");
                    $bbj= number_format($row->bbj,"2",".",",");
                    $bm= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perdaV',$data);
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
    function preview_perdaVpdf(){
        $kd_skpd = $this->session->userdata('kdskpd');
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">LAINNYA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                    </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi WHERE a.kd_skpd='$kd_skpd' GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd='$kd_skpd' GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=number_format($row->bbtl,"2",".",",");
                    $bppkd= number_format($row->bppkd,"2",".",",");
                    $bpeg= number_format($row->bpeg,"2",".",",");
                    $bbj= number_format($row->bbj,"2",".",",");
                    $bm= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        $this->_mpdf('',$cRet,10,10,10,1);
        //$this->template->load('template','anggaran/rka/perdaV',$data);
    }
    
    
    function preview_perkada(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PENJABARAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH (Rp.)</b></td>
                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>PENJELASAN</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"17%\" bgcolor=\"#CCCCCC\" align=\"center\">URAIAN</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">VOLUME</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">SATUAN</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">HARGA</td>
                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">TOTAL</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                                       
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                 $sql1="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='4'  ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                  
                 $sql2="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='51'  ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql3="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='52'  ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Belanja </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                   
                   /*                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $bljpm1=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql4="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='61'  ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                                     
                
        
                  }
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                  }                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 
                 
                 $sql5="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='62'  ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $netto=$bljpm1-$bljpk1;
                   if ($netto < 0){
                	$x1="(";
                	$netto=$netto*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $net=number_format($netto,2,',','.');  
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$net$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
        
        */
        
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    //function preview_perkada(){
//         $id = $this->uri->segment(3);
//         $cetak = $this->uri->segment(4);
//        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
//                 $sqlskpd=$this->db->query($sqldns);
//                 foreach ($sqlskpd->result() as $rowdns)
//                {
//                   
//                    $kd_urusan=$rowdns->kd_u;                    
//                    $nm_urusan= $rowdns->nm_u;
//                    $kd_skpd  = $rowdns->kd_sk;
//                    $nm_skpd  = $rowdns->nm_sk;
//                }
//       
//        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
//                 $sqlsclient=$this->db->query($sqlsc);
//                 foreach ($sqlsclient->result() as $rowsc)
//                {
//                   
//                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
//                    $kab     = $rowsc->kab_kota;
//                    $daerah  = $rowsc->daerah;
//                    $thn     = $rowsc->thn_ang;
//                }
//        
//        
//        $cRet='';
//        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
//                    <tr>
//                         <td align=\"center\"><strong>$kab</strong></td>
//                         
//                    </tr>
//                    <tr>
//                         <td align=\"center\"><strong>PENJABARAN APBD </strong></td>
//                    </tr>
//                    
//                    <tr>
//                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
//                    </tr>
//
//                  </table>";
//        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
//                    <tr>
//                        <td width=\"20%\">Urusan Organisasi </td>
//                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
//                    </tr>
//                    <tr>
//                        <td>Organisasi</td>
//                        <td>:$kd_skpd - $nm_skpd</td>
//                    </tr>
//                    
//                </table>";  
//        
//        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
//                     <thead>                       
//                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>KODE REKENING</b></td>                            
//                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>                            
//                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>JUMLAH (Rp.)</b></td>
//                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>PENJELASAN</b></td>                            
//                            </tr>
//                        <tr>
// 		                     <td width=\"17%\" bgcolor=\"#CCCCCC\" align=\"center\">URAIAN</td>
//                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">VOLUME</td>
//                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">SATUAN</td>
//                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">HARGA</td>
//                             <td width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">TOTAL</td>
//                        </tr>    
//                     </thead>
//                     <tfoot>
//                        <tr>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>  
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>                                                       
//                         </tr>
//                     </tfoot>
//                    
//                     
//                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">&nbsp;</td>                            
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>                            
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
//                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
//                        ";
//                        
//                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
//                 $sqlp=$this->db->query($sqltp);
//                 foreach ($sqlp->result() as $rowp)
//                {
//                   $pend=number_format($rowp->totp,"2",".",",");
//                    $cob1=$rowp->totp;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pendapatan Daerah</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 } 
//                 //$sql1="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
////                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
////                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
////                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
////                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
////                        UNION ALL
////                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '5' AS nu,no_po AS po FROM trdpo
////                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,1)='4') a ORDER BY kd_rek,nu,po";
////                 
////                 $query = $this->db->query($sql1);
//                 $var = array("$id");
//                 $sql="call sql_perkada4(?) ";
//                 
//                 $query = $this->db->query($sql,$var);
//                 //$query = $this->skpd_model->getAllc();
//                                                  
//                foreach ($query->result() as $row)
//                {
//                    $kode=$row->kd_rek1;
//                    $nama=$row->nm_rek;                    
//                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
//                    $uraian=$row->uraian;
//                    $volume=$row->volume;
//                    $satuan=$row->satuan; 
//                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
//                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
//                   
//                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
//                                     ";
//                
//        
//                  }
//                  
//                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Pendapatan</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                $query->free_result();                                       
//                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
//                 $sqlb=$this->db->query($sqltb);
//                 foreach ($sqlb->result() as $rowb)
//                {
//                   $blj=number_format($rowb->totb,"2",".",",");
//                    //$cob1=$rowp->totp;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Daerah</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 }
//                 
//                 $sqltbtl="SELECT SUM(nilai) AS totbtl FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
//                 $sqlbtl=$this->db->query($sqltbtl);
//                 foreach ($sqlbtl->result() as $rowbtl)
//                {
//                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
//                    //$cob1=$rowp->totp;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Tidak Langsung</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbtl</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 } 
//                  
//                 //$sql2="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
////                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
////                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
////                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
////                        UNION ALL
////                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
////                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='51'
////                        ) a ORDER BY kd_rek,nu,po";
////                 
////                 $query1 = $this->db->query($sql2);
//                 $sql1="call sql_perkada_51(?) ";
//                 
//                 $querybtl = $this->db->query($sql1,$var);
//                 //$query = $this->skpd_model->getAllc();
//                                                  
//                foreach ($querybtl->result() as $row)
//                {
//                    $kode=$row->kd_rek1;
//                    $nama=$row->nm_rek;                    
//                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
//                    $uraian=$row->uraian;
//                    $volume=$row->volume;
//                    $satuan=$row->satuan; 
//                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
//                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
//                   
//                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
//                                     ";
//                
//        
//                  }
//                  $querybtl->free_result();
//                 $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
//                 $sqlbl=$this->db->query($sqltbl);
//                 foreach ($sqlbl->result() as $rowbl)
//                {
//                   $bljbl=number_format($rowbl->totbl,"2",".",",");
//                    //$cob1=$rowp->totp;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Langsung</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbl</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 }
//                 
//                // $sql3="SELECT * FROM (SELECT a.kd_program AS kd_rek, a.kd_program AS kd_rek1,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trskpd a INNER JOIN m_prog c ON a.kd_program1=c.kd_program
////                        LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(len(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_program,c.nm_program 
////                        UNION ALL
////                        SELECT a.kd_kegiatan AS kd_rek,a.kd_kegiatan AS kd_rek1,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
////                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
////                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
////                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'5' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
////                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'6' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
////                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
////                        UNION ALL
////                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total,'7' AS nu,no_po AS po FROM trdpo
////                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='52'
////                        ) a ORDER BY kd_rek,nu,po";
////                 
////                 $query2 = $this->db->query($sql3);
////                 //$query = $this->skpd_model->getAllc();
//                 $sql2="call sql_perkada_bl(?) ";
//                 
//                 $querybl = $this->db->query($sql2,$var);
//                                                  
//                foreach ($querybl->result() as $rowbl)
//                {
//                    $kode=$rowbl->kd_rek1;
//                    $nama=$rowbl->nm_rek;                    
//                    $nilai= empty($rowbl->nilai) || $rowbl->nilai == 0 ? '' :number_format($rowbl->nilai,2,',','.');
//                    $uraian=$rowbl->uraian;
//                    $volume=$rowbl->volume;
//                    $satuan=$rowbl->satuan; 
//                    $harga= empty($rowbl->harga) || $rowbl->harga == 0 ? '' :number_format($rowbl->harga,2,',','.');
//                    $total= empty($rowbl->total) || $rowbl->total == 0 ? '' :number_format($rowbl->total,2,',','.');
//                   
//                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
//                                     ";
//                
//        
//                  }
//                  $querybl->free_result();
//                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Belanja </td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                                     
//                 $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
//                 $sqlpm=$this->db->query($sqltpm);
//                 foreach ($sqlpm->result() as $rowpm)
//                {
//                   $bljpm=number_format($rowpm->totpm,"2",".",",");
//                   $bljpm1=$rowpm->totpm;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Masuk</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpm</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                                     
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 }
////                 
////                 $sql4="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
////                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
////                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
////                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
////                        UNION ALL
////                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
////                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='61'
////                        ) a ORDER BY kd_rek,nu,po";
////                 
////                 $query3 = $this->db->query($sql4);
////                 //$query = $this->skpd_model->getAllc();
//                  $sql3="call sql_perkada_61(?) ";
//                 
//                  $query3 = $this->db->query($sql3,$var);                                                  
//                foreach ($query3->result() as $row)
//                {
//                    $kode=$row->kd_rek1;
//                    $nama=$row->nm_rek;                    
//                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
//                    $uraian=$row->uraian;
//                    $volume=$row->volume;
//                    $satuan=$row->satuan; 
//                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
//                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
//                   
//                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
//                                     ";
//                                     
//                
//        
//                  }
//                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                  
//                  $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
//                 $sqlpk=$this->db->query($sqltpk);
//                 foreach ($sqlpk->result() as $rowpk)
//                {
//                   $bljpk=number_format($rowpk->totpk,"2",".",",");
//                   $bljpk1=$rowpk->totpk;
//                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Keluar</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpk</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//                  }                   
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
//                 
////                 
////                 $sql5="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
////                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
////                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
////                        UNION ALL
////                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
////                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
////                        UNION ALL
////                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
////                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='62'
////                        ) a ORDER BY kd_rek,nu,po";
////                 
////                 $query4 = $this->db->query($sql5);
////                 //$query = $this->skpd_model->getAllc();
//                  $sql4="call sql_perkada_62(?) ";
//                 
//                  $query4 = $this->db->query($sql4,$var);                                                  
//                foreach ($query4->result() as $row)
//                {
//                    $kode=$row->kd_rek1;
//                    $nama=$row->nm_rek;                    
//                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
//                    $uraian=$row->uraian;
//                    $volume=$row->volume;
//                    $satuan=$row->satuan; 
//                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
//                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
//                   
//                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
//                                     ";
//                
//        
//                  }
//                  $netto=$bljpm1-$bljpk1;
//                   if ($netto < 0){
//                	$x1="(";
//                	$netto=$netto*-1;
//                	$y1=")";}
//                  else {
//                	$x1="";
//	                $y1="";}
//                 $net=number_format($netto,2,',','.');  
//                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Netto</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$net$y1</td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
//                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
//        $cRet .=       " </table>";
//        $data['prev']= $cRet;
//        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
//        //$this->_mpdf('',$cRet,10,10,10,0);
//        //$this->template->load('template','anggaran/rka/perkadaII',$data);
//        echo $cRet;
//        //switch($cetak){   
////        case 1;
////        $this->_mpdf('',$cRet,10,10,10,1);
////        break;
////        case 0;
////        $this->template->load('template','anggaran/rka/perkadaII',$data);
////        break;
////        case 2;        
////         header("Cache-Control: no-cache, no-store, must-revalidate");
////         header("Content-Type: application/vnd.ms-excel");
////         header("Content-Disposition: attachment; filename=PERDA.xls");
////        $this->load->view('anggaran/rka/perkadaII', $data);
////        break;
////        }
//        
//        //$this->load->view('anggaran/rka/perdaV', $data);
//                
//    }
    
    function preview_perda1_ubah(){
       $id = $this->uri->segment(3);
       $cetak = $this->uri->segment(4);
             
       if ($id <> 'keseluruhan' ) {
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
                
         $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       }
       
       if ($id <> 'keseluruhan') {
           $skpd1 = "and kd_skpd='$id'";
           $skpd2 = " and b.kd_skpd='$id'";
           
       } else {
           $skpd1 = '';
           $skpd2 = '';
            
       }
       
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN I  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        if ($id <> 'keseluruhan') {
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                        <tr>
                            <td width=\"20%\">Urusan Organisasi </td>
                            <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td>Organisasi</td>
                            <td>: $kd_skpd - $nm_skpd</td>
                        </tr>
                    
                    </table>";      
        }
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\" colspan=\"2\" ><b>JUMLAH (Rp.)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        <tr >
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Penyusunan</b></td>
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Perubahan</b></td>                             
                        </tr>  
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                        
               
                   $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='4'  $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='4'  $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='4'  $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
               
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_u,"2",".",",");
                    $rumus1 = $row->nilai_u - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");                                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen1</td>
                                 </tr>";
                }
              
                $sqltp="SELECT SUM(nilai) AS totp,Sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' $skpd1 ";
                
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4   =   number_format($rowp->totp,"2",".",",");
                   $coba4u  =   number_format($rowp->totp_u,"2",".",",");
                   $rumus2  =   $rowp->totp_u - $rowp->totp;                   
                   if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");     
                    $cob1   =$rowp->totp;
                    $cob1u  =$rowp->totp_u;
                    $per2   = ($rumus2!=0)?($rumus2/$rowp->totp) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen2</td>
                                 </tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }
                
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='5' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='5' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='5' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_u,"2",".",",");
                    $rumus3 = $row1->nilai_u - $row1->nilai;
                    if ($rumus3 < 0){
                    	$x1="(";
                    	$rumus3=$rumus3*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total3 = number_format($rumus3,"2",".",",");     
                    $per3   = ($rumus3!=0)?($rumus3 /$row1->nilai ) * 100:0; 
                    $persen3= number_format($per3,"2",".",",");
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen3</td>
                                  </tr>";
                }
                   
                 $sqltb="SELECT SUM(nilai) AS totb,sum(nilai_ubah) as totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' $skpd1 ";                                           
                    
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $coba8  =   number_format($rowb->totb,"2",".",",");
                    $coba8u =   number_format($rowb->totb_u,"2",".",",");
                    $rumus4 =   $rowb->totb_u - $rowb->totb;
                    if ($rumus4 < 0){
                    	$x1="(";
                    	$rumus4=$rumus4*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total4 = number_format($rumus4,"2",".",",");
                    $cob=$rowb->totb;
                    $cobu=$rowb->totb_u;
                    $per4   = ($rumus4!=0)?($rumus4 /$rowb->totb ) * 100:0; 
                    $persen4= number_format($per4,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen4</td>
                                </tr>";
                 } 
                  
                  $suplus=$cob1-$cob;
                  $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surpu$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                   
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(a.kd_rek1,1)='6' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='61' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='61' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                            
                    
                    
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  = $row3->rek;
                    $coba10 = $row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_u,"2",".",",");
                    $rumus5 = $row3->nilai_u - $row3->nilai;
                    if ($rumus5 < 0){
                    	$x1="(";
                    	$rumus5=$rumus5*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total5 = number_format($rumus5,"2",".",",");
                    $per5   = ($rumus5!=0)?($rumus5 /$row3->nilai) * 100:0; 
                    $persen5= number_format($per5,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen5</td>    
                                 </tr>";
                }
                
                    $sqltpm="SELECT SUM(nilai) AS totpm, SUM(nilai_ubah) as totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' $skpd1 ";
                
                
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_u,"2",".",",");
                   $rumus6  = $rowpm->totpm_u - $rowpm->totpm;
                   if ($rumus6 < 0){
                    	$x1="(";
                    	$rumus6=$rumus6*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total6 = number_format($rumus6,"2",".",",");
                   $cob3   =$rowpm->totpm;
                   $cob3u  =$rowpm->totpm_u;
                   $per6   = ($rumus6!=0)?($rumus6 /$rowpm->totpm) * 100:0; 
                   $persen6= number_format($per6,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen6</td>
                                </tr>";
                }
                
                $sql4="sELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(a.kd_rek2,2)='62' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(a.kd_rek3,2)='62' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                    
                
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13  = $row4->rek;
                    $coba14  = $row4->nm_rek;
                    $coba15  = number_format($row4->nilai,"2",".",",");
                    $coba15u = number_format($row4->nilai_u,"2",".",",");
                    $rumus7  = $row4->nilai_u - $row4->nilai;
                    if ($rumus7 < 0){
                    	$x1="(";
                    	$rumus7=$rumus7*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total7 = number_format($rumus7,"2",".",",");
                   $per7   = ($rumus7!=0)?($rumus7 /$row4->nilai) * 100:0; 
                   $persen7= number_format($per7,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen7</td>
                                 </tr>";
                }
             
                    $sqltpk="SELECT SUM(nilai) AS totpk, SUM(nilai) as totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' $skpd1 ";    

                
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_u,"2",".",",");
                   $rumus8  = $rowpk->totpk_u - $rowpk->totpk;
                   if ($rumus8 < 0){
                    	$x1="(";
                    	$rumus8=$rumus8*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total8 = number_format($rumus8,"2",".",",");
                   $cob4=$rowpk->totpk;
                   $cob4u=$rowpk->totpk_u;
                   $per8   = ($rumus8!=0)?($rumus8 /$rowpk->totpk) * 100:0; 
                   $persen8= number_format($per8,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen8</td>
                                </tr>";
                 }  
                  
                  $netto=$cob3-$cob4;
                  $nettou=$cob3u-$cob4u; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.'); 
                 if ($nettou < 0){
                	$a1="(";
                	$nettou=$nettou*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettu=number_format($nettou,2,',','.');
                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nett$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nettu$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                    if ($silpa < 0){
                    	$c1="(";
                    	$silpa=$silpa*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silp=number_format($silpa,2,',','.');
                    $silpau=($cob1u+$cob3u)-($cobu+$cob4u);
                    if ($silpau < 0){
                    	$c1="(";
                    	$silpau=$silpau*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silpu=number_format($silpau,2,',','.');                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"40%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silp$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silpu$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                  </tr>
                                  ";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet         .= "</table>";
        $data['prev']  = $cRet;
        $data['sikap'] = 'preview';
        if ($id <> 'keseluruhan') {
            $judul         = 'Laporan APBD Perubahan lampI - '.$kd_skpd;
        } else {
            $judul         = 'Laporan APBD Perubahan lampI - Keseluruhan';
        }
        
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN I');    
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perda_1_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
                
    }
    
    function preview_perdaII_ubah($cetak=0){
        //$cetak =   $this->uri->segment(3);           
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                
        $cRet  ='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN II  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"4\"><b>PENDAPATAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"54%\" align=\"center\" colspan=\"8\"><b>BELANJA</b></td>
                        </tr>
                        <tr>
 		                    <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                        </tr>
                        <tr>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" >&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,a.kd_urusan1 AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,a.kd_urusan AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan WHERE len(kd_urusan) <> '1' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, a.nm_skpd AS nama,a.kd_skpd AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_skpd a ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,a.nm_skpd
                        UNION
                        SELECT '' AS kode, 'JUMLAH' AS nama,'JUMLAH' AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' ) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51') AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1) a ORDER BY a.urut
                        ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   =$row->kode;
                    $nama   =$row->nama;
                    $pend   =number_format($row->nilai,"2",".",",");
                    $pendu  =number_format($row->nilai_ubah,"2",".",",");
                    $rumus1  = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                    $btl    = number_format($row->btl,"2",".",",");
                    $bl     = number_format($row->bl,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $btlu   = number_format($row->btl_ubah,"2",".",",");
                    $blu    = number_format($row->bl_ubah,"2",".",",");
                    $jumu   = number_format($row->jumlah_ubah,"2",".",",");
                    $rumus2 = ($row->jumlah_ubah - $row->jumlah);
                    if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");
                    $per2   = ($rumus2!=0)?($rumus2 / $row->jumlah ) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");    
                    
                     $cRet    .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"5%\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"15%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btl</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen2</td>
                                </tr>
                                     ";
                
        
                  }  

        $cRet          .=       " </table>";

        $data['prev']  = $cRet;
        
        $judul = 'Laporan APBD Perubahan Lamp II';
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II'); 
                    
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                
    }
    
    function preview_perdaIII_ubah(){
      $id    = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN III:</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>: $kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>URAIAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Sebelum Perubahan</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>(Rp.)</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->kd_rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_ubah,"2",".",",");
                    $rumus1 = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp, SUM(nilai_ubah) as totp_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                   $coba4u=number_format($rowp->totp_ubah,"2",".",",");
                   $rumus2 = $rowp->totp_ubah - $rowp->totp;
                   if ($rumus2 < 0){
                        $x1="("; $rumus2=$rumus2*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total2 = number_format($rumus2,"2",".",",");  
                   $per2   = ($rumus2!=0)?($rumus2 / $rowp->totp ) * 100:0; 
                   $persen2= number_format($per2,"2",".",",");
                   $cob1=$rowp->totp;
                   $cob1u=$rowp->totp_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) as totb_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                   $jmlbu=number_format($rowb->totb_ubah,"2",".",",");
                   $cob=$rowb->totb;
                   $cobu=$rowb->totb_ubah;
                   $rumus3 = $rowb->totb_ubah - $rowb->totb;
                   if ($rumus3 < 0){
                        $x1="("; $rumus3=$rumus3*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total3 = number_format($rumus3,"2",".",",");  
                   $per3   = ($rumus3!=0)?($rumus3 / $rowb->totb ) * 100:0; 
                   $persen3= number_format($per3,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">BELANJA DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlbu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->kd_rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_ubah,"2",".",",");
                    $rumus4 = $row1->nilai_ubah - $row1->nilai;
                    if ($rumus4 < 0){
                        $x1="("; $rumus4=$rumus4*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total4 = number_format($rumus4,"2",".",",");  
                   $per4   = ($rumus4!=0)?($rumus4 / $row1->nilai) * 100:0; 
                   $persen4= number_format($per4,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                ";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl, SUM(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus5  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus5 < 0){
                        $x1="("; $rumus5=$rumus5*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total5 = number_format($rumus5,"2",".",",");  
                   $per5   = ($rumus5!=0)?($rumus5 / $rowbl->totbl) * 100:0; 
                   $persen5= number_format($per5,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen5</td>                                
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,
              			  (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai,
             			  (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai_ubah
            			  FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(len(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai) AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1    =$row1bl->kd_rek;
                    $bl2    =$row1bl->nm_rek;
                    $bl3    = number_format($row1bl->nilai,"2",".",",");
                    $bl3u   = number_format($row1bl->nilai_ubah,"2",".",",");
                    $rumus6 = $row1bl->nilai_ubah - $row1bl->nilai;
                    if ($rumus6 < 0){
                        $x1="("; $rumus6=$rumus6*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total6 = number_format($rumus6,"2",".",",");  
                    $per6   = ($rumus6!=0)?($rumus6 / $row1bl->nilai) * 100:0; 
                    $persen6= number_format($per6,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl,Sum(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus7  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus7 < 0){
                        $x1="("; $rumus7=$rumus7*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total7 = number_format($rumus7,"2",".",",");  
                    $per7   = ($rumus7!=0)?($rumus7 / $rowbl->totbl) * 100:0; 
                    $persen7= number_format($per7,"2",".",",");
                   $cob=$rowbl->totbl;
                   $cobu=$rowbl->totbl_ubah;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 
                 $suplus=$cob1-$cob;
                 $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');               
                  
                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Suprlus/(Defisit)</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surp$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surpu$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">PEMBIAYAAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  =$row3->kd_rek;
                    $coba10 =$row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_ubah,"2",".",",");
                    $rumus8 = $row3->nilai_ubah - $row3->nilai;
                    if ($rumus8 < 0){
                        $x1="("; $rumus8=$rumus8*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total8 = number_format($rumus8,"2",".",",");  
                    $per8   = ($rumus8!=0)?($rumus8 / $row3->nilai) * 100:0; 
                    $persen8= number_format($per8,"2",".",",");
                    
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_ubah,"2",".",",");
                   $rumus9  = $rowpm->totpm_ubah - $rowpm->totpm;
                   if ($rumus9 < 0){
                        $x1="("; $rumus9=$rumus9*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total9 = number_format($rumus9,"2",".",",");  
                    $per9   = ($rumus9!=0)?($rumus9 / $rowpm->totpm) * 100:0; 
                    $persen9= number_format($per9,"2",".",",");
                    $cob3    = $rowpm->totpm;
                    $cob3u   = $rowpm->totpm_ubah;
                     $cRet    .= " 
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total9$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen9</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13     = $row4->kd_rek;
                    $coba14     = $row4->nm_rek;
                    $coba15     = number_format($row4->nilai,"2",".",",");
                    $coba15u    = number_format($row4->nilai_ubah,"2",".",",");
                    $rumus10    = $row4->nilai_ubah - $row4->nilai;
                    if ($rumus10 < 0){
                        $x1="("; $rumus10=$rumus10*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total10 = number_format($rumus10,"2",".",",");  
                    $per10   = ($rumus10!=0)?($rumus10 / $row4->nilai) * 100:0; 
                    $persen10= number_format($per10,"2",".",",");
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total10$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen10</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_ubah,"2",".",",");
                   $rumus11 = $rowpk->totpk_ubah - $rowpk->totpk;
                   if ($rumus11 < 0){
                        $x1="("; $rumus11=$rumus11*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total11 = number_format($rumus11,"2",".",",");  
                    $per11   = ($rumus11!=0)?($rumus11 / $rowpk->totpk) * 100:0; 
                    $persen11= number_format($per11,"2",".",",");
                    
                   $cob4    =$rowpk->totpk;
                   $cob4u   =$rowpk->totpk_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\">Jumlah Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$x1$total11$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen11</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                 }  
                  

              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul     = 'Laporan APBD Perubahan Lamp III - '.$kd_skpd;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        switch($cetak) {
        case 0;
              $this->template->load('template','anggaran/rka/perdaIII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }       
       
        
                
    }
    
    
    function preview_perdaIV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN IV  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI PERUBAHAN BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH, ORGANISASI, PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"22%\" align=\"center\"><b>URAIAN URUSAN, ORGANISASI, PROGRAM DAN KEGIATAN PEMERINTAH DAERAH</b></td>                            
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SEBELUM PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SETELAH PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                        </tr>
                        <tr>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"22%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlahu,a.kd_urusan1 AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpegu
                        ,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlahu,a.kd_urusan AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbju, 
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlahu,LEFT(b.kd_skpd,7) AS urut FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(len(b.kd_program)))=b.kd_program ) AS jumlahu,
                        a.kd_skpd AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlahu,
                        SUBSTRING(b.kd_kegiatan,6,13) AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlahu,'JUMLAH' AS urut FROM trdrka) a ORDER BY urut,kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   = $row->kode;
                    $nama   = $row->nama;
                    $pend   = number_format($row->bpeg,"2",".",",");
                    $btl    = number_format($row->bbj,"2",".",",");
                    $bl     = number_format($row->bm,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $pendu  = number_format($row->bpegu,"2",".",",");
                    $btlu   = number_format($row->bbju,"2",".",",");
                    $blu    = number_format($row->bmu,"2",".",",");
                    $jumu   = number_format($row->jumlahu,"2",".",",");
                    $rumus1 = $row->jumlahu - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"22%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen1</td>
                                </tr> ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp IV ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN IV');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaIV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                                              
    }
    
    function preview_perdaV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN IV  </h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5></strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"15%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"15%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SEBELUM PERUBAHAN</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SETELAH PERUBAHAN</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"19%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>    
                     </thead>
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                        (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah,
                        (SELECT SUM(a.nilai_ubah) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah_u FROM trdrka a  INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah_u FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,'99' AS kode1,'3' AS kode2,'' AS skpd,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5') AS jumlah,                                          
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_u FROM trdrka) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $jumlah=number_format($row->jumlah,"2",".",",");
                    $jumlah_u= number_format($row->jumlah_u,"2",".",",");
                    $rumus1 = $row->jumlah_u - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",","); 
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$persen1</td>
                                    </tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp V ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN V');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
                
    }
    
    function preview_perkada_ubah(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PENJABARAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"17%\" align=\"center\"><b>Uraian</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td>
                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Penjelasan</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Sebelum Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Setelah Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                             <td width=\"18%\" bgcolor=\"#CCCCCC\" align=\"center\">Uraian</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                             <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Harga</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Total</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                                       
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $pen=$rowp->totp;
                    $pend_u=number_format($rowp->totp_u,"2",".",",");
                    $pen_u=$rowp->totp_u;
                    $pend_s = $rowp->totp_u - $rowp->totp;
                    if ($pend_s < 0){
                    	$x1="("; $pend_s=$pend_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pend_selisih = number_format($pend_s,"2",".",",");
                    $per1   = ($pend_s!=0)?($pend_s / $rowp->totp ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 $sql1="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' AS nilai_u,uraian AS uraian,volume_ubah1 AS volume,satuan_ubah1 AS satuan,harga_ubah1 AS harga,total_ubah AS total, '5' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,1)='4') a ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nu=$row->nilai_u;
                    $n=$row->nilai;
                    $nilaip_s = $nu - $n;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                                       
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none; border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                   $blj1=$rowb->totb;
                   $blj_u=number_format($rowb->totb,"2",".",",");
                   $blj_u1=$rowb->totb_u;
                   $blj_s = $rowb->totb_u - $rowb->totb;
                    if ($blj_s < 0){
                    	$x1="("; $blj_s=$blj_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $blj_selisih = number_format($blj_s,"2",".",",");
                    $per1_blj  = ($pend_s!=0)?($blj_s / $rowb->totb ) * 100:0; 
                    $persen_blj= number_format($per1_blj,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl,SUM(nilai_ubah) AS totbtl_u FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                   $bljbtl1=$rowbtl->totbtl;
                   $bljbtl_u=number_format($rowbtl->totbtl_u,"2",".",",");
                   $bljbtl1_u=$rowbtl->totbtl_u;
                   $btl_s = $rowbtl->totbtl_u - $rowbtl->totbtl;
                    if ($btl_s < 0){
                    	$x1="("; $btl_s=$btl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $btl_selisih = number_format($btl_s,"2",".",",");
                    $per1_btl  = ($pend_s!=0)?($btl_s / $rowbtl->totbtl ) * 100:0; 
                    $persen_btl= number_format($per1_btl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$btl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_btl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                  
                 $sql2="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='51'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaip_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl,SUM(nilai_ubah) AS totbl_u FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                   $bljbl1=$rowbtl->totbtl;
                   $bljbl_u=number_format($rowbl->totbl_u,"2",".",",");
                   $bljbl1_u=$rowbl->totbl_u;
                   $bl_s = $bljbl1_u - $bljbl1;
                    if ($bl_s < 0){
                    	$x1="("; $bl_s=$bl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $bl_selisih = empty($bl_s) || $bl_s == 0 ? '' :number_format($bl_s,"2",".",",");
                    $per1_bl  = ($pend_s!=0)?($bl_s / $rowbl->totbl ) * 100:0; 
                    $persen_bl= empty($per1_bl) || $per1_bl == 0 ? '' :number_format($per1_bl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$bl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_bl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 
                 $sql3="SELECT * FROM (SELECT a.kd_program AS kd_rek, a.kd_program AS kd_rek1,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(len(a.kd_program))) = a.kd_program) AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trskpd a INNER JOIN m_prog c ON a.kd_program1=c.kd_program
                        LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(len(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_program,c.nm_program 
                        UNION ALL
                        SELECT a.kd_kegiatan AS kd_rek,a.kd_kegiatan AS kd_rek1,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'5' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'6' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' 'AS nilai_u,uraian AS uraian,volume_ubah1 AS volume,satuan_ubah1 AS satuan,harga_ubah1 AS harga,total_ubah AS total,'7' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='52'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaib_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaib_s=$nilaib_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaib_selisih = empty($nilaib_s) || $nilaib_s == 0 ? '' :number_format($nilaib_s,"2",".",",");
                    $perb   = ($nilaib_s!=0)?($nilaib_s / $row->nilai ) * 100:0; 
                    $persenb= empty($perb) || $perb == 0 ? '' :number_format($perb,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaib_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenb</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $pm=$rowpm->totpm;
                   $bljpm_u=number_format($rowpm->totpm_u,"2",".",",");
                   $pm_u=$rowpm->totpm_u;                   
                    $pm_s = $pm_u - $pm;
                    if ($pm_s < 0){
                    	$x1="("; $pm_s=$pm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pm_selisih = number_format($pm_s,"2",".",",");
                    $per1_pm  = ($pend_s!=0)?($pm_s / $rowpm->totpm ) * 100:0; 
                    $persen_pm= number_format($per1_pm,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                 }
                 
                 $sql4="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='61'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaipm_s = $row->nilai_u - $row->nilai;
                    if ($nilaipm_s < 0){
                    	$x1="("; $nilaipm_s=$nilaipm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipm_selisih = empty($nilaipm_s) || $nilaipm_s == 0 ? '' :number_format($nilaipm_s,"2",".",",");
                    $perpm   = ($nilaipm_s!=0)?($nilaipm_s / $row->nilai ) * 100:0; 
                    $persenpm= empty($perpm) || $perpm == 0 ? '' :number_format($perpm,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   $bljpk_u=number_format($rowpk->totpk_u,"2",".",",");
                   $bljpk1_u=$rowpk->totpk_u;                   
                   $pk_s = $bljpk1_u - $bljpk1;
                    if ($pk_s < 0){
                    	$x1="("; $pk_s=$pk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pk_selisih = number_format($pk_s,"2",".",",");
                    $per1_pk  = ($pend_s!=0)?($pk_s / $rowpk->totpk ) * 100:0; 
                    $persen_pk= number_format($per1_pk,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                  }                   
                    
                 
                 
                 $sql5="SELECT * FROM (SELECT SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTR(no_trdrka,34,2)='62'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $pk=$row->nilai;
                    $pk_u=$row->nilai_u;
                    $nilaipk_s = $pk_u - $pk;
                    if ($nilaipk_s < 0){
                    	$x1="("; $nilaipk_s=$nilaipk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipk_selisih = empty($nilaipk_s) || $nilaipk_s == 0 ? '' :number_format($nilaipk_s,"2",",",".");
                    $perpk   = ($nilaipk_s!=0)?($nilaipk_s / $row->nilai ) * 100:0; 
                    $persenpk= empty($perpk) || $perpk == 0 ? '' :number_format($perpk,"2",",",".");
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $sqltpk="SELECT SUM(nilai) AS totpk,sum(nilai_ubah)as totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                  $sqlpk=$this->db->query($sqltpk);
                  foreach ($sqlpk->result() as $rowpklr)
                    {
                       $pk=$rowpklr->totpk;
                       $pk_u=$rowpklr->totpk_u;
                    }
                  $netto=$pm - $pk;
                  $net=number_format($netto,"2",",",".");
                  $netto_u=$pm_u - $pk_u;
                  $net_u=number_format($netto_u,"2",",",".");
                  $netto_s=$netto_u - $netto;
                  if ($netto_s < 0){
                    	$x1="("; $netto_s=$netto_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $netto_selisih = number_format($netto_s,"2",",",".");
                    $perpnet   = ($netto_s!=0)?($netto_s / $netto ) * 100:0; 
                    $persennet= number_format($perpnet,"2",",",".");                   
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$netto_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persennet</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    function _mpdf_down($judul='',$nm_giat='',$isi='',$lMargin='',$rMargin='',$font=10,$orientasi='',$hal='',$tab='',$jdlsave='',$tMargin='') {
                

        ini_set("memory_limit","-1");
        $this->load->library('mpdf');
        //$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 6; /* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;   /* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1;     /* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 1; /* in pts */
        $this->mpdf->defaultfooterfontstyle = blank;    /* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 0; 
        $sa=1;
        $tes=0;
        if ($hal==''){
        $hal1=1;
        } 
        if($hal!==''){
        $hal1=$hal;
        }
        
        if ($tMargin=='' ){
            $tMargin=16;
        }
        
        if($lMargin==''){
            $lMargin=15;
        }

        if($rMargin==''){
            $rMargin=15;
        }
        
        $judulx = $judul.'-'.$nm_giat.'.pdf';
        $this->mpdf = new mPDF('utf-8', array(215,330),$size,'',$lMargin,$rMargin,$tMargin); //folio
        
        $mpdf->cacheTables = true;
        $mpdf->packTableData=true;
        $mpdf->simpleTables=true;
        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
        if (!empty($tab)) $this->mpdf->SetTitle($tab); 
        if ($hal != 'no'){
            $this->mpdf->SetFooter("Halaman {PAGENO}  ");
        }
        if (!empty($judulx)) $this->mpdf->writeHTML($judulx);
        //$this->mpdf->simpleTables= true;     
        $this->mpdf->writeHTML($isi);         
        //$this->mpdf->Output('');
        $this->mpdf->Output($judulx,'D');
    }
    
    
    
	function _mpdf($judul='',$isi='',$lMargin=10,$rMargin=10,$font=10,$orientasi='',$hal='') {
                

        ini_set("memory_limit","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 6;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 1; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
        $this->mpdf = new mPDF('utf-8', array(215,330),$size); //folio
        $this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		$this->mpdf->SetFooter("Printed on SIMAKDA SKPD || Halaman {PAGENO}  ");
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
        $this->mpdf->writeHTML($isi);         
        $this->mpdf->Output();
               
    }
	
	
	

    
    
     function cari0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0',$lccr); 
	}
    function caridpa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0',$lccr); 
	}
    function caridppa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0',$lccr); 
	}
     function caridppa0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd',$lccr); 
	}
    function cari1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1',$lccr); 
	}
    function caridpa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1',$lccr); 
	}
    function caridppa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1',$lccr); 
	}
    function caridppa1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd',$lccr); 
	}
    function cari21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21',$lccr); 
	}
    function caridpa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21',$lccr); 
	}    
    function caridppa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21',$lccr); 
	}
    function caridppa21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd',$lccr); 
	}
    function caridppa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22',$lccr); 
	}
    function caridppa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221',$lccr); 
	}
    function cari0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd',$lccr); 
	}
    function cari1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd',$lccr); 
	}
    function cari21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd',$lccr); 
	}
    function cari22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 22','rka22',$lccr); 
	}
    function caridpa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22',$lccr); 
	}
    function cari221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function caridpa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function cari31()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31',$lccr); 
	}
    function cari31pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31',$lccr); 
	}
    function cari32()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32',$lccr); 
	}
    function cari32pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32',$lccr); 
	}
    function cari_perda1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN I','perda_1',$lccr); 
	}
    function cari_perdaIII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD LAMPIRAN III','perda_III',$lccr); 
	}
    function cari_perkadaII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_II',$lccr); 
	}
    
    function cari_perkada_ubah()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah',$lccr); 
	}
    
    function cari_perda1_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda1_ubah',$lccr); 
	}
    
    function cari_perdaIII_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah',$lccr); 
	}
    
//WAHYU====================================================================================================================
    

    //pindah 23-11-2017 (1)
function tambah_rka()
    {
    	$this->rka_model->usercek();
        $jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PENYUSUNAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka',$data) ; 
        $query1->free_result();
   }


   function tambah_rka_pend()
	{
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA');   
        /* $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }*/
        $this->template->load('template','anggaran/rka/tambah_rka_pend',$data) ; 
        //$query1->free_result();
   }

  	function tambah_rka_ubah(){
  		$this->rka_model->usercek();
  		$this->rka_model->kunci_menu_ubah();
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PERUBAHAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT DOKUMEN ANGGARAN PERUBAHAN';
        $this->template->set('title', 'INPUT DPPA');   

        $this->template->load('template','anggaran/rka/tambah_rka_ubah',$data) ; 
       // $query1->free_result();
   }

  function select_rka2($kode) {
        
        $skpd = $this->session->userdata('kdskpd');
        $bid = $skpd;
        $cek = explode(".",$bid);
        $ck = $cek[3];
        $cekleft = substr($kode,0,12);
        $cekright = substr($kode,16,8);        
        
                          
        if($ck=="00"){
            $par = "where a.kd_subkegiatan='$kode'";
        }else{
            $gab = $cekleft.".".$ck.".".$cekright; 
            
            $par = "where kd_bidsubkegiatan='$gab'";
        }
            
		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,a.sumber,a.sumber2,a.sumber3,a.sumber4 from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 $par order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
						'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4']                                
                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }

	
	//pindah 23-11-2017 (2)
function select_rka($kegiatan='') {

        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,a.nilaisempurna2,
                ISNULL(a.sumber, '') as sumber,ISNULL(a.sumber2, '') as sumber2,ISNULL(a.sumber3, '') as sumber3,ISNULL(a.sumber4, '') as sumber4,
                ISNULL(a.sumber1_su, '') as sumber1_su,ISNULL(a.sumber2_su, '') as sumber2_su,ISNULL(a.sumber3_su, '') as sumber3_su,
                ISNULL(a.sumber4_su, '') as sumber4_su,
                ISNULL(a.sumber1_su2, '') as sumber1_su2,ISNULL(a.sumber2_su2, '') as sumber2_su2,ISNULL(a.sumber3_su2, '') as sumber3_su2,
                ISNULL(a.sumber4_su2, '') as sumber4_su2,
                                ISNULL(a.sumber1_ubah, '') as sumber1_ubah,ISNULL(a.sumber2_ubah, '') as sumber2_ubah,ISNULL(a.sumber3_ubah, '') as sumber3_ubah,
                ISNULL(a.sumber4_ubah, '') as sumber4_ubah,
                ISNULL(a.nilai_sumber, 0) as nilai_sumber,ISNULL(a.nilai_sumber2,0) as nilai_sumber2,ISNULL(a.nilai_sumber3, 0) as nilai_sumber3,
                ISNULL(a.nilai_sumber4, 0) as nilai_sumber4,
                ISNULL(a.nsumber1_su, 0) as nsumber1_su,ISNULL(a.nsumber2_su,0) as nsumber2_su,ISNULL(a.nsumber3_su, 0) as nsumber3_su,
                ISNULL(a.nsumber4_su, 0) as nsumber4_su,
                                ISNULL(a.nsumber1_su2, 0) as nsumber1_su2,ISNULL(a.nsumber2_su2,0) as nsumber2_su2,ISNULL(a.nsumber3_su2, 0) as nsumber3_su2,
                ISNULL(a.nsumber4_su2, 0) as nsumber4_su2,
                ISNULL(a.nsumber1_ubah, 0) as nsumber1_ubah,ISNULL(a.nsumber2_ubah,0) as nsumber2_ubah,ISNULL(a.nsumber3_ubah, 0) as nsumber3_ubah,
                ISNULL(a.nsumber4_ubah, 0) as nsumber4_ubah
                from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 
                join trskpd c on a.kd_kegiatan=c.kd_kegiatan
                where a.kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {
            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'nilaisempurna2' => number_format($resulte['nilaisempurna2'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4'],
                        'sumber1_su' => $resulte['sumber1_su'],
                        'sumber2_su' => $resulte['sumber2_su'],
                        'sumber3_su' => $resulte['sumber3_su'],
                        'sumber4_su' => $resulte['sumber4_su'],
                        'sumber1_su2' => $resulte['sumber1_su2'],
                        'sumber2_su2' => $resulte['sumber2_su2'],
                        'sumber3_su2' => $resulte['sumber3_su2'],
                        'sumber4_su2' => $resulte['sumber4_su2'],
                        'sumber1_ubah' => $resulte['sumber1_ubah'],
                        'sumber2_ubah' => $resulte['sumber2_ubah'],
                        'sumber3_ubah' => $resulte['sumber3_ubah'],
                        'sumber4_ubah' => $resulte['sumber4_ubah'],                               
                        'nsumber1_su' => number_format($resulte['nsumber1_su'],"2",".",","), 
                        'nsumber2_su' => number_format($resulte['nsumber2_su'],"2",".",","), 
                        'nsumber3_su' => number_format($resulte['nsumber3_su'],"2",".",","),
                        'nsumber4_su' => number_format($resulte['nsumber4_su'],"2",".",","),
                        'nsumber1_su2' => number_format($resulte['nsumber1_su2'],"2",".",","), 
                        'nsumber2_su2' => number_format($resulte['nsumber2_su2'],"2",".",","), 
                        'nsumber3_su2' => number_format($resulte['nsumber3_su2'],"2",".",","),
                        'nsumber4_su2' => number_format($resulte['nsumber4_su2'],"2",".",","),
                        'nsumber1_ubah' => number_format($resulte['nsumber1_ubah'],"2",".",","), 
                        'nsumber2_ubah' => number_format($resulte['nsumber2_ubah'],"2",".",","), 
                        'nsumber3_ubah' => number_format($resulte['nsumber3_ubah'],"2",".",","),
                        'nsumber4_ubah' => number_format($resulte['nsumber4_ubah'],"2",".",",") ,
                        'nilai_sumber' => number_format($resulte['nilai_sumber'],"2",".",","), 
                        'nilai_sumber2' => number_format($resulte['nilai_sumber2'],"2",".",","), 
                        'nilai_sumber3' => number_format($resulte['nilai_sumber3'],"2",".",","),
                        'nilai_sumber4' => number_format($resulte['nilai_sumber4'],"2",".",",")                                 

                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }

   function select_rka_ubah($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,sumber from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'nilai_sempurna' => number_format($resulte['nilai_sempurna']),
                        'nilai_ubah' => number_format($resulte['nilai_ubah']),                             
                        'sdana' => $resulte['sumber']  
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

	   
   function select_rincian() {
        $sql = "select uraian,volume1 from trdpo ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'uraian' => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
    
    function ambil_rekening5() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_rek5, nm_rek5 FROM ms_rek5 where left(kd_rek5,1) in ('4','5','6') and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
           
    }
           
     
//pindah 23-11-2017 (7)
	function ld_rek($giat='',$rek='') {
        if ($rek==''){
            $dan='';
        }else{
            $dan="and a.kd_rek5='$rek'";
        }
        $sql = " SELECT kd_rek5,nm_rek5 FROM (SELECT kd_rek5,nm_rek5 FROM ms_rek5 WHERE kd_rek5 NOT IN (SELECT kd_rek5 FROM trdrka WHERE kd_kegiatan='$giat'  ) AND
                 (kd_rek5 LIKE '4%' OR kd_rek5 LIKE '5%' OR kd_rek5 LIKE '6%'))a,
                 (SELECT @kd:=b.jns_kegiatan, @pj:=len(b.jns_kegiatan) FROM trskpd a INNER JOIN m_giat b ON 
                 a.kd_kegiatan1=b.kd_kegiatan WHERE a.kd_kegiatan='$giat' )t 
                 WHERE LEFT(a.kd_rek5,@pj)=@kd $dan ORDER BY a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    } 
    
    
    function rek($giat='') {
    
        $sql = " SELECT kd_rek5,nm_rek5 FROM ms_rek5 order by kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	   
	function ld_sdana() {
        $sql = " SELECT * from sumber_dana ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'sdana' => $resulte['sdana']
                       
                        );
                        $ii++;
        }
           
           
        echo json_encode($result);
    	   
	} 

//pindah 23-11-2017 (6)
   function tsimpan($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$sdana='') {
       
        if (trim($reklama)==''){
            $reklama=$rekbaru;
        }

        $nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmgiat=$this->rka_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek5=$this->rka_model->get_nama($rekbaru,'nm_rek5','ms_rek5','kd_rek5');

        $notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
        $query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
        $query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");   
        $query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");    

        $this->select_rka($kegiatan);
    }
    
   //pindah 23-11-2017 (15) 
  function tsimpan_ar(){
        
        $id     =  $this->session->userdata('pcNama'); 
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;

        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
    	$user_name  =  $this->session->userdata('pcNama'); 
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdrka";
        $perintah="Input Edit RKA Murni $notrdrka ";

            $sql="INSERT into log_activity (user_name, tabel, last_update, perintah, url, ip_pc, browser, os) values ('$user_name','$tabel','$tgl','$perintah','$url/$notrdrka','$ip_num','$browser', '$os')";
            $this->db->query($sql);
        

        $query_del = $this->db->query("delete from trdrka where left(kd_skpd,7)=left('$kdskpd',7) and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,
                                        sumber,sumber2,sumber3,sumber4,nilai_sumber,nilai_sumber2,nilai_sumber3,nilai_sumber4,
                                       sumber1_su,sumber2_su,sumber3_su,sumber4_su,nsumber1_su,nsumber2_su,nsumber3_su,nsumber4_su,     
                                       sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,nilai_akhir_sempurna,username,last_update
                                       ,sumber1_su2,sumber2_su2,sumber3_su2,sumber4_su2,nsumber1_su2,nsumber2_su2,nsumber3_su2,nsumber4_su2) 
                                        values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3'
                                        ,'$sdana4','$ndana1',$ndana2,$ndana3,$ndana4,'$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,       
                                       '$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,'$nilai','$id',getdate(),'$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4)");        

/*
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,
                                       sumber,sumber2,sumber3,sumber4,nilai_sumber,nilai_sumber2,nilai_sumber3,nilai_sumber4,
                                       sumber1_su,sumber2_su,sumber3_su,sumber4_su,nsumber1_su,nsumber2_su,nsumber3_su,nsumber4_su,     
                                       sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,nilai_akhir_sempurna
                                       ) values('$notrdrka','$kdskpd'
                                       ,'$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4',
                                       '$ndana1',$ndana2,$ndana3,$ndana4,'$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,       
                                       '$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,'$nilai')");        


*/
        
        if ( $query_ins > 0 and $query_del > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }
    

    function tsimpan_ubah(){
        $this->rka_model->kunci_menu_ubah();
        $kdskpd = $this->input->post('kd_skpd');
        $kdskpd2= $this->input->post('kd_skpd2');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
        $id     =  $this->session->userdata('pcNama');        
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;

        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
    	$user_name  =  $this->session->userdata('pcNama'); 
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdrka";
        $perintah="Input Edit RKA Ubah $notrdrka ";

        $log=$this->support->log_aktivitas("$tabel","$perintah");
        

        $query_find = $this->db->query("select * from trdrka where kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'");
        $update = $query_find->num_rows();
        if($update > 0){
            $query_ins = $this->db->query("UPDATE trdrka set sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',
                nsumber2_ubah='$ndana2',nsumber3_ubah='$ndana3',nsumber4_ubah='$ndana4',
                username='$id',last_update=getdate() where kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'
                                           ");        
        }else{
            $query_ins = $this->db->query("INSERT into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,
                sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,username,last_update) 
            values('$notrdrka','$kdskpd2','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek',0,0,'$nilai','$sdana1','$sdana2','$sdana3','$sdana4','$ndana1','$ndana2','$ndana3','$ndana4','$id',getdate())");        
        }
             
		
        if ( $query_ins > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }
    
    //pindah 23-11-2017 (9)
function tsimpan_rinci(){

        $skpd    = $this->input->post('skpd');
        $kegiatan    = $this->input->post('giat');
        $rekening    = $this->input->post('rek');
        $index    = $this->input->post('id');
        $uraian    = $this->input->post('uraian');
        $volume1    = $this->input->post('volum1');
        $satuan1    = $this->input->post('satuan1');
        $harga1    = $this->input->post('harga1');
        $volume2    = $this->input->post('volum2');
        $satuan2    = $this->input->post('satuan2');
        $volume3    = $this->input->post('volum3');
        $satuan3    = $this->input->post('satuan3');
        
        $satuan1 = str_replace("12345678987654321","",$satuan1);
        $satuan1 = str_replace("undefined","",$satuan1);

        $satuan2 = str_replace("12345678987654321","",$satuan2);
        $satuan2 = str_replace("undefined","",$satuan2);

        $satuan3 = str_replace("12345678987654321","",$satuan3);
        $satuan3 = str_replace("undefined","",$satuan3);

        $uraian = str_replace("%20"," ",$uraian);
        $uraian = str_replace("%60"," ",$uraian);

        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $vol1=$volume1;
        $vol2=$volume2;
        $vol3=$volume3;
        if($volume1==0){$volume1=1;$vol1='';}
        if($volume2==0){$volume2=1;$vol2='';}
        if($volume3==0){$volume3=1;$vol3='';}
        
        $total   = $volume1*$volume2*$volume3*$harga1;

        $query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
        $query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
                                     values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
        $query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");   
        $this->rka_rinci($skpd,$kegiatan,$rekening);
    }
    

    //pindah 23-11-2017 (11)
    function tsimpan_rinci_jk(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('cskpd');
        $kegiatan  = $this->input->post('giat'); 
        $id        =  $this->session->userdata('pcNama');                       
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
        $crek = $this->input->post('crek');
            
    
        $sql       = "delete from trdpo where no_trdrka='$norka'";
        $asg       = $this->db->query($sql);
            
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(kd_kegiatan,kd_rek5,no_po,header,kode,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,
                            total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,
                            volume_sempurna1,volume_sempurna2,volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,
                            harga_sempurna1,total_sempurna,harga_sempurna2,total_sempurna_2)"; 
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
      
        $query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilai_sempurna= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilaisempurna2= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka), 
                                     nilai_akhir_sempurna=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                     ,username='$id',last_update=getdate(),
                                     sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4',nilai_sumber='$ndana1',
                                     nilai_sumber2=$ndana2,nilai_sumber3=$ndana3,nilai_sumber4=$ndana4,     
                                     sumber1_su='$sdana1',sumber2_su='$sdana2',sumber3_su='$sdana3',sumber4_su='$sdana4',nsumber1_su=$ndana1,
                                     nsumber2_su=$ndana2,nsumber3_su=$ndana3,nsumber4_su=$ndana4,       
                                     sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',nsumber1_ubah=$ndana1,
                                     nsumber2_ubah=$ndana2,nsumber3_ubah=$ndana3,nsumber4_ubah=$ndana4
                                     where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna_2= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna_final= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     total_ubah= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     username='$id',last_update=getdate()
                                     where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd'");  

/*
        $query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilai_sempurna= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilai_akhir_sempurna=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate(),
                                    sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4',nilai_sumber='$ndana1',
                                    nilai_sumber2=$ndana2,nilai_sumber3=$ndana3,nilai_sumber4=$ndana4,      
                                    sumber1_su='$sdana1',sumber2_su='$sdana2',sumber3_su='$sdana3',sumber4_su='$sdana4',nsumber1_su=$ndana1,
                                    nsumber2_su=$ndana2,nsumber3_su=$ndana3,nsumber4_su=$ndana4,        
                                    sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',nsumber1_ubah=$ndana1,
                                    nsumber2_ubah=$ndana2,nsumber3_ubah=$ndana3,nsumber4_ubah=$ndana4       
                                    where no_trdrka='$norka' ");  
        $query1 = $this->db->query("update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                    total_sempurna= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                    total_ubah= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                    username='$id',last_update=getdate()
                                    where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");  
*/
        $this->rka_rinci($cskpd,$kegiatan,$crek);
    
    }
    
    function tsimpan_rinci_ar(){
        
        $uraian = $this->input->post('vuraian');
        $vol1   = $this->input->post('vvol1');
        $sat1   = $this->input->post('vsat1');
        $vol2   = $this->input->post('vvol2');
        $sat2   = $this->input->post('vsat2');
        $vol3   = $this->input->post('vvol3');
        $sat3   = $this->input->post('vsat4');
        $volume = $this->input->post('vvolume');
        $harga  = $this->input->post('vharga');
        $total  = $this->input->post('vtotal');
        $no_po  = $this->input->post('vno_po');
        $norka  = $this->input->post('vnorka');
        
        $query1 = $this->db->query("delete from trdpo where no_trdrka='$norka' and no_po='$no_po'");
        $query2 = $this->db->query("insert into trdpo(no_po,    no_trdrka, uraian,    volume1, satuan1, harga1,   total,    volume_ubah1, satuan_ubah1, harga_ubah1, total_ubah, volume2, satuan2, volume_ubah2, satuan_ubah2, volume3, satuan3, volume_ubah3, satuan_ubah3, tvolume,   tvolume_ubah)
                                               values('$no_po', '$norka',  '$uraian', '$vol1', '$sat1', '$harga', '$total', '$vol1',      '$sat1',      '$harga',    '$total',   '$vol2', '$sat2', '$vol2',      '$sat2',      '$vol3', '$sat3', '$vol3',      '$sat3',      '$volume', '$volume'   )"); 
        
        
        if ( $query1 > 0 and $query2 > 0 ) {
            echo '1';
        } else {
            echo '0';
        }  
        
        $query3 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query4 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
        
    }

    function thapus_rinci_ar(){
        $norka = $this->input->post('vnorka');
        $nopo  = $this->input->post('vnopo');
        
        $query = $this->db->query("delete from trdpo where no_trdrka='$norka' and no_po='$nopo'");
        if ( $query > 0 ){
            echo '1' ;
        } else {
            echo '0' ;
        }
    }
	
	function thapus_pend($skpd='',$kegiatan='',$rek='') {
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka_pend where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" update trskpd_pend set total=( select sum(nilai) as jum from trdrka_pend where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka_pend($kegiatan);
    }

    
	
	
	
	
    //pindah 23-11-2017 (10)
    function thapus_rinci_ar_all(){
        $norka = $this->input->post('vnorka');
        $kegi = $this->input->post('kegi');
        $kdskpd = $this->input->post('kdskpd');

        
        $query = $this->db->query("delete from trdpo where no_trdrka='$norka'");
        $query1 = $this->db->query(" update trdrka set nilai=0,nilai_sempurna=0,nilai_ubah=0,nilai_akhir_sempurna=0 
                                     ,nilai_sumber=0,nilai_sumber2=0,nilai_sumber3=0,nilai_sumber4=0, 
                                     nsumber1_su=0,nsumber2_su=0,nsumber3_su=0,nsumber4_su=0,nsumber1_ubah=0,nsumber2_ubah=0,nsumber3_ubah=0,nsumber4_ubah=0
                                     where no_trdrka='$norka' "); 
        $query1 = $this->db->query("update trskpd set total=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and kd_skpd='$kdskpd')
                                    ,total_sempurna=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and kd_skpd='$kdskpd'),
                                    total_ubah=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and kd_skpd='$kdskpd') 
                                    where kd_kegiatan='$kegi' and kd_skpd='$kdskpd'"); 

 
        if ( $query > 0 ){
            echo '1' ;
        } else {
            echo '0' ;
        }
    }
    
    function tsimpan_rinci_ubah($skpd='',$kegiatan='',$rekening='',$index=0,$uraian='',$volume1=0,$satuan1='',$harga=0,$volume_ubah1=0,$satuan_ubah1='',$harga_ubah=0,$volume2=0,$satuan2='',$volume3=0,$satuan3='',$volume_ubah2=0,$satuan_ubah2='',$volume_ubah3=0,$satuan_ubah3=''){
	   
		$satuan1 = str_replace("12345678987654321","",$satuan1);
		$satuan1 = str_replace("undefined","",$satuan1);

		$satuan2 = str_replace("12345678987654321","",$satuan2);
		$satuan2 = str_replace("undefined","",$satuan2);

		$satuan3 = str_replace("12345678987654321","",$satuan3);
		$satuan3 = str_replace("undefined","",$satuan3);

		$satuan_ubah1 = str_replace("12345678987654321","",$satuan_ubah1);
		$satuan_ubah1 = str_replace("undefined","",$satuan_ubah1);

		$satuan_ubah2 = str_replace("12345678987654321","",$satuan_ubah2);
		$satuan_ubah2 = str_replace("undefined","",$satuan_ubah2);

		$satuan_ubah3 = str_replace("12345678987654321","",$satuan_ubah3);
		$satuan_ubah3 = str_replace("undefined","",$satuan_ubah3);

		$uraian = str_replace("%20"," ",$uraian);
		$uraian = str_replace("%60"," ",$uraian);
		

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
		
        if(($volume1==0)or($volume1=='')) $volume1=1;
        if(($volume2==0)or($volume2=='')) $volume2=1;
        if(($volume3==0)or($volume3=='')) $volume3=1;
        if(($harga==0)or($harga=='')) $harga=0;
		
		$total	 = $volume1*$volume2*$volume3*$harga;
		
		
        if(($volume_ubah1==0)or($volume_ubah1=='')) $volume_ubah1=1;
        if(($volume_ubah2==0)or($volume_ubah2=='')) $volume_ubah2=1;
        if(($volume_ubah3==0)or($volume_ubah3=='')) $volume_ubah3=1;
		
		$total_ubah	 = $volume_ubah1*$volume_ubah2*$volume_ubah3*$harga_ubah;
		
		
		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume3,satuan3,volume_ubah2,satuan_ubah2,volume_ubah3,satuan_ubah3) 
									 values('$index','$norka','$uraian',$volume1,'$satuan1',$harga,$total,$volume_ubah1,'$satuan_ubah1',$harga_ubah,$total_ubah,$volume2,'$satuan2',$volume3,'$satuan3',$volume_ubah2,'$satuan_ubah2',$volume_ubah3,'$satuan_ubah3') ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah=(select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rekening);
	}

//pindah 23-11-2017 (8)
    function thapus($skpd='',$kegiatan='',$rek='') {
        
        $notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
        $query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
        $query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
        $query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");   
        $this->select_rka($kegiatan);
    }

    function thapus_ubah($skpd='',$skpd2='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;

        $user_name  =  $this->session->userdata('pcNama');
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdrka";
        $perintah="Hapus rekening $notrdrka";

 
            $sql="insert into log_activity (user_name, tabel, last_update, perintah, url, ip_pc, browser, os) values ('$user_name','$tabel','$tgl','$perintah','$url','$ip_num','$browser', '$os')";
            $this->db->query($sql);
        

		$query = $this->db->query(" delete from trdrka where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total_ubah=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ) where kd_kegiatan1='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ");	
		$this->select_rka_ubah($kegiatan);
    }

    function thapus_rinci($skpd='',$kegiatan='',$rek,$index=0) {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rek);
    }
	
    function thapus_rinci_ubah($skpd='',$kegiatan='',$rek,$index=0) {    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rek);
    }



function cek_nopo_ubah($norka='',$cpo){
        $query_find = $this->db->query("select * from trdpo where no_trdrka='$norka' and no_po='$cpo' and (total<>0)");
        $update = $query_find->num_rows();
        if($update < 1){
            $result = '0';
        }else{
            $result = '1';
        }

        $query_find = $this->db->query("select * from trdpo where no_trdrka='$norka' and no_po='$cpo' and (total_sempurna<>0)");
        $update = $query_find->num_rows();
        if($update < 1){
            $result = '0';
        }else{
            $result = '1';
        }

        echo json_encode($result);
    }      

//pindah 23-11-2017 (12)
function rka_rinci($skpd='',$kegiatan='',$rekening='') {
        
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
			
	   $jm=0; 
       $sql = "select sum(c.jm_sb) jm_sb,sum(c.jm_sh) jm_sh from(
        select count(*)jm_sb,0 jm_sh from mssisb where kode_rek_rinci not in 
        (select kode_rek_rinci from mssish) and left(kode_rek_rinci,7)='$rekening'
        UNION ALL
        select 0 jm_sb,count(*)jm_sh from mssish where kode_rek_rinci not in 
        (select kode_rek_rinci from mssisb) and left(kode_rek_rinci,7)='$rekening')c";                   
        
        $query1 = $this->db->query($sql)->row();
        $sb = $query1->jm_sb;
        $sh = $query1->jm_sh;
        
        if($sh>0){
            $jm=1;
        }else{
            if($sb>0){
                $jm=2;
            }else{
                $jm=0;
            }
        }
			
            $result[] = array(
                        'id'      => $ii,   
                        'header'  => $resulte['header'],  
                        'kode'    => $resulte['kode'],  
                        'no_po'   => $resulte['no_po'],
                        'unik'   => $resulte['unik'],   
                        'uraian'  => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],  
                        'volume2' => $resulte['volume2'],  
                        'volume3' => $resulte['volume3'],  
                        'satuan1' => $resulte['satuan1'],  
                        'satuan2' => $resulte['satuan2'],  
                        'satuan3' => $resulte['satuan3'],
                        'volume'  => $resulte['tvolume'],  
                        'harga1'  => number_format($resulte['harga1'],"2",".",","),  
                        'hargap'  => number_format($resulte['harga1'],"2",".",","),                             
                        'harga2'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga3'],"2",".",","),
                        'totalp'  => number_format($resulte['total'],"2",".",",") ,                            
                        'total'   => number_format($resulte['total'],"2",".",","),
                        'volume_sempurna1' => $resulte['volume_sempurna1'],
                        'volume_sempurna2' => $resulte['volume_sempurna2'],
                        'tvolume_sempurna' => $resulte['tvolume_sempurna'],                            
                        'satuan_sempurna1' => $resulte['satuan_sempurna1'],
                        'satuan_sempurna2' => $resulte['satuan_sempurna2'],
                        'harga_sempurna1'  => number_format($resulte['harga_sempurna1'],"2",".",","),
                        'harga_sempurna2'  => number_format($resulte['harga_sempurna2'],"2",".",","),
                        'total_sempurna'  => number_format($resulte['total_sempurna'],"2",".",","),
                        'total_sempurna_2'  => number_format($resulte['total_sempurna_2'],"2",".",","),
                        'volume_ubah1' => $resulte['volume_ubah1'],
                        'tvolume_ubah' => $resulte['tvolume_ubah'],                            
                        'satuan_ubah1' => $resulte['satuan_ubah1'],
                        'harga_ubah1'  => number_format($resulte['harga_ubah1'],"2",".",","),
                        'total_ubah'  => number_format($resulte['total_ubah'],"2",".",","),
						'init_max' => $jm
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function rka_rinci_ubah($skpd='',$kegiatan='',$rekening='') {
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id'      => $ii,        
                        'no_po'   => $resulte['no_po'],  
                        'uraian'  => $resulte['uraian'], 
						'volume1_susun' => $resulte['volume1'],  
                        'volume2_susun' => $resulte['volume2'],  
                        'volume3_susun' => $resulte['volume3'],  
                        'satuan1_susun' => $resulte['satuan1'],  
                        'satuan2_susun' => $resulte['satuan2'],  
                        'satuan3_susun' => $resulte['satuan3'],
						'volume_susun'  => $resulte['tvolume'], 
						'harga1_susun'  => number_format($resulte['harga1'],"2",".",","),  
                        'harga2_susun'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3_susun'  => number_format($resulte['harga3'],"2",".",","),
						'total_susun_s' => number_format($resulte['total'],"2",".",","),
						
                        'volume1_awal' => $resulte['volume_sempurna1'],  
                        'volume2_awal' => $resulte['volume_sempurna2'],  
                        'volume3_awal' => $resulte['volume_sempurna3'],  
                        'satuan1_awal' => $resulte['satuan_sempurna1'],  
                        'satuan2_awal' => $resulte['satuan_sempurna2'],  
                        'satuan3_awal' => $resulte['satuan_sempurna3'],
                        'volume_awal'  => $resulte['tvolume_sempurna'],
						'harga1_awal'  => number_format($resulte['harga_sempurna1'],"2",".",","),  
                        'harga2_awal'  => number_format($resulte['harga_sempurna2'],"2",".",","),                             
                        'harga3_awal'  => number_format($resulte['harga_sempurna3'],"2",".",","),
						'total_awal_s' => number_format($resulte['total_sempurna'],"2",".",","), 
						
                       
						
                        'volume1' => $resulte['volume_ubah1'],  
                        'volume2' => $resulte['volume_ubah2'],  
                        'volume3' => $resulte['volume_ubah3'],  
                        'satuan1' => $resulte['satuan_ubah1'],  
                        'satuan2' => $resulte['satuan_ubah2'],  
                        'satuan3' => $resulte['satuan_ubah3'],
                        'volume'  => $resulte['tvolume_ubah'],  
                        'harga1'  => number_format($resulte['harga_ubah1'],"2",".",","),  
                        'harga2'  => number_format($resulte['harga_ubah2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga_ubah3'],"2",".",","),
                        'total'   => number_format($resulte['total_ubah'],"2",".",",")                            
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	 
	 


	function rka_hukum($skpd='',$subkegiatan='',$kd_rek5='') {        
		$sql = " SELECT *,(SELECT dhukum FROM d_hukum WHERE left(kd_skpd,7)=left('$skpd',7) AND kd_kegiatan='$kegiatan' AND kd_rek5='$kd_rek5' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

function rka_hukum_2($skpd='',$kegiatan='') {        
		$sql = " SELECT *,(SELECT dhukum FROM d_hukum WHERE kd_skpd=left('$skpd',7) AND kd_kegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

	function rka_hukum_ubah($skpd='',$kegiatan='') {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum_ubah WHERE kd_skpd='$skpd' AND kd_subkegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }	

//pindah 23-11-2017 (13)
function load_sum_rek(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $skp = substr($kdskpd,0,7);
        $query1 = $this->db->query(" select sum(nilai) as rektotal,sum(nilai_sempurna) as rektotal_sempurna,sum(nilai_ubah) as rektotal_ubah from 
                                     trdrka where left(kd_skpd,7)='$skp' and left(kd_rek5,3) not in ('514','515') and kd_kegiatan='$kegiatan'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_sempurna' => number_format($resulte['rektotal_sempurna'],"2",".",","),
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   
    }
    

function get_realisasi($cskpd=''){

        $query1 = $this->db->query("select total=isnull(spp,0)+isnull(transaksi,0) from ms_skpd a left join
                                    (           
                                        select b.kd_skpd,sum(c.nilai) [spp] from trhspp b join trdspp c on b.no_spp=c.no_spp and b.kd_skpd=c.kd_skpd
                                        where b.jns_spp not in ('1','2') and b.kd_skpd='$cskpd' and (sp2d_batal<>'1' or sp2d_batal is null ) group by b.kd_skpd
                                    ) as d on a.kd_skpd=d.kd_skpd
                                    left join 
                                    (
                                        select f.kd_skpd,sum(f.nilai) [transaksi] from trhtransout e join trdtransout f on e.no_bukti=f.no_bukti and e.kd_skpd=f.kd_skpd
                                        where f.kd_skpd='$cskpd' and e.jns_spp ='1' group by f.kd_skpd
                                        ) g on a.kd_skpd=g.kd_skpd
                                    where a.kd_skpd='$cskpd'"); 
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }
    
    function load_bendahara_p(){

		$kdskpd = $this->input->post('skpd');
	

        $query1 = $this->db->query(" select nip,nama from ms_ttd where kd_skpd='$kdskpd'  AND kode='BP' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}

//pindah 23-11-2017 (14)
	function load_sum_rek_rinci(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $rek = $this->input->post('rek');
        $norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total) as rektotal_rinci,sum(total_ubah) as rektotal_rinci_ubah from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        'rektotal_rinci_ubah' => number_format($resulte['rektotal_rinci_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   
    }
    

	//pindah 23-11-2017 (17)
function load_det_keg(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai'],
                        'm_tu' => $resulte['tu_mas'],
                        'k_tu' => $resulte['tu_kel'],
                        'h_tu' => $resulte['tu_has'],
                        'cp_ck' => $resulte['tk_capai'],
                        'm_ck' => $resulte['tk_mas'],
                        'ang_lalu' => number_format(($resulte['ang_lalu']),"2",".",","),
                        'ang_depan' => number_format(($resulte['ang_depan']),"2",".",","),                    
                        'k_ck' => $resulte['tk_kel'],
                        'h_ck' => $resulte['tk_has']                        
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   

    }


	function load_det_keg_ubah(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where left(kd_skpd,7)=left('$kdskpd',7) and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai_ubah'],
                        'm_tu' => $resulte['tu_mas_ubah'],
                        'k_tu' => $resulte['tu_kel_ubah'],
                        'h_tu' => $resulte['tu_has_ubah'],
                        'cp_ck' => $resulte['tk_capai_ubah'],
						'm_ck' => $resulte['tk_mas_ubah'],
                        //'m_ck' => 'Rp. '.number_format($resulte['tk_mas']),
                        'k_ck' => $resulte['tk_kel_ubah'],
                        'h_ck' => $resulte['tk_has_ubah']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}

    function simpan_det_keg(){
        
        $skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        $ang_lalu=$this->input->post('lalu');
        $ang_depan=$this->input->post('depan');

        
        $this->db->query(" update trskpd set tu_capai='$cp_tu', 
                                             tu_mas='$m_tu',            
                                             tu_kel='$k_tu',            
                                             tu_has='$h_tu',
                                             tk_capai='$cp_ck',
                                             tk_mas='$m_ck',
                                             tk_kel='$k_ck',
                                             tk_has='$h_ck',
                                             tu_capai_sempurna='$cp_tu', 
                                             tu_mas_sempurna='$m_tu',           
                                             tu_kel_sempurna='$k_tu',           
                                             tu_has_sempurna='$h_tu',
                                             tk_capai_sempurna='$cp_ck',
                                             tk_mas_sempurna='$m_ck',
                                             tk_kel_sempurna='$k_ck',
                                             tk_has_sempurna='$h_ck',
                                             tu_capai_ubah='$cp_tu', 
                                             tu_mas_ubah='$m_tu',           
                                             tu_kel_ubah='$k_tu',           
                                             tu_has_ubah='$h_tu',
                                             tk_capai_ubah='$cp_ck',
                                             tk_mas_ubah='$m_ck',
                                             tk_kel_ubah='$k_ck',
                                             tk_has_ubah='$h_ck',
                                             lokasi='$lokasi',
                                             sasaran_giat='$sasaran',
                                             waktu_giat='$wkeg',
                                             kd_pptk='$ttd',
                                             ang_depan='$ang_depan',
                                             ang_lalu='$ang_lalu'
        where kd_kegiatan='$giat'  "); 
    }//pindah 23-11-2017 (16)
/**/
     function simpan_det_keg_ubah(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        $this->db->query(" update trskpd set tu_mas_ubah='$m_tu',			
											 tu_kel_ubah='$k_tu',			
											 tu_has_ubah='$h_tu',
											 tk_capai_ubah='$cp_ck',
											 tk_mas_ubah='$m_ck',
											 tk_kel_ubah='$k_ck',
											 tk_has_ubah='$h_ck',
											 lokasi='$lokasi',
											 sasaran_giat='$sasaran',
											 waktu_giat='$wkeg',
											 kd_pptk='$ttd'
		where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$giat'  "); 
	}


function get_realisasi_rek($cskpd=''){
        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $rek5 = $this->input->post('rek5');

        
        $query1 = $this->db->query("SELECT SUM(nilai) as rektotal, SUM(nilai_sempurna) as rektotal_sempurna, SUM(nilai_ubah) as rektotal_ubah,
        ( SELECT SUM(nilai) FROM 
                    (select sum(a.nilai) nilai 
                    from trdspp a 
                    inner join trhspp b on a.no_spp=b.no_spp AND a.kd_skpd=b.kd_skpd
                    where a.kd_kegiatan='$kegiatan' and a.kd_rek5='$rek5' and left(a.kd_skpd,7)=left('$kdskpd',7)
                    AND b.jns_spp IN ('3','4','5','6')
                    and (b.sp2d_batal !='1' or b.sp2d_batal IS NULL) 
                    UNION ALL
                    SELECT SUM(nilai) as nilai FROM trdtagih t 
                    INNER JOIN trhtagih u 
                    ON t.no_bukti=u.no_bukti AND t.kd_skpd=u.kd_skpd
                    WHERE 
                    t.kd_kegiatan = '$kegiatan'
                    AND left(u.kd_skpd,7)=left('$kdskpd',7)
                    AND t.kd_rek = '$rek5'
                    AND u.no_bukti 
                    NOT IN (select no_tagih FROM trhspp WHERE left(kd_skpd,7)=left('$kdskpd',7))
                    UNION ALL
                    SELECT SUM(a.nilai) nilai FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
                    WHERE a.kd_kegiatan='$kegiatan' and a.kd_rek5='$rek5' and left(a.kd_skpd,7)=left('$kdskpd',7) AND b.jns_spp IN ('1','2')
                    
                    UNION ALL                    
                    SELECT SUM(a.nilai) nilai FROM trdtransout a INNER JOIN trhtransout b ON a.no_bukti=b.no_bukti AND a.kd_skpd=b.kd_skpd
                    WHERE a.kd_kegiatan='$kegiatan' and a.kd_rek5='$rek5' and left(a.kd_skpd,7)=left('$kdskpd',7) AND b.jns_spp IN ('4','6') and panjar in ('3')                    

                    UNION ALL
                    SELECT SUM(a.nilai) nilai FROM trdtransout_cmsbank a INNER JOIN trhtransout_cmsbank b ON a.no_voucher=b.no_voucher AND a.kd_skpd=b.kd_skpd
                    WHERE a.kd_kegiatan='$kegiatan' and a.kd_rek5='$rek5' and left(a.kd_skpd,7)=left('$kdskpd',7) AND b.status_validasi = '0'
                    
                    )b)
          as rektotal_realisasi
          FROM trdrka WHERE kd_rek5='$rek5' and kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$kdskpd',7)");
        
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['rektotal_realisasi'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }


    function simpan_dhukum(){

		$skpd  = $this->input->post('skpd');
        $giat  = $this->input->post('giat');
        $isi   = $this->input->post('cisi');      
        $rek5   = $this->input->post('rek5');      
        $pecah = explode('||',$isi);
		$pj    = count($pecah);

		$this->db->query(" delete from d_hukum where kd_skpd='$skpd' and kd_kegiatan='$giat' and kd_rek5='$rek5' "); 		
		$this->db->query(" delete from d_hukum_sempurna where kd_skpd='$skpd' and kd_kegiatan='$giat' and kd_rek5='$rek5' "); 		
		$this->db->query(" delete from d_hukum_ubah where kd_skpd='$skpd' and kd_kegiatan='$giat' and kd_rek5='$rek5' "); 
	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum(kd_skpd,kd_kegiatan,kd_rek5,dhukum) values('$skpd','$giat','$rek5','".$pecah[$i]."') ");
				$this->db->query(" insert into d_hukum_sempurna(kd_skpd,kd_kegiatan,kd_rek5,dhukum) values('$skpd','$giat','$rek5','".$pecah[$i]."') "); 
				$this->db->query(" insert into d_hukum_ubah(kd_skpd,kd_kegiatan,kd_rek5,dhukum) values('$skpd','$giat','$rek5','".$pecah[$i]."') "); 	
			}
		}
	}
    
    function simpan_dhukum_ubah(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $isi=$this->input->post('cisi');      
        $pecah=explode('||',$isi);
		$pj=count($pecah);

		$this->db->query(" delete from d_hukum_ubah where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		
	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum_ubah(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 		
			}
		}

	}

	function cek_cek(){
		//$xxx=$_SERVER['REQUEST_URI'];
		//$ccc=explode("/",$xxx);
		//$vvv=$ccc[1]."/".$ccc[2]."/".$ccc[3];
		$vvvx="tambah_rka";
   	 	header("Refresh: 1; URL=$vvvx");
   	 	//echo $vvvx;
	}

//pindah 23-11-2017 (5)    
   function pgiat($cskpd='') {
   	 	$vvv="tambah_rka";
   	 	//header("Refresh: 1; URL=$vvv");
   	 	
       $where_baru = "";
         //$where_baru = "";

        $cskpdd = substr($cskpd,0,7);
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_skpd,a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,status_keg FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan=b.kd_kegiatan
                 where left(a.kd_skpd,7) ='$cskpdd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') ) $where_baru
                 order by a.kd_kegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd'  => $resulte['kd_skpd'],  
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'status_keg'   => $resulte['status_keg']
                        );
                        $ii++;
        }
        echo json_encode($result);
           
    }    
    
    
    
     function psgiat($bidskpd='') {
        $cskpd = $this->session->userdata('kdskpd');
        $cskpdd = substr($cskpd,0,7);
        $bid = $cskpd;
        $cek = explode(".",$bid);
        $ck = $cek[3];  
        
        if($ck=="00"){
            $where = "where SUBSTRING(a.kd_kegiatan,6,7)='$cskpd'";
        }else{
            $where ="where SUBSTRING(a.kd_bidsubkegiatan,6,10)='$bid'";
        }
        
        $sql = 
        
        $lccr = $this->input->post('q');
        $sql1  = $this->db->query("SELECT a.kd_kegiatan,'lanjut' as jns_kegiatan FROM m_giat a 
                  $where");                
        $result = array();              
        foreach($sql1->result_array() as $hasil)
        {          
                  
        $jns_kegiatan = $hasil['jns_kegiatan'];
        $kd_kegiatan = $hasil['kd_kegiatan'];                    

        $sql  = "SELECT a.kd_kegiatan,a.nm_kegiatan FROM m_giat a 
                  where kd_kegiatan='$kd_kegiatan'";
        
        $query1 = $this->db->query($sql);          
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $jns_kegiatan
                        );
                        $ii++;
        }
        }
        echo json_encode($result);
    	   
	}
   
function pgiat_pend($cskpd='') {
        
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan FROM trskpd_pend a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                 where a.kd_skpd='$cskpd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') )";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan']
                        );
                        $ii++;
        }
        echo json_encode($result);
    	   
	}
       


    function urusan() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_urusan,nm_urusan FROM ms_urusan where upper(kd_urusan) like upper('%$lccr%') or upper(nm_urusan) like upper('%$lccr%') order by kd_urusan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_urusan' => $resulte['kd_urusan'],  
                        'nm_urusan' => $resulte['nm_urusan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

    function session_skpd() {
        $skpd = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd='$skpd' order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}
    
    function skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}
    
	function config_skpd(){
        $skpd      = $this->session->userdata('kdskpd');
        $tahun     = $this->session->userdata('pcThang');
		$user      = $this->session->userdata('pcNama');
        $bidang    = $skpd;
        $kd_bidang = "";
        $nm_bidang = "";
                         
        $cek = explode(".",$bidang);
        $ckbid = $cek[3];
        if($ckbid!="00"){
           $kd_bidang = "";
           $nm_bidang = ""; 
           //$sqll = $this->db->query("select nm_bidang from ms_bidang where kd_bidskpd='$bidang'")->row();
           //$kd_bidang = $bidang;
           //$nm_bidang = $sqll->nm_bidang; 
        }else{
           $kd_bidang = "";
           $nm_bidang = ""; 
        }
                        
        
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_ubah FROM  ms_skpd a LEFT JOIN trhrka b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'statu' => $resulte['statu'],
                        'status_ubah' => $resulte['status_ubah'],
                        'kd_bidang' => $kd_bidang,
                        'nm_bidang' => $nm_bidang,
                        'tanggaran' => $tahun,
						'user_name' => $user		
                        );
                        $ii++;
        }
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	
    function config_skpd_2(){
        $skpd     = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM  ms_skpd where kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		$result = array();
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }
    
    function giat($cskpd='') {
        
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)=left('$cskpd',4) or left(kd_kegiatan,4)='0.00')";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function kegiatan($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$cskpd',4) or left(kd_kegiatan,4)='0.00') and 
        (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function tambah_giat()
	{
		/*$wy=$this->rka_model->combo_urus();
        $jk=$this->rka_model->combo_skpd1();         
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode Urusan</td>
                        <td>:</td>
                        <td>$wy</td>
                        </tr>
                  ";
         
         $cRet .="<tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;*/
        if($this->auth->is_logged_in() == false)
   		{      	
      		$this->auth->do_logout();				
			redirect(site_url().'/welcome/index');
   		}else{
        $data['page_title']= 'PILIH KEGIATAN';
        $this->template->set('title', 'DETAIL KEGIATAN');          
        $this->template->load('template','anggaran/rka/pilih_giat',$data) ; 
        //$this->load->view('anggaran/rka/tambah_rka',$data) ;
        }
   }
   
   function select_giat($skpd='') {    
        $sql = "select a.kd_kegiatan1 as kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,a.lanjut from trskpd a inner join m_giat b on b.kd_kegiatan=a.kd_kegiatan1 where a.kd_skpd='$skpd' order by a.kd_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],                         
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'jns_kegiatan' => $resulte['jns_kegiatan'],                           
                        'lanjut' => $resulte['lanjut']                           
                        );
                        $ii++;
        }
        echo json_encode($result);
    }
    
       function select_subgiat($skpd='') {
        $skpdd = $this->session->userdata('kdskpd');
        /*$bidang = $skpdd;
        $subskpd = substr($skpdd,0,7);
        
        if($skpd==''){
           $skpd = $skpdd; 
           
        $cek = explode(".",$bidang);
        $bid = $cek[3];
        if($bid=="00"){
            $par = "";
        }else{
            $par = "and kd_skpd='$bidang'";
        }
                                
        $urusan = $cek[0].".".$cek[1];                                    
        }else{             
        $pisah = explode("_",$skpd);
        $kdskpd = $pisah[0];
        $urusan = $pisah[1];
         
        $cek = explode(".",$kdskpd);
        $bid = $cek[3];
        if($bid=="00"){
            $par = "";
        }else{
            $par = "and a.kd_skpd='$kdskpd'";
        }
        
        }*/
                                         
        $sql = "select a.kd_sub_kegiatan,a.nm_sub_kegiatan from ms_sub_kegiatan a 
        where left(a.kd_sub_kegiatan,6)=left('$skpdd',6) order by a.kd_sub_kegiatan";

        /*$sql = "select a.nm_program,a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,a.lanjut from trskpd 
        a inner join ms_kegiatan b on b.kd_kegiatan=a.kd_kegiatan where a.kd_skpd='$skpdd' order by a.kd_kegiatan";
        */
        
		$query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            /*$result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'], 
                        'nm_program' => $resulte['nm_program'],                          
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'jns_kegiatan' => $resulte['jns_kegiatan'],                           
                        'lanjut' => $resulte['lanjut']                           
                        );*/

            $result[] = array(
                'id' => $ii,
                'kd_sub_kegiatan' => $resulte['kd_sub_kegiatan'],                         
                'nm_sub_kegiatan' => $resulte['nm_sub_kegiatan']                   
                );                        
            $ii++;
        }
        echo json_encode($result);
    }
        
     function ld_mgiat() { 
        $skpd = $this->session->userdata('kdskpd');
        $urusan = $_REQUEST['kode'];        
        
        $lccr = $this->input->post('q');
//        $sql = "SELECT kd_program,kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where SUBSTRING(kd_kegiatan,6,10)= '$skpd' and left(kd_kegiatan,4)= $urusan or (left(kd_kegiatan,4)='0.00') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
          $sql = "SELECT kd_program,nm_program,kd_skpd from m_prog where kd_skpd= '$skpd' and (upper(kd_program) like upper('%$lccr%') or upper(nm_program) like upper('%$lccr%')) order by kd_program ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_program' => $resulte['kd_program'],    
//                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
//                        'nm_kegiatan' => $resulte['nm_kegiatan'],
						'nm_program' => $resulte['nm_program'],
//                        'jns_kegiatan' => $resulte['jns_kegiatan'],
//                        'lanjut' => 'Tidak'

                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function ld_mgiat_pa() { 
        $skpd = $this->session->userdata('kdskpd');
        $lccr = $this->input->post('q');
        $sql = "SELECT left(a.kd_sub_kegiatan,7) as kd_program,
(select nm_program from ms_program where kd_program=left(a.kd_sub_kegiatan,7)) nm_program
from trdrka a where left(a.kd_skpd,17)= left('$skpd',17) 
group by left(a.kd_sub_kegiatan,7)
order by left(a.kd_sub_kegiatan,7)";
        //$sql = "SELECT kd_program,nm_program from ms_program where left(kd_bidang_urusan,4)= left('$skpd',4) and (upper(kd_program) like upper('%$lccr%') or upper(nm_program) like upper('%$lccr%')) order by kd_program ";
        
        //$sql = "SELECT kd_program,nm_program,kd_skpd from m_prog where left(kd_skpd,7)= left('$skpd',7) and (upper(kd_program) like upper('%$lccr%') or upper(nm_program) like upper('%$lccr%')) order by kd_program ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_program' => $resulte['kd_program'],    
						'nm_program' => $resulte['nm_program'],
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function ld_giat($skpd='',$urusan='') { 
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$skpd',4) or left(kd_kegiatan,4)= $urusan or left(kd_kegiatan,4)='0.00') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'lanjut' => 'Tidak'

                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
	
	function ld_subgiat($skpd='',$urusan='',$keg='') { 
        $lccr = $this->input->post('q');
        
        $skpd = $this->session->userdata('kdskpd');                      
        
     //   $sql = "SELECT kd_kegiatan,kd_subkegiatan,nm_subkegiatan,jns_kegiatan FROM m_sub_giat where kd_kegiatan='$keg' and (left(kd_subkegiatan,4)= left('$skpd',4) or left(kd_subkegiatan,4)= $urusan or left(kd_subkegiatan,4)='0.00') and (upper(kd_subkegiatan) like upper('%$lccr%') or upper(nm_subkegiatan) like upper('%$lccr%')) order by kd_subkegiatan ";
        $sql = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM trskpd where kd_program='$keg' and left(kd_kegiatan,4)= '$urusan' or left(kd_kegiatan,4)='0.00' and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
//						'kd_subkegiatan' => $resulte['kd_subkegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'lanjut' => 'Tidak'

                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

 	function ld_lanjut() {
    
           
		$result[] = array('lanjut' => 'Ya');
		$result[] = array('lanjut' => 'Tidak');                       
           
        echo json_encode($result);
    	   
	}
   
    function cek_subgiat(){
      $giat = $this->input->post('cid');
        
        $cek_cou = $this->db->query("select count(a.kd_kegiatan) as kd from trskpd a
        inner join trdrka b on a.kd_kegiatan=b.kd_kegiatan and 
        LEFT(a.kd_skpd,7)=LEFT(b.kd_skpd,7) where a.kd_kegiatan='$giat'")->row();
        $cek_count = $cek_cou->kd;
        if($cek_count==0){
            $nama = "1";
        }else{
        
        $sql = $this->db->query("select right(kd_skpd,2) as kode, kd_skpd from trskpd where kd_kegiatan='$giat'")->row();
        $cek = $sql->kode;
        $cekskpd = $sql->kd_skpd;
        
        if($cek!="00"){
            $sql = $this->db->query("select nm_bidang from ms_bidang where kd_bidskpd='$cekskpd'")->row();
            $nama = $sql->nm_bidang;            
        }else{
            $nama = "0";
        }
                        
        }
        echo $nama;    	   	
    }
   
    function ld_jns() {    
        $sql = "SELECT jns_kegiatan FROM m_giat group by jns_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'jns_kegiatan' => $resulte['jns_kegiatan']                                               
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
 function psimpan($bid='',$skpd='',$urusan='',$rekbaru='',$reklama='',$jns='',$lanjut='Tidak') {      	    
            
    //$kd=$this->right($rekbaru,5);
    //$prog1=$this->left($rekbaru,13);	
	//$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
    //$giat=$urusan.'.'.$skpd.'.'.$kd;
    //$prog=$this->left($giat,18);
    $bidskpd = substr($skpd,0,7);
    $kd1=$this->right($rekbaru,8);
    //$ckskpd = explode(".",$skpd);
    //$ckp = $ckskpd[0].".".$ckskpd[1].".".$ckskpd[2];
    //$bidskpd = $ckp.".".$bid;     
    
    $gabung=$skpd.".".$rekbaru;
    $bidsubgiat = $urusan.".".$bid.".".$kd1;            
    
   
    $this->db->query("update trskpd set kd_skpd='$bid' where kd_gabungan='$gabung' and left(kd_skpd,7)='$bidskpd'");
    $this->db->query("update trdrka set kd_skpd='$bid' where kd_kegiatan='$rekbaru' and left(kd_skpd,7)='$bidskpd'");    
    
		
    $this->select_subgiat($skpd);          
    }
    
    function ghapus($skpd='',$kegiatan='') {
    	
		$query = $this->db->query("delete from trskpd where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and  kd_kegiatan not in(SELECT DISTINCT kd_kegiatan FROM trdrka)");
		$this->select_giat($skpd);
    }

    function jjhapus($kegiatan='') {
        $kegiatan = $this->uri->segment(3);
    	$skpd=$this->session->userdata('kdskpd');        
        
        $cek = $this->db->query("select count(*) as jum from trskpd where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7)")->row();
        $hasil = $cek->jum;
        if($hasil!=0){
		$query = $this->db->query("update trskpd set kd_skpd='$skpd' where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7)");
        }
        //if($query){
        $query = $this->db->query("update trdrka set kd_skpd='$skpd' where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7)");   
        //}          
		if($query){
		  echo '1';
		}
        //$this->select_subgiat($skpd);
    }

    function anggaran_kas()
	{
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS');   
        $this->template->load('template','anggaran/rka/anggaran_kas',$data) ; 
   }
       
   function load_trdskpd(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => $resulte['nilai']                                                                
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   
    function load_trskpd1() {
        $cskpd=$this->uri->segment(3); 
        $jns_beban = '';
        $where = '';
        $spdlalu = ',0 as lalu';            
       
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total_ubah,a.total $spdlalu FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) $jns_beban $where AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'lalu'       => $resulte['lalu'],
                        'total'       => $resulte['total'],
                        'total_ubah'  => $resulte['total_ubah']        
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    
function realisasi_angkas($skpd=''){
        $skpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        
        $query1 = $this->db->query("select SUM(CASE WHEN awal >='1' and akhir <= '3' then nilai ELSE 0 END) as triw1,
SUM(CASE WHEN awal >='4' and akhir <= '6' then nilai ELSE 0 END) as triw2,
SUM(CASE WHEN awal >='7' and akhir <= '9' then nilai ELSE 0 END) as triw3,
SUM(CASE WHEN awal >='10' and akhir <= '12' then nilai ELSE 0 END) as triw4
 FROM 
(select a.bulan_awal as awal,a.bulan_akhir as akhir,a.no_spd,a.kd_skpd,b.kd_kegiatan,sum(b.nilai_final) as nilai from trhspd a INNER JOIN
trdspd b on a.no_spd =b.no_spd where b.kd_kegiatan ='$kegiatan' and a.kd_skpd ='$skpd'
group by a.no_spd,a.kd_skpd,b.kd_kegiatan,a.bulan_awal,a.bulan_akhir
)a
");
        
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'triw1' => number_format($resulte['triw1'],2,'.',','),                                              
                            'triw2' => number_format($resulte['triw2'],2,'.',','),                                             
                            'triw3' => number_format($resulte['triw3'],2,'.',','),                                            
                            'triw4' => number_format($resulte['triw4'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }
    
    function load_giat() {
        $cskpd=$this->uri->segment(3); 
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_skpd,a.kd_kegiatan,a.nm_kegiatan,a.kd_program,a.nm_program,(SELECT SUM(nilai)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total,
                (SELECT SUM(nilai_sempurna)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total_sempurna,
                (SELECT SUM(nilai_ubah)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total_ubah FROM trskpd a  
                WHERE left(kd_skpd,7)= left('$cskpd',7)  AND (UPPER(kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(nm_kegiatan) LIKE UPPER('%$lccr%')) order by a.kd_kegiatan";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => number_format($resulte['total'],"2",".",","),
                        'total_sempurna'       => number_format($resulte['total_sempurna'],"2",".",","),
                        'total_ubah'  => number_format($resulte['total_ubah'],"2",".",",")   
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
           
    }
    
    
    
        function load_trskpd() {
        //$cskpd=$this->uri->segment(3);
        $cskpd = $this->input->post('kode');
        $jenis = $this->input->post('jenis');//'52';
        $giat = $this->input->post('giat');
        $no = $this->input->post('no');                        
        if ($jenis !=''){
            $jns_beban = " and a.jns_kegiatan='$jenis' ";
        } else {
            $jns_beban = '';
        }
        if ($giat !=''){                                    
            $where = " and a.kd_kegiatan not in ($giat) ";
        } else {
            $where = '';
        }
        if ($no!=''){
            $spdlalu = ",(SELECT SUM(nilai_final) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu";
        } else {
            $spdlalu = ',0 as lalu';            
        }
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total $spdlalu FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) $jns_beban $where AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'lalu'       => $resulte['lalu'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    
	/*
    function simpan_trskpd(){
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','1','$bln1','$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','2','$bln2','$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','3','$bln3','$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','4','$bln4','$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','5','$bln5','$status') ";
                $asg = $this->db->query($sql5);        
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','6','$bln6','$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','7','$bln7','$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','8','$bln8','$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','9','$bln9','$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','10','$bln10','$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','11','$bln11','$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','12','$bln12','$status') ";
                $asg = $this->db->query($sql12);         
                $sql13 = "update trskpd set triw1='$tr1',triw2='$tr2',triw3='$tr3',triw4='$tr4' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
        } else {
            echo '0';
            exit();
        }
        echo '1';
    }
	*/
	
	
function simpan_trskpd(){
        
        $cskpda=$this->input->post('cskpda');
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpda.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','1','$bln1','$bln1',$bln1,$bln1,'0','','','') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','2','$bln2','$bln2',$bln2,$bln2,'0','','','') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','3','$bln3','$bln3',$bln3,$bln3,'0','','','') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','4','$bln4','$bln4',$bln4,$bln4,'0','','','') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','5','$bln5','$bln5',$bln5,$bln5,'0','','','') ";
                $asg = $this->db->query($sql5);       
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','6','$bln6','$bln6',$bln6,$bln6,'0','','','') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','7','$bln7','$bln7',$bln7,$bln7,'0','','','') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','8','$bln8','$bln8',$bln8,$bln8,'0','','','') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','9','$bln9','$bln9',$bln9,$bln9,'0','','','') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','10','$bln10','$bln10',$bln10,$bln10,'0','','','') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','11','$bln11','$bln11',$bln11,$bln11,'0','','','') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','12','$bln12','$bln12',$bln12,$bln12,'0','','','') ";
                $asg = $this->db->query($sql12); 
                $ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1='$tr1',triw1_sempurna='$tr1',triw1_ubah='$tr1',
                triw2='$tr2',triw2_sempurna='$tr2',triw2_ubah='$tr2',
                triw3='$tr3',triw3_sempurna='$tr3',triw3_ubah='$tr3',
                triw4='$tr4',triw4_sempurna='$tr4',triw4_ubah='$tr4',
                total='$ntotal',total_sempurna='$ntotal',total_ubah='$ntotal',kd_skpd='$cskpd' where kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       

        } else {
            echo '0';
            exit();
        }
        
        echo '1';
    }

    function simpan_trskpd_rek(){
        
        $kdrek5 = $this->input->post('rek');
        
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_skpd='$cskpd' and kd_kegiatan='$cgiat' and kd_rek5='$kdrek5'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','1','$bln1','$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','2','$bln2','$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','3','$bln3','$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','4','$bln4','$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','5','$bln5','$status') ";
                $asg = $this->db->query($sql5);        
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','6','$bln6','$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','7','$bln7','$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','8','$bln8','$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','9','$bln9','$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','10','$bln10','$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','11','$bln11','$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','$kdrek5','12','$bln12','$status') ";
                $asg = $this->db->query($sql12);         
                $sql13 = "update trskpd set triw1='$tr1',triw2='$tr2',triw3='$tr3',triw4='$tr4' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
        } else {
            echo '0';
            exit();
        }
        echo '1';
    }

	function cek_simpan(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');

		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
			$msg = array('pesan'=>'1');
			echo json_encode($msg);
		} else{
			$msg = array('pesan'=>'0');
			echo json_encode($msg);
		}
		
	}
	
	
////////////SPD MULAI
function spd()
    {
        $data['page_title']= 'INPUT S P D';
        $this->template->set('title', 'INPUT S P D');   
        $this->template->load('template','anggaran/rka/spd',$data) ; 
    }
    
	    function config_spd()
    {
        $data['page_title']= 'INPUT KONFIGURASI S P D';
        $this->template->set('title', 'INPUT KONFIGURASI S P D');   
        $this->template->load('template','anggaran/rka/config_spd',$data) ; 
    }
	
    function load_spd() {
		$kd_skpd = $this->session->userdata('kdskpd'); 
		//$kd_skpd = '1.20.08.10'; 
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ="WHERE a.kd_skpd='$kd_skpd'";
        if ($kriteria <> ''){                               
            $where="AND (upper(a.no_spd) like upper('%$kriteria%') or a.tgl_Spd like '%$kriteria%' or upper(a.nm_skpd) like 
                    upper('%$kriteria%') or upper(a.kd_skpd) like upper('%$kriteria%') or upper(a.jns_beban) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhspd a $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();
        
        //$sql = "SELECT *,IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung') AS nm_beban from trhspd $where order by tgl_Spd,kd_skpd limit $offset,$rows";
		
        $sql = "SELECT TOP $rows  a.*,nama,case when jns_beban='52' then 'Belanja Langsung' else 'Belanja Tidak Langsung' end AS nm_beban from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip  $where  AND no_spd not in (SELECT TOP $offset  no_spd from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip ) order by tgl_Spd,kd_skpd ";
        $query1 = $this->db->query($sql);       
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'tgl_spd' => $resulte['tgl_spd'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
						'ketentuan' => $resulte['klain'],
						'nama_bend' => $resulte['nama'],
						'nip' => $resulte['kd_bkeluar'],						
                        'jns_beban' => $resulte['jns_beban'],
                        'nm_beban' => $resulte['nm_beban'],
                        'bulan_awal' => $resulte['bulan_awal'],
                        'bulan_akhir' => $resulte['bulan_akhir'],
                        'total' => $resulte['total'],                                                                      
                        'status' => $resulte['status']                                                                      
                        );
                        $ii++;
        }
        $result["rows"] = $row;           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function load_dspd_ar($skpd='') {            
        $no = $this->input->post('no');
		$jenis = $this->input->post('jenis');
				$skpd = $this->input->post('skpd');
		$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="nilai";		
			$sts="susun";		
		}else{
			$field="nilai_ubah";				
			$sts="ubah";		
		}
		
		if ($jenis=='52'){
        $sql = "SELECT a.*,kd_rek5,nm_rek5 ,(SELECT SUM(nilai_final) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu,
                (SELECT SUM(total) FROM trskpd WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd ) AS anggaran from trdspd a inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
		}else {
        $sql = "SELECT a.*,kd_rek5,nm_rek5 ,isnull((SELECT SUM(nilai_final) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd 
				WHERE n.kd_kegiatan=a.kd_kegiatan  and kd_rek5=a.kd_Rek5 and m.no_spd <> '$no'),0) AS lalu,
				(SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_Rek5 ) AS anggaran from trdspd a
				inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";

		}
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
                        'nilai'       => number_format($resulte['nilai'],"2",".",","),
                        'lalu'        => number_format($resulte['lalu'],"2",".",","),
                        'anggaran'    => number_format($resulte['anggaran'],"2",".",",")                               
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    
    function load_dspd() {            
        $no = $this->input->post('no');
        $sql = "SELECT a.*,(SELECT SUM(nilai_final) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu,
                (SELECT SUM(total) FROM trskpd WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd ) AS anggaran from trdspd a inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
						'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
                        'kd_program' => $resulte['kd_program'],
                        'nm_program' => $resulte['nm_program'],
                        'nilai' => $resulte['nilai'],
                        'lalu' => $resulte['lalu'],
                        'anggaran' => $resulte['anggaran']                                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    
    function spd_lalu(){
        $kegiatan = $this->input->post('cgiat');
        $tgl = $this->input->post('ctgl');     
        //$kegiatan = '1.01.1.01.01.00.01.01';
        //$tgl = '2012-10-29';      
        $sql = "SELECT SUM(nilai) as lalu FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd WHERE a.kd_kegiatan='$kegiatan' AND tgl_spd < '$tgl'";
        $query1 = $this->db->query($sql);  
        $row = $query1->row();
        $result[] = array('lalu' => $row->lalu);
        echo json_encode($result);
        $query1->free_result();
    }
    
    function simpan_spd(){
        $tabel  = $this->input->post('tabel');
        $idx    = $this->input->post('cidx');
        $nomor  = $this->input->post('no');
        $nomor2  = $this->input->post('no2');
		$mode_tox= $this->input->post('mode_tox');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd = $this->input->post('nmskpd');
        $bend   = $this->input->post('bend');
        $bln1   = $this->input->post('bln1');
        $bln2   = $this->input->post('bln2');
        $ketentuan  = $this->input->post('ketentuan');
        $pengajuan  = $this->input->post('pengajuan');
        $jenis      = $this->input->post('jenis');
        $total      = $this->input->post('total');
        $csql       = $this->input->post('sql');        
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('Y-m-d H:i:s');    
        $msg = array();                
        // Simpan Header //
        if ($tabel == 'trhspd') {
			if ($mode_tox=='tambah'){
//            $sql = "delete from  $tabel where kd_skpd='$skpd' and no_spd='$nomor'";
//           $asg = $this->db->query($sql);
           //if ($asg){
                $sql = "insert into  $tabel (no_spd,tgl_spd,kd_skpd,nm_skpd,jns_beban,bulan_awal,bulan_akhir,total,klain,kd_bkeluar,username,tglupdate) 
                        values('$nomor','$tgl','$skpd', rtrim('$nmskpd'),'$jenis','$bln1','$bln2','$total', rtrim('$ketentuan'),'$bend','$usernm','$update')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                } else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                }          
            //} else {
           //     $msg = array('pesan'=>'0');
            //    echo json_encode($msg);
             //   exit();
            //}
			} else {
                $sql = "update $tabel set 
					no_spd='$nomor',tgl_spd='$tgl',kd_skpd='$skpd',nm_skpd=rtrim('$nmskpd'),
					jns_beban='$jenis',bulan_awal='$bln1',bulan_akhir='$bln2',total='$total',klain=rtrim('$ketentuan'),kd_bkeluar='$bend',username='$usernm',tglupdate='$update'
					where no_spd='$nomor2' ";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                } else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                }          
 				
			}
			
        } else if ($tabel == 'trdspd') {
            
            // Simpan Detail //                       
                $sql = "delete from  $tabel where no_spd='$nomor'";
                $asg = $this->db->query($sql);
                if (!($asg)){
                   $msg= array('pesan'=>'0');
                   echo json_encode($msg);
                   exit();
                } else {
                    $sql = "insert into  $tabel(no_spd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,kd_program,nm_program,nilai)";                        
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }                                                             
        }
        //$asg->free_result();
    }
    
    function hapus_spd(){
        $nomor = $this->input->post('no');
        $msg = array();         
        $sql = "delete from trdspd where no_spd='$nomor'";
        $asg = $this->db->query($sql);
        if ($asg){
            $sql = "delete from trhspd where no_spd='$nomor'";
            $asg = $this->db->query($sql);
            if (!($asg)){
               $msg = array('pesan'=>'0');
               echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
          $msg = array('pesan'=>'1');
          echo json_encode($msg);              
    } 
    
    function cetak_lampiran_spd1(){
        
        $lntahunang = $this->session->userdata('pcThang');       
        $lcnospd = $this->input->post('nomor1');        
        $csql = "SELECT (SELECT no_dpa FROM trhrka WHERE kd_skpd = a.kd_skpd) AS no_dpa,
                (SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan IN(SELECT kd_kegiatan FROM trdspd WHERE no_spd=a.no_spd)
                 AND kd_skpd = a.kd_skpd) jm_ang,
                (SELECT SUM(total_hasil) FROM trhspd WHERE kd_skpd = a.kd_skpd AND jns_beban=a.jns_beban AND 
                tgl_spd<=a.tgl_spd AND no_spd<>a.no_spd) AS jm_spdlalu,
                a.total AS jm_spdini,a.jns_beban,a.bulan_awal,a.bulan_akhir
                FROM trhspd a WHERE a.no_spd = '$lcnospd'";
                
        $hasil = $this->db->query($csql);
        $data1 = $hasil->row();
        $periode1 = $this->rka_model->getBulan($data1->bulan_awal);
        $periode2 = $this->rka_model->getBulan($data1->bulan_akhir);
        $jnsspd = $data1->jns_beban;
        $lnsisa = $data1->jm_ang - $data1->jm_spdlalu - $data1->jm_spdini;
        
        $cRet = '';
        
        if($jnsspd=='51'){            
                
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                 <tr>
                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:10px\">
                    LAMPIRAN SPD NOMOR : $lcnospd<br>
                    BELANJA TIDAK LANGSUNG<BR>
                    PERIODE BULAN: $periode1 S/D $periode2 <BR>
                    TAHUN ANGGARAN: $lntahunang
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
                <tr>
                    <td width=\"20%\" align=\"center\" style=\"font-size:12px\">Nomor DPA-/DPPA-SKPD        
                    </td>
                    <td width=\"20%\" align=\"center\" style=\"font-size:12px\">Anggaran        
                    </td>
                    <td width=\"20%\" align=\"center\" style=\"font-size:12px\">Akumulasi pada SPD<br>Sebelumnya        
                    </td>
                    <td width=\"20%\" align=\"center\" style=\"font-size:12px\">Jumlah Pada SPD<br>Periode ini        
                    </td>
                    <td width=\"20%\" align=\"center\" style=\"font-size:12px\">Sisa Anggaran
                    </td>
                </tr>";
                $cRet .="
                <tr>
                    <td align=\"center\" style=\"font-size:12px\">$data1->no_dpa        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_ang)."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_spdlalu)."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_spdini)."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($lnsisa)."&nbsp;
                    </td>
                </tr>";
                $cRet .="
                <tr>
                    <td colspan=\"5\" style=\"border-bottom:none;border-right:none;border-left:none;font-size:10px\">
                       <br>Jumlah Dana Belanja Langsung : Rp ".number_format($data1->jm_spdini)."<br><i>(".$this->rka_model->terbilang(ceil($data1->jm_spdini))." rupiah)</i>
                    </td>                             
                 </tr>
                 <tr>
                    <td colspan=\"3\" style=\"border: solid 1px white;font-size:10px\">
                    </td>
                    <td colspan=\"2\" style=\"border: solid 1px white;font-size:10px\" align=\"center\">
                        Ditetapkan di<br>
                        pada tanggal<br>
                        <br>&nbsp;
                        <br>&nbsp;
                        <b>PPKD SELAKU BUD,</b>
                        <br>&nbsp;
                        <br>&nbsp;
                        <br>&nbsp;
                        (nama lengkap)<br>
                        NIP.                                
                    </td>           
                </tr>
            </table>";
        }else{
             //echo $jnsspd.'jjj';
        $cRet .="
            <table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                <tr>
                    <td colspan=\"8\" style=\"border-top:none;border-right:none;border-left:none;font-size:10px\">
                    LAMPIRAN SPD NOMOR : $lcnospd<br>
                    BELANJA LANGSUNG<BR>
                    PERIODE BULAN: $periode1 S/D $periode2 <BR>
                    TAHUN ANGGARAN: $lntahunang
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
                <tr>
                    <td width=\"2%\" align=\"center\" style=\"font-size:12px\">No.<br>Urut        
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-size:12px\">Nomor DPA-/DPPA-SKPD        
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-size:12px\">Program        
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-size:12px\">kegiatan        
                    </td>
                    <td width=\"17%\" align=\"center\" style=\"font-size:12px\">Anggaran        
                    </td>
                    <td width=\"17%\" align=\"center\" style=\"font-size:12px\">Akumulasi pada<br>SPD<br>Sebelumnya
                    </td>
                    <td width=\"17%\" align=\"center\" style=\"font-size:12px\">Jumlah<br>Pada SPD<br>Periode Ini
                    </td>
                    <td width=\"17%\" align=\"center\" style=\"font-size:12px\">Sisa Anggaran
                    </td>
                </tr>";
            
            $sql = "SELECT (SELECT no_dpa FROM trhrka WHERE kd_skpd = b.kd_skpd) AS no_dpa,
                    a.kd_program,a.kd_kegiatan,(SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND
                    kd_skpd=b.kd_skpd) AS anggaran,(SELECT SUM(nilai_final) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd
                    WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban) AS spd_lalu,a.nilai FROM 
                    trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd WHERE 
                    a.no_spd = '$lcnospd'";
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
                    foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
                       $lntotal = $lntotal + $row->nilai;
                       $lcsisa = $row->anggaran - $row->spd_lalu - $row->nilai;
                       //echo $row->no_dpa;
                       $cRet .="<tr>
                                    <td width=\"2%\" align=\"center\" style=\"font-size:10px\">$lcno       
                                    </td>
                                    <td width=\"18%\" align=\"left\" style=\"font-size:10px\">$row->no_dpa        
                                    </td>
                                    <td width=\"20%\" align=\"left\" style=\"font-size:10px\">$row->kd_program        
                                    </td>
                                    <td width=\"20%\" align=\"left\" style=\"font-size:10px\">$row->kd_kegiatan        
                                    </td>
                                    <td width=\"10%\" align=\"right\" style=\"font-size:10px\">".number_format($row->anggaran)."&nbsp;        
                                    </td>
                                    <td width=\"10%\" align=\"right\" style=\"font-size:10px\">".number_format($row->spd_lalu)."&nbsp;
                                    </td>
                                    <td width=\"10%\" align=\"right\" style=\"font-size:10px\">".number_format($row->nilai)."&nbsp;
                                    </td>
                                    <td width=\"10%\" align=\"right\" style=\"font-size:10px\">".number_format($lcsisa)."&nbsp;
                                    </td>
                                </tr>";    
                        
                    }
                
            $cRet .="
            </table>";
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" cellspacing=\"0\" cellpadding=\"0\">
            <tr>
            <td colspan=\"8\" style=\"border-bottom:none;border-right:none;border-left:none;font-size:10px\">
            <br>Jumlah Dana Belanja Langsung : Rp ".number_format($lntotal)."<br><i>(".$this->rka_model->terbilang($lntotal)." rupiah)</i>
            </td>           
            </tr>
            <tr>
                <td colspan=\"5\" style=\"border: solid 1px white;font-size:10px\">
                </td>
                <td colspan=\"3\" style=\"border: solid 1px white;font-size:10px\" align=\"center\">
                    Ditetapkan di<br>
                    pada tanggal<br>
                    <br>&nbsp;
                    <br>&nbsp;
                    <b>PPKD SELAKU BUD,</b>
                    <br>&nbsp;
                    <br>&nbsp;
                    <br>&nbsp;
                    (nama lengkap)<br>
                    NIP.                                
                </td>           
            </tr>
            </table>";
            //echo $cRet;
        }
        $data['prev']= $cRet;  
        //echo $data['prev'];  
        $this->rka_model->_mpdf('',$cRet,'10','10',5,'1');
        $hasil->free_result();
    }
    
    
    function cetak_otor_spd(){
        $lcnospd = $this->input->post('nomor1');                
        $csql2 = "select nm_skpd,kd_skpd,tgl_spd,total,bulan_awal,bulan_akhir from trhspd where no_spd = '$lcnospd' ";
        $hasil1 = $this->db->query($csql2);
        $trh1 = $hasil1->row();
        $ldtgl_spd = $trh1->tgl_spd;
        $jmlspdini = number_format(ceil($trh1->total));
        $biljmlini = $this->rka_model->terbilang(ceil($trh1->total));
        $lckdskpd = $trh1->kd_skpd;
        $blnini = $this->rka_model->getBulan($trh1->bulan_awal);
        $blnsd = $this->rka_model->getBulan($trh1->bulan_akhir);
        $lcnmskpd = $trh1->nm_skpd;
        
        // jumlah anggaran
        $csql1 = "SELECT SUM(nilai) AS jumlah FROM trdrka WHERE kd_kegiatan IN 
                  (SELECT kd_kegiatan FROM trdspd WHERE no_spd = '$lcnospd')";
                  
                  
        $hasil1 = $this->db->query($csql1);
        $trh2 = $hasil1->row();
        $jmldpa = number_format(ceil($trh2->jumlah));
        
        
        //spd lalu
        $sql = "select sum(total) as jm_spd_l from trhspd where no_spd<>'$lcnospd' 
                and tgl_spd<='$ldtgl_spd' and kd_skpd='$lckdskpd'";
        $hasil = $this->db->query($sql);
        $trh = $hasil->row();
        $jmlspdlalu = number_format(ceil($trh->jm_spd_l));
        
        
        
        $csql = "SELECT * from sclient";
        $hasil = $this->db->query($csql);
        $trh3 = $hasil->row();
        $jmlsisa = number_format(ceil($trh2->jumlah - $trh->jm_spd_l));
        $jmlsisa2 = number_format(ceil($trh2->jumlah - $trh->jm_spd_l - $trh1->total));
        $bilsisa = $this->rka_model->terbilang(ceil($trh2->jumlah - $trh->jm_spd_l - $trh1->total));
        $cRet = '';
        $cRet .="
        <table border=\"0\" width=\"100%\"  style=\"font-size:12px\">
            <tr>
                <td align=\"center\">
				PEMERINTAH PROVINSI MAHARDIKA<BR>
                PAJABAT PENGELOLA KEUANGAN DAERAH SELAKU BENDAHARA UMUM DAERAH<BR>
                NOMOR 20202 TAHUN 2012<br>
                TENTANG <BR>
                SURAT PENYEDIAAN DANA ANGGARAN BELANJA DAERAH TAHUN ANGGARAN 2012<BR>
                PPKD SELAKU BUD<br><br>&nbsp;
                </td>
            </tr>
        </table>";
        $cRet .="
        <table border=\"0\" width=\"100%\">
            <tr>
                <td align=\"left\" valign=\"top\" width=\"13%\"  style=\"font-size:12px\">
                Menimbang
                </td>
                <td width=\"2%\" align=\"right\" valign=\"top\"  style=\"font-size:12px\">:
                </td>
                <td align=\"justify\" width=\"85%\" colspan=\"2\"  style=\"font-size:12px\">
                    $trh3->spd_head1
                </td>
            </tr>
            <tr>
                <td align=\"left\" valign=\"top\" width=\"13%\" rowspan=\"4\"  style=\"font-size:12px\">
                Mengingat
                </td>
                <td width=\"2%\" align=\"right\" valign=\"top\" rowspan=\"4\" style=\"font-size:12px\">:
                </td>
                <td width=\"2%\" align=\"right\" valign=\"top\" style=\"font-size:12px\" >1.
                </td>
                <td align=\"justify\" width=\"83%\" style=\"font-size:12px\">
                    $trh3->ingat1
                </td>
            </tr>
            <tr>
                <td width=\"2%\" align=\"right\" valign=\"top\"  style=\"font-size:12px\">2.
                </td>
                <td align=\"justify\" width=\"83%\" style=\"font-size:12px\">
                    $trh3->ingat2
                </td>
            </tr>
            <tr>
                <td width=\"2%\" align=\"right\" valign=\"top\"  style=\"font-size:12px\">3.
                </td>
                <td align=\"justify\" width=\"83%\" style=\"font-size:12px\">
                    $trh3->ingat3
                </td>
            </tr>
            <tr>
                <td width=\"2%\" align=\"right\" valign=\"top\" style=\"font-size:12px\" >4.
                </td>
                <td align=\"justify\" width=\"83%\" style=\"font-size:12px\">
                    $trh3->ingat4
                </td>
            </tr>
        </table>";
        
        $cRet .="<br><br>
        <table border=\"0\" width=\"100%\">
            <tr>
                <td colspan=\"5\" align=\"center\" valign=\"top\" width=\"13%\"  style=\"font-size:12px\">
                    MEMUTUSKAN :<br>&nbsp;
                </td>
            </tr>
            <tr>
                <td colspan=\"5\" align=\"justify\" valign=\"top\" width=\"13%\"  style=\"font-size:12px\">
                    &emsp;&emsp;&emsp;$trh3->ingat4<br>&nbsp;
                </td>
            </tr>
            <tr>
                <td width=\"10%\"  style=\"font-size:12px\" align=\"right\">1.
                </td>
                <td colspan=\"2\" width=\"38%\"  style=\"font-size:12px\">Diajukan kepada SKPD
                </td>
                <td  width=\"2%\"  style=\"font-size:12px\">:
                </td>
                <td  width=\"48%\"  style=\"font-size:12px\">&nbsp;$lcnmskpd
                </td>
            </tr>
            <tr>
                <td width=\"2%\"  style=\"font-size:12px\" align=\"right\">2.
                </td>
                <td colspan=\"2\" width=\"38%\"  style=\"font-size:12px\">Nama Bendahara
                </td>
                <td  width=\"2%\"  style=\"font-size:12px\">:
                </td>
                <td  width=\"58%\"  style=\"font-size:12px\">
                </td>
            </tr>
            <tr>
                <td width=\"2%\"  style=\"font-size:12px\" valign=\"top\" align=\"right\">3.
                </td>
                <td colspan=\"2\" width=\"38%\"  style=\"font-size:12px\" valign=\"top\">Jumlah Penyediaan dana
                </td>
                <td  width=\"2%\"  style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\"  style=\"font-size:12px\">Rp. $jmlspdini<br>
                <i>($biljmlini)</i>
                </td>
            </tr>
            <tr>
                <td width=\"2%\"  style=\"font-size:12px\" align=\"right\">4.
                </td>
                <td colspan=\"2\" width=\"38%\"  style=\"font-size:12px\">Untuk Kebutuhan
                </td>
                <td  width=\"2%\"  style=\"font-size:12px\">:
                </td>
                <td  width=\"58%\"  style=\"font-size:12px\">Bulan $blnini s.d Bulan $blnsd
                </td>
            </tr>
            <tr>
                <td width=\"2%\"  style=\"font-size:12px\" align=\"right\">5.
                </td>
                <td colspan=\"2\" width=\"38%\"  style=\"font-size:12px\">Ikhtisar penyediaan dana :
                </td>
                <td  width=\"2%\"  style=\"font-size:12px\">
                </td>
                <td  width=\"58%\"  style=\"font-size:12px\">
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\">&nbsp;
                </td>
                <td width=\"2%\" style=\"font-size:12px\" valign=\"top\">a.
                </td>
                <td width=\"36%\" style=\"font-size:12px\" valign=\"top\">Jumlah dana DPA-SKPD/DPPA-SKPD/DPAL
                </td>
                <td  width=\"2%\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">Rp. $jmldpa
                </td>
            </tr>
            
            <tr>
                <td width=\"2%\" style=\"font-size:12px\">&nbsp;
                </td>
                <td width=\"2%\" style=\"font-size:12px\" valign=\"top\">b.
                </td>
                <td width=\"36%\" style=\"font-size:12px\" valign=\"top\">Akumulasi SPD sebelumnya
                </td>
                <td  width=\"2%\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">Rp.$jmlspdlalu
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\">&nbsp;
                </td>
                <td width=\"2%\" style=\"font-size:12px\" valign=\"top\">c.
                </td>
                <td width=\"36%\" style=\"font-size:12px\" valign=\"top\">Sisa dana yang belum di SPD kan
                </td>
                <td  width=\"2%\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">Rp.$jmlsisa
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\">&nbsp;
                </td>
                <td width=\"2%\" style=\"font-size:12px\" valign=\"top\">d.
                </td>
                <td width=\"36%\" style=\"font-size:12px\" valign=\"top\">Jumlah dana yang di SPD kan saat ini
                </td>
                <td  width=\"2%\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">Rp. $jmlspdini
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\">&nbsp;
                </td>
                <td width=\"2%\" style=\"font-size:12px\" valign=\"top\">e.
                </td>
                <td width=\"36%\" style=\"font-size:12px\" valign=\"top\">Sisa jumlah dama DPA yang belum di SPD kan
                </td>
                <td  width=\"2%\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">Rp. $jmlsisa2 <br>
                <i>($bilsisa)</i>
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\" align=\"right\">6.
                </td>
                <td colspan=\"2\" width=\"38%\" style=\"font-size:12px\">Ketentuan-ketentuan lain
                </td>
                <td  width=\"2%\" style=\"font-size:12px\">:
                </td>
                <td  width=\"58%\" style=\"font-size:12px\">
                </td>
            </tr>
            <tr>
                <td width=\"2%\" style=\"font-size:12px\" align=\"right\">
                </td>
                <td colspan=\"2\" width=\"38%\" style=\"font-size:12px\">
                </td>
                <td width=\"2%\" style=\"font-size:12px\">
                </td>
                <td width=\"58%\" style=\"font-size:12px\" align=\"center\"><br><br>Ditetapkan di...
                <br>pada tanggal<br>
                PPKD SELAKU BUD<br><br><br>(nama lengkap)<br>NIP.
                
                
                </td>
            </tr>
        </table>";
        $data['prev']= $cRet;    
        $this->rka_model->_mpdf('',$cRet,'2','10',5,'0');
    }

    function ang_kas($skpd='',$cetak='')
    {
        $data['page_title']= 'ANGGARAN KAS';
        $this->template->set('title', 'ANGGARAN KAS');   
        $this->template->load('template','anggaran/rka/cetak_anggaran_kas',$data) ; 
    }

   function anggaran_kas_ubah()
	{
        $data['page_title']= 'INPUT ANGGARAN KAS PERUBAHAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS PERUBAHAN');   
        $this->template->load('template','anggaran/rka/anggaran_kas_ubah',$data) ; 
   }
                   
   
   function angaran_kas($skpd='',$cetak=1){
       
	   $jns_ang=$this->uri->segment(5); 
       $skpdd = $this->session->userdata('kdskpd');
       $bid = $skpdd;
       $cek = explode(".",$bid);
       $ck = $cek[3];               
        
		
		if ($jns_ang == '1'){
			$angx = '';
		}else if ($jns_ang == '2'){
			$angx = '_sempurna';
		}else if ($jns_ang == '3'){
			$angx = '_ubah';
		}else{
			$angx = '';
		}
		
			
        
       $ang_t=0;
       $jan_t=0;
       $feb_t=0;
       $mar_t=0;
       $apr_t=0;
       $mei_t=0;
       $jun_t=0;
       $jul_t=0;
       $ags_t=0;
       $sep_t=0;
       $okt_t=0;
       $nov_t=0;
       $des_t=0;
       
       $jtriw1=0;
       $jtriw2=0;
       $jtriw3=0;
       $jtriw4=0;
       
       $id     = $skpd;
       $qrskpd = $this->db->query("select upper(nm_skpd) as cnmskpd from ms_skpd where kd_skpd='$id'");
       
       foreach( $qrskpd->result() as $qrskpd ){
            $nmskpd = $qrskpd->cnmskpd; 
       }
       
       $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
       
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>ANGGARAN KAS KEGIATAN</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$nmskpd</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong></strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Kegiatan</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Anggaran Tahun ini(Rp).</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Triwulan I (Rp).</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Triwulan II (Rp).</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Triwulan III (Rp).</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Triwulan IV (Rp).</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Jan</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Feb</td>                             
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Mar</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Apr</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Mei</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Jun</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Jul</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Ags</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Sep</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Okt</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Nov</td>
                             <td width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Des</td>
                        </tr>    
                     </thead>
                    <!--<tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                            
                         </tr>
                     </tfoot>-->
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                            $id2 = substr($id,9,2);
                         if ($id2 == '00'){
                 $sql1="
					SELECT kd_skpd, kd_kegiatan, (select nm_kegiatan from trskpd WHERE kd_kegiatan=yyy.kd_kegiatan)
					nm_kegiatan, 
					sum(jan)+sum(feb)+sum(mar)+sum(apr)+sum(mei)+sum(jun)+sum(jul)+sum(ags)+sum(sep)+sum(okt)+sum(nov)+sum(des) total,
					sum(jan) jan, sum(feb) feb, sum(mar) mar, sum(apr) apr, sum(mei) mei, sum(jun) jun, sum(jul) jul, sum(ags) ags, sum(sep) sep, sum(okt) okt, sum(nov) nov, sum(des) des from (
					select kd_skpd, kd_kegiatan, 
					case when bulan=1 then sum(nilai) end as jan,
					case when bulan=2 then sum(nilai) end as feb,
					case when bulan=3 then sum(nilai) end as mar,
					case when bulan=4 then sum(nilai) end as apr,
					case when bulan=5 then sum(nilai) end as mei,
					case when bulan=6 then sum(nilai) end as jun,
					case when bulan=7 then sum(nilai) end as jul,
					case when bulan=8 then sum(nilai) end as ags,
					case when bulan=9 then sum(nilai) end as sep,
					case when bulan=10 then sum(nilai) end as okt,
					case when bulan=11 then sum(nilai) end as nov,
					case when bulan=12 then sum(nilai) end as des
					from (
					select kd_skpd, a.kd_kegiatan, sum(nilai$angx) nilai, bulan from trdskpd_ro a inner join (select kd_kegiatan oke from trdrka group by kd_kegiatan) b on a.kd_kegiatan=b.oke
					GROUP BY kd_skpd, bulan, a.kd_kegiatan)xxx
					GROUP BY kd_skpd, kd_kegiatan, bulan) yyy WHERE left(kd_skpd,7)=left('$id',7) GROUP BY kd_skpd, kd_kegiatan";
                    }else{
                        $sql1="SELECT kd_skpd, kd_kegiatan, (select nm_kegiatan from trskpd WHERE kd_kegiatan=yyy.kd_kegiatan)
					nm_kegiatan, 
					sum(jan)+sum(feb)+sum(mar)+sum(apr)+sum(mei)+sum(jun)+sum(jul)+sum(ags)+sum(sep)+sum(okt)+sum(nov)+sum(des) total,
					sum(jan) jan, sum(feb) feb, sum(mar) mar, sum(apr) apr, sum(mei) mei, sum(jun) jun, sum(jul) jul, sum(ags) ags, sum(sep) sep, sum(okt) okt, sum(nov) nov, sum(des) des from (
					select kd_skpd, kd_kegiatan, 
					case when bulan=1 then sum(nilai) end as jan,
					case when bulan=2 then sum(nilai) end as feb,
					case when bulan=3 then sum(nilai) end as mar,
					case when bulan=4 then sum(nilai) end as apr,
					case when bulan=5 then sum(nilai) end as mei,
					case when bulan=6 then sum(nilai) end as jun,
					case when bulan=7 then sum(nilai) end as jul,
					case when bulan=8 then sum(nilai) end as ags,
					case when bulan=9 then sum(nilai) end as sep,
					case when bulan=10 then sum(nilai) end as okt,
					case when bulan=11 then sum(nilai) end as nov,
					case when bulan=12 then sum(nilai) end as des
					from (
					select kd_skpd, kd_kegiatan, sum(nilai$angx) nilai, bulan from trdskpd_ro inner join (select kd_kegiatan oke from trdrka GROUP BY kd_kegiatan) b
        on trdskpd_ro.kd_kegiatan=b.oke
					GROUP BY kd_skpd, bulan, kd_kegiatan)xxx
					GROUP BY kd_skpd, kd_kegiatan, bulan) yyy WHERE kd_skpd='$id' GROUP BY kd_skpd, kd_kegiatan";
                    }
                    //echo $sql1;
                $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan;
                    $nama=$row->nm_kegiatan;
                    $ang=number_format($row->total,"2",".",",");
                    $jan=number_format($row->jan,"2",".",",");
                    $feb=number_format($row->feb,"2",".",",");
                    $mar=number_format($row->mar,"2",".",",");
                    $apr=number_format($row->apr,"2",".",",");
                    $mei=number_format($row->mei,"2",".",",");
                    $jun=number_format($row->jun,"2",".",",");
                    $jul=number_format($row->jul,"2",".",",");
                    $ags=number_format($row->ags,"2",".",",");
                    $sep=number_format($row->sep,"2",".",",");
                    $okt=number_format($row->okt,"2",".",",");
                    $nov=number_format($row->nov,"2",".",",");
                    $des=number_format($row->des,"2",".",",");
	
                    $ang1=$row->total;
                    $jan1=$row->jan;
                    $feb1=$row->feb;
                    $mar1=$row->mar;
                    $apr1=$row->apr;
                    $mei1=$row->mei;
                    $jun1=$row->jun;
                    $jul1=$row->jul;
                    $ags1=$row->ags;
                    $sep1=$row->sep;
                    $okt1=$row->okt;
                    $nov1=$row->nov;
                    $des1=$row->des;
                    
                    $ang_t=$ang_t+$ang1;

                    $jan_t=$jan_t+$jan1;
                    $feb_t=$feb_t+$feb1;
                    $mar_t=$mar_t+$mar1;

                    $apr_t=$apr_t+$apr1;
                    $mei_t=$mei_t+$mei1;
                    $jun_t=$jun_t+$jun1;

                    $jul_t=$jul_t+$jul1;
                    $ags_t=$ags_t+$ags1;
                    $sep_t=$sep_t+$sep1;

                    $okt_t=$okt_t+$okt1;
                    $nov_t=$nov_t+$nov1;
                    $des_t=$des_t+$des1;
                    
                    
                    $jtriw1 = $jtriw1 + ($jan1+$feb1+$mar1);
                    $jtriw2 = $jtriw2 + ($apr1+$mei1+$jun1);
                    $jtriw3 = $jtriw3 + ($jul1+$ags1+$sep1);
                    $jtriw4 = $jtriw4 + ($okt1+$nov1+$des1);
					$hasil_total = $jtriw1+$jtriw2+$jtriw3+$jtriw4;
                    $jtriw1_t = number_format($jtriw1,2,'.',',');
                    $jtriw2_t = number_format($jtriw2,2,'.',',');
                    $jtriw3_t = number_format($jtriw3,2,'.',',');
                    $jtriw4_t = number_format($jtriw4,2,'.',',');
                    $tot_t = number_format($hasil_total,2,'.',',');
                    
                    $ang_t2=number_format($ang_t,"2",".",",");
                    $jan_t2=number_format($jan_t,"2",".",",");
                    $feb_t2=number_format($feb_t,"2",".",",");
                    $mar_t2=number_format($mar_t,"2",".",",");
                    $apr_t2=number_format($apr_t,"2",".",",");
                    $mei_t2=number_format($mei_t,"2",".",",");
                    $jun_t2=number_format($jun_t,"2",".",",");
                    $jul_t2=number_format($jul_t,"2",".",",");
                    $ags_t2=number_format($ags_t,"2",".",",");
                    $sep_t2=number_format($sep_t,"2",".",",");
                    $okt_t2=number_format($okt_t,"2",".",",");
                    $nov_t2=number_format($nov_t,"2",".",",");
                    $des_t2=number_format($des_t,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">$kode</td>                            
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\">$nama</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$des</td>
                                    </tr>
                                     ";
                  }  
                  
                                     
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\"></td>                            
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\">JUMLAH</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$ang_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jan_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$feb_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$mar_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$apr_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$mei_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jun_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jul_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$ags_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$sep_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$okt_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$nov_t2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$des_t2</td>
                                    </tr>
                                     ";         
                
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\"></td>                            
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\">JUMLAH TRIWULAN</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$ang_t2</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jtriw1_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jtriw2_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jtriw3_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$jtriw4_t</td>
                                    </tr>
                                     ";  
 
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan Angkas SKPD ';
        $this->template->set('title', 'CETAK ANGKAS SKPD');        
        switch($cetak) {
                case 0;
               echo ("<title>Anggaran Kas</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;    
        case 1;
             $this->tukd_model->_mpdf('',$cRet,10,10,10,'1');
        break;
       case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= anggaran_kas-$id.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
                
    }
 
 //wahyu=================================================================
	function load_dspd_all_keg($jenis='',$skpd='',$awal=0,$ahir=12,$nospd=''){

		
        $stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="b.nilai";		
			$sts="susun";		
		}else{
			$field="b.nilai_ubah";				
			$sts="ubah";		
		}

		if ($jenis=='52'){
		  $dan="a.jns_kegiatan ='$jenis'";
		 
			$sql = " SELECT a.*,('')kd_rek5,('')nm_rek5,(SELECT SUM($field) FROM trdskpd b WHERE a.kd_kegiatan=b.kd_kegiatan AND b.bulan>=$awal AND b.bulan<=$ahir and b.status='$sts' ) AS nilai FROM trskpd a WHERE a.kd_skpd='$skpd' and $dan";
		  }else{
		  $dan="a.jns_kegiatan ='$jenis'";
		 
			$sql = " select b.kd_kegiatan,f.nm_kegiatan,f.kd_program,c.nm_program,b.kd_rek5,d.nm_rek5,$field from trdrka b inner join m_giat f
 on b.kd_kegiatan=f.kd_kegiatan inner join m_prog c on 
f.kd_program=c.kd_program inner join ms_rek5 d on b.kd_rek5=d.kd_rek5 where b.kd_kegiatan in 
(select kd_kegiatan FROM trskpd a WHERE a.kd_skpd='$skpd' and $dan) order by b.kd_rek5";
		  }

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 

			if ($stsubah==0){
				$angg="nilai";		
			}else{
				$angg="nilai_ubah";				
			}
			if ($jenis=='52'){
				$n_nilai=$resulte['nilai'];
				if ($stsubah==0){
					$angg="total";		
				}else{
					$angg="total_ubah";				
				}	
			} else {
				$n_nilai=0;
				
			}
			
			$giat=$resulte['kd_kegiatan'];
			$rek=$resulte['kd_rek5'];
			 $q_rek="a.kd_rek5 ='$rek'";
			$s = " SELECT SUM(a.nilai) as nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd WHERE b.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' and $q_rek and a.no_spd<>'$nospd' ";
			$q = $this->db->query($s);  
	        foreach($q->result_array() as $res){
				$lalu=$res['nilai'];
			}


			$result[] = array(
                        'id'          => $ii,        
                        'no_spd'      => '',
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
						'nilai'       => number_format($n_nilai,"2",".",","),
                        'lalu'        => number_format($lalu,"2",".",","),
                        'anggaran'    => number_format($resulte[$angg],"2",".",",")
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	
	}
//======================================================================
    function bulan() {
               
        for ($count = 1; $count <= 12; $count++)
        {
            $result[]= array(
                     'bln' => $count,
                     'nm_bulan' => $this->tukd_model->getBulan($count)
                     );    
        }
        
        echo json_encode($result);
    	
	}
    
    
    function proses_posting(){
        $jns=$this->input->post('ctk');
        $skpd =$this->input->post('skpd');
        if ($jns==1){
       	        $this->db->query(" delete from perkada ");
				$where=" ";	
                $where1=" where jns='52'";	
			}else{
			    $this->db->query(" delete from perkada where kd_skpd='$skpd' "); 
				$where=" where kd_skpd ='$skpd'";				
                $where1=" where kd_skpd ='$skpd' and jns='52'";
			}
        //Pendapatan
		$sql = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE  LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '5' AS nu,no_po AS po,'4' AS jns FROM trdpo
                        WHERE SUBSTR(no_trdrka,34,1)='4') a $where ORDER BY kd_rek,nu,po";
        $query1 = $this->db->query($sql);  
        
        foreach($query1->result_array() as $pend){
			  $skpd=$pend['kd_skpd'];
			  $rek=$pend['kd_rek'];
			  $rek1=$pend['kd_rek1'];
			  $nm_rek=$pend['nm_rek'];
              $nm_rek=str_replace("'"," ",$nm_rek);
			  $nilai=$pend['nilai'];
			  $uraian=$pend['uraian'];
			  $volume=$pend['volume'];	
			  $satuan=$pend['satuan'];
			  $harga=$pend['harga'];
			  $total=$pend['total'];
			  $nu=$pend['nu'];
			  $po=$pend['po'];
              $jns=$pend['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        		$sql1 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'51' AS jns  FROM trdpo
                        WHERE  SUBSTR(no_trdrka,34,2)='51'
                        )  a $where ORDER BY kd_rek,nu,po";
                        
        $query2 = $this->db->query($sql1);  
        
        foreach($query2->result_array() as $btl){
			  $skpd=$btl['kd_skpd'];
			  $rek=$btl['kd_rek'];
			  $rek1=$btl['kd_rek1'];
			  $nm_rek=$btl['nm_rek'];
              $nm_rek=str_replace("'"," ",$nm_rek);
			  $nilai=$btl['nilai'];
			  $uraian=$btl['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$btl['volume'];	
			  $satuan=$btl['satuan'];
			  $harga=$btl['harga'];
			  $total=$btl['total'];
			  $nu=$btl['nu'];
			  $po=$btl['po'];
              $jns=$btl['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        $sql2 = " SELECT kd_skpd,CONCAT(kode,'.',kode1) AS kd_rek,(CASE nu WHEN '1' THEN kode WHEN '2' THEN kode  WHEN '7' THEN '' ELSE CONCAT(kode,'.',kode1) END) AS kd_rek1,
            		nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns FROM (
            		SELECT DISTINCT b.kd_program AS kode,'' AS kode1,b.nm_program AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'1' AS nu,'' AS po,b.jns_kegiatan AS jns FROM trdrka a INNER JOIN 
            		trskpd b ON a.kd_kegiatan=b.kd_kegiatan GROUP BY b.kd_program
            		UNION 
            		SELECT  a.kd_kegiatan AS kode,'' AS kode1,a.nm_kegiatan AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,'' AS volume,
            		'' AS satuan,'' AS harga,'' AS total,'2' AS nu,'' AS po,b.jns_kegiatan FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan 
            		GROUP BY b.kd_kegiatan
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,2) AS kode1, nm_rek2 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'3' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek2 b ON LEFT(kd_rek5,2)=b.kd_rek2 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,2)
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,3) AS kode1, nm_rek3 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'4' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek3 b ON LEFT(kd_rek5,3)=b.kd_rek3 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,3)
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,5) AS kode1, nm_rek4 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'5' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek4 b ON LEFT(kd_rek5,5)=b.kd_rek4 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,5)
            		UNION 
            		SELECT  a.kd_kegiatan AS kode,a.kd_rek5 AS kode1, nm_rek5 AS nm_rek,a.nilai AS nilai,a.kd_skpd,'' AS uraian,'' AS volume,
            		'' AS satuan,'' AS harga,'' AS total,'6' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a 
            		UNION 
            		SELECT SUBSTR(no_trdrka,12,21) AS kode,SUBSTR(no_trdrka,34,7) AS kode1,' 'AS nm_rek,'' nilai,LEFT(no_trdrka,10) AS kd_skpd,uraian,volume1 AS volume,
            		satuan1 AS satuan,harga1 AS satuan,total,'7' AS nu,no_po AS po,SUBSTR(no_trdrka,34,2) AS jns FROM trdpo 
            		) a $where1 ORDER BY kd_rek,nu,po";
                        
        $query3 = $this->db->query($sql2);  
        
        foreach($query3->result_array() as $bl){
			  $skpd=$bl['kd_skpd'];
			  $rek=$bl['kd_rek'];
			  $rek1=$bl['kd_rek1'];
			  $nm_rek=$bl['nm_rek'];
              $nm_rek=str_replace("'"," ",$nm_rek);
			  $nilai=$bl['nilai'];
			  $uraian=$bl['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$bl['volume'];	
			  $satuan=$bl['satuan'];
              $satuan=str_replace("'"," ",$satuan);
			  $harga=$bl['harga'];
			  $total=$bl['total'];
			  $nu=$bl['nu'];
			  $po=$bl['po'];
              $jns=$bl['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        $sql3 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'61' AS jns  FROM trdpo
                        WHERE  SUBSTR(no_trdrka,34,2)='61'
                        ) a $where ORDER BY kd_rek,nu,po";
                        
        $query4 = $this->db->query($sql3);  
        
        foreach($query4->result_array() as $pemby1){
			  $skpd=$pemby1['kd_skpd'];
			  $rek=$pemby1['kd_rek'];
			  $rek1=$pemby1['kd_rek1'];
			  $nm_rek=$pemby1['nm_rek'];
			  $nilai=$pemby1['nilai'];
			  $uraian=$pemby1['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$pemby1['volume'];	
			  $satuan=$pemby1['satuan'];
			  $harga=$pemby1['harga'];
			  $total=$pemby1['total'];
			  $nu=$pemby1['nu'];
			  $po=$pemby1['po'];
              $jns=$pemby1['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        $sql4 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTR(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'61' AS jns  FROM trdpo
                        WHERE  SUBSTR(no_trdrka,34,2)='62'
                        ) a $where ORDER BY kd_rek,nu,po";
                        
        $query5 = $this->db->query($sql4);  
        
        foreach($query5->result_array() as $pemby2){
			  $skpd=$pemby2['kd_skpd'];
			  $rek=$pemby2['kd_rek'];
			  $rek1=$pemby2['kd_rek1'];
			  $nm_rek=$pemby2['nm_rek'];
			  $nilai=$pemby2['nilai'];
			  $uraian=$pemby2['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$pemby2['volume'];	
			  $satuan=$pemby2['satuan'];
			  $harga=$pemby2['harga'];
			  $total=$pemby2['total'];
			  $nu=$pemby2['nu'];
			  $po=$pemby2['po'];
              $jns=$pemby2['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}

	
		echo '1';	
	}
    
    function dsimpan()
	{
			
		$skpd    = $this->input->post('skpd');
        $kegiatan    = $this->input->post('giat');
        $rekening    = $this->input->post('rek');
        $index    = $this->input->post('id');
        $uraian    = $this->input->post('uraian');
        $volume1    = $this->input->post('volum1');
        $satuan1    = $this->input->post('satuan1');
        $harga1    = $this->input->post('harga1');
        $volume2    = $this->input->post('volum2');
        $satuan2    = $this->input->post('satuan2');
        $volume3    = $this->input->post('volum3');
        $satuan3    = $this->input->post('satuan3');
        
		$satuan1 = str_replace("12345678987654321","",$satuan1);
		$satuan1 = str_replace("undefined","",$satuan1);

		$satuan2 = str_replace("12345678987654321","",$satuan2);
		$satuan2 = str_replace("undefined","",$satuan2);

		$satuan3 = str_replace("12345678987654321","",$satuan3);
		$satuan3 = str_replace("undefined","",$satuan3);

		$uraian = str_replace("%20"," ",$uraian);
		$uraian = str_replace("%60"," ",$uraian);

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $vol1=$volume1;
        $vol2=$volume2;
        $vol3=$volume3;
        if($volume1==0){$volume1=1;$vol1='';}
        if($volume2==0){$volume2=1;$vol2='';}
        if($volume3==0){$volume3=1;$vol3='';}
		
		$total	 = $volume1*$volume2*$volume3*$harga1;
           
           $asg = $this->db->query($sql);
            if ($asg > 0){  	
                    $query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
                        		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
                        									 values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
                        		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
                        		$query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
                        		$this->rka_rinci($skpd,$kegiatan,$rekening);
                    					
			} else {
            echo '0';
            exit();
        }
        echo '1';
	}
    
    function ambil_sdana(){
        
        $lccr  = $this->input->post('q');
        $query1 = $this->db->query("select * from ms_dana where upper(kd_sdana) like upper('%$lccr%') or upper(nm_sdana) like upper('%$lccr%') ") ;
        //$query1 = $this->db->query("select kd_sdana, nm_sdana from ms_dana") ;
        
        
        $ii     = 0;
        $result = array();
        foreach ($query1->result_array() as $resulte) {
            
            $result[] = array(
                'id'       => '$ii',
                'kd_sdana' => $resulte['kd_sdana'],
                'nm_sdana' => $resulte['nm_sdana']
                );
                $ii++;    
        }
        
        echo json_encode($result) ;
    }
    
    
     function cek_kas(){
        
        $skpd     = $this->input->post('skpd');
        $kegiatan = $this->input->post('kegiatan');
        
        $result   = array();
        $query    = $this->db->query("select * from trdskpd where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$kegiatan'");
        //$query    = $this->db->query("select * from trdskpd where kd_skpd='1.03.01.00' and kd_kegiatan='1.03.1.03.01.00.18.04' ");
        $ii       = 0;
        
        foreach ( $query->result_array() as $row ){
            
            $result[] = array(
                'id'    =>  '$ii',
                'bulan' =>  $row['bulan'],
                'nilai' =>  $row['nilai']
            );
            $ii++;
        }
        echo json_encode($result);
    }
	//---------- Tambahan Agus--------/
	
	//------ Untuk RKA Penyempurna
	
	function tambah_rka_sempurna(){

		$this->rka_model->usercek();
		$this->rka_model->kunci_menu_geser();
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PENYEMPURNAAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA');   

        $this->template->load('template','anggaran/rka/tambah_rka_sempurna',$data) ; 
       // $query1->free_result();
   }
   
   function select_rka_sempurna($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.sumber,a.sumber2,a.sumber3,a.sumber4 from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4']                                
                        );
                        $ii++;
        }
		echo json_encode($result);
            $query1->free_result();
	}
	
function select_rka_pend($kegiatan='') {
        $skpd     = $this->session->userdata('kdskpd');
		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,a.sumber,a.sumber2,a.sumber3,a.sumber4 from 
				trdrka_pend a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' 
				AND a.kd_skpd='$skpd' order by a.kd_rek5";                   
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
						'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4']                                
                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }

	function ambil_rekening5_all_pend() {
        $skpd     = $this->session->userdata('kdskpd');
        $lccr    = $this->input->post('q');
        $notin   = $this->input->post('reknotin');
        $jnskegi = $this->input->post('jns_kegi');
        
        if ( $notin <> ''){
            $where = " and kd_rek5 not in ($notin) ";
        } else {
            $where = " ";
        }
		$sql = "SELECT kd_rek5, nm_rek5 FROM trdrka where ( left(kd_rek5,1)='4' ) AND LEFT(kd_skpd,7) = LEFT('$skpd',7)
				and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) $where order by kd_rek5";
        $query1 = $this->db->query($sql); 
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
        echo json_encode($result);
	}

	function load_sum_rek_pend(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select sum(nilai) as rektotal,sum(nilai_ubah) as rektotal_ubah from trdrka_pend where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	
	
	function load_sum_rek_sempurna(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
        $skpdd = substr($kdskpd,0,7); 

        $query1 = $this->db->query(" select sum(nilai_sempurna) as rektotal,sum(nilai_ubah) as rektotal_ubah from trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	
	function tsimpan_ar_sempurna(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $skpdd = substr($kdskpd,0,7); 
        $kegiatan = substr($kdkegi,0,21);
		$program = substr($kdkegi,0,18);
		$urusan = substr($kdkegi,0,4);	
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
		$nmpro = $this->rka_model->get_nama($program,'nm_program','m_prog','kd_program');
        $nmkegi = $this->rka_model->get_nama($kegiatan,'nm_kegiatan','m_giat','kd_kegiatan');
        $nmsubkegi = $this->rka_model->get_nama($kdkegi,'nm_subkegiatan','m_sub_giat','kd_subkegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $cek = $this->db->query("select kd_skpd as kd_bidang from trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi' group by kd_skpd")->row(); 
		$hasil_bidang = $cek->kd_bidang;
        if($hasil_bidang==""){
            $hasil_bidang = $kdskpd;
        }
        
		$a = $this->db->query("SELECT COUNT(*) as jum FROM trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi' and kd_rek5='$kdrek'");
		foreach ($a->result() as $ju)
                {
                    $jumlah=$ju->jum;                    
                }
		if ($jumlah>0) {
			$query_upd = $this->db->query("UPDATE trdrka SET nilai_sempurna='$nilai',nilai_ubah='$nilai',sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4' where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi' and kd_rek5='$kdrek' ");
			if ( $query_upd > 0 ) {				
					
			   
               $cek = $this->db->query("select sum(nilai_sempurna) as n_sempurna from trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi'")->row(); 
               $hasil = $cek->n_sempurna;
               $query_upd = $this->db->query("UPDATE trskpd SET total_sempurna='$hasil',total_ubah='$hasil' where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi' ");    
                 if ( $query_upd > 0 ) {
				echo "1" ;
                }else {
				echo "0" ;
			     }
                
			} else {
				echo "0" ;
			}
		} else{							
			
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek;
		$nogab  = $kdskpd.'.'.$kdkegi;
		$query_del = $this->db->query("delete from trdrka where no_trdrka='$notrdrka'");        	
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,sumber,sumber2,sumber3,sumber4,kd_subkegiatan,nm_subkegiatan) values
                                                         ('$notrdrka','$hasil_bidang','$nmskpd','$kegiatan','$nmkegi','$kdrek','$nmrek','0','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4','$kdkegi','$nmsubkegi')");        
        
			if ( $query_ins > 0 and $query_del > 0 ) {
				
				$cek_trskpd = $this->db->query("SELECT COUNT(*) as jum FROM trskpd where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi'")->row();
				$data_trskpd = $cek_trskpd->jum;
				if($data_trskpd>0){
					$cek = $this->db->query("select sum(nilai_sempurna) as n_sempurna from trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi'")->row(); 
					$hasil = $cek->n_sempurna;
					$query_upd = $this->db->query("UPDATE trskpd SET total_sempurna='$hasil',total_ubah='$hasil' where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi' ");    
						if ( $query_upd > 0 ) {
							echo "1" ;
						}else {
							echo "0" ;
						}				 
				}else{
					$cek = $this->db->query("select sum(nilai_sempurna) as n_sempurna from trdrka where left(kd_skpd,7)='$skpdd' and kd_subkegiatan='$kdkegi'")->row(); 
					$hasil = $cek->n_sempurna;
					
					$query_ins = $this->db->query("insert into trskpd (kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,nm_skpd,kd_kegiatan1,nm_kegiatan,jns_kegiatan,kd_program1,nm_program,total,total_sempurna,total_ubah,kd_subkegiatan,nm_subkegiatan) values
                                                         ('$nogab','$kegiatan','$program','$urusan','$kdskpd','$nmskpd','$kegiatan','$nmkegi','52','$program','$nmpro','0','$hasil','$hasil','$kdkegi','$nmsubkegi')");        
        
					if ( $query_ins > 0 ) {
							echo "1" ;
						}else {
							echo "0" ;
						}
				}
				
			} else {
				echo "0" ;
			}
		}        
    }
	
	
	
	
	function tsimpan_ar_pend(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = "Pendapatan";
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
        $query_del = $this->db->query("delete from trdrka_pend where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka_pend(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,sumber,sumber2,sumber3,sumber4) values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4')");        
        
        if ( $query_ins > 0 and $query_del > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }
    
	function rka_rinci_sempurna($skpd='',$kegiatan='',$rekening='') {
        
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id'      => $ii,        
                        'no_po'   => $resulte['no_po'],  
                        'uraian'  => $resulte['uraian'],  
						'volume1_awal' => $resulte['volume1'],  
                        'volume2_awal' => $resulte['volume2'],  
                        'volume3_awal' => $resulte['volume3'],  
                        'satuan1_awal' => $resulte['satuan1'],  
                        'satuan2_awal' => $resulte['satuan2'],  
                        'satuan3_awal' => $resulte['satuan3'],
                        'volume_awal'  => $resulte['tvolume'],  
                        'harga1_awal'  => number_format($resulte['harga1'],"2",".",","),  
                        'harga2_awal'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3_awal'  => number_format($resulte['harga3'],"2",".",","),
						'total_awal_s' => number_format($resulte['total'],"2",".",","),                            
                        'volume1' => $resulte['volume_sempurna1'],  
                        'volume2' => $resulte['volume_sempurna2'],  
                        'volume3' => $resulte['volume_sempurna3'],  
                        'satuan1' => $resulte['satuan_sempurna1'],  
                        'satuan2' => $resulte['satuan_sempurna2'],  
                        'satuan3' => $resulte['satuan_sempurna3'],
                        'volume'  => $resulte['tvolume_sempurna'],  
                        'harga1'  => number_format($resulte['harga_sempurna1'],"2",".",","),  
                        'harga2'  => number_format($resulte['harga_sempurna2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga_sempurna3'],"2",".",","),
                        'total'   => number_format($resulte['total_sempurna'],"2",".",",")                            
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	
	
	
	
	
	function load_sum_rek_rinci_sempurna(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total_sempurna) as rektotal_rinci from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	
	function tsimpan_rinci_jk_semp(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
                               
		$sql		= "delete from trdpo where  no_trdrka='$norka'";
		$sql1		= "delete from trdpo_ubah where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
		$asg       = $this->db->query($sql1);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1, tvolume_sempurna, satuan_sempurna1, harga_sempurna1, total_sempurna)"; 
                    $sql1 = "insert into trdpo_ubah(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1, tvolume_sempurna, satuan_sempurna1, harga_sempurna1, total_sempurna)"; 
					$asg = $this->db->query($sql.$csql);
					$asg = $this->db->query($sql1.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  
		$query1 = $this->db->query(" update trdrka set nilai_sempurna=(select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka), nilai_ubah=(select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd'), total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");	
		$this->rka_rinci_sempurna($skpd,$kegiatan,$rekening);
	}

	function cek_trdpo_edit(){
		$kdrka= $this->input->post('vnorka');
        $nopo = $this->input->post('vnopo');
        $urai  = $this->input->post('vurai');
		$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo where no_trdrka='$kdrka' and no_po='$nopo' and uraian='$urai' and volume1='0' and satuan1='' and harga1='0.00' and total='0.00'");
		//$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo_sempurna where no_trdrka='$kdrka' and no_po='$nopo' and uraian LIKE '%$urai%'");
		foreach ($a->result() as $ju)
                {
                 $jumlah=$ju->jum;                    
                }
				if ($jumlah>0) {
					echo "1" ;
					} else {
					echo "0" ;
					}
				
	}

	function cek_trdpo_delete(){
		$kdrka= $this->input->post('vnorka');
        $nopo = $this->input->post('vnopo');
        $urai  = $this->input->post('vurai');
		$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo where no_trdrka='$kdrka' and uraian = '$urai' and volume1='0' and satuan1='' and harga1='0.00' and total='0.00'");
		//$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo_sempurna where no_trdrka='$kdrka' and no_po='$nopo' and uraian LIKE '%$urai%'");
		foreach ($a->result() as $ju)
                {
                 $jumlah=$ju->jum;                    
                }
				if ($jumlah>0) {
					echo "1" ;
					} else {
					echo "0" ;
					}
				
	}
	
	function cek_trdpo(){
		$kdrka= $this->input->post('vnorka');
        $nopo = $this->input->post('vnopo');
        $urai  = $this->input->post('vurai');
		//$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo_sempurna where no_trdrka='$kdrka' and no_po='$nopo' and uraian LIKE '%$urai%' and volume1='0' and satuan1='' and harga1='0.00' and total='0.00'");
		$a = $this->db->query("SELECT COUNT(*) as jum FROM trdpo where no_trdrka='$kdrka' and no_po='$nopo' and uraian LIKE '%$urai%'");
		foreach ($a->result() as $ju)
                {
                    $jumlah=$ju->jum;                    
                }
				if ($jumlah>0) {
					echo "1" ;
					} else {
					echo "0" ;
					}
				
	}
	
	
	function rka_hukum_sempurna($skpd='',$kegiatan='') {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum_sempurna WHERE kd_skpd='$skpd' AND kd_kegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	
	
	function simpan_dhukum_sempurna(){

		$skpd  = $this->input->post('skpd');
        $giat  = $this->input->post('giat');
        $isi   = $this->input->post('cisi');      
        $pecah = explode('||',$isi);
		$pj    = count($pecah);

		$this->db->query(" delete from d_hukum_sempurna where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		
		$this->db->query(" delete from d_hukum_ubah where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		

	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum_sempurna(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 
				$this->db->query(" insert into d_hukum_ubah(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 		
			}
		}
	}
	
	
	
	


	function simpan_det_keg_sempurna(){
        $skpdbp=$this->input->post('skpdbp');
        $skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        
        $this->db->query(" update trskpd set tu_capai_sempurna='$cp_tu',
                                             tu_capai_ubah='$cp_tu', 
                                             tu_mas_sempurna='$m_tu',
                                             tu_mas_ubah='$m_tu',           
                                             tu_kel_sempurna='$k_tu',
                                             tu_kel_ubah='$k_tu',           
                                             tu_has_sempurna='$h_tu',
                                             tu_has_ubah='$h_tu',
                                             tk_capai_sempurna='$cp_ck',
                                             tk_capai_ubah='$cp_ck',
                                             tk_mas_sempurna='$m_ck',
                                             tk_mas_ubah='$m_ck',
                                             tk_kel_sempurna='$k_ck',
                                             tk_kel_ubah='$k_ck',
                                             tk_has_sempurna='$h_ck',
                                             tk_has_ubah='$h_ck',
                                             lokasi='$lokasi',
                                             sasaran_giat='$sasaran',
                                             waktu_giat='$wkeg',
                                             kd_pptk='$ttd'
        where kd_skpd='$skpdbp' and kd_kegiatan='$giat'  "); 
    }

//--------------------- RKA Perubahan ---------------------//
 function tsimpan_ar_ubah(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_subkegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        
        $kkdgiat = substr($kdkegi,0,21);
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegitan = $this->rka_model->get_nama($kkdgiat,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmkegisub = $this->rka_model->get_nama($kdkegi,'nm_subkegiatan','trskpd','kd_subkegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
		$a = $this->db->query("SELECT COUNT(*) as jum FROM trdrka where kd_skpd='$kdskpd' and kd_subkegiatan='$kdkegi' and kd_rek5='$kdrek'");
		foreach ($a->result() as $ju)
                {
                    $jumlah=$ju->jum;                    
                }
		if ($jumlah>0) {
			$query_upd = $this->db->query("UPDATE trdrka SET nilai_ubah='$nilai',sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4' where kd_skpd='$kdskpd' and kd_subkegiatan='$kdkegi' and kd_rek5='$kdrek' ");
			if ( $query_upd > 0 ) {
				echo "1" ;
			} else {
				echo "0" ;
			}
		} 
        else{
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
                
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,sumber,sumber2,sumber3,sumber4,kd_subkegiatan,nm_subkegiatan) values('$notrdrka','$kdskpd','$nmskpd','$kkdgiat','$nmkegitan','$kdrek','$nmrek','0','0','$nilai','$sdana1','$sdana2','$sdana3','$sdana4','$kdkegi','$nmkegisub')");        
        
			if ( $query_ins > 0 and $query_del > 0 ) {
				echo "1" ;
			} else {
				echo "0" ;
			}
		}
        
    }
	
	
	function load_sum_rek_ubah(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('skeg');

        $query1 = $this->db->query(" select sum(nilai_sempurna) as rektotal,sum(nilai_ubah) as rektotal_ubah from trdrka where kd_subkegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	
	
	
	function tsimpan_rinci_jk_ubah(){
        $rekening  = $this->input->post('crek');
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $cskpd2    = $this->input->post('skpd2');
        $kegiatan  = $this->input->post('giat'); 
        $id        =  $this->session->userdata('pcNama');
        $sql       = "delete from trdpo where no_trdrka='$norka'";
        $asg       = $this->db->query($sql);
            
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "INSERT into trdpo(no_po,header,kode,kd_kegiatan,kd_rek5,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,
                            volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1,volume_sempurna2,
                            volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,harga_sempurna1,total_sempurna)"; 
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
      
             $log=$this->support->log_aktivitas("trdpo","INPUT RKA UBAH $norka");
        $query1 = $this->db->query("UPDATE trdrka set 
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate() where no_trdrka='$norka'");  
        $query1 = $this->db->query("UPDATE trdrka set nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate() where no_trdrka='$norka' ");  
        $query1 = $this->db->query("UPDATE trskpd set total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd2' ),
                                    username1='$id',last_update=getdate() where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd2' ");    
        $this->rka_rinci($cskpd,$kegiatan,$rekening);
    
    }
	
	
	function load_sum_rek_rinci_ubah(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total_ubah) as rektotal_rinci from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
		   
		   
	}
    
    function get_realisasi_keg($cskpd=''){
        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');

        
        $query1 = $this->db->query("SELECT sum(isnull(z.lalu,0)) total
 from(
SELECT a.kd_kegiatan,a.kd_rek5,a.nm_rek5,
            (SELECT SUM(nilai) FROM 
                        (
                        SELECT
                            SUM (isnull(c.nilai,0)) as nilai
                        FROM
                            trdtransout c
                        LEFT JOIN trhtransout d ON c.no_bukti = d.no_bukti
                        AND c.kd_skpd = d.kd_skpd
                        WHERE
                        c.kd_kegiatan = a.kd_kegiatan
                        AND left(d.kd_skpd,7) = left(a.kd_skpd,7)
                        AND c.kd_rek5 = a.kd_rek5   AND d.jns_spp='1'                   
                        UNION ALL
                        SELECT
                            SUM (isnull(c.nilai,0)) as nilai
                        FROM
                            trdtransout_cmsbank c
                        LEFT JOIN trhtransout_cmsbank d ON c.no_voucher = d.no_voucher
                        AND c.kd_skpd = d.kd_skpd
                        WHERE
                        c.kd_kegiatan = a.kd_kegiatan
                        AND left(d.kd_skpd,7) = left(a.kd_skpd,7)
                        AND c.kd_rek5 = a.kd_rek5
                        AND c.no_voucher <> 'x'
                        AND d.jns_spp='1' AND d.status_validasi='0'
                        UNION ALL
                        SELECT SUM(isnull(x.nilai,0)) as nilai FROM trdspp x
                        INNER JOIN trhspp y 
                        ON x.no_spp=y.no_spp AND x.kd_skpd=y.kd_skpd
                        WHERE
                        x.kd_kegiatan = a.kd_kegiatan
                        AND left(x.kd_skpd,7) = left(a.kd_skpd,7)
                        AND x.kd_rek5 = a.kd_rek5
                        AND y.jns_spp IN ('3','4','5','6')
                        AND (sp2d_batal IS NULL or sp2d_batal ='' or sp2d_batal='0')
                        UNION ALL
                        SELECT SUM(isnull(nilai,0)) as nilai FROM trdtagih t 
                        INNER JOIN trhtagih u 
                        ON t.no_bukti=u.no_bukti AND t.kd_skpd=u.kd_skpd
                        WHERE 
                        t.kd_kegiatan = a.kd_kegiatan
                        AND u.kd_skpd = a.kd_skpd
                        AND t.kd_rek = a.kd_rek5
                        AND u.no_bukti 
                        NOT IN (select no_tagih FROM trhspp WHERE kd_skpd=a.kd_skpd )
                        )r) AS lalu                    
                        FROM trdrka a )z
                                                where z.kd_kegiatan ='$kegiatan'
                        group by z.kd_kegiatan");
        
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }
//---------------------- Tambahan Anggaran -------------------//
    //pindah 23-11-2017 (3)
function load_sum_rek_rinci_rka(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $rek = $this->input->post('rek');
        $norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query("SELECT nilai, nilai_sempurna, nilai_ubah FROM trdrka where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rka' => number_format($resulte['nilai'],"2",".",","),
                        'rektotal_rka_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'rektotal_rka_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),
                        
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);
           
         }
	
//--------------------- Anggaran Kas Sempurna -----------------//

	function anggaran_kas_sempurna()
		{
			$data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN PENYEMPURNAAN';
			$this->template->set('title', 'INPUT ANGGARAN KAS PENYEMPURNAAN');   
			$this->template->load('template','anggaran/rka/anggaran_kas_sempurna',$data) ; 
	   }	
	
	
	function load_giat_sempurna() {
        $cskpd=$this->uri->segment(3); 
		$lccr='';        
        $lccr = $this->input->post('q');        
        /*$sql = "SELECT a.kd_kegiatan,a.nm_kegiatan,a.kd_program,a.nm_program,(SELECT SUM(nilai)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total,
                (SELECT SUM(nilai_ubah)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total_ubah FROM trskpd a  
                WHERE kd_skpd= '$cskpd'   AND (UPPER(kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(nm_kegiatan) LIKE UPPER('%$lccr%'))";*/   

		$sql = "SELECT a.kd_kegiatan,a.nm_kegiatan,a.kd_program,a.nm_program,
				SUM(b.nilai) as total,
				SUM(b.nilai_sempurna) AS total_sempurna,
				SUM(b.nilai_ubah) AS total_ubah
				FROM trskpd a
				RIGHT JOIN trdrka b ON b.kd_kegiatan=a.kd_kegiatan
				WHERE a.kd_skpd = '$cskpd' 
				AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(a.nm_kegiatan) LIKE UPPER('%$lccr%'))
				GROUP BY a.kd_kegiatan
				";  
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => $resulte['total'],
						'total_sempurna' => $resulte['total_sempurna'],
                        'total_ubah'  => $resulte['total_ubah'],        
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
	
	function load_trdskpd_sempurna(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 1;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => number_format($resulte['nilai_sempurna'],2,'.',',')                                                              
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
	
	
function simpan_trskpd_sempurna(){
        
        $id         =  $this->session->userdata('pcNama');
        $cskpda=$this->input->post('cskpda');
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $query_find = $this->db->query("select * from trdskpd where kd_kegiatan='$cgiat'");
        $update = $query_find->num_rows();

       if($update > 0){    
                $kdGab = $cskpda.'.'.$cgiat;
                $sql1 = "update trdskpd set nilai_sempurna='$bln1',nilai_ubah=$bln1,kd_skpd='$cskpd',nilai_sempurna_final='$bln1' where kd_gabungan='$kdGab' and bulan=1";
                $asg = $this->db->query($sql1);                              
                $sql2 = "update trdskpd set nilai_sempurna='$bln2',nilai_ubah=$bln2,kd_skpd='$cskpd',nilai_sempurna_final='$bln2' where kd_gabungan='$kdGab' and bulan=2";
                $asg = $this->db->query($sql2);                
                $sql3 = "update trdskpd set nilai_sempurna='$bln3',nilai_ubah=$bln3,kd_skpd='$cskpd',nilai_sempurna_final='$bln3' where kd_gabungan='$kdGab' and bulan=3";
                $asg = $this->db->query($sql3);                
                $sql4 = "update trdskpd set nilai_sempurna='$bln4',nilai_ubah=$bln4,kd_skpd='$cskpd',nilai_sempurna_final='$bln4' where kd_gabungan='$kdGab' and bulan=4";
                $asg = $this->db->query($sql4);        
                $sql5 = "update trdskpd set nilai_sempurna='$bln5',nilai_ubah=$bln5,kd_skpd='$cskpd',nilai_sempurna_final='$bln5' where kd_gabungan='$kdGab' and bulan=5";
                $asg = $this->db->query($sql5);       
                $sql6 = "update trdskpd set nilai_sempurna='$bln6',nilai_ubah=$bln6,kd_skpd='$cskpd',nilai_sempurna_final='$bln6' where kd_gabungan='$kdGab' and bulan=6";
                $asg = $this->db->query($sql6);                
                $sql7 = "update trdskpd set nilai_sempurna='$bln7',nilai_ubah=$bln7,kd_skpd='$cskpd',nilai_sempurna_final='$bln7' where kd_gabungan='$kdGab' and bulan=7";
                $asg = $this->db->query($sql7);                
                $sql8 = "update trdskpd set nilai_sempurna='$bln8',nilai_ubah=$bln8,kd_skpd='$cskpd',nilai_sempurna_final='$bln8' where kd_gabungan='$kdGab' and bulan=8";
                $asg = $this->db->query($sql8);                
                $sql9 = "update trdskpd set nilai_sempurna='$bln9',nilai_ubah=$bln9,kd_skpd='$cskpd',nilai_sempurna_final='$bln9' where kd_gabungan='$kdGab' and bulan=9";
                $asg = $this->db->query($sql9);                
                $sql10 = "update trdskpd set nilai_sempurna='$bln10',nilai_ubah=$bln10,kd_skpd='$cskpd',nilai_sempurna_final='$bln10' where kd_gabungan='$kdGab' and bulan=10";
                $asg = $this->db->query($sql10);                
                $sql11 = "update trdskpd set nilai_sempurna='$bln11',nilai_ubah=$bln11,kd_skpd='$cskpd',nilai_sempurna_final='$bln11' where kd_gabungan='$kdGab' and bulan=11";
                $asg = $this->db->query($sql11);                
                $sql12 = "update trdskpd set nilai_sempurna='$bln12',nilai_ubah=$bln12,kd_skpd='$cskpd',nilai_sempurna_final='$bln12' where kd_gabungan='$kdGab' and bulan=12";
                $asg = $this->db->query($sql12);         
                $ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1_sempurna='$tr1',triw2_sempurna='$tr2',triw3_sempurna='$tr3',triw4_sempurna='$tr4',total_sempurna='$ntotal',
                          triw1_ubah='$tr1',triw2_ubah='$tr2',triw3_ubah='$tr3',triw4_ubah='$tr4',total_ubah='$ntotal',kd_skpd='$cskpd',username1='$id',last_update=getdate(),
                          triw1_sempurna_2='$tr1',triw2_sempurna_2='$tr2',triw3_sempurna_2='$tr3',triw4_sempurna_2='$tr4',
                          triw1_sempurna_final='$tr1',triw2_sempurna_final='$tr2',triw3_sempurna_final='$tr3',triw4_sempurna_final='$tr4',total_sempurna_final='$ntotal'
                          where kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);   
                echo '1';                            
        }else{
            $sql = "delete from trdskpd where kd_kegiatan='$cgiat'";
            $asg = $this->db->query($sql);
            if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','1',0,0,'$bln1','$bln1','1','','','','$bln1') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','2',0,0,'$bln2','$bln2','1','','','','$bln2') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','3',0,0,'$bln3','$bln3','1','','','','$bln3') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','4',0,0,'$bln4','$bln4','1','','','','$bln4') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','5',0,0,'$bln5','$bln5','1','','','','$bln5') ";
                $asg = $this->db->query($sql5);       
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','6',0,0,'$bln6','$bln6','1','','','','$bln6') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','7',0,0,'$bln7','$bln7','1','','','','$bln7') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','8',0,0,'$bln8','$bln8','1','','','','$bln8') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','9',0,0,'$bln9','$bln9','1','','','','$bln9') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','10',0,0,'$bln10','$bln10','1','','','','$bln10') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','11',0,0,'$bln11','$bln11','1','','','','$bln11') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','12',0,0,'$bln12','$bln12','1','','','','$bln12') ";
                $asg = $this->db->query($sql12);         
                $ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1_sempurna='$tr1',triw2_sempurna='$tr2',triw3_sempurna='$tr3',triw4_sempurna='$tr4',total_sempurna='$ntotal',
                          triw1_ubah='$tr1',triw2_ubah='$tr2',triw3_ubah='$tr3',triw4_ubah='$tr4',total_ubah='$ntotal',kd_skpd ='$cskpd'username1='$id',last_update=getdate(),
                          triw1_sempurna_2='$tr1',triw2_sempurna_2='$tr2',triw3_sempurna_2='$tr3',triw4_sempurna_2='$tr4',
                          triw1_sempurna_final='$tr1',triw2_sempurna_final='$tr2',triw3_sempurna_final='$tr3',triw4_sempurna_final='$tr4',total_sempurna_final='$ntotal'
                          where kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
                echo '1';
            } else {
                echo '0';
                exit();
            }
        }


    }
	
	
	
	
	function load_trdskpd_ubah(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => number_format($resulte['nilai_ubah'],2,'.',',')                                                                
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   
   
   function simpan_trskpd_ubah(){
    
        $cskpda=$this->input->post('cskpda');
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $query_find = $this->db->query("select * from trdskpd where kd_kegiatan='$cgiat'");
        $update = $query_find->num_rows();
        
        if($update > 0){    
                $kdGab = $cskpda.'.'.$cgiat;
                $sql1 = "update trdskpd set nilai_ubah=$bln1,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=1";
                $asg = $this->db->query($sql1);                              
                $sql2 = "update trdskpd set nilai_ubah=$bln2,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=2";
                $asg = $this->db->query($sql2);                
                $sql3 = "update trdskpd set nilai_ubah=$bln3,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=3";
                $asg = $this->db->query($sql3);                
                $sql4 = "update trdskpd set nilai_ubah=$bln4,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=4";
                $asg = $this->db->query($sql4);        
                $sql5 = "update trdskpd set nilai_ubah=$bln5,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=5";
                $asg = $this->db->query($sql5);       
                $sql6 = "update trdskpd set nilai_ubah=$bln6,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=6";
                $asg = $this->db->query($sql6);                
                $sql7 = "update trdskpd set nilai_ubah=$bln7,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=7";
                $asg = $this->db->query($sql7);                
                $sql8 = "update trdskpd set nilai_ubah=$bln8,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=8";
                $asg = $this->db->query($sql8);                
                $sql9 = "update trdskpd set nilai_ubah=$bln9,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=9";
                $asg = $this->db->query($sql9);                
                $sql10 = "update trdskpd set nilai_ubah=$bln10,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=10";
                $asg = $this->db->query($sql10);                
                $sql11 = "update trdskpd set nilai_ubah=$bln11,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=11";
                $asg = $this->db->query($sql11);                
                $sql12 = "update trdskpd set nilai_ubah=$bln12,kd_skpd='$cskpd' where kd_gabungan='$kdGab' and bulan=12";
                $asg = $this->db->query($sql12);         
                $ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1_ubah='$tr1',triw2_ubah='$tr2',triw3_ubah='$tr3',triw4_ubah='$tr4',total_ubah='$ntotal', kd_skpd='$cskpd' where kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);   
                echo '1';                            
        }else{
            $sql = "delete from trdskpd where kd_kegiatan='$cgiat'";
            $asg = $this->db->query($sql);
            if ($asg){                           
                $kdGab = $cskpda.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','1',0,0,0,'$bln1','2') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','2',0,0,0,'$bln2','2') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','3',0,0,0,'$bln3','2') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','4',0,0,0,'$bln4','2') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','5',0,0,0,'$bln5','2') ";
                $asg = $this->db->query($sql5);       
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','6',0,0,0,'$bln6','2') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','7',0,0,0,'$bln7','2') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','8',0,0,0,'$bln8','2') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','9',0,0,0,'$bln9','2') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','10',0,0,0,'$bln10','2') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','11',0,0,0,'$bln11','2') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','12',0,0,0,'$bln12','2') ";
                $asg = $this->db->query($sql12);         
                $ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1_ubah='$tr1',triw2_ubah='$tr2',triw3_ubah='$tr3',triw4_ubah='$tr4',total_ubah='$ntotal', kd_skpd='$cskpd' where kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
                echo '1';
            } else {
                echo '0';
                exit();
            }
        }
        
    }
				
//--------------- Anggaran Selesai ----------------//
	
//--------------- Laporan RKA -------------------//
function load_tanda_tangan() {
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$kd_skpd2= $this->left($kd_skpd,7);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE left(kd_skpd,7)= '$kd_skpd2' AND kode='PA'  AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
function load_tanda_tangan_lagi() {
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$kd_skpd2= $this->left($kd_skpd,7);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE left(kd_skpd,7)= '$kd_skpd2' AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}	
	
	function load_tanda_tangan_dpa() {
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$kd_skpd2= $this->left($kd_skpd,7);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE kode IN ('SETDA','PPKD') AND kd_skpd='$kd_skpd' AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
	
	
	function load_tanda_tangan_dpa1() {
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$kd_skpd2= $this->left($kd_skpd,7);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE kode='PPKD'  AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
	function total_spd_ar($jenis='',$skpd='',$awal='',$ahir=''){
        
        if ($jenis=='5'){
		  $dan="left(b.jns_kegiatan,1) ='$jenis'";
		}else{
		  $dan="b.jns_kegiatan ='$jenis'";
		}
        
        $skpd     = $skpd;
        $stsubah  = $this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="a.nilai";		
			$sts="susun";		
		}else{
			$field="a.nilai";				
			$sts="ubah";		
		}
        
        $sql = "SELECT SUM($field) as nilai FROM trdskpd a inner join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                WHERE a.kd_skpd='$skpd' and a.bulan>=$awal AND a.bulan<=$ahir and a.status='$sts' and $dan ";
				
        $query1 = $this->db->query($sql);  
		$test   = $query1->num_rows();
        $ii     = 0;
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'total' => $resulte['nilai']
                        );
                        $ii++;
        }
		
		if ($test===0){
            $result = array(
                        'total' => ''
                        );
                        $ii++;
		}		
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	
	function jumlah_detail_spd(){
        
        $no_spd = $this->input->post('cno_spd');
        $sql    = "SELECT SUM(nilai) as nilai FROM trdspd WHERE no_spd = '$no_spd' ";
		//$sql    = "SELECT total as nilai FROM trhspd WHERE no_spd = '$no_spd' ";		
        $query1 = $this->db->query($sql);  
		$test   = $query1->num_rows();
        $ii     = 0;
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'total' => $resulte['nilai']
                        );
                        $ii++;
        }
		
				
        echo json_encode($result);
    	$query1->free_result();   
    }
	
	//pindah 23-11-2017 (4)
function load_nilai_kua($cskpd=''){
                
        $query1 = $this->db->query("SELECT a.nilai_kua, (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1) IN ('5') 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) as nilai_ang,(SELECT SUM(nilai_sempurna) FROM trdrka WHERE LEFT(kd_rek5,1) IN ('5') 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) [nilai_angg_sempurna],(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1) IN ('5') 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) [nilai_angg_ubah] FROM ms_skpd a where a.kd_skpd='$cskpd'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        //'rekspm' => number_format($resulte['rekspm'],2,'.',','),
                        'nilai' => number_format($resulte['nilai_kua'],2,'.',','),                      
                        'kua_terpakai' => number_format($resulte['nilai_ang'],2,'.',','),
                        'kua_terpakai_sempurna' => number_format($resulte['nilai_angg_sempurna'],2,'.',','),                       
                        'kua_terpakai_ubah' => number_format($resulte['nilai_angg_ubah'],2,'.',',')  
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }
	
    
    //penetapan
	function skpdall() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where right(kd_skpd,2)='00' 
		and ( upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') )
		order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }


	 function skpduser() {
        $lccr = $this->input->post('q');
        $id  = $this->session->userdata('kdskpd');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where kd_skpd='$id' order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }

     function tambah_rka_penetapan()
    {
        $jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PERANCANGAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT PERANCANGAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA RANCANG');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka_rancang a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka_penetapan',$data) ; 
        $query1->free_result();
   }

 function tambah_giat_penetapan()
    {
        $wy=$this->rka_model->combo_urus();
        $jk=$this->rka_model->combo_skpd1();         
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode Urusan</td>
                        <td>:</td>
                        <td>$wy</td>
                        </tr>
                  ";
         
         $cRet .="<tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;
        $data['page_title']= 'PILIH KEGIATAN';
        $this->template->set('title', 'DETAIL KEGIATAN');          
        $this->template->load('template','anggaran/rka/pilih_giat_penetapan',$data) ; 
        //$this->load->view('anggaran/rka/tambah_rka',$data) ;
   }

 function select_rka_rancang($kegiatan='') {

        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,
                ISNULL(a.sumber, '') as sumber,ISNULL(a.sumber2, '') as sumber2,ISNULL(a.sumber3, '') as sumber3,ISNULL(a.sumber4, '') as sumber4,
                ISNULL(a.sumber1_su, '') as sumber1_su,ISNULL(a.sumber2_su, '') as sumber2_su,ISNULL(a.sumber3_su, '') as sumber3_su,
                ISNULL(a.sumber4_su, '') as sumber4_su,
                ISNULL(a.sumber1_ubah, '') as sumber1_ubah,ISNULL(a.sumber2_ubah, '') as sumber2_ubah,ISNULL(a.sumber3_ubah, '') as sumber3_ubah,
                ISNULL(a.sumber4_ubah, '') as sumber4_ubah,
                ISNULL(a.nilai_sumber, 0) as nilai_sumber,ISNULL(a.nilai_sumber2,0) as nilai_sumber2,ISNULL(a.nilai_sumber3, 0) as nilai_sumber3,
                ISNULL(a.nilai_sumber4, 0) as nilai_sumber4,
                ISNULL(a.nsumber1_su, 0) as nsumber1_su,ISNULL(a.nsumber2_su,0) as nsumber2_su,ISNULL(a.nsumber3_su, 0) as nsumber3_su,
                ISNULL(a.nsumber4_su, 0) as nsumber4_su,
                ISNULL(a.nsumber1_ubah, 0) as nsumber1_ubah,ISNULL(a.nsumber2_ubah,0) as nsumber2_ubah,ISNULL(a.nsumber3_ubah, 0) as nsumber3_ubah,
                ISNULL(a.nsumber4_ubah, 0) as nsumber4_ubah
                from trdrka_rancang a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 
                join trskpd_rancang c on a.kd_kegiatan=c.kd_kegiatan
                where a.kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {
            
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4'],
                        'sumber1_su' => $resulte['sumber1_su'],
                        'sumber2_su' => $resulte['sumber2_su'],
                        'sumber3_su' => $resulte['sumber3_su'],
                        'sumber4_su' => $resulte['sumber4_su'],
                        'sumber1_ubah' => $resulte['sumber1_ubah'],
                        'sumber2_ubah' => $resulte['sumber2_ubah'],
                        'sumber3_ubah' => $resulte['sumber3_ubah'],
                        'sumber4_ubah' => $resulte['sumber4_ubah'],                               
                        'nsumber1_su' => number_format($resulte['nsumber1_su'],"2",".",","), 
                        'nsumber2_su' => number_format($resulte['nsumber2_su'],"2",".",","), 
                        'nsumber3_su' => number_format($resulte['nsumber3_su'],"2",".",","),
                        'nsumber4_su' => number_format($resulte['nsumber4_su'],"2",".",","),
                        'nsumber1_ubah' => number_format($resulte['nsumber1_ubah'],"2",".",","), 
                        'nsumber2_ubah' => number_format($resulte['nsumber2_ubah'],"2",".",","), 
                        'nsumber3_ubah' => number_format($resulte['nsumber3_ubah'],"2",".",","),
                        'nsumber4_ubah' => number_format($resulte['nsumber4_ubah'],"2",".",",") ,
                        'nilai_sumber' => number_format($resulte['nilai_sumber'],"2",".",","), 
                        'nilai_sumber2' => number_format($resulte['nilai_sumber2'],"2",".",","), 
                        'nilai_sumber3' => number_format($resulte['nilai_sumber3'],"2",".",","),
                        'nilai_sumber4' => number_format($resulte['nilai_sumber4'],"2",".",",")                                 

                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }

    function load_sum_rek_rinci_rka_penetapan(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $rek = $this->input->post('rek');
        $norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query("SELECT nilai, nilai_sempurna, nilai_ubah FROM trdrka_rancang where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rka' => number_format($resulte['nilai'],"2",".",","),
                        'rektotal_rka_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'rektotal_rka_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),
                        
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);
           
         }

    function load_nilai_kua_rancang($cskpd=''){
                
        $query1 = $this->db->query("SELECT a.nilai_kua, (SELECT SUM(nilai) FROM trdrka_rancang WHERE LEFT(kd_rek5,2) IN (52) 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) as nilai_ang,(SELECT SUM(nilai_sempurna) FROM trdrka_rancang WHERE LEFT(kd_rek5,2) IN (52) 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) [nilai_angg_sempurna],(SELECT SUM(nilai_ubah) FROM trdrka_rancang WHERE LEFT(kd_rek5,2) IN (52) 
        AND left(kd_skpd,7) = left(a.kd_skpd,7)) [nilai_angg_ubah] FROM ms_skpd a where a.kd_skpd='$cskpd'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        //'rekspm' => number_format($resulte['rekspm'],2,'.',','),
                        'nilai' => number_format($resulte['nilai_kua'],2,'.',','),                      
                        'kua_terpakai' => number_format($resulte['nilai_ang'],2,'.',','),
                        'kua_terpakai_sempurna' => number_format($resulte['nilai_angg_sempurna'],2,'.',','),                       
                        'kua_terpakai_ubah' => number_format($resulte['nilai_angg_ubah'],2,'.',',')  
                        );
                        $ii++;
        }
       
           echo json_encode($result);
           $query1->free_result();  
    }

   function pgiat_rancang($cskpd='') {
        
        $cskpdd = substr($cskpd,0,7);
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_skpd,a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,status_keg FROM trskpd_rancang a INNER JOIN m_giat b ON a.kd_kegiatan=b.kd_kegiatan
                 where left(a.kd_skpd,7) ='$cskpdd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') ) 
                 order by a.kd_kegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd'  => $resulte['kd_skpd'],  
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'status_keg'   => $resulte['status_keg']
                        );
                        $ii++;
        }
        echo json_encode($result);
           
    }
    function tsimpan_rancang($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$sdana='') {
       
        if (trim($reklama)==''){
            $reklama=$rekbaru;
        }

        $nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmgiat=$this->rka_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek5=$this->rka_model->get_nama($rekbaru,'nm_rek5','ms_rek5','kd_rek5');

        $notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
//trdrka
        $query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
        $query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");   
        $query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");    
//trdrka rancang
        $query = $this->db->query(" delete from trdrka_rancang where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
        $query = $this->db->query(" insert into trdrka_rancang(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");   
        $query = $this->db->query(" update trskpd_rancang set total=( select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS=( select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");    

        $this->select_rka_rancang($kegiatan);
    }

    function ld_rek_rancang($giat='',$rek='') {
        if ($rek==''){
            $dan='';
        }else{
            $dan="and a.kd_rek5='$rek'";
        }
        $sql = " SELECT kd_rek5,nm_rek5 FROM (SELECT kd_rek5,nm_rek5 FROM ms_rek5 WHERE kd_rek5 NOT IN (SELECT kd_rek5 FROM trdrka_rancang WHERE kd_kegiatan='$giat'  ) AND
                 (kd_rek5 LIKE '4%' OR kd_rek5 LIKE '5%' OR kd_rek5 LIKE '6%'))a,
                 (SELECT @kd:=b.jns_kegiatan, @pj:=len(b.jns_kegiatan) FROM trskpd_rancang a INNER JOIN m_giat b ON 
                 a.kd_kegiatan1=b.kd_kegiatan WHERE a.kd_kegiatan='$giat' )t 
                 WHERE LEFT(a.kd_rek5,@pj)=@kd $dan ORDER BY a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    } 

function thapus_rancang($skpd='',$kegiatan='',$rek='') {
        
        $notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
        $query = $this->db->query(" delete from trdrka where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
        $query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
        $query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna=( select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna_2=( select sum(nilaisempurna2) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna_final=( select sum(nilai_akhir_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) )
        							where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ");   
        
        $query = $this->db->query(" delete from trdrka_rancang where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
        $query = $this->db->query(" delete from trdpo_rancang where no_trdrka='$notrdrka' ");
        $query = $this->db->query(" update trskpd_rancang set total=( select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna=( select sum(nilai_Sempurna) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_ubah=( select sum(nilai_ubah) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna_2=( select sum(nilaisempurna2) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ),
        							total_sempurna_final=( select sum(nilai_akhir_Sempurna) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) )
        							where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpd',7) ");   
        
        $this->select_rka_rancang($kegiatan);
    }
    
    function tsimpan_rinci_rancang(){

        $skpd    = $this->input->post('skpd');
        $kegiatan    = $this->input->post('giat');
        $rekening    = $this->input->post('rek');
        $index    = $this->input->post('id');
        $uraian    = $this->input->post('uraian');
        $volume1    = $this->input->post('volum1');
        $satuan1    = $this->input->post('satuan1');
        $harga1    = $this->input->post('harga1');
        $volume2    = $this->input->post('volum2');
        $satuan2    = $this->input->post('satuan2');
        $volume3    = $this->input->post('volum3');
        $satuan3    = $this->input->post('satuan3');
        
        $satuan1 = str_replace("12345678987654321","",$satuan1);
        $satuan1 = str_replace("undefined","",$satuan1);

        $satuan2 = str_replace("12345678987654321","",$satuan2);
        $satuan2 = str_replace("undefined","",$satuan2);

        $satuan3 = str_replace("12345678987654321","",$satuan3);
        $satuan3 = str_replace("undefined","",$satuan3);

        $uraian = str_replace("%20"," ",$uraian);
        $uraian = str_replace("%60"," ",$uraian);

        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $vol1=$volume1;
        $vol2=$volume2;
        $vol3=$volume3;
        if($volume1==0){$volume1=1;$vol1='';}
        if($volume2==0){$volume2=1;$vol2='';}
        if($volume3==0){$volume3=1;$vol3='';}
        
        $total   = $volume1*$volume2*$volume3*$harga1;
//murni
        $query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
        $query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
                                     values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
        $query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");   
//rancang        
        $query1 = $this->db->query(" delete from trdpo_rancang where no_po='$index' and no_trdrka='$norka' ");  
        $query1 = $this->db->query(" insert into trdpo_rancang(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
                                     values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
        $query1 = $this->db->query(" update trdrka_rancang set nilai= (select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka) where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd_rancang set total= (select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");   
        
        $this->rka_rinci_rancang($skpd,$kegiatan,$rekening);
    }
    function rka_rinci_rancang($skpd='',$kegiatan='',$rekening='') {
        
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo_rancang where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id'      => $ii,   
                        'header'  => $resulte['header'],  
                        'kode'    => $resulte['kode'],  
                        'no_po'   => $resulte['no_po'],  
                        'uraian'  => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],  
                        'volume2' => $resulte['volume2'],  
                        'volume3' => $resulte['volume3'],  
                        'satuan1' => $resulte['satuan1'],  
                        'satuan2' => $resulte['satuan2'],  
                        'satuan3' => $resulte['satuan3'],
                        'volume'  => $resulte['tvolume'],  
                        'harga1'  => number_format($resulte['harga1'],"2",".",","),  
                        'hargap'  => number_format($resulte['harga1'],"2",".",","),                             
                        'harga2'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga3'],"2",".",","),
                        'totalp'  => number_format($resulte['total'],"2",".",",") ,                            
                        'total'   => number_format($resulte['total'],"2",".",","),
                        'volume_sempurna1' => $resulte['volume_sempurna1'],
                        'tvolume_sempurna' => $resulte['tvolume_sempurna'],                            
                        'satuan_sempurna1' => $resulte['satuan_sempurna1'],
                        'harga_sempurna1'  => number_format($resulte['harga_sempurna1'],"2",".",","),
                        'total_sempurna'  => number_format($resulte['total_sempurna'],"2",".",","),
                        'volume_ubah1' => $resulte['volume_ubah1'],
                        'tvolume_ubah' => $resulte['tvolume_ubah'],                            
                        'satuan_ubah1' => $resulte['satuan_ubah1'],
                        'harga_ubah1'  => number_format($resulte['harga_ubah1'],"2",".",","),
                        'total_ubah'  => number_format($resulte['total_ubah'],"2",".",",")
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


 function thapus_rinci_ar_all_rancang(){
        $norka = $this->input->post('vnorka');
        $kegi = $this->input->post('kegi');
        $kdskpd = $this->input->post('kdskpd');

        //murni
        $query = $this->db->query("delete from trdpo where no_trdrka='$norka'");
        $query1 = $this->db->query(" update trdrka set nilai=0,nilai_sempurna=0,nilaisempurna2=0,nilai_ubah=0,nilai_akhir_sempurna=0 
                                     ,nilai_sumber=0,nilai_sumber2=0,nilai_sumber3=0,nilai_sumber4=0, 
                                     nsumber1_su=0,nsumber2_su=0,nsumber3_su=0,nsumber4_su=0,nsumber1_ubah=0,nsumber2_ubah=0,nsumber3_ubah=0,nsumber4_ubah=0
                                     where no_trdrka='$norka' "); 
        $query1 = $this->db->query("update trskpd set total=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7))
                                    ,total_sempurna=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_sempurna_2=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_sempurna_final=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_ubah=(select isnull(sum(nilai),0) from trdrka where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)) 
                                    where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)"); 
//rancang
        $query = $this->db->query("delete from trdpo_rancang where no_trdrka='$norka'");
        $query1 = $this->db->query(" update trdrka_rancang set nilai=0,nilai_sempurna=0,nilaisempurna2=0,nilai_ubah=0,nilai_akhir_sempurna=0 
                                     ,nilai_sumber=0,nilai_sumber2=0,nilai_sumber3=0,nilai_sumber4=0, 
                                     nsumber1_su=0,nsumber2_su=0,nsumber3_su=0,nsumber4_su=0,nsumber1_ubah=0,nsumber2_ubah=0,nsumber3_ubah=0,nsumber4_ubah=0
                                     where no_trdrka='$norka' "); 
        $query1 = $this->db->query("update trskpd_rancang set total=(select isnull(sum(nilai),0) from trdrka_rancang where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7))
                                    ,total_sempurna=(select isnull(sum(nilai),0) from trdrka_rancang where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_sempurna_2=(select isnull(sum(nilai),0) from trdrka_rancang where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_sempurna_final=(select isnull(sum(nilai),0) from trdrka_rancang where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)),
                                    total_ubah=(select isnull(sum(nilai),0) from trdrka_rancang where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)) 
                                    where kd_kegiatan='$kegi' and left(kd_skpd,7)=left('$kdskpd',7)"); 

 
        if ( $query > 0 ){
            echo '1' ;
        } else {
            echo '0' ;
        }
    }

function tsimpan_rinci_jk_rancang(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $rekening      = $this->input->post('crek');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
        $id         =  $this->session->userdata('pcNama');                       
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
            
    
        $sql1       = "delete from trdpo where no_trdrka='$norka'";
         $asg2       = $this->db->query($sql1);
        $sql       = "delete from trdpo_rancang where no_trdrka='$norka'";
        $asg       = $this->db->query($sql);
            
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{      
                //murni      
                    $sql1 = "insert into trdpo(kd_kegiatan,kd_rek5,no_po,header,kode,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,
                            total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,
                            volume_sempurna1,volume_sempurna2,volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,
                            harga_sempurna1,total_sempurna,harga_sempurna2,total_sempurna_2)";
                    $asg1 = $this->db->query($sql1.$csql);
                    $sql = "insert into trdpo_rancang(kd_kegiatan,kd_rek5,no_po,header,kode,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,
                            total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,
                            volume_sempurna1,volume_sempurna2,volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,
                            harga_sempurna1,total_sempurna,harga_sempurna2,total_sempurna_2)";
                //rancang            
                           
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
      //murni
        $query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilai_sempurna= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilaisempurna2= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                     nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka), 
                                     nilai_akhir_sempurna=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                     ,username='$id',last_update=getdate(),
                                     sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4',nilai_sumber='$ndana1',
                                     nilai_sumber2=$ndana2,nilai_sumber3=$ndana3,nilai_sumber4=$ndana4,     
                                     sumber1_su='$sdana1',sumber2_su='$sdana2',sumber3_su='$sdana3',sumber4_su='$sdana4',nsumber1_su=$ndana1,
                                     nsumber2_su=$ndana2,nsumber3_su=$ndana3,nsumber4_su=$ndana4,       
                                     sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',nsumber1_ubah=$ndana1,
                                     nsumber2_ubah=$ndana2,nsumber3_ubah=$ndana3,nsumber4_ubah=$ndana4
                                     where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     total_sempurna_2= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna_final= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_ubah= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     username='$id',last_update=getdate()
                                     where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd'");

    
    //rancang
     $query1 = $this->db->query(" update trdrka_rancang set nilai= (select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka),
                                     nilai_sempurna= (select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka),
                                     nilaisempurna2= (select sum(total) as nl from trdpo where no_trdrka=trdrka_Rancang.no_trdrka),
                                     nilai_ubah=(select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka), 
                                     nilai_akhir_sempurna=(select sum(total) as nl from trdpo_rancang where no_trdrka=trdrka_rancang.no_trdrka)
                                     ,username='$id',last_update=getdate(),
                                     sumber='$sdana1',sumber2='$sdana2',sumber3='$sdana3',sumber4='$sdana4',nilai_sumber='$ndana1',
                                     nilai_sumber2=$ndana2,nilai_sumber3=$ndana3,nilai_sumber4=$ndana4,     
                                     sumber1_su='$sdana1',sumber2_su='$sdana2',sumber3_su='$sdana3',sumber4_su='$sdana4',nsumber1_su=$ndana1,
                                     nsumber2_su=$ndana2,nsumber3_su=$ndana3,nsumber4_su=$ndana4,       
                                     sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',nsumber1_ubah=$ndana1,
                                     nsumber2_ubah=$ndana2,nsumber3_ubah=$ndana3,nsumber4_ubah=$ndana4
                                     where no_trdrka='$norka' ");  
        $query1 = $this->db->query(" update trskpd_rancang set total= (select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna= (select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     total_sempurna_2= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_sempurna_final= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                     total_ubah= (select sum(nilai) as jum from trdrka_rancang where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                     username='$id',last_update=getdate()
                                     where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd'");  


        $this->rka_rinci_rancang($cskpd,$kegiatan,$rekening);
    
    }

function load_sum_rek_rancang(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $skp = substr($kdskpd,0,7);
        $query1 = $this->db->query(" select sum(nilai) as rektotal,sum(nilai_sempurna) as rektotal_sempurna,sum(nilai_ubah) as rektotal_ubah from 
                                     trdrka_rancang where left(kd_skpd,7)='$skp' and left(kd_rek5,3) not in ('514','515') and kd_kegiatan='$kegiatan'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_sempurna' => number_format($resulte['rektotal_sempurna'],"2",".",","),
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   
    }


function load_sum_rek_rinci_rancang(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');
        $rek = $this->input->post('rek');
        $norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total) as rektotal_rinci,sum(total_ubah) as rektotal_rinci_ubah from trdpo_rancang where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        'rektotal_rinci_ubah' => number_format($resulte['rektotal_rinci_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   
    }



    function tsimpan_ar_rancang(){
        
        $id         =  $this->session->userdata('pcNama'); 
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
//murni
        $query_del = $this->db->query("delete from trdrka where left(kd_skpd,7)=left('$kdskpd',7) and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,
                                        sumber,sumber2,sumber3,sumber4,nilai_sumber,nilai_sumber2,nilai_sumber3,nilai_sumber4,
                                       sumber1_su,sumber2_su,sumber3_su,sumber4_su,nsumber1_su,nsumber2_su,nsumber3_su,nsumber4_su,     
                                       sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,nilai_akhir_sempurna,username,last_update) 
                                        values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3'
                                        ,'$sdana4','$ndana1',$ndana2,$ndana3,$ndana4,'$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,       
                                       '$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,'$nilai','$id',getdate())"); 

//rancang
        $query_del = $this->db->query("delete from trdrka_rancang where left(kd_skpd,7)=left('$kdskpd',7) and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka_rancang(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,
                                        sumber,sumber2,sumber3,sumber4,nilai_sumber,nilai_sumber2,nilai_sumber3,nilai_sumber4,
                                       sumber1_su,sumber2_su,sumber3_su,sumber4_su,nsumber1_su,nsumber2_su,nsumber3_su,nsumber4_su,     
                                       sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,nilai_akhir_sempurna,username,last_update) 
                                        values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3'
                                        ,'$sdana4','$ndana1',$ndana2,$ndana3,$ndana4,'$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,       
                                       '$sdana1','$sdana2','$sdana3','$sdana4',$ndana1,$ndana2,$ndana3,$ndana4,'$nilai','$id',getdate())");         

   
        if ( $query_ins > 0 and $query_del > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }

function simpan_det_keg_rancang(){
        
        $skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        $ang_lalu=$this->input->post('lalu');      
        
        //murni
        $this->db->query(" update trskpd set tu_capai='$cp_tu', 
                                             tu_mas='$m_tu',            
                                             tu_kel='$k_tu',            
                                             tu_has='$h_tu',
                                             tk_capai='$cp_ck',
                                             tk_mas='$m_ck',
                                             tk_kel='$k_ck',
                                             tk_has='$h_ck',
                                             tu_capai_sempurna='$cp_tu', 
                                             tu_mas_sempurna='$m_tu',           
                                             tu_kel_sempurna='$k_tu',           
                                             tu_has_sempurna='$h_tu',
                                             tk_capai_sempurna='$cp_ck',
                                             tk_mas_sempurna='$m_ck',
                                             tk_kel_sempurna='$k_ck',
                                             tk_has_sempurna='$h_ck',
                                             tu_capai_ubah='$cp_tu', 
                                             tu_mas_ubah='$m_tu',           
                                             tu_kel_ubah='$k_tu',           
                                             tu_has_ubah='$h_tu',
                                             tk_capai_ubah='$cp_ck',
                                             tk_mas_ubah='$m_ck',
                                             tk_kel_ubah='$k_ck',
                                             tk_has_ubah='$h_ck',
                                             lokasi='$lokasi',
                                             sasaran_giat='$sasaran',
                                             waktu_giat='$wkeg',
                                             kd_pptk='$ttd',
                                             ang_lalu='$ang_lalu'
        where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
//rancang
        $this->db->query(" update trskpd_rancang set tu_capai='$cp_tu', 
                                             tu_mas='$m_tu',            
                                             tu_kel='$k_tu',            
                                             tu_has='$h_tu',
                                             tk_capai='$cp_ck',
                                             tk_mas='$m_ck',
                                             tk_kel='$k_ck',
                                             tk_has='$h_ck',
                                             tu_capai_sempurna='$cp_tu', 
                                             tu_mas_sempurna='$m_tu',           
                                             tu_kel_sempurna='$k_tu',           
                                             tu_has_sempurna='$h_tu',
                                             tk_capai_sempurna='$cp_ck',
                                             tk_mas_sempurna='$m_ck',
                                             tk_kel_sempurna='$k_ck',
                                             tk_has_sempurna='$h_ck',
                                             tu_capai_ubah='$cp_tu', 
                                             tu_mas_ubah='$m_tu',           
                                             tu_kel_ubah='$k_tu',           
                                             tu_has_ubah='$h_tu',
                                             tk_capai_ubah='$cp_ck',
                                             tk_mas_ubah='$m_ck',
                                             tk_kel_ubah='$k_ck',
                                             tk_has_ubah='$h_ck',
                                             lokasi='$lokasi',
                                             sasaran_giat='$sasaran',
                                             waktu_giat='$wkeg',
                                             kd_pptk='$ttd',
                                             ang_lalu='$ang_lalu'
        where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
    }



    function load_det_keg_rancang(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd_rancang where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai'],
                        'm_tu' => $resulte['tu_mas'],
                        'k_tu' => $resulte['tu_kel'],
                        'h_tu' => $resulte['tu_has'],
                        'cp_ck' => $resulte['tk_capai'],
                        'm_ck' => $resulte['tk_mas'],
                        'ang_lalu' => number_format(($resulte['ang_lalu']),"2",".",","),
                        'k_ck' => $resulte['tk_kel'],
                        'h_ck' => $resulte['tk_has']                        
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   
    }




    function ld_giat_rancang($skpd='',$urusan='') { 
        $lccr   = $this->input->post('q');
        if ($skpd=='0')
        {
            $sql    = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,4)= '$urusan') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%'))  order by kd_kegiatan ";
    }else{
            $sql    = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,10)= left('$skpd',10) or (left(kd_kegiatan,4)='$urusan' or left(kd_kegiatan,4)='0.00') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) ) order by kd_kegiatan ";  
}
    
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'lanjut' => 'Tidak'

                        );
                        $ii++;
        }
        echo json_encode($result);
    }

function select_giat_rancang($skpd='') {    
        $sql = "select a.kd_kegiatan as kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,a.lanjut from trskpd_rancang a inner join m_giat b on b.kd_kegiatan=a.kd_kegiatan1 where a.kd_skpd='$skpd' order by a.kd_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],                         
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'jns_kegiatan' => $resulte['jns_kegiatan'],                           
                        'lanjut' => $resulte['lanjut']                           
                        );
                        $ii++;
        }
        echo json_encode($result);
    }



function psimpan_rancang($skpd='',$urusan='',$rekbaru='',$reklama='',$jns='',$lanjut='Tidak') {         

   $kd=$this->right($rekbaru,6);
    $prog1=$this->left($rekbaru,18);    
    $giat=$urusan.'.'.$skpd.'.'.$kd;
    $prog=$this->left($giat,18); 
    $gabung=$skpd.'.'.$giat;
    $nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
    $nmgiat=$this->rka_model->get_nama($rekbaru,'nm_kegiatan','m_giat','kd_kegiatan');
    $nmprog=$this->rka_model->get_nama($prog1,'nm_program','m_prog','kd_program');
    //murni
    $query = $this->db->query("delete from trskpd where kd_skpd='$skpd' and kd_kegiatan1='$rekbaru'");
    $queryx = $this->db->query("insert into trskpd(kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,kd_kegiatan1,kd_program1,jns_kegiatan,nm_skpd,nm_kegiatan,nm_program,lanjut) 
                                values('$gabung','$giat','$prog','$urusan','$skpd','$rekbaru','$prog1','$jns','$nmskpd','$nmgiat','$nmprog','$lanjut')");   
    
    //rancang
    $query = $this->db->query("delete from trskpd_rancang where kd_skpd='$skpd' and kd_kegiatan1='$rekbaru'");
    $queryx = $this->db->query("insert into trskpd_rancang(kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,kd_kegiatan1,kd_program1,jns_kegiatan,nm_skpd,nm_kegiatan,nm_program,lanjut) 
                                values('$gabung','$giat','$prog','$urusan','$skpd','$rekbaru','$prog1','$jns','$nmskpd','$nmgiat','$nmprog','$lanjut')"); 


     $this->db->query("WITH a as (SELECT
                        kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,nm_skpd,kd_kegiatan1,nm_kegiatan,jns_kegiatan,kd_program1,nm_program,indika,
                        tu,tk,sasaran_giat,sumber_dana,waktu_giat,tk_kwt,kd_pptk,kd_comp,kontrak,jns_keg,tu_capai,tu_capai_sempurna,tu_capai_ubah,tu_mas,
                        tu_mas_sempurna,tu_mas_ubah,tu_kel,tu_kel_sempurna,tu_kel_ubah,tu_has,tu_has_Sempurna,tu_has_ubah,tk_capai,tk_capai_sempurna,
                        tk_capai_ubah,tk_mas,tk_mas_sempurna,tk_mas_ubah,tk_kel,tk_kel_sempurna,tk_kel_ubah,tk_has,tk_has_sempurna,tk_has_ubah,alasan,
                        username,latar_belakang,triw1,triw1_Sempurna,triw1_ubah,triw2,triw2_Sempurna,triw2_ubah,triw3,triw3_Sempurna,triw3_ubah,
                        triw4,triw4_Sempurna,triw4_ubah,total,total_sempurna,total_ubah,lokasi,status_keg,lanjut,ang_lalu,username1,last_update,rancang,
                        kd_subkegiatan,nm_subkegiatan,kd_bidsubkegiatan,
                        ROW_NUMBER() OVER(PARTITION by 
                        kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,nm_skpd,kd_kegiatan1,nm_kegiatan,jns_kegiatan,kd_program1,nm_program,indika,
                        tu,tk,sasaran_giat,sumber_dana,waktu_giat,tk_kwt,kd_pptk,kd_comp,kontrak,jns_keg,tu_capai,tu_capai_sempurna,tu_capai_ubah,tu_mas,
                        tu_mas_sempurna,tu_mas_ubah,tu_kel,tu_kel_sempurna,tu_kel_ubah,tu_has,tu_has_Sempurna,tu_has_ubah,tk_capai,tk_capai_sempurna,
                        tk_capai_ubah,tk_mas,tk_mas_sempurna,tk_mas_ubah,tk_kel,tk_kel_sempurna,tk_kel_ubah,tk_has,tk_has_sempurna,tk_has_ubah,alasan,
                        username,latar_belakang,triw1,triw1_Sempurna,triw1_ubah,triw2,triw2_Sempurna,triw2_ubah,triw3,triw3_Sempurna,triw3_ubah,
                        triw4,triw4_Sempurna,triw4_ubah,total,total_sempurna,total_ubah,lokasi,status_keg,lanjut,ang_lalu,username1,last_update,rancang,
                        kd_subkegiatan,nm_subkegiatan,kd_bidsubkegiatan
                        ORDER BY kd_gabungan) 
                        AS duplicateRecCount
                        FROM trskpd
                        )
                    --Now Delete Duplicate Records
                    DELETE FROM a
                    WHERE duplicateRecCount > 1");

    $this->db->query("WITH a as (SELECT
                        kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,nm_skpd,kd_kegiatan1,nm_kegiatan,jns_kegiatan,kd_program1,nm_program,indika,
                        tu,tk,sasaran_giat,sumber_dana,waktu_giat,tk_kwt,kd_pptk,kd_comp,kontrak,jns_keg,tu_capai,tu_capai_sempurna,tu_capai_ubah,tu_mas,
                        tu_mas_sempurna,tu_mas_ubah,tu_kel,tu_kel_sempurna,tu_kel_ubah,tu_has,tu_has_Sempurna,tu_has_ubah,tk_capai,tk_capai_sempurna,
                        tk_capai_ubah,tk_mas,tk_mas_sempurna,tk_mas_ubah,tk_kel,tk_kel_sempurna,tk_kel_ubah,tk_has,tk_has_sempurna,tk_has_ubah,alasan,
                        username,latar_belakang,triw1,triw1_Sempurna,triw1_ubah,triw2,triw2_Sempurna,triw2_ubah,triw3,triw3_Sempurna,triw3_ubah,
                        triw4,triw4_Sempurna,triw4_ubah,total,total_sempurna,total_ubah,lokasi,status_keg,lanjut,ang_lalu,username1,last_update,rancang,
                        kd_subkegiatan,nm_subkegiatan,kd_bidsubkegiatan,
                        ROW_NUMBER() OVER(PARTITION by 
                        kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,nm_skpd,kd_kegiatan1,nm_kegiatan,jns_kegiatan,kd_program1,nm_program,indika,
                        tu,tk,sasaran_giat,sumber_dana,waktu_giat,tk_kwt,kd_pptk,kd_comp,kontrak,jns_keg,tu_capai,tu_capai_sempurna,tu_capai_ubah,tu_mas,
                        tu_mas_sempurna,tu_mas_ubah,tu_kel,tu_kel_sempurna,tu_kel_ubah,tu_has,tu_has_Sempurna,tu_has_ubah,tk_capai,tk_capai_sempurna,
                        tk_capai_ubah,tk_mas,tk_mas_sempurna,tk_mas_ubah,tk_kel,tk_kel_sempurna,tk_kel_ubah,tk_has,tk_has_sempurna,tk_has_ubah,alasan,
                        username,latar_belakang,triw1,triw1_Sempurna,triw1_ubah,triw2,triw2_Sempurna,triw2_ubah,triw3,triw3_Sempurna,triw3_ubah,
                        triw4,triw4_Sempurna,triw4_ubah,total,total_sempurna,total_ubah,lokasi,status_keg,lanjut,ang_lalu,username1,last_update,rancang,
                        kd_subkegiatan,nm_subkegiatan,kd_bidsubkegiatan
                        ORDER BY kd_gabungan) 
                        AS duplicateRecCount
                        FROM trskpd_rancang
                        )
                    --Now Delete Duplicate Records
                    DELETE FROM a
                    WHERE duplicateRecCount > 1");    

    $this->select_giat_rancang($skpd);
    }



function ghapus_rancang($skpd='',$kegiatan='') {
        $query = $this->db->query("delete from trskpd_rancang where left(kd_skpd,7)=left('$skpd',7) and kd_kegiatan='$kegiatan' and kd_kegiatan not in(SELECT DISTINCT kd_kegiatan FROM trdrka)");
        $this->select_giat_rancang($skpd);
    }
    //end penetapan//


   //baru
function config_skpd2(){
        $skpd     =  $this->input->post('kdskpd');
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_sempurna,b.status_sempurna_final,b.status_ubah,b.status_rancang FROM  ms_skpd a LEFT JOIN trhrka b ON 
                a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd' ";
        $query1 = $this->db->query($sql);  
        
        $test = $query1->num_rows();
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'statu' => $resulte['statu'],
                        'status_sem' => $resulte['status_sempurna'],
                        'status_sem_final' => $resulte['status_sempurna_final'],
                        'status_ubah' => $resulte['status_ubah'],
                        'status_rancang' => $resulte['status_rancang']
                        );
                        $ii++;
        }
        

        
        
        echo json_encode($result);
        $query1->free_result();   
    }   
    
    
function load_ttd_agr() {
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT * FROM ms_ttd WHERE (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%')) and kode='agr'";   

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan'],  
                        'pangkat' => $resulte['pangkat']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
           
    }
    
    
     function load_ttd_unit($skpd='') {
        $kd_skpd = $skpd; 
        $kd_skpd2= $this->left($kd_skpd,10);        
        $kd_skpd3= $this->left($kd_skpd,7);
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT * FROM ms_ttd WHERE left(kd_skpd,7)= '$kd_skpd3' AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

         
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();        
    }
    
    	function load_ttd_bud(){
        $kd_skpd = $this->session->userdata('kdskpd'); 
		$kdskpd = substr($kd_skpd,0,7);
		$sql = "SELECT * FROM ms_ttd WHERE kode='bud'";

        $mas = $this->db->query($sql);
        $result = array();
        $ii = 0;        
        foreach($mas->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],
                        'jabatan' => $resulte['jabatan']
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $mas->free_result();
    	   
	}
     function load_ttd_unit_pa($skpd='') {
        $kd_skpd = $skpd; 
        $kd_skpd2= $this->left($kd_skpd,10);        
        $kd_skpd3= $this->left($kd_skpd,7);
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT * FROM ms_ttd WHERE kode='PA' and left(kd_skpd,7)= '$kd_skpd3' AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

         
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();        
    }
    
    function load_ttd_unit_filter($skpd='1.01.01.00',$kode='1') {
        $kd_skpd = $skpd; 
        $kd_skpd2= $this->left($kd_skpd,10);        
        $kd_skpd3= $this->left($kd_skpd,7);
        $lccr='';        
        $lccr = $this->input->post('q');       

        if($kode=='2'){
        	$sql = "SELECT * FROM ms_ttd WHERE kode='PA' and kd_skpd= '$kd_skpd' AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";
        }else if($kode=='1'){
        	$sql = "SELECT * FROM ms_ttd WHERE (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%')) and kode='agr'";
        }
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();        
    }
    
        function  tanggal_format_indonesia2($tgl){
        $tanggal  =  substr($tgl,7,2);
        $bulan  = $this-> getBulan(substr($tgl,5,2));
        $tahun  =  substr($tgl,0,4);
        return  $tanggal.' '.$bulan.' '.$tahun;

    }  
    
    
//ctk_dpa0
    function ctk_dpa0(){
        $data['page_title']= 'Cetak RKA 0';
        $this->template->set('title', 'Cetak DPA 0');   
        $this->template->load('template','anggaran/rka/ctk_dpa0',$data) ; 
    }



         function preview_dpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        $ttd2x= $this->uri->segment(8);
        $tgl2= $this->uri->segment(7);
        $statttd= $this->uri->segment(9);
        $ttd1x= $this->uri->segment(10);
        $ttd_tgl = $this->tukd_model->tanggal_format_indonesia($tgl2);
        $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        //$ttd2= $_REQUEST['ttd2'];        
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        if($status=='1'){
            $judulrka = 'RINGKASAN DOKUMEN PELAKSANAAN ANGGARAN';
            $n_trdrka = '';
            $kdrka ='DPA';
        }else{
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $n_trdrka  =   '_rancang';
            $kdrka ='RKA';
        }
        
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,left(a.kd_skpd,7) as kd_skp,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)=left('$id',7) and right(kd_skpd,2)='00'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
         
        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                    
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


       if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }       
        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>$judulrka</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>$kdrka - PD<br></strong></td>
                    </tr>

                    <tr>
                         <td  style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>PERANGKAT DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
                  
       if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                   <tr>
                        <td><strong>&emsp;Unit Organisasi</stong></td>
                        <td><strong>: $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi </stong></td>
                        <td ><strong>: </stong></td>
                        <td><strong> $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                </table>";            
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                            
                         <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"10%\" align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"70%\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"20%\" align=\"center\"><strong>3</strong></td></tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$this->dotrek(rtrim($row->kd_rek));
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                    
                    if(strlen($coba1)>3){                                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1 </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba1</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba3</strong></td></tr>";                        
                    }
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka$n_trdrka WHERE LEFT(kd_rek5,2)='41' and $a$skpd$b='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                    
                    if ($cob1!=0){                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba4</strong></td></tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    } 
                 }     

                 
         
         
               $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$this->dotrek(rtrim($row1->kd_rek));
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    
                    if(strlen($coba5)>3){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                    }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka$n_trdrka WHERE (LEFT(kd_rek5,2)='51' or LEFT(kd_rek5,2)='52') and $a$skpd$b='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba8</strong></td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                    $x1="(";
                    $suplus=$suplus*-1;
                    $y1=")";}
                  else {
                    $x1="";
                    $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$x1$surp$y1</strong></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";

                    if ($id == 'ppkd' || $id == 'ppkd1'){
                        //PENERIMAAN PEMBIAYAAN
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
        
                       $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpen = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                    
                        $totpen1=number_format($totpen,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENERIMAAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpen1</strong></td></tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                    

                        //PENGELUARAN PEMBIAYAAN
        
                        $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka$n_trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka$n_trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpeng = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                        
                        $jbiaya = $totpen - $totpeng;
                        
                         $jbiaya = $this->rp_minus($jbiaya);
                        
                       $totpeng=number_format($totpeng,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENGELUARAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpeng</strong></td></tr>";
                     //perbaiki totpeng dan jbiaya
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                                                         
                       $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$jbiaya</strong></td></tr>";


                    }
                    
  
   
                    
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Anggaran<br>Perangkat Daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td width=\"4%\" style=\"text-align: center;\"><strong>1</strong> </td>
                                <td width=\"23%\" style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>3</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>4</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>5</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>6</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
                                                        
  
                    //Pendapatan
                    $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                    
                    //BTL
                    $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a
                                join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Tidak Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //BL
                    $qtriw = " SELECT  isnull(sum(a.triw1),0) AS triw1,isnull(sum(a.triw2),0) AS triw2,isnull(sum(a.triw3),0) 
                                AS triw3,isnull(sum(a.triw4),0) AS triw4 FROM trskpd a
                                join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_program,2)<>'00' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.003' AND $a a.$skpd$b='$id'";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
                                <table border=\"0\" width=\"100%\">
                                <tr>
                                <td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
                                <br>&nbsp;
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;  
                                </td>
                                <td width=\"30%\" align=\"center\">$daerah,$ttd_tgl 
                                <br>$jdlnip1
                                <br>$jabatan1
                                <p>&nbsp;</p>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br><strong><ins>$nama1</ins></strong>
                                <br>$nip1 
                                </td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
//end ctk_dpa0
    
    
    
    //ctk_dpa1
    function ctk_dpa1(){
        $data['page_title']= 'Cetak RKA 1';
        $this->template->set('title', 'Cetak DPA 1');   
        $this->template->load('template','anggaran/rka/ctk_dpa1',$data) ; 
    }
    
    
    
     function preview_coverrka0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd1x = $this->uri->segment(9);
        $ttd1 = str_replace('x',' ',$ttd1x);

        $idd = substr($id,0,7).".00";
        $sqlorg="SELECT kd_skpd,nm_skpd FROM ms_skpd WHERE kd_skpd='$idd'";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_skpd;                    
                    $nm_org= $rowdns->nm_skpd;
                }

        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1x=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1x= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1x  = empty($rowttd->jab) ? '': $rowttd->jab;
                }


$sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        if($status=='1'){
            $judulrka = 'Dokumen Pelaksanaan Anggaran';
            $judulrka1 = 'DOKUMEN PELAKSANAAN ANGGARAN';
            $n_trdrka = '';
            $kdrka ='DPA';
        }else{
            $judulrka = 'Rencana Kerja Anggaran';
            $judulrka1 = 'RENCANA KERJA ANGGARAN';
            $n_trdrka  =   '_rancang';
            $kdrka ='RKA';
        }

  
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; margin-top: 200px;\" width=\"80%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$judulrka1</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td>                    
                    </tr>
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>($kdrka-SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                    </tbody>
                </table>
                <table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

                 $sql1="select a.kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where kd_skpd ='$id' group by left(kd_kegiatan,4),kd_skpd,nm_urusan";
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
                        

                        $cRet    .= "
                                    <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">Urusan Pemerintah</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">: $urus - $nm_urus</td>
                                     </tr>";
                }


                 $cRet    .= "      <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">Organisasi</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">: $kd_org - $nm_org</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">Pengguna Anggaran</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">&nbsp;</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">a.Nama</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">: $nama1x</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">b.NIP</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">: $nip1x</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">c.Jabatan</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">: $jabatan1x</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">&nbsp;</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">&nbsp;</td>
                                     </tr>
                                     <tr>
                                        <td width=\"20%\" align=\"left\" style=\"font-weight: bold;\">&nbsp;</td>
                                        <td width=\"60%\" align=\"left\" style=\"font-weight: bold;\">&nbsp;</td>
                                     </tr>
                                     </table>";

        $cRet .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                    <tr>
                        <td width=\"10%\" align=\"center\" style=\"font-weight: bold;\">Kode</td> 
                        <td width=\"70%\" align=\"center\" style=\"font-weight: bold;\">Nama Formulir</td>
                    </tr>
                    </thead>
                    <tbody align=\"left\">
                    <tr>
                        <td width=\"20%\" ><strong>$kdrka - SKPD</strong></td> 
                        <td width=\"60%\" >Ringkasan $judulrka Perangkat Daerah</td>                    
                    </tr>
                    <tr>
                        <td width=\"20%\" ><strong>$kdrka - SKPD 1</strong></td> 
                        <td width=\"60%\" >Rincian $judulrka Pendapatan Satuan Kerja Perangkat Daerah </td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>$kdrka - SKPD 2</strong></td> 
                        <td width=\"60%\" >Rekapitulasi Rincian Anggaran Belanja menurut Program dan Kegiatan Satuan Kerja Perangkat Daerah</td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>$kdrka - SKPD 2.1</strong></td> 
                        <td width=\"60%\" >Rincian Anggaran Belanja menurut Program dan Kegiatan Satuan Kerja Perangkat Daerah</td>                    
                    </tr>
                     <!--<tr>
                        <td width=\"20%\" ><strong>$kdrka - SKPD 2.2.1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Anggaran Belanja Langsung Program dan Per Kegiatan Satuan Kerja Perangkat Daerah </td>                    
                    </tr>-->                                                                                                
                    </tbody>
                </table>";
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','',50);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }    
     
     function preview_coverdpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2 = $this->uri->segment(8);
        //$ttd2= $_REQUEST['ttd2'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
        

        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.02.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"7\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>PENDAPATAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"30%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>01</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>4</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"20%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
   
    function preview_dpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttd1x = $this->uri->segment(9);
        $ttd2x = $this->uri->segment(10);
        $statttd = $this->uri->segment(11);
        //$ttd = $this->uri->segment(10);       
        $tgl2 = $this->uri->segment(8);
        $tgl_ttd = $this->tukd_model->tanggal_format_indonesia($tgl2);
      //  $ttd1= $_REQUEST['ttd1'];
      //  $ttd2= $_REQUEST['ttd2'];
        $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        if($status=='1'){
            $judulrka = 'RINGKASAN DOKUMEN PELAKSANAAN ANGGARAN';
            $judulrka2 = 'Ringkasan Dokumen Pelaksanaan Anggaran';
            $n_trdrka = '';
            $kdrka ='DPA';
        }else{
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $judulrka2 = 'Rencana Kerja dan Anggaran';
            $n_trdrka  =   '_rancang';
            $kdrka ='RKA';
        }


        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>$judulrka<br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"25%\" align=\"center\" colspan=\"5\"><strong>NOMOR $kdrka PD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka 1 - PD<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>01</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"5%\" align=\"center\"><strong>4</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_skpd - $nm_skpd</strong></td>
                    </tr>";
       $Xret2.= "";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>$judulrka2<br>Pendapatan Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";
                
 

                $sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,6)='00.001' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.001'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,6)='00.001' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                            a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,6)='00.001' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==' '){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
                    
                }

                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";
        $cRet    .= "</table>";
     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

                             $cRet .=" 
                                            <tr>
                                                <td align=\"right\">$daerah, $tgl_ttd &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;
                                                    <br>$jabatan1
                                                    <br>$jdlnip1 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    <br>
                                                    <b><u>$nama1</u></b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                    <br>$nip1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                </td>
                                                <td  align=\"center\" valign=\"top\">
                                                </td>
                                                <td  align=\"center\" valign=\"top\"> 
                                         </td>
                                                
                                            </tr>";

                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"4\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>
                                </table>";                                       
        $cRet    .= "</table>"; 

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.001' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-1</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
//end ctk_dpa1


//ctk_dpa21
    function ctk_dpa21(){
        $data['page_title']= 'Cetak RKA 2.1';
        $this->template->set('title', 'Cetak RKA2.1');   
        $this->template->load('template','anggaran/rka/ctk_dpa21',$data) ; 
    }
    
     function preview_coverdpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2= $this->uri->segment(8);
        //$ttd2= $_REQUEST['ttd2'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
         
        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.02.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
        
        $k2 = substr($kd_skpd,5,2);                        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"8\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>BELANJA TIDAK LANGSUNG</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"27%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$k2</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>5</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>1</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"21%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";
       $Xret2 .="       ";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
     function preview_dpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttd1x = $this->uri->segment(9);
        $ttd2x = $this->uri->segment(10);
        $statttd = $this->uri->segment(11);
        $tgl2 = $this->uri->segment(8);       
        $tgl_ttd2 = $this->tukd_model->tanggal_format_indonesia($tgl2);
//        $ttd1= $_REQUEST['ttd1'];
  //      $ttd2= $_REQUEST['ttd2'];
                
         $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
        if($status=='1'){
            $judulrka = 'RINGKASAN DOKUMEN PELAKSANAAN ANGGARAN';
            $judulrka2 = 'Ringkasan Dokumen Pelaksanaan Anggaran';
            $n_trdrka = '';
            $kdrka ='DPA';
        }else{
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $judulrka2 = 'Rencana Kerja dan Anggaran';
            $n_trdrka  =   '_rancang';
            $kdrka ='RKA';
        }



        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $kd_pd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='$kd_skpd'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

           if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
      
        $k2 = substr($kd_skpd,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>$judulrka<br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR $kdrka PD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka - <br>PD - 2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_pd - $nm_skpd</strong></td>
                    </tr>";
       $Xret2.= "";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>$judulrka2<br>Belanja Tidak Langsung Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"6\"></td>
                         </tr>
                     </tfoot>   
                        ";


            IF ($id == 'ppkd'){                    
                $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and a.total<>0
                            ) 
                        a ORDER BY a.rek1,a.id";
            }else{
                if($id == 'ppkd1'){
                    $sql1="SELECT * FROM(
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
                            union all
                            
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id 
                            FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,6)='00.002' and substring(a.no_trdrka,34,3) not in ('514','515')
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        
                            UNION ALL 
                            SELECT 0 header, a.no_urut [no_po],RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) in ('514','515') and a.total<>0
                            union all
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) not in ('514','515') 
                            ) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
                }else{
                    $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' ) 
                        a ORDER BY a.rek1,a.id";
                }
            }       

                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    }
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
                    
                }


                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";

                    $cRet .="   <tr>
                                    <td  width=\"100%\" align=\"left\" colspan=\"6\">
                                        <table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;
                                                &emsp;&emsp;&emsp;&emsp;&emsp;
                                                $daerah, $tgl_ttd2
                                            </tr>
                                            <tr>
                                                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\" valign=\"top\">
                                                    <br>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><ins></ins></b>
                                                    <br>
                                                    <br>
                                                </td>
                                                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\">$jdlnip1  
                                                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1 
                                                </td>
                                            </tr>
                                        </table>
                                    </td>       
                                </tr>";
                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>";                                       

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <tr>
                    <td style=\"border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"left\" colspan=\"6\">
                    <table  border=\"0\" width=\"100%\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    </table>
                    </td>       
                </tr>                    
                </table>";    

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-21</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//end ctk_dpa21


//ctk_dpa22
    function ctk_dpa22(){
        $data['page_title']= 'Cetak RKA 2.2';
        $this->template->set('title', 'Cetak RKA 2.2');   
        $this->template->load('template','anggaran/rka/ctk_dpa22',$data) ; 
    }
    
    
    
   
   function preview_rka22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $tgl2 = $this->uri->segment(8);
        $tgl_ttd2 = $this->tukd_model->tanggal_format_indonesia($tgl2);
        $ttd1x = $this->uri->segment(9);
        $ttd2x = $this->uri->segment(10);
        $statttd = $this->uri->segment(11);        //$ttd1= $_REQUEST['ttd1'];
        //$ttd2= $_REQUEST['ttd2'];
                
         $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $n_trdrka  =   '';
            $kdrka ='RKA';
        


        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id' and right(kd_skpd,2)='00'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

      if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }             
 
        $cRet='';

    $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"></td>
                         <td width=\"66%\" align=\"center\" ><strong>$judulrka<br>PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>$kdrka - PD <br><h3>2.2</h3></strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>
                  <table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                  <tr>
                                        <td width=\"20%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                                        <td width=\"80%\"><strong>: $kd_urusan1 - $nm_urusan1</strong></td>
                                    </tr>";        

      

       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $sql1="select a.kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where left(kd_skpd,7) =left('$id',7) AND LEFT(a.kd_skpd,4) = LEFT (b.kd_urusan, 4)
 group by left(kd_kegiatan,4),kd_skpd,nm_urusan";
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
       $Xret1.="
                    <tr>
                        <td width=\"20%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"80%\" ><strong>: $urus - $nm_urus</strong></td>
                    </tr>

                    ";
                }
       $Xret2.= "<tr>
                        <td width=\"20%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"80%\"> <strong>: $kd_skpd - $nm_skpd</strong></td>
                    </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA LANGSUNG BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        

        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td width=\"22%\" colspan=\"2\" align=\"center\"><b>Kode</b></td>  
                            <td width=\"17%\" rowspan=\"2\" align=\"center\" valign=\"middle\"><b>Uraian</b></td>
                            <td width=\"6%\"  rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:9px;\"  align=\"center\"><b>Target Kinerja (Kuantitatif)</b></td>
                            <td width=\"3%\"  rowspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"36%\" colspan=\"4\" align=\"center\"><b>Triwulan</b></td>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Jumlah</b></td>
                        </tr>
                        <tr>
                            <td width=\"12%\" align=\"center\"><b>Program</b></td>                            
                            <td width=\"10%\" align=\"center\"><b>Kegiatan</b></td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">I</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">II</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">III</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">IV</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">9</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">10</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">11=(7+8+9+10)</td>
                         </tr>
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"11\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT 
                            a.kd_program AS prog,
                            a.kd_program AS prog1,
                            ' ' AS giat,
                            a.nm_program AS uraian,
                            ' ' AS lokasi,
							sum(x.nilai) nilai,
                            ' ' AS target,
                            '' [sumber_dana],
                            (select sum(isnull(triw1,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw1,
                            (select sum(isnull(triw2,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw2,
                            (select sum(isnull(triw3,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw3,
                            (select sum(isnull(triw4,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw4
                        FROM
                            trdrka x
                        LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
                            AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                            RIGHT (a.kd_program, 2) <> '00'
                        AND $a x.kd_skpd$b = left('$id',7)
                        GROUP BY
                            a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                                a.kd_program AS prog,
                                ' ' AS prog1,
                                a.kd_kegiatan AS giat,
                                a.nm_kegiatan AS uraian,
                                a.lokasi AS lokasi,
								a.total as nilai,
                                a.tk_kel AS target,
                                isnull(tabela.sumber,'') [sumber_dana],
                                isnull(a.triw1,0) [triw1],
                                isnull(a.triw2,0) [triw2],
                                isnull(a.triw3,0) [triw3],
                                isnull(a.triw4,0) [triw4]   
                            FROM
                                trdrka x
                                LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
                                left join (
SELECT 
    kd_kegiatan, 
    (SELECT top 1 sumber 
            FROM trdrka as b 
            WHERE len(sumber)>2 and b.kd_kegiatan = a.kd_kegiatan 
            ) AS sumber
FROM 
    (SELECT DISTINCT kd_kegiatan FROM trdrka ) AS a
) tabela
on x.kd_kegiatan = tabela.kd_kegiatan
                            WHERE
                                RIGHT(a.kd_program,2)<>'00' AND
                                $a x.kd_skpd$b=left('$id',7)
                            GROUP BY
                                a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,total,tk_kel,a.triw1,a.triw2,a.triw3,a.triw4,tabela.sumber 
                                            ORDER BY prog,giat     
                        ";
  

                $tottriw1 = 0;
                $tottriw2 = 0;
                $tottriw3 = 0;
                $tottriw4 = 0;
                $totnilai = 0; 
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giat=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $triw1=$row->triw1;
                    $triw2=$row->triw2;
                    $triw3=$row->triw3;
                    $triw4=$row->triw4;
					$nilai=$row->nilai;
                    //$nilai = $triw1 + $triw2 + $triw3 + $triw4;
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $tottriw1 = $tottriw1 +  $triw1;   
                        $tottriw2 = $tottriw2 +  $triw2;
                        $tottriw3 = $tottriw3 +  $triw3;
                        $tottriw4 = $tottriw4 +  $triw4;
                        $totnilai = $totnilai +  $nilai;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $triw1=number_format($triw1,2,',','.');
                    $triw2=number_format($row->triw2,2,',','.');
                    $triw3=number_format($row->triw3,2,',','.');
                    $triw4=number_format($row->triw4,2,',','.');
                    $nilai1 = number_format($nilai,2,',','.');
 
                    

                      $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  align=\"left\">$prog</td>                                     
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$giat</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$target</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw2</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw3</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw4</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                    </tr> 
                                    
                                   
                                    ";

 
                }
				
				$sqlsum="select sum(total) as tot,sum(triw1) as tw1,sum(triw2) as tw2,
					   sum(triw3) as tw3,sum(triw4) as tw4 from trskpd
					  where left(kd_skpd,7) =left('$id',7) and substring(kd_kegiatan,17,2)<>'00'";
					  
					  $query = $this->db->query($sqlsum);
				foreach ($query->result() as $row)
                {
                $triw1xx=$row->tw1;   
                $triw2xx=$row->tw2; 
                $triw3xx=$row->tw3; 
                $triw4xx=$row->tw4; 
                $totalxxx=$row->tot; 
				
				$triw1x=number_format($triw1xx,2,',','.');
				$triw2x=number_format($triw2xx,2,',','.');
				$triw3x=number_format($triw3xx,2,',','.');
				$triw4x=number_format($triw4xx,2,',','.');
				$totalxx=number_format($totalxxx,2,',','.');
				
       
                 $cRet    .= " <tr>
                                    <td colspan=\"6\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw1x</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw2x</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw3x</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw4x</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totalxx</td>
                                </tr>
                                 ";
            

 
				}


                             $cRet .="<tr>
                                        <td colspan=\"11\">
                                            <table border=\"0\" width=\"100%\" >
                                                
                                                <tr>
                                                    <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\" valign=\"top\">
                                                        <br>
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><ins></ins></b>
                                                        <br>
                                                        <br> 
                                                    </td>
                                                    <td align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td align=\"center\">$daerah,$tgl_ttd2<br>
                                                    $jdlnip1  
                                                        <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><u>$nama1</u></b>
                                                        <br>$nip1 
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";

        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-22</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             //$this->_mpdf('',$cRet,10,10,10,'1');
              $this->_mpdf_down('RKA22',$nm_org,$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA22.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }


//end dpa 22


function preview_dpa221(){
       $id = $this->uri->segment(3);
       $id2 = substr($id,0,7);
       $giat = $this->uri->segment(4);
       $cetak = $this->uri->segment(5);
       $chkpa = $this->uri->segment(6);
       $cell = $this->uri->segment(7); 
       
        $tgl2= $_REQUEST['tgl_ttd'];
        $ttd1x= $_REQUEST['ttd1'];
        $ttd2x= $_REQUEST['ttd2'];
        $ttd1=  str_replace('x',' ',$ttd1x);
        $ttd2=  str_replace('x',' ',$ttd2x);
        $tgl_ttd = $this->tukd_model->tanggal_format_indonesia($tgl2);
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
            $judulrka = 'DOKUMEN PELAKSANAAN ANGGARAN';
            $n_trdrka = '';
            $kdrka ='DPA';
        


        
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd=left('$id',7)+'.00'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT kd_org,nm_org FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT kd_urusan1,nm_urusan1 FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

      
      if($chkpa==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttd1' and kode ='agr'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttd2'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nipx=$rowttd->nip;                    
                    $namax= $rowttd->nm;
                    $jabatanx  = $rowttd->jab;
                }
                 
         $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,z.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,rtrim(d.sumber) [sumber] ,a.sasaran_giat,a.ang_lalu,a.waktu_giat FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN m_prog z ON a.kd_program=z.kd_program
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
                f.nm_urusan,
                a.kd_skpd,
                e.nm_skpd,
                a.kd_program,
                z.nm_program,
                a.kd_kegiatan,
                c.nm_kegiatan,
                a.tu_capai,
                a.tu_mas,
                a.tu_kel,
                a.tu_has,
                a.tk_capai,
                a.tk_mas,
                a.tk_kel,
                a.tk_has,
                a.lokasi,
                d.sumber,
                a.sasaran_giat,
                a.ang_lalu,a.waktu_giat";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                    $wak_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;

                    
                }
        $kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
        $nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
        $kd_skpd= empty($roworg->kd_skpd) || ($roworg->kd_skpd) == '' ? '' : ($roworg->kd_skpd);
        $nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
        $kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
        $nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
        $kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
        $nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
        $lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
        $tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
        $tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
        $tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
        $tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
        $tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
        $tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
        $tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
        $tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
        $sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
        $ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);
        $wak_giat= empty($roworg->waktu_giat) || ($roworg->waktu_giat) == '' || ($roworg->waktu_giat) == 'Null' ? '' : ($roworg->waktu_giat);
        $sumber= empty($roworg->sumber) || ($roworg->sumber) == '' || ($roworg->sumber) == 'Null' ? '' : ($roworg->sumber);
        $org = substr($kd_skpd,0,7);
        switch($sumber){
            case 'DAU';
                $sumber = 'Dana Alokasi Umum (DAU)';
            break;
            case 'PAD';
                $sumber = 'Pendapatan Asli Daerah (PAD)';
            break;            
            case 'DAK';
                $sumber = 'Dana Alokasi Khusus (DAK)';
            break;           
        }
        
  
       $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",",",".");
                   $totp1 =number_format($rowb->totb*1.1,"2",",",".");
                }        
        $cRet='';

 
        $k2 = substr($id,0,7);
        $k3 = substr($kd_prog,-2,2);
        $k4 = substr($kd_giat,19,3);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>$judulrka<br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR $kdrka SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>$kdrka - SKPD <br>2.2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k3</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k4</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>2</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Organisasi</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\"> <strong>$org - $nm_org</strong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&nbsp;Program</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\" align=\"left\">$kd_prog   - $nm_prog</td>
                    </tr>
                    <tr><td width=\"20%\" align=\"left\">&nbsp;Kegiatan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\" align=\"left\">$kd_giat   - $nm_giat</td>
                    </tr>
                    <tr><td width=\"20%\" align=\"left\">&nbsp;</td>
                        <td width=\"3%\" align=\"center\"></td>
                        <td colspan=\"7\" width=\"77%\" align=\"left\"></td>
                    </tr>
                    <tr><td width=\"20%\" align=\"left\">&nbsp;Waktu Pelaksanaan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"6\" width=\"77%\" align=\"left\">$wak_giat</td>
                    </tr>
                    <tr><td width=\"20%\" align=\"left\">&nbsp;Lokasi Kegiatan</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\" align=\"left\">$lokasi</td>
                    </tr>                      
                    <tr><td width=\"20%\" align=\"left\">&nbsp;Sumber Dana</td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td colspan=\"7\" width=\"77%\" align=\"left\">$sumber</td>
                    </tr>
                </table>";         
 
        $cRet .= "<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"9\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belanja langsung</td>
                    </tr>";
        $cRet .="<tr>
                 <td colspan=\"2\" align=\"center\">Indikator </td>
                 <td colspan=\"3\" align=\"center\">Tolak Ukur Kerja </td>
                 <td colspan=\"4\" align=\"center\">Target Kinerja </td>
                </tr>";       
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Capaian Program </td>
                    <td colspan=\"3\">$tu_capai</td>
                    <td colspan=\"4\">$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Masukan </td>
                    <td colspan=\"3\">$tu_mas</td>
                    <td colspan=\"4\">Rp. $totp </td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Keluaran </td>
                    <td colspan=\"3\">$tu_kel</td>
                    <td colspan=\"4\">$tk_kel</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td colspan=\"2\">Hasil </td>
                    <td colspan=\"3\">$tu_has</td>
                    <td colspan=\"4\">$tk_has</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"9\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"9\" align=\"center\">RINCIAN $judulrka BELANJA LANGSUNG <br>MENURUT PROGRAM DAN PER KEGIATAN PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";


        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" colspan=\"3\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td colspan=\"2\" style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td colspan=\"3\" style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: solid 1px black; border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"></hr></td>
                         </tr>
                     </tfoot>   
                        ";

                $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.nilai != 0 and a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.nilai != 0 and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL  
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume2,' ' AS satuan2, 0 AS harga2,isnull(SUM(a.total_sempurna),0) AS nilai2,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' /*and nilai <> 0*/
                        UNION ALL 
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume2,a.satuan_sempurna1 AS satuan2, a.harga_sempurna1 AS harga2,
                        a.total_sempurna AS nilai2,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null) and a.total != 0
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                        
                $totbl = 0;
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $nopo = $row->no_po;
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :$row->volume;

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilaibl = empty($row->nilai)  ? 0 : $row->nilai;
                    
                    if(strlen($row->rek1) <= '5' ){
                        $bold = 'font-weight:bold;';
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                    }else{
                        $bold ='';
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    if(strlen($row->rek1) == '1' ){
                        $totbl = $totbl + $nilaibl;
                    }            
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;$bold $lbawah $latas  \" width=\"40%\">&nbsp;$uraian</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"center\">$sat</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;$bold $lbawah $latas \" width=\"14%\" align=\"right\">$hrg</td>
                                     <td colspan=\"3\" style=\"vertical-align:top;$bold $lbawah $latas \" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                             
                }

                   $totbl=number_format($totbl,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td colspan=\"3\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totbl</strong></td></tr>";

                             $cRet .="
                                        <tr>
                                        <td colspan=\"9\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"50%\" colspan=\"2\">&emsp;
                                                    <td width=\"10%\" >
                                                </tr>
                                                <tr>
                                                    <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\" valign=\"top\">&nbsp;
                                                    <br>&nbsp;
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><ins>&nbsp;</ins></b>
                                                    <br>&nbsp;
                                                    <br>&nbsp;
                                                    </td>
                                                    <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\">$daerah, $tgl_ttd 
                                                    <br>Mengesahkan,
                                                    <br>$jabatanx
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$namax</u></b>
                                                    <br>$nipx
                                                   </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                            
                                    ";

   
        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7)";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" 
                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"9\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                     </tr>

                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"9\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;
                            <table border=\"0\" width=\"100%\">
                                <tr>
                                    <td width=\"15%\" align=\"left\">&emsp;Triwulan I</td>
                                    <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                                    <td width=\"10%\" align=\"right\">&emsp;$triw1</td>
                                    <td width=\"65%\" align=\"left\">&emsp;</td>

                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan II</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw2</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan III</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw3</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan IV</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"right\">&emsp;Jumlah</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$total</td>
                                    <td align=\"left\">&emsp;</td>

                                </tr>                           
                            </table>
                        </td>
                     </tr>

                </table>";    

                                                                       
                $jdla=$giat;
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-2.2.1</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-221-$jdla.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;
               $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'0');
        break;
        
        }    
    } 
//end ctk_dpa221   

function preview_coverdpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $idd = substr($id,0,7).".00";
        $sqlorg="SELECT kd_skpd,nm_skpd FROM ms_skpd WHERE kd_skpd='$id'";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_skpd;                    
                    $nm_org= $rowdns->nm_skpd;
                }
        
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
        
       if($status=='1'){
            $judulrka = 'Ringkasan Dokumen Pelaksanaan Anggaran';
            $kdrka ='DPA';
        }else{
            $judulrka = 'Rencana Kerja dan Anggaran';
            $kdrka ='RKA';
        }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; margin-top: 200px;\" width=\"80%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$judulrka</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>PERANGKAT DAERAH ($kdrka PD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                    </tbody>
                </table>";

        $cRet .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                    <tr>
                        <td width=\"20%\" align=\"center\" style=\"font-weight: bold;\">Kode</td> 
                        <td width=\"60%\" align=\"center\" style=\"font-weight: bold;\">Nama Formulir</td>
                    </tr>
                    </thead>
                    <tbody align=\"left\">
                    <tr>
                        <td width=\"20%\" ><strong>$kdrka - PD</strong></td> 
                        <td width=\"60%\" >$judulrka Perangkat Daerah</td>                    
                    </tr>
                    <tr>
                        <td width=\"20%\" ><strong>$kdrka - PD 1</strong></td> 
                        <td width=\"60%\" >$judulrka Pendapatan Perangkat Daerah </td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>$kdrka - PD 2</strong></td> 
                        <td width=\"60%\" >Rekapitulasi Belanja menurut Program dan Kegiatan Perangkat Daerah</td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>$kdrka - PD 2.1</strong></td> 
                        <td width=\"60%\" >$judulrka Belanja Langsung Program dan Per Kegiatan Perangkat Daerah </td>                    
                    </tr>                                                                                                
                    </tbody>
                </table>";
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','',50);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }    
     
     
     
//rancang
    function edit_sumber_kegi_rancang(){
        $data['page_title']= 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN';
        $this->template->set('title', 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN');   
        $this->template->load('template','anggaran/rka/edit_sumber_kegi_rancang',$data) ; 
    }


    function kegi_sumber_rancang($cskpd='') {
        $lccr = $this->input->post('q');
        if($cskpd==''){
            $result[] = array(
                        'id' => 0,        
                        'kd_kegiatan' => '',  
                        'nm_kegiatan' => '',  
                        'nilai' =>  '',
                        'sumber' => '',
                        'ket_sumber' => ''
                        );
        }else{
            $query1 = "select DISTINCT kd_kegiatan,nm_kegiatan,sum(nilai) as nilai,
                       case when sumber2 is null then sumber
                        else sumber+'  '+sumber2 end as sumber,
                        case when (sumber2 is null or sumber2 =' ')then '1'
                        else '2' end as ket_sumber
                        from trdrka_rancang where left(kd_skpd,7) = left('$cskpd',7)
                        group by kd_kegiatan,nm_kegiatan,sumber,sumber2 order by kd_kegiatan";  
            
            $query2=$this->db->query($query1);

            $result = array();
            $ii = 0;
            foreach($query2->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan'],  
                            'nilai' =>  number_format($resulte['nilai'],"2",".",","),
                            'sumber' => $resulte['sumber'],
                            'ket_sumber'=> $resulte['ket_sumber']
                            );
                            $ii++;
            }                            
        }

        echo json_encode($result);
           
    }
    
    function update_sumber_kegi_rancang(){
        $ckegi   = $this->input->post('kegi');
        $sumber   = $this->input->post('csumber1');
        /*
        $npad   = $this->input->post('snpad');
        $ndak   = $this->input->post('sndak');
        $ndaknf = $this->input->post('sndaknf');
        $ndau = $this->input->post('sndau');
        $ndbhp = $this->input->post('sndbhp');
        $ndid = $this->input->post('sndid');
        */
        $nangg = 'nilai';
        
 //      $asg = $this->rka_model->q_update_sumber_kegi($ckegi,$sumber,$nangg,$npad,$ndak,$ndaknf,$ndau,$ndbhp,$ndid);

          $asg = $this->rka_model->q_update_sumber_kegi_rancang($ckegi,$sumber,$nangg);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
    }

    //end rancang
function cek_anggaran()
    {
        $data['page_title']= 'Cek Anggaran';
        $this->template->set('title', 'Cek Anggaran');   
        $this->template->load('template','anggaran/rka/cek_anggaran',$data) ; 
    }

function cek_anggaran_sirup()
    {
        $data['page_title']= 'Cek Anggaran - SIRUP';
        $this->template->set('title', 'Cek Anggaran - SIRUP');   
        $user = $this->session->userdata('pcNama');
		$userBid = $this->session->userdata('bidang');
        if($user=='rup'){
          $this->template->load('template','anggaran/rup/cek_anggaransirup_all',$data) ;  
        }else{
			if($userBid==8){
				$this->template->load('template','anggaran/rup/cek_anggaransirup_all',$data) ; 
			}else{
				$this->template->load('template','anggaran/rup/cek_anggaransirup',$data) ; 
			}	
           
        }
          
    }

function cek_list_sirup()
    {
        $data['page_title']= 'Cek List - SIRUP';
        $this->template->set('title', 'Cek List - SIRUP');   
        $user = $this->session->userdata('pcNama');
		$userBid = $this->session->userdata('bidang');
        if($user=='rup'){
           $this->template->load('template','anggaran/rup/cek_listsirup_all_rup',$data) ;  
        }else{
		   if($userBid==8){
			   $this->template->load('template','anggaran/rup/cek_listsirup_all',$data) ; 
		   }else{
			   $this->template->load('template','anggaran/rup/cek_listsirup',$data) ; 
		   }
           
        }
          
    }	

function user_cppkrup(){
    
        $skpd = $this->session->userdata('kdskpd');        
        $userm = $this->session->userdata('pcNama');
        
        $par = "where kd_skpd='$skpd' and bidang='6' and user_name='$userm'";
        
        $sql = "select * from [user] $par order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'username' => $resulte['user_name'],						
                        'nama' => $resulte['nama'],
                        'did' => $resulte['id_user']                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   function user_cppkrup_giat(){
    
        $skpd = $this->session->userdata('kdskpd');        
        $userm = $this->session->userdata('pcNama');
        $lccr  = $this->input->post('q');
        
        $sql = "select c.* from(
select a.*,
isnull(case when a.kunci=3 then 'nonaktif'
else 
case when
(select count(username) from ms_ttd where kd_skpd=a.kd_skpd and username=a.user_name)=0 
then 'nonaktif'
else 'aktif' end 
end,'nonaktif') as status_ppkom,
(select id_ttd from ms_ttd where username=a.user_name) id_ppk
from [user] a where a.kd_skpd='$skpd' and a.bidang='6')
c where c.status_ppkom='aktif' 
and
(upper(c.user_name) like upper('%$lccr%') or upper(c.nama) like upper('%$lccr%'))
order by c.kd_skpd";

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'username' => $resulte['user_name'],						
                        'nama' => $resulte['nama'],
                        'did' => $resulte['id_user'],
                        'dippk' => $resulte['id_ppk']                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }

	function user_cppkrup_all(){
    
        $skpd = $this->input->post('skpd');       
        $userm = $this->session->userdata('pcNama');
        $lccr  = $this->input->post('q');
        
        $par = "where kd_skpd='$skpd' and bidang='6'";
        
        $sql = "select * from [user] $par and
                (upper(user_name) like upper('%$lccr%') or upper(nama) like upper('%$lccr%')) order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'username' => $resulte['user_name'],						
                        'nama' => $resulte['nama'],
                        'did' => $resulte['id_user']                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   } 

function user_cppkrup_all_data(){
    
        $skpd = $this->input->post('skpd');       
        $userm = $this->session->userdata('pcNama');
        
        $par = "where kd_skpd='$skpd' and bidang in ('6','8')";
        
        $sql = "select * from [user] $par order by kd_skpd";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'username' => $resulte['user_name'],						
                        'nama' => $resulte['nama'],
                        'did' => $resulte['id_user']                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }    

function cppkrup(){
    
        $skpd = $this->session->userdata('kdskpd');        
        $userm = $this->session->userdata('pcNama');
        
        $par = "where kd_skpd='$skpd' and username='$userm' and jns='rup' ";
        
        $sql = "select * from ms_ttd $par order by kd_skpd,nip";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
						'username' => $resulte['username'],						
                        'nip' => $resulte['nip'],						
						'nama' => $resulte['nama'],
                        'did' => $resulte['id']                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   function cgiatrup(){
    
        $skpd = $this->session->userdata('kdskpd');        
        $userm = $this->session->userdata('pcNama');
        $userL = $this->uri->segment(4);
        
        $userL = str_replace("%20"," ",$userL);
        
        
        $par = "where a.username='$userL'";
        
        $sql = "select a.*,b.nm_skpd from ms_sub_kegiatan_rup a left join ms_skpd b on b.kd_skpd=a.kd_skpd 
        $par order by a.kd_sub_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_sub_kegiatan' => $resulte['kd_sub_kegiatan'],
						'nm_sub_kegiatan' => $resulte['nm_sub_kegiatan'],
						'kd_skpd' => $resulte['kd_skpd'],
						'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
	
	 function tambah_giat_rup()
	{
		
        $data['page_title']= 'PILIH KEGIATAN';
        $this->template->set('title', 'DETAIL KEGIATAN');          
        $this->template->load('template','anggaran/rup/pilih_giat_rup',$data) ; 
        
   }	
	
   function load_giatrup(){
    
        $skpd = $this->session->userdata('kdskpd');        
        $userm = $this->session->userdata('pcNama');
        $keg = $this->uri->segment(4);
        
        $sql = "select a.*
        from ms_kegiatan a where a.kd_program='$keg' 
        order by a.kd_kegiatan";

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
						'nm_kegiatan' => $resulte['nm_kegiatan']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }


   function load_subgiatrup(){
    
    $skpd = $this->session->userdata('kdskpd');        
    $userm = $this->session->userdata('pcNama');
    $keg = $this->uri->segment(4);
    
    $sql = "select a.*,
isnull((select 
case when b.kunci=3 then 'nonaktif'
else 
case when
(select count(username) from ms_ttd where username=b.user_name)=0 
then 'nonaktif'
else 'aktif' end 
end as hasil
from [user] b where b.user_name=a.username),'nonaktif') status,
a.kd_skpd,
(select nm_skpd from ms_skpd where kd_skpd=a.kd_skpd) nm_skpd
from ms_sub_kegiatan_rup a where a.kd_kegiatan='$keg' and left(a.kd_skpd,17)=left('$skpd',17)
order by a.kd_sub_kegiatan";

    $query1 = $this->db->query($sql);  
    $result = array();
    $ii = 0;
    foreach($query1->result_array() as $resulte)
    { 
       
        $result[] = array(
                    'id' => $ii,  
                    'kd_skpd' => $resulte['kd_skpd'],  
                    'nm_skpd' => $resulte['nm_skpd'],      
                    'kd_sub_kegiatan' => $resulte['kd_sub_kegiatan'],
                    'nm_sub_kegiatan' => $resulte['nm_sub_kegiatan'],
                    'statuss' => $resulte['status'],
                    'user_lama' => $resulte['username']
                    );
                    $ii++;
    }
       
    echo json_encode($result);
}
  
   function cek_subgiat_rup(){
      $giat = $this->input->post('cid');
      $nipp = $this->input->post('cnip'); 
	  $user = $this->input->post('cuser'); 	
	  $copd = $this->input->post('copd'); 	
      $nama = "";

      	$cek_giat = $this->db->query("select count(a.kd_sub_kegiatan) as kd from trskpd a
        where a.kd_sub_kegiatan='$giat'")->row();
        $cek_giatan = $cek_giat->kd;
        if($cek_giatan>1){

        	$cek_cou = $this->db->query("select count(a.kd_sub_kegiatan) as kd from ms_sub_kegiatan_rup a
        	where a.kd_sub_kegiatan='$giat' and kd_skpd='$copd' and a.id!=''")->row();
        	$cek_count = $cek_cou->kd;
        	if($cek_count==0){
           	 	$nama = "0";
        	}else{
        			$sql = $this->db->query("select a.id as nip,b.nama from ms_sub_kegiatan_rup a left join [user] b on b.id_user = a.id
        			where a.kd_sub_kegiatan='$giat' and a.kd_skpd='$copd'")->row();
        			$nama = 'Kegiatan ini milik PPKOM : '.$sql->nama;        			                    
        	}
        
        echo $nama; 

        }else{
        echo $nama = 'Kegiatan Tidak Tersedia';	
        }  	   	
    } 
  
   function psimpan_rup($user='',$nip='',$keg='',$did='',$did='') {      	    
    
    //$usern = $this->session->userdata('pcNama');
    $waktu_update = date('Y-m-d H:i:s'); 
    //$nip = str_replace("%20"," ",$nip);
    
                         
    $this->db->query("update ms_sub_kegiatan_rup set username='$user',last_update='$waktu_update',id='$did' where kd_sub_kegiatan='$keg'");
    	
    $this->cgiatrup($nip);          
    } 


    function psimpan_rup_nonaktif($user='',$nip='',$keg='',$did='',$dippk='',$opd='') {      	    
    
    //$usern = $this->session->userdata('pcNama');
    //$skpd = $this->session->userdata('kdskpd');    
    $waktu_update = date('Y-m-d H:i:s'); 
    //$nip = str_replace("%20"," ",$nip);
      
   	$this->db->query("update ms_sub_kegiatan_rup set username='$user',last_update='$waktu_update',id='$did' where kd_sub_kegiatan='$keg' and kd_skpd='$opd'");
    $this->db->query("update a set a.username='$user' from sirup_detail_lokasi a left join sirup_header b on b.id=a.id and b.username=a.username where b.kd_kegiatan='$keg'");    
    $this->db->query("update sirup_header set username='$user',id_ppk='$dippk' where kd_kegiatan='$keg' and username='$username'");
	$this->db->query("update sirup_detail set username='$user' where kd_kegiatan='$keg' and username='$username'");
    
    $this->cgiatrup($nip);          
    }  


   function psimpan_rup_nonaktif_lain($user='',$nip='',$keg='',$did='',$dippk='') {      	    
    
    //$usern = $this->session->userdata('pcNama');
    $skpd = $this->session->userdata('kdskpd');    
    $waktu_update = date('Y-m-d H:i:s'); 
    //$nip = str_replace("%20"," ",$nip);
      
    $this->db->query("
    	insert into ms_sub_kegiatan_rup
select kd_sub_kegiatan,
nm_sub_kegiatan,
left(kd_sub_kegiatan,12) as kd_kegiatan,
'5' as jns_sub_kegiatan,
'$user' as username,
'$waktu_update' as last_update,
'$did' as id,
left(kd_skpd,17)+'.0000' as kd_skpd
from trskpd where kd_sub_kegiatan='$keg' and kd_skpd='$skpd'
group by kd_sub_kegiatan,nm_sub_kegiatan,left(kd_skpd,17)
    	");
                        
    //$this->db->query("update ms_sub_kegiatan_rup set username='$user',last_update='$waktu_update',id='$did' where kd_sub_kegiatan='$keg'");
    //$this->db->query("update a set a.username='$user' from sirup_detail_lokasi a left join sirup_header b on b.id=a.id and b.username=a.username where b.kd_kegiatan='$keg'");    

    //$this->db->query("update sirup_header set username='$user',id_ppk='$dippk' where kd_kegiatan='$keg'");
	//$this->db->query("update sirup_detail set username='$user' where kd_kegiatan='$keg'");
    
    $this->cgiatrup($nip);          
    }   
  
  function hapus_kegrup($kegiatan='') {
        $kegiatan = $this->uri->segment(4);
        $lokasiSKPD = $this->uri->segment(5);
    	$skpd=$this->session->userdata('kdskpd');  
        $usern = $this->session->userdata('pcNama');      
        $waktu_update = date('Y-m-d H:i:s'); 
        
        $query = $this->db->query("update ms_sub_kegiatan_rup set id='',username='',last_update='$waktu_update' where kd_sub_kegiatan='$kegiatan' and kd_skpd='$lokasiSKPD'");   
       	if($query){
		  echo '1';
		}else{
		  echo '0';
		}
        
    }
	
   function preview_cetakan_cek_anggaran_sirup(){
        $id = $this->uri->segment(4);
        $status_ang = $this->uri->segment(5);
        $username = $this->uri->segment(6);

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        $sqlsckeg="SELECT kd_sub_kegiatan,nm_sub_kegiatan FROM ms_sub_kegiatan where kd_sub_kegiatan='$id'";
                 $sqlkeg=$this->db->query($sqlsckeg);
                 foreach ($sqlkeg->result() as $rowsc)
                {
                   
                    $idkeg=$rowsc->kd_sub_kegiatan;
                    $nmkeg=$rowsc->nm_sub_kegiatan;
                    
                }
        
       $cRet = '';
       $cRet.="<table style=\"font-size:30px;border-left:solid 0px black;border-top:solid 0px black;border-right:solid 0px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td align=\"center\" colspan=\"5\" style=\"font-size:22px;border: solid 0px white;\"><b>LIST PAKET KEGIATAN</b></td>
                        
                    </tr>
                 </table><br/>";
       
       $cRet.="<table style=\"border-collapse:collapse;font-size:14px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"5%\"><strong>Kegiatan</strong></td>
                        <td width=\"1%\"><strong >: </strong></td>
                        <td colspan=\"3\" width=\"82%\"><strong>$idkeg - $nmkeg</strong></td>
                    </tr>";
      
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:15 px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">

                     <thead >                       
                        <tr>
                            <td bgcolor=\"#A9A9A9\" rowspan=\"2\" width=\"3%\" align=\"center \"><b>ID</b></td>
                            <td bgcolor=\"#A9A9A9\" rowspan=\"2\" width=\"5%\" align=\"center \"><b>Paket</b></td>
                            <td bgcolor=\"#A9A9A9\" rowspan=\"2\" width=\"30%\" align=\"center\"><b>Nama Paket</b></td>
                            <td bgcolor=\"#A9A9A9\" colspan=\"4\" width=\"35%\" align=\"center\"><b>Rincian Paket</b></td>
                            <td bgcolor=\"#A9A9A9\" rowspan=\"2\" width=\"15%\" align=\"center\"><b>Metode Pemilihan / <br/> Tipe Swakelola</b></td>
                            <td bgcolor=\"#A9A9A9\" rowspan=\"2\" width=\"12%\" align=\"center\"><b>Total Paket</b></td>
                         </tr>
						 <tr>
                            <td bgcolor=\"#A9A9A9\" width=\"5%\" align=\"center\"><b>Tahun</b></td>
							<td bgcolor=\"#A9A9A9\" width=\"17%\" align=\"center\"><b>Jenis</b></td>
							<td bgcolor=\"#A9A9A9\" width=\"5%\"align=\"center\"><b>Vol</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center\"><b>Pagu</b></td>
                         </tr>
                     </thead>
                     
                   
                        ";
            $stt='';
        if($status_ang=='1'){
            $stt='';
        }else if($status_ang=='2'){
            $stt='_sempurna';
        }else if($status_ang=='3'){
            $stt='_ubah';
        }

                $sql1="select c.* from(
select
a.username,
a.idrup,
a.id,
a.kd_skpd, 
a.kd_kegiatan,
a.jenis_paket,
case when a.jenis_paket='1' then 'Penyedia' else 'Swakelola' end as jenis,
case when a.is_deleted='1' then '(PAKET DIREVISI' else '' end as is_deleted,
(select top 1 alasan_revisi from sirup_history_paket where idrup=a.idrup) alasan,
a.nm_paket nm_paket,
(select top 1 isi_paket from sirup_detail where kd_skpd=a.kd_skpd and id=a.id and username=a.username ) isi_paket,
a.jns_pengadaan,
isnull(a.mtd_pengadaan,0) mtd_pengadaan,
a.tipe_swakelola,
a.total
from sirup_header a
) c
where c.kd_kegiatan='$idkeg' and c.username='$username' and c.is_deleted=''
group by c.idrup,c.is_deleted,c.alasan,c.username,c.jenis_paket,c.isi_paket,c.id,c.kd_skpd,c.kd_kegiatan,c.jenis,c.nm_paket,c.jns_pengadaan,c.mtd_pengadaan,tipe_swakelola,c.total
order by c.jenis";
  

                $tvol = 0;
                $tpagu = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $id=rtrim($row->id);
					$idrup=rtrim($row->idrup);
                    $keg=rtrim($row->kd_kegiatan);                    
                    $nm1=rtrim($row->nm_paket);
                    $nm2=rtrim($row->isi_paket);
                    $del=rtrim($row->is_deleted);
                    if($del<>''){
                    	$als=", KET: ".rtrim(strtoupper($row->alasan)).")";	
                    }else{
                    	$als="";
                    }
                     

                    $jns=rtrim($row->jenis);
                    $jnspkt=rtrim($row->jenis_paket);
					$tipe=rtrim($row->tipe_swakelola);
					
                    $mtd_p=rtrim($row->mtd_pengadaan);

                    if($mtd_p==0){
                    if($jns=='Penyedia'){	
                    $metodepeng="Kosong";
                    }else{
                    $metodepeng="Tipe Swakelola ".$tipe;  	
                    }	                    
                    }else{
                    if($jns=='Penyedia'){
                    $sqlmp="select nm_mp from sirup_metode_pengadaan where kd_mp in ('$mtd_p')";
                    $mp3=$this->db->query($sqlmp);$mp2=$mp3->row();
                    $metodepeng=$mp2->nm_mp;
                    }else{
                    $metodepeng="Tipe Swakelola ".$tipe;    
                    }

                    }  

                    $nilai_angx = number_format($row->total,2,',','.');
                    if(rtrim($jnspkt)==1){
                    $nm = $nm1." (".$nm2.")";
                	}else{
                	$nm = $nm1;	
                	}	

                	if($del<>''){
                    	$als=", KET: ".rtrim(strtoupper($row->alasan)).")";	
                    }else{
                    	$als="";
                    }

                     $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"text-align:center; \" >$idrup</td>
										<td align=\"left\" style=\"text-align:center; \" >$jns</td>
                                        <td align=\"left\" style=\"vertical-align:left; \" >$nm <b>$del $als</b></td>
                                        <td align=\"left\" colspan=\"4\" style=\"vertical-align:middle; \" >
                                         ";
                              
                              $cRet    .= " <table border=\"0\" width=\"100%\">";

                $sql1="
select  
b.kd_kegiatan,
b.tahun,
b.isi_paket,
b.vol,
b.pagu,
b.nmjns_pengadaan,
(select count(is_deleted) from sirup_header where id='$id' and username='$username' ) init_deleted
from sirup_detail b 
where b.kd_kegiatan='$idkeg' and b.id='$id' and b.username='$username'
"; $query = $this->db->query($sql1);
foreach ($query->result() as $row)
                {
                    $isi=rtrim($row->isi_paket);
                    $itahun=rtrim($row->tahun);
                    $jnsp=rtrim($row->nmjns_pengadaan);
                    $vol=rtrim($row->vol);                    
                    $nilai_pagu = number_format($row->pagu,2,',','.');     
                    $tinit = $row->init_deleted;
                    if($tinit==0){
                    	$tpagu = $tpagu + $row->pagu;               	
                    }
                    if(rtrim($jnspkt)==1){
                    	$ket_jns = "Penggadaan : ".$jnsp;
                    }else{
                    	$ket_jns = strtolower($isi);
                    }	
                    
                    
                     $cRet    .= " <tr>                                
                                        <td align=\"center\" width=\"15%\" >$itahun</td>
										<td align=\"left\" width=\"40%\" >$ket_jns</td>
										<td align=\"left\" width=\"10%\" >$vol</td>
                                        <td align=\"right\" width=\"40%\" >$nilai_pagu</td>
                                   </tr>";   
                                        
                    
                 }                	
                             	

                                      
                 $cRet    .= " </table></td>";             
                                       
                           $cRet    .= "<td align=\"left\" style=\"text-align:center; \" >$metodepeng</td>
                                        <td align=\"right\" style=\"vertical-align:right; \" >$nilai_angx</td>
                                    </tr>"; 
                     }

            
            $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"vertical-align:left;\" colspan=\"9\" >&nbsp;</td>                                      
                                         ";
            $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"border:none;\" colspan=\"7\" ></td>
                                        <td align=\"left\" style=\"border:none;\" >&nbsp;Total Paket RUP</td>
                                        <td align=\"right\" style=\"border:none; \" >".number_format($tpagu,2,',','.')." </td>
                                         "; 
            
            $sqlada="select sum(c.nilai) nilai from(
					  select isnull(sum(nilai),0) as nilai from trdrka where kd_sub_kegiatan ='$idkeg')c";

            $ada3=$this->db->query($sqlada);$ada2=$ada3->row();
            $total_anggaran_n=$ada2->nilai;  

            $sqlada_n1="select sum(c.nilai) nilai from(
					  select isnull(sum(0),0) as nilai from trdrka where kd_sub_kegiatan ='$idkeg')c";

            $ada3_n1=$this->db->query($sqlada_n1);$ada2_n1=$ada3_n1->row();
            $total_anggaran_n1=$ada2_n1->nilai;    

            $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"border:none;\" colspan=\"7\" ></td>
                                        <td align=\"left\" style=\"border:none;\" >&nbsp;Total Pagu Tahun</td>
                                        <td align=\"right\" style=\"border:none; \" >".number_format($total_anggaran_n,2,',','.')." </td>
                                         ";
            $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"border:none;\" colspan=\"7\" ></td>
                                        <td align=\"left\" style=\"border:none;\" >&nbsp;Total Pagu Tahun +N</td>
                                        <td align=\"right\" style=\"border:none; \" >".number_format($total_anggaran_n1,2,',','.')." </td>
                                         ";                               
            $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"border:none;\" colspan=\"7\" ></td>
                                        <td align=\"left\" style=\"border:none;\" >&nbsp;Total Pagu - RUP</td>
                                        <td align=\"right\" style=\"border:none; \" >".number_format(($total_anggaran_n+$total_anggaran_n1)-$tpagu,2,',','.')." </td>
                                         ";  
            $cRet    .= " <tr>                                
                                        <td align=\"center\" style=\"border:none;\" colspan=\"9\" >&nbsp;</td>

                                   </tr>";
			$cRet    .= " <tr>                                
                                        <td align=\"center\" style=\"border-bottom:none;border-top:solid 1px black;\" colspan=\"9\" >&nbsp;</td>

                                   </tr>";                                   
			$cRet    .= " <tr>                                
                                        <td align=\"center\" style=\"border:none;\" colspan=\"9\" ><b><h2>LIST PAKET REVISI</h2></b></td>

                                   </tr>";                                      

        //paket revisi    
        $sql1="select c.* from(
select
a.username,
a.idrup,
a.id,
a.kd_skpd, 
a.kd_kegiatan,
a.jenis_paket,
case when a.jenis_paket='1' then 'Penyedia' else 'Swakelola' end as jenis,
case when a.is_deleted='1' then '(PAKET DIREVISI' else '' end as is_deleted,
(select top 1 alasan_revisi from sirup_history_paket where idrup=a.idrup) alasan,
a.nm_paket nm_paket,
(select top 1 isi_paket from sirup_detail where kd_skpd=a.kd_skpd and id=a.id and username=a.username ) isi_paket,
a.jns_pengadaan,
isnull(a.mtd_pengadaan,0) mtd_pengadaan,
a.tipe_swakelola,
a.total
from sirup_header a
) c
where c.kd_kegiatan='$idkeg' and c.username='$username' and c.is_deleted<>''
group by c.idrup,c.is_deleted,c.alasan,c.username,c.jenis_paket,c.isi_paket,c.id,c.kd_skpd,c.kd_kegiatan,c.jenis,c.nm_paket,c.jns_pengadaan,c.mtd_pengadaan,tipe_swakelola,c.total
order by c.jenis";
  

                $tvol = 0;
                $tpagu = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $id=rtrim($row->id);
					$idrup=rtrim($row->idrup);
                    $keg=rtrim($row->kd_kegiatan);                    
                    $nm1=rtrim($row->nm_paket);
                    $nm2=rtrim($row->isi_paket);
                    $del=rtrim($row->is_deleted);
                    if($del<>''){
                    	$als=", KET: ".rtrim(strtoupper($row->alasan)).")";	
                    }else{
                    	$als="";
                    }
                     

                    $jns=rtrim($row->jenis);
                    $jnspkt=rtrim($row->jenis_paket);
					$tipe=rtrim($row->tipe_swakelola);
					
                    $mtd_p=rtrim($row->mtd_pengadaan);

                    if($mtd_p==0){
                    if($jns=='Penyedia'){	
                    $metodepeng="Kosong";
                    }else{
                    $metodepeng="Tipe Swakelola ".$tipe;  	
                    }	                    
                    }else{
                    if($jns=='Penyedia'){
                    $sqlmp="select nm_mp from sirup_metode_pengadaan where kd_mp in ('$mtd_p')";
                    $mp3=$this->db->query($sqlmp);$mp2=$mp3->row();
                    $metodepeng=$mp2->nm_mp;
                    }else{
                    $metodepeng="Tipe Swakelola ".$tipe;    
                    }

                    }

                        

                    $nilai_angx = number_format($row->total,2,',','.');
                    if(rtrim($jnspkt)==1){
                    $nm = $nm1." (".$nm2.")";
                	}else{
                	$nm = $nm1;	
                	}	

                	if($del<>''){
                    	$als=", KET: ".rtrim(strtoupper($row->alasan)).")";	
                    }else{
                    	$als="";
                    }

                     $cRet    .= " <tr>                                
                                        <td align=\"left\" style=\"text-align:center; \" >$idrup</td>
										<td align=\"left\" style=\"text-align:center; \" >$jns</td>
                                        <td align=\"left\" style=\"vertical-align:left; \" >$nm <b>$del $als</b></td>
                                        <td align=\"left\" colspan=\"4\" style=\"vertical-align:middle; \" >
                                         ";
                              
                              $cRet    .= " <table border=\"0\" width=\"100%\">";

                $sql1="
select  
b.kd_kegiatan,
b.isi_paket,
b.tahun,
b.vol,
b.pagu,
b.nmjns_pengadaan,
(select count(is_deleted) from sirup_header where id='$id' and username='$username' ) init_deleted
from sirup_detail b 
where b.kd_kegiatan='$idkeg' and b.id='$id' and b.username='$username'
"; $query = $this->db->query($sql1);
foreach ($query->result() as $row)
                {
                    $isi=rtrim($row->isi_paket);
                    $itahun=rtrim($row->tahun);
                    $jnsp=rtrim($row->nmjns_pengadaan);
                    $vol=rtrim($row->vol);                    
                    $nilai_pagu = number_format($row->pagu,2,',','.');     
                    $tinit = $row->init_deleted;
                    if($tinit==0){
                    	$tpagu = $tpagu + $row->pagu;               	
                    }
                    if(rtrim($jnspkt)==1){
                    	$ket_jns = "Penggadaan : ".$jnsp;
                    }else{
                    	$ket_jns = strtolower($isi);
                    }	
                    
                    $cRet    .= " <tr>                                
                                        <td align=\"center\" width=\"15%\" >$itahun</td>
										<td align=\"left\" width=\"40%\" >$ket_jns</td>
										<td align=\"left\" width=\"10%\" >$vol</td>
                                        <td align=\"right\" width=\"40%\" >$nilai_pagu</td>
                                   </tr>";   
                                        
                    
                 }
                   $cRet    .= " </table></td>";             
                                       
                           $cRet    .= "<td align=\"left\" style=\"text-align:center; \" >$metodepeng</td>
                                        <td align=\"right\" style=\"vertical-align:right; \" >$nilai_angx</td>
                                    </tr>"; 
                     }                                        



        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
        /*switch($cetak) {
        case 0;
               echo ("<title>Lap Perbandingan Anggaran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= cek_anggaran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }   */
        
        echo ("<title>Lap Perbandingan Anggaran Dan RUP</title>");
        echo($cRet); 
        //$this->_mpdf('',$cRet,10,10,10,'1');
    }


   
    function load_status_cek_anggaran(){
         $row[] = array(                         						
                        'idx' => '1',
                        'dstatus'  => 'Nilai Murni'
                        ); 
            $row[] = array(                         						
                        'idx' => '2',
                        'dstatus'  => 'Nilai Pergeseran'
                        );
            $row[] = array(                         						
                        'idx' => '3',
                        'dstatus'  => 'Nilai Perubahan'
                        );     
                        
            echo json_encode($row);            
    }

     function load_cek_anggaran(){
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('kriteria_init');
        $kriteria_skpd = $this->input->post('kriteria_skpd');
        
        $init ='';
        if ($kriteria <> ''){                               
            
            if($kriteria=="1"){
                $init= "nilai";
                $tw="";
            }else if($kriteria=="2"){
                $init= "nilai_sempurna";
                $tw="_sempurna";
            }else{
                $init= "nilai_ubah";
                $tw="_ubah";
            }                                        
        }
        
        $sql = "SELECT count(x.kd_kegiatan) as tot  from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                select a.kd_kegiatan,sum($init) as nilai_kas from trdskpd_ro a inner join trskpd c on a.kd_kegiatan=c.kd_kegiatan 
                where left(a.kd_skpd,7)=left('$kriteria_skpd',7)
                group by a.kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan
                " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                select a.kd_kegiatan,sum($init) as nilai_kas from trdskpd_ro a inner join trskpd c on a.kd_kegiatan=c.kd_kegiatan
                where left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan 
                order by x.kd_kegiatan,x.nm_kegiatan
                "; 
                
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],        
                        'nilai_ang' => number_format($resulte['nilai_ang'],2),
                        'nilai_kas' => number_format($resulte['nilai_kas'],2),
                        'status_hasil' => $resulte['hasil']
                        );
                        $ii++;
        }

        $update="UPDATE a SET
        $init=b.$init
        from trdskpd a inner join (
        select a.kd_kegiatan, bulan,sum(nilai) nilai, 
        sum(nilai_susun) nilai_susun,
        sum(nilai_sempurna) nilai_sempurna,
        sum(nilai_ubah) nilai_ubah
        from trdskpd_ro a inner join trskpd b on a.kd_kegiatan=b.kd_kegiatan
        GROUP BY a.kd_kegiatan, bulan)b
        on a.kd_kegiatan=b.kd_kegiatan and a.bulan=b.bulan"; 
        $query = $this->db->query($update); 
        
        $sql="
        UPDATE a SET
        a.triw1$tw=p.triw1,
        a.triw2$tw=p.triw2,
        a.triw3$tw=p.triw3,
        a.triw4$tw=p.triw4
        from trskpd a inner join( 
        select kd_kegiatan, sum(a) triw1, sum(b) triw2, sum(c) triw3, sum(d) triw4, sum(a)+sum(b)+ sum(c)+sum(d) total from(
        select kd_kegiatan,
        case WHEN bulan BETWEEN 1 and 3 then isnull(sum($init),0) end as a,
        case WHEN bulan BETWEEN 4 and 6 then isnull(sum($init),0) end as b,
        case WHEN bulan BETWEEN 7 and 9 then isnull(sum($init),0) end as c,
        case WHEN bulan BETWEEN 10 and 12 then isnull(sum($init),0) end as d
        from(
        select a.kd_kegiatan, bulan,sum(nilai_sempurna) nilai, 
        sum(nilai_susun) nilai_susun,
        sum(nilai_sempurna) nilai_sempurna,
        sum(nilai_ubah) nilai_ubah
        from trdskpd_ro a inner join trskpd b on a.kd_kegiatan=b.kd_kegiatan
        GROUP BY a.kd_kegiatan, bulan) xx GROUP BY kd_kegiatan, bulan)yy 
        GROUP BY kd_kegiatan) p on a.kd_kegiatan=p.kd_kegiatan
        WHERE a.kd_skpd='$kriteria_skpd'
        "; 
        $query = $this->db->query($sql);
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);     
    }
    
    function load_cek_anggaranxx(){
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('kriteria_init');
        $kriteria_skpd = $this->input->post('kriteria_skpd');
        
        $init ='';
        if ($kriteria <> ''){                               
            
            if($kriteria=="1"){
                $init= "nilai";
            }else if($kriteria=="2"){
                $init= "nilai_sempurna";
            }else{
                $init= "nilai_ubah";
            }                                        
        }
        
        $sql = "select count(x.kd_kegiatan) as tot  from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan	

                ) z on z.kd_kegiatan = x.kd_kegiatan
                " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "select x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
               
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan	

                ) z on z.kd_kegiatan = x.kd_kegiatan 
                order by x.kd_kegiatan,x.nm_kegiatan
                ";
                  // echo( $sql);
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],        
                        'nilai_ang' => number_format($resulte['nilai_ang'],2),
                        'nilai_kas' => number_format($resulte['nilai_kas'],2),
                        'status_hasil' => $resulte['hasil']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);     
    }
    
	function load_cek_anggaran_sirup(){
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('kriteria_init');
        $kriteria_skpd = $this->input->post('kriteria_skpd');
		$kriteria_user = $this->input->post('kriteria_user');
        
        $init ='';
        if ($kriteria <> ''){                               
            
            if($kriteria=="1"){
                $init= "nilai";
            }else if($kriteria=="2"){
                $init= "nilai_sempurna";
            }else{
                $init= "nilai_ubah";
            }                                        
        }
        
        $sql = "select count(x.kd_kegiatan) as tot  from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang,(
                select username from m_giat_rup where kd_kegiatan=trdrka.kd_kegiatan
                ) username from trdrka
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan	

                ) z on z.kd_kegiatan = x.kd_kegiatan
				where z.username='$kriteria_user'
                " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "select  x.username,x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum($init) as nilai_ang,(
                select username from m_giat_rup where kd_kegiatan=trdrka.kd_kegiatan
                ) username from trdrka 
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan

                ) z on z.kd_kegiatan = x.kd_kegiatan 
				where z.username='$kriteria_user'
                order by x.kd_kegiatan,x.nm_kegiatan
                ";
                
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'username' => $resulte['username'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],        
                        'nilai_ang' => number_format($resulte['nilai_ang'],2),
                        'nilai_kas' => number_format($resulte['nilai_kas'],2),
                        'status_hasil' => $resulte['hasil']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);     
    }
	
	function load_cek_anggaran_sirup_ppkom(){
        $result = array();
        $row = array();
        $page = isset($_POST['page']) ? intval($_POST['page']) : 1;
        $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
        $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('kriteria_init');
        $kriteria_skpd = $this->input->post('kriteria_skpd');
		$kriteria_user = $this->input->post('kriteria_user');
        
        $init ='';
        if ($kriteria <> ''){                               
            
            if($kriteria=="1"){
                $init= "nilai";
            }else if($kriteria=="2"){
                $init= "nilai_sempurna";
            }else{
                $init= "nilai_ubah";
            }                                        
        }
        
        $sql = "select count(x.kd_sub_kegiatan) as tot  from(
                select kd_sub_kegiatan,nm_sub_kegiatan,sum($init) as nilai_ang,(
                select username from ms_sub_kegiatan where kd_sub_kegiatan=trdrka.kd_sub_kegiatan
                ) username from trdrka
                where kd_skpd='$kriteria_skpd'
                group by kd_sub_kegiatan,nm_sub_kegiatan )x
                left join (
                
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				a.kd_skpd='$kriteria_skpd'                
                group by a.kd_kegiatan

                ) z on z.kd_kegiatan = x.kd_sub_kegiatan 
				where x.username='$kriteria_user'
                " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "select  x.username,x.kd_sub_kegiatan,x.nm_sub_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_sub_kegiatan,nm_sub_kegiatan,sum($init) as nilai_ang,(
                select username from ms_sub_kegiatan where kd_sub_kegiatan=trdrka.kd_sub_kegiatan
                ) username from trdrka 
                where left(kd_skpd,7)=left('$kriteria_skpd',7)
                group by kd_sub_kegiatan,nm_sub_kegiatan )x
                left join (
                
                select a.kd_kegiatan,sum(a.pagu) as nilai_kas from sirup_detail a
                left join sirup_header b on b.id=a.id and a.username=b.username 
                where (b.is_deleted<>1 or b.is_deleted is null) and
				left(a.kd_skpd,7)=left('$kriteria_skpd',7)                
                group by a.kd_kegiatan
                
                ) z on z.kd_kegiatan = x.kd_sub_kegiatan 
				where x.username='$kriteria_user'
                order by x.kd_sub_kegiatan,x.nm_sub_kegiatan
                ";
                
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'username' => $resulte['username'],
                        'kd_kegiatan' => $resulte['kd_sub_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_sub_kegiatan'],        
                        'nilai_ang' => number_format($resulte['nilai_ang'],2),
                        'nilai_kas' => number_format($resulte['nilai_kas'],2),
                        'status_hasil' => $resulte['hasil']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);     
    }
	
    function preview_cetakan_cek_anggaran(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $status_ang = $this->uri->segment(5);


    
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
     
        
        $cRet='';
       $Xret1 = '';
       $Xret1.="<table style=\"font-size:30px;border-left:solid 0px black;border-top:solid 0px black;border-right:solid 0px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td align=\"center\" colspan=\"5\" style=\"font-size:22px;border: solid 0px white;\"><b>LAPORAN PERBANDINGAN<br>NILAI ANGGARAN DAN NILAI ANGGARAN KAS</b></td>
                        
                    </tr>
                 </table>";

       $Xret2 = '';
       $Xret3 = ''; 
       
       $Xret2.="<table style=\"border-collapse:collapse;font-size:14px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td colspan=\"3\" width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret3.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td colspan=\"3\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>
                 </table>";       
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:15 px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">

                     <thead >                       
                        <tr>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center \"><b>Kode Kegiatan</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"50%\" align=\"center\"><b>Nama Kegiatan</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center\"><b>Nilai Anggaran</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"15%\" align=\"center\"><b>Nilai Anggaran Kas</b></td>
                            <td bgcolor=\"#A9A9A9\" width=\"5%\" align=\"center\"><b>Hasil</b></td>
                         </tr>
                     </thead>
                     
                   
                        ";
            $stt='';
        if($status_ang=='1'){
            $stt='';
        }else if($status_ang=='2'){
            $stt='_sempurna';
        }else if($status_ang=='3'){
            $stt='_ubah';
        }

                $sql1="SELECT x.kd_kegiatan,x.nm_kegiatan,x.nilai_ang,z.nilai_kas,case when z.nilai_kas = x.nilai_ang then 'SAMA' ELSE 'TIDAK' END AS hasil from(
                select kd_kegiatan,nm_kegiatan,sum(nilai".$stt.") as nilai_ang from trdrka
                where left(kd_skpd,7)=left('$id',7)
                group by kd_kegiatan,nm_kegiatan )x
                left join (
                SELECT a.kd_kegiatan,sum(nilai".$stt.") as nilai_kas from trdskpd_ro a inner join trskpd c on a.kd_kegiatan=c.kd_kegiatan
                where left(a.kd_skpd,7)=left('$id',7)                
                group by a.kd_kegiatan
                ) z on z.kd_kegiatan = x.kd_kegiatan 
                order by x.kd_kegiatan,x.nm_kegiatan";
  				

  

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $giat=rtrim($row->kd_kegiatan);
                    $nm_giat=rtrim($row->nm_kegiatan);
                    $hasil=rtrim($row->hasil);
                    $nilai_ang=($row->nilai_ang);
                    $nilai_angx = number_format($nilai_ang,2,',','.');
                    $nilai_kas=($row->nilai_kas);
                    $nilai_kasx = number_format($nilai_kas,2,',','.');

                            if($hasil=='SAMA'){


                      $cRet    .= " <tr>                                
                                        <td align=\"center\" style=\"vertical-align:middle; \" >$giat</td>
                                        <td align=\"left\" style=\"vertical-align:middle; \" >$nm_giat</td>
                                        <td align=\"right\" style=\"vertical-align:middle; \" >$nilai_ang</td>
                                        <td align=\"right\" style=\"vertical-align:middle; \" >$nilai_kas</td>
                                        <td align=\"center\" style=\"vertical-align:middle; \" >$hasil</td>
                                    </tr> 
                                   
                                    ";
    
                            }else{
                

                      $cRet    .= " <tr>                                
                                        <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"vertical-align:middle;\" >$giat</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"left\" style=\"vertical-align:middle;\" >$nm_giat</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"right\" style=\"vertical-align:middle;\" >$nilai_ang</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"right\" style=\"vertical-align:middle;\">$nilai_kas</td>
                                        <td bgcolor=\"#CCCCCC\" align=\"center\" style=\"vertical-align:middle;\">$hasil</td>
                                    </tr> 
                                   
                                    ";

                            }

                }

 
        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Lap Perbandingan Anggaran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= cek_anggaran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }



 function cs_kegi_ubah($skpd) {
        //$skpd   = $this->input->post('skpd');
        $sql = "select kd_kegiatan, '' nm_kegiatan from trdrka WHERE left(kd_skpd,7)=left('$skpd',7)
                group by kd_kegiatan,nm_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }

function cs_kegi($skpd) {
        //$skpd   = $this->input->post('skpd');
        $sql = "select kd_kegiatan,nm_kegiatan from trdrka where nilai<>0 and left(kd_skpd,7)=left('$skpd',7) and RIGHT(kd_kegiatan,6) not in('00.001','00.002')
                group by kd_kegiatan,nm_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }

//start edit_sumber_murni


    function edit_sumber_kegi(){
        $data['page_title']= 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN';
        $this->template->set('title', 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN');   
        $this->template->load('template','anggaran/rka/edit_sumber_kegi',$data) ; 
    }


    function kegi_sumber($cskpd='') {
        $lccr = $this->input->post('q');
        if($cskpd==''){
            $result[] = array(
                        'id' => 0,        
                        'kd_kegiatan' => '',  
                        'nm_kegiatan' => '',  
                        'nilai' =>  '',
                        'sumber' => '',
                        'ket_sumber' => ''
                        );
        }else{
            $query1 = "select DISTINCT kd_kegiatan,nm_kegiatan,sum(nilai) as nilai,
                       case when sumber2 is null then sumber
                        else sumber+'  '+sumber2 end as sumber,
                        case when (sumber2 is null or sumber2 =' ')then '1'
                        else '2' end as ket_sumber
                        from trdrka where left(kd_skpd,7) = left('$cskpd',7)
                        group by kd_kegiatan,nm_kegiatan,sumber,sumber2 order by kd_kegiatan";  
            
            $query2=$this->db->query($query1);

            $result = array();
            $ii = 0;
            foreach($query2->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan'],  
                            'nilai' =>  number_format($resulte['nilai'],"2",".",","),
                            'sumber' => $resulte['sumber'],
                            'ket_sumber'=> $resulte['ket_sumber']
                            );
                            $ii++;
            }                            
        }

        echo json_encode($result);
           
    }
    
    function update_sumber_kegi(){
        $ckegi   = $this->input->post('kegi');
        $sumber   = $this->input->post('csumber1');
        /*
        $npad   = $this->input->post('snpad');
        $ndak   = $this->input->post('sndak');
        $ndaknf = $this->input->post('sndaknf');
        $ndau = $this->input->post('sndau');
        $ndbhp = $this->input->post('sndbhp');
        $ndid = $this->input->post('sndid');
        */
        $nangg = 'nilai';
        
 //      $asg = $this->rka_model->q_update_sumber_kegi($ckegi,$sumber,$nangg,$npad,$ndak,$ndaknf,$ndau,$ndbhp,$ndid);

          $asg = $this->rka_model->q_update_sumber_kegi($ckegi,$sumber,$nangg);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
    }

    //end murni

function status_keg(){
        $skpd     =  $this->input->post('kdskpd');
        $kegi    =  $this->input->post('keg');
        $sql = "SELECT status_keg from trskpd WHERE kd_skpd = '$skpd' and kd_kegiatan='$kegi'";
        $query1 = $this->db->query($sql);  
        
        $test = $query1->num_rows();
        
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'status_keg' => $resulte['status_keg']
                        );
                        $ii++;
        }
        echo json_encode($result);
        $query1->free_result();   
    }

    function update_status_keg(){
       $keg      = $this->input->post('kdgiat');
       $ckd_skpd     = $this->input->post('kd_skpd');
       $csts      = $this->input->post('status_keg1');
       $usernm      = $this->session->userdata('pcNama');
       $last_update =  date('d-m-y H:i:s');
                    
       $sql = "UPDATE trskpd set status_keg='$csts' where kd_kegiatan='$keg' and left(kd_skpd,7)=left('$ckd_skpd',7) ";
       //update trhspd set status='$csts' where no_spd='$no_spd' and kd_skpd='$ckd_skpd' ";
       $asg = $this->db->query($sql);
        if ($asg > 0){      
            echo $csts;
        } else {
            echo '5';
        }
    }


    function tsimpan_sempurna(){ 
        $this->rka_model->kunci_menu_geser();
        $kdskpdbp = $this->input->post('kd_skpd2');
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $nmurni  = $this->input->post('nilaimurni');
        $sdana1 = rtrim($this->input->post('dana1'));
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $ndana1 = $this->input->post('vdana1');
        $ndana2 = $this->input->post('vdana2');
        $ndana3 = $this->input->post('vdana3');
        $ndana4 = $this->input->post('vdana4');
        $id         =  $this->session->userdata('pcNama');        
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');

        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
    	$user_name  =  $this->session->userdata('pcNama'); 
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdrka";
        $perintah="Input Edit RKA Geser $notrdrka ";

         $sql="insert into log_activity (user_name, tabel, last_update, perintah, url, ip_pc, browser, os) values ('$user_name','$tabel','$tgl','$perintah','$url/$notrdrka','$ip_num','$browser', '$os')";
         $this->db->query($sql);
 

        $query_find = $this->db->query("select * from trdrka where left(kd_skpd,7)=left('$kdskpd',7) and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'");
        $update = $query_find->num_rows();
        if($update > 0){
            $query_ins = $this->db->query("update trdrka set username='$id',
                sumber1_su='$sdana1',sumber2_su='$sdana2',sumber3_su='$sdana3',sumber4_su='$sdana4',
                sumber1_su2='$sdana1',sumber2_su2='$sdana2',sumber3_su2='$sdana3',sumber4_su2='$sdana4',
                sumber1_ubah='$sdana1',sumber2_ubah='$sdana2',sumber3_ubah='$sdana3',sumber4_ubah='$sdana4',
                nsumber1_su='$ndana1',nsumber2_su='$ndana2',nsumber3_su='$ndana3',nsumber4_su='$ndana4',
                nsumber1_su2='$ndana1',nsumber2_su2='$ndana2',nsumber3_su2='$ndana3',nsumber4_su2='$ndana4',
                nsumber1_ubah='$ndana1',nsumber2_ubah='$ndana2',nsumber3_ubah='$ndana3',nsumber4_ubah='$ndana4',
                last_update=getdate() where left(kd_skpd,7)=left('$kdskpdbp',7) and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'");        
        }else{
            $query_del = $this->db->query("delete from trdrka where no_trdrka = '$notrdrka'");

            $query_ins = $this->db->query("INSERT into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilaisempurna2,nilai_akhir_sempurna,nilai_ubah,sumber1_su,sumber2_su,sumber3_su,sumber4_su,
            sumber1_ubah,sumber2_ubah,sumber3_ubah,sumber4_ubah,nsumber1_su,nsumber2_su,nsumber3_su,nsumber4_su,
            nsumber1_ubah,nsumber2_ubah,nsumber3_ubah,nsumber4_ubah,username,last_update) 
            values('$notrdrka','$kdskpdbp','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nmurni','$nilai','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4','$sdana1','$sdana2','$sdana3','$sdana4',
            '$ndana1','$ndana2','$ndana3','$ndana4','$ndana1','$ndana2','$ndana3','$ndana4','$id',getdate())");        
        }



        if ( $query_ins > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }

    function cek_kas_sempurna(){
        
        $skpd     = $this->input->post('skpd');
        $kegiatan = $this->input->post('kegiatan');
        
        $result   = array();
        $query    = $this->db->query("select * from trdskpd_sempurna where kd_skpd='$skpd' and kd_kegiatan='$kegiatan'");
        //$query    = $this->db->query("select * from trdskpd where kd_skpd='1.03.01.00' and kd_kegiatan='1.03.1.03.01.00.18.04' ");
        $ii       = 0;
        
        foreach ( $query->result_array() as $row ){
            
            $result[] = array(
                'id'    =>  '$ii',
                'bulan' =>  $row['bulan'],
                'nilai' =>  $row['nilai']
            );
            $ii++;
        }
        echo json_encode($result);
    }
  
function thapus_sempurna($skpd='',$skpdbp='',$kegiatan='',$rek='') {
        
        $notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;

        $user_name  =  $this->session->userdata('pcNama');
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdrka";
        $perintah="Hapus rekening $notrdrka";

            $sql="insert into log_activity (user_name, tabel, last_update, perintah, url, ip_pc, browser, os) values ('$user_name','$tabel','$tgl','$perintah','$url','$ip_num','$browser', '$os')";
            $this->db->query($sql);
        
               
        $query = $this->db->query(" delete from trdrka where left(kd_skpd,7)=left('$skpdbp',7) and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
        $query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
        $query = $this->db->query(" update trskpd set total_Sempurna=( select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpdbp',7) ),
                                    total_sempurna_2=( select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpdbp',7) ),
                                    total_sempurna_final=( select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpdbp',7) ), 
                                    total_ubah=( select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpdbp',7) )
                                    where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$skpdbp',7) ");   
        $this->select_rka($kegiatan);
    }

    function cek_nopo_sempurna($norka='',$cpo){
        $query_find = $this->db->query("select * from trdpo where no_trdrka='$norka' and no_po='$cpo' and (total<>0)");
        $update = $query_find->num_rows();
        if($update < 1){
            $result = '0';
        }else{
            $result = '1';
        }
        echo json_encode($result);
    }
    

    function tsimpan_rinci_jk_sempurna(){
        $this->rka_model->kunci_menu_geser();
        $norka      = $this->input->post('no');
        $csql       = $this->input->post('sql');
        $cskpd      = $this->input->post('skpd');
        $cskpd2     = $this->input->post('skpdbp');
        $kegiatan   = $this->input->post('giat');
        $rekening   = substr($norka,35,7); 
        $id         =  $this->session->userdata('pcNama');
        $sql        = "delete from trdpo where no_trdrka='$norka'";
        $asg        = $this->db->query($sql);
        
        $user_name  =  $this->session->userdata('pcNama'); 
        $ip_num = $this->get_ip(); 
        $browser = $this->get_browser();
        $os=$_SERVER['HTTP_USER_AGENT'];
        $url = "http://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
        date_default_timezone_set('asia/jakarta');
        $tgl=date('Y-m-d H:i:s');
        $tabel="trdpo";
        $perintah="Input Edit DPO Geser $norka ";
        $sql="insert into log_activity (user_name, tabel, last_update, perintah, url, ip_pc, browser, os) values ('$user_name','$tabel','$tgl','$perintah','$url','$ip_num','$browser', '$os')";
            $this->db->query($sql);

                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(no_po,header,kode,kd_kegiatan,kd_rek5,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,
                            volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1,volume_sempurna2,
                            volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,harga_sempurna1,harga_sempurna2,total_sempurna,total_sempurna_2)"; 
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
    
                    }
                }
      

        $query1 = $this->db->query("update trdrka set nilai_sempurna= (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilai_akhir_sempurna= (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilaisempurna2= (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate()  where no_trdrka='$norka' ");  
        $query1 = $this->db->query("update trskpd set total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$cskpd2',7) ), 
                                    total_sempurna_2= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$cskpd2',7) ),
                                    total_sempurna_final= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$cskpd2',7) ),
                                    total_ubah= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$cskpd2',7) )
                                    where kd_kegiatan='$kegiatan' and left(kd_skpd,7)=left('$cskpd2',7) ");    
        $this->rka_rinci($cskpd,$kegiatan,$rekening);
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
    }

	function load_det_keg_sempurna(){

        $kdskpd = $this->input->post('skpd');
        $kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai_sempurna'],
                        'm_tu' => $resulte['tu_mas_sempurna'],
                        'k_tu' => $resulte['tu_kel_sempurna'],
                        'h_tu' => $resulte['tu_has_sempurna'],
                        'cp_ck' => $resulte['tk_capai_sempurna'],
                        'm_ck' => $resulte['tk_mas_sempurna'],
                        'ang_lalu' => number_format(($resulte['ang_lalu']),"2",".",","),
                        'k_ck' => $resulte['tk_kel_sempurna'],
                        'h_ck' => $resulte['tk_has_sempurna']                       
                        );
                        $ii++;
        }
           
           //return $result;
           echo json_encode($result);   

    }

function ctk_dpa0_sempurna(){
        $data['page_title']= 'Cetak DPA 0 Pergeseran';
        $this->template->set('title', 'Cetak DPA 0 Pergeseran');   
        $this->template->load('template','anggaran/rka/ctk_dpa0_sempurna',$data) ; 
    }

//dpa 0 sempurna
 function preview_dpa0_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        $ttd2= $this->uri->segment(8);
        $tgl2= $this->uri->segment(7);
        $ttd_tgl = $this->tukd_model->tanggal_format_indonesia($tgl2);
        //$ttd2= $_REQUEST['ttd2'];
		if($id=='4.02.01.00'){
        $nm_perangkat_daerah_kap ='PEJABAT PENGELOLA KEUANGAN DAERAH';
        $nm_perangkat_daerah ='Pejabat Pengelola Keuangan Daerah';
        $nm_perangkat_daerah_singkat ='PPKD';
        }else{
		$nm_perangkat_daerah_kap ='SATUAN KERJA PERANGKAT DAERAH';
        $nm_perangkat_daerah ='Satuan Kerja Perangkat Daerah';
        $nm_perangkat_daerah_singkat ='SKPD';
        	
		}
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)=left('$id',7) and right(kd_skpd,2)='00' ";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
         
        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                    
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


       if ($ttd2<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  and kode='agr'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }        
        
        $cRet='';
        
        
        
     $cRet .="<table colspan=\"7\" style=\"border-collapse:collapse;font-size:14;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"2\" style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                         <td colspan=\"4\" align=\"center\" style=\"border-collapse:collapse;border-bottom: solid 1px black\"><strong>RINGKASAN DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN<br>$nm_perangkat_daerah_kap</strong></td>
                         <td rowspan=\"2\" colspan=\"2\" style=\"border-collapse:collapse;font-size:14;border-left: solid 1px black;border-bottom: solid 1px black\" align=\"center\"><strong>FORMULIR<br>DPA - $nm_perangkat_daerah_singkat<br></strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"4\" align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK<br>TAHUN ANGGARAN $thn</td>
                    </tr>
                  
                    </table>

                  ";        
                  
                 
            $cRet .="<table style=\"border-collapse:collapse;font-size:10;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:11;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td colspan=\"3\">&nbsp;</td>
                        <td colspan=\"4\">&nbsp;</td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td colspan=\"4\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td colspan=\"4\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"><strong>&emsp;Unit Organisasi</stong></td>
                        <td colspan=\"4\"><strong>: $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\">&nbsp;</td>
                        <td colspan=\"4\">&nbsp;</td>
                    </tr>
                    <tr>
                     <td colspan=\"7\" style=\"border-collapse:collapse;border-left:solid 1px black;border-top:solid 1px black;font-size:14\" align=\"center\"><b>Ringkasan Dokumen Pelaksanaan Pergeseran Anggaran $nm_perangkat_daerah</b></td>
                    </tr>

                </table>";
            
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\"> 
                     <thead>

                        <tr><td rowspan=\"2\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td colspan=\"2\" rowspan=\"2\" align=\"center\"><b>URAIAN</b></td>
                            <td colspan=\"2\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td colspan=\"2\" align=\"center\"><b>BERTAMBAH/BERKURANG</b></td>
                        </tr>
                        <tr><td align=\"center\"><b>SEBELUM PERGESERAN</b></td>                            
                            <td align=\"center\"><b>SETELAH PERGESERAN</b></td>
                            <td align=\"center\"><b>(Rp)</b></td>
                            <td align=\"center\"><b>%</b></td>
                        </tr>    
                         <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>1</strong></td>                            
                            <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>3</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>4</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>5</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>6</strong></td>

                         </tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan=\"2\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b=left('$id',7) GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$this->dotrek(rtrim($row->kd_rek));
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                    $coba3u= number_format($row->nilai_sempurna,"2",",",".");

                    $n=$row->nilai;
                    $n_u=$row->nilai_sempurna;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");


                    if(strlen($coba1)>3){                                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba1 </td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" >$coba2</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$x1$persen1$y1</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><strong>$coba1</strong></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"><strong>$coba2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba3</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba3u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$n_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$persen1$y1</strong></td>
                                    </tr>";                        
                    }
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_sempurna) AS totp_sempurna FROM trdrka WHERE LEFT(kd_rek5,1)='4' and $a$skpd$b=left('$id',7)";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                   $coba4u=number_format($rowp->totp_sempurna,"2",",",".");
                    $cob1=$rowp->totp;
                    $surplusx1=$rowp->totp;
                    $surplusx1u=$rowp->totp_sempurna;

                    $totp_a=$rowp->totp;
                    $totpu_u=$rowp->totp_sempurna;
                    $totp_s = $totpu_u - $totp_a;
                    if ($totp_s < 0){
                        $x1="("; $n_s=$totp_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totp_selisih = number_format($totp_s,"2",".",",");
                    if ($totp_a==0){
                        $per1totp=0;
                    }else{
                    $per1totp   = ($totp_s!=0)?($totp_s / $totp_a ) * 100:0;
                    }
                    $persen1totp = number_format($per1totp,"2",".",",");


                    if ($cob1!=0){                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba4</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba4u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totp$y1</strong></td></tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";
                    } 
                 }     

                 
         
         
               $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b=left('$id',7) 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b=left('$id',7) GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,1)='5' ) AND $a b.$skpd$b=left('$id',7) 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai_sempurna FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,1)='5' ) AND $a b.$skpd$b=left('$id',7) 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$this->dotrek(rtrim($row1->kd_rek));
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    $coba7u= number_format($row1->nilai_sempurna,"2",",",".");

                    $n2=$row1->nilai;
                    $n2_u=$row1->nilai_sempurna;
                    $n2_s = $n2_u - $n2;
                    if ($n2_s < 0){
                        $x1="("; $n2_s=$n2_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n2_selisih = number_format($n2_s,"2",".",",");
                    if ($n2==0){
                        $per1=0;
                    }else{
                    $per1   = ($n2_s!=0)?($n2_s / $n2 ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");

                    if(strlen($coba5)>3){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba5</td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none ;border-bottom: none;\" >$coba6</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$n2_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$persen1$y1</td>
                                     </tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><strong>$coba5</strong></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" ><strong>$coba6</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$n2_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$persen1$y1</strong></td></tr>";                                                    
                    }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_sempurna) AS totb_sempurna FROM trdrka WHERE (LEFT(kd_rek5,2)='5') and $a$skpd$b=left('$id',7)";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                   $coba8u=number_format($rowb->totb_sempurna,"2",",",".");
                    $cob=$rowb->totb;
                    $surplusx=$rowb->totb;
                    $surplusxu=$rowb->totb_sempurna;

                    $totb_a=$rowb->totb;
                    $totbu_u=$rowb->totb_sempurna;
                    $totb_s = $totbu_u - $totb_a;
                    if ($totb_s < 0){
                        $x1="("; $totb_s=$totb_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totp_selisih = number_format($totb_s,"2",".",",");
                    if ($totb_a==0){
                        $per1totb=0;
                    }else{
                    $per1totb   = ($totb_s!=0)?($totb_s / $totb_a ) * 100:0;
                    }
                    $persen1totb = number_format($per1totb,"2",".",",");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\"><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba8</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba8u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totb$y1</strong></td>
                                </tr>";
                 } 
                  
                  $suplus=$surplusx1-$surplusx; 
                  if ($suplus < 0){
                    $x1="(";
                    $suplus=$suplus*-1;
                    $y1=")";}
                  else {
                    $x1="";
                    $y1="";}
                $surp=number_format($suplus,2,',','.'); 

                $suplusu=$surplusx1u-$surplusxu; 
                  if ($suplusu < 0){
                    $x1u="(";
                    $suplusu=$suplusu*-1;
                    $y1u=")";}
                  else {
                    $x1u="";
                    $y1u="";}
                 $surpu=number_format($suplusu,2,',','.');  


                    $totsurp_a=$suplus;
                    $totsurp_u=$suplusu;
                    $totsurp_s = $totsurp_u - $totsurp_a;
                    if ($totsurp_s < 0){
                        $x1="("; $totsurp_s=$totsurp_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totsurp_selisih = number_format($totsurp_s,"2",".",",");
                    if ($totsurp_a==0){
                        $per1totsurp=0;
                    }else{
                    $per1totsurp   = ($totsurp_s!=0)?($totsurp_s / $totsurp_a ) * 100:0;
                    }
                    $persen1totsurp = number_format($per1totsurp,"2",".",",");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\"  style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" ><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$surp$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1u$surpu$y1u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totsurp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totsurp$y1</strong></td>
                                     </tr>";
                                     

                   
                    
  
   
                    
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Pergeseran Anggaran<br>$nm_perangkat_daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td colspan=\"5\" style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td width=\"4%\" style=\"text-align: center;\"><strong>1</strong> </td>
                                <td width=\"23%\" style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>3</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>4</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>5</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>6</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
                                                        
  
                    //Pendapatan
                    $qtriw = " SELECT isnull( a.triw1_sempurna,0) AS triw1,isnull( a.triw2_sempurna,0) AS triw2,isnull( a.triw3_sempurna,0) 
                                AS triw3,isnull( a.triw4_sempurna,0) AS triw4  FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b=LEFT('$id',7) group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b=LEFT('$id',7)";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total= $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3+ $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                    
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai_sempurna) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai_sempurna) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai_sempurna) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai_sempurna) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro  a inner join (select kd_kegiatan from trdrka GROUP BY kd_kegiatan) b
        on a.kd_kegiatan=b.kd_kegiatan
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,1)='5' and left(kd_skpd,7)=left('$id',7)
                            "; //echo($qtriw);
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT '3.1' as kode,'Pengeluaran Pembiayaan' as uraian,w.triw1,x.triw2,y.triw3,z.triw4,total.total from
(select isnull(sum(nilai_sempurna),0) as triw1 from trdskpd_ro where left(kd_rek5,2) ='61' and bulan in('1','2','3') and kd_skpd='$id')w,
(select isnull(sum(nilai_sempurna),0) as triw2 from trdskpd_ro where left(kd_rek5,2) ='61' and bulan in('4','5','6') and kd_skpd='$id')x,
(select isnull(sum(nilai_sempurna),0) as triw3 from trdskpd_ro where left(kd_rek5,2) ='61' and bulan in('7','8','9') and kd_skpd='$id')y,
(select isnull(sum(nilai_sempurna),0) as triw4 from trdskpd_ro where left(kd_rek5,2) ='61' and bulan in('10','11','12') and kd_skpd='$id')z,
(select isnull(sum(nilai_sempurna),0) as total from trdskpd_ro where left(kd_rek5,2) ='61' and kd_skpd='$id')total";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  select '3.2' as kode,'Pengeluaran Pembiayaan' as uraian,w.triw1,x.triw2,y.triw3,z.triw4,total.total from
(select isnull(sum(nilai_sempurna),0) as triw1 from trdskpd_ro where left(kd_rek5,2) ='62' and bulan in('1','2','3') and kd_skpd='$id')w,
(select isnull(sum(nilai_sempurna),0) as triw2 from trdskpd_ro where left(kd_rek5,2) ='62' and bulan in('4','5','6') and kd_skpd='$id')x,
(select isnull(sum(nilai_sempurna),0) as triw3 from trdskpd_ro where left(kd_rek5,2) ='62' and bulan in('7','8','9') and kd_skpd='$id')y,
(select isnull(sum(nilai_sempurna),0) as triw4 from trdskpd_ro where left(kd_rek5,2) ='62' and bulan in('10','11','12') and kd_skpd='$id')z,
(select isnull(sum(nilai_sempurna),0) as total from trdskpd_ro where left(kd_rek5,2) ='62' and kd_skpd='$id')total";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
                                <table border=\"0\" width=\"100%\">
                                <tr>
                                <td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
                                <br>&nbsp;
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;  
                                </td>
                                <td width=\"30%\" align=\"center\">$daerah, $ttd_tgl 
                                <br>$jdlnip1
                                <br>$jabatan1
                                <p>&nbsp;</p>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br><strong><ins>$nama1</ins></strong>
                                <br>$nip1 
                                </td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0-Pergeseran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0-Pergeseran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }


 function ctk_dppa1_sempurna(){
        $data['page_title']= 'Cetak DPA 1 Pergeseran';
        $this->template->set('title', 'Cetak DPA 1 Pergeseran');   
        $this->template->load('template','anggaran/rka/ctk_dppa1_sempurna',$data) ; 
    }
    
     function preview_coverdppa1_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2= $_REQUEST['ttd2'];
        $ttdx = str_replace('a',' ',$ttd2);
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE nip='$ttdx'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"7\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>PENDAPATAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"30%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>01</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>4</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"20%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
function preview_dppa1_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttdsetda = $this->uri->segment(7);
		
		if($id=='4.02.01'){
        $nm_perangkat_daerah_kap ='PEJABAT PENGELOLA KEUANGAN DAERAH';
        $nm_perangkat_daerah ='Pejabat Pengelola Keuangan Daerah';
        $nm_perangkat_daerah_singkat ='PPKD';
        }else{
		$nm_perangkat_daerah_kap ='SATUAN KERJA PERANGKAT DAERAH';
        $nm_perangkat_daerah ='Satuan Kerja Perangkat Daerah';
        $nm_perangkat_daerah_singkat ='SKPD';		
		}
        $ttd1= $_REQUEST['ttd1'];   
        $ttd2= $_REQUEST['ttd2'];
        $tgltt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1);
        $ttd2 = str_replace('a',' ',$ttd2);
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan2 = str_replace('PENGGUNA','',$jabatan2);
                    $jabatan2 = str_replace('ANGGARAN','',$jabatan2);
                    $jabatan2 = str_replace('Pengguna','',$jabatan2);
                    $jabatan2 = str_replace('Anggaran','',$jabatan2);
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                        <td  colspan=\"8\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN <br>$nm_perangkat_daerah_kap</strong></td>
                        <td  colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPA - $nm_perangkat_daerah_singkat 
                        <br>1<br></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;border-bottom: hidden;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong> </td>
                    </tr>    
                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td colspan=\"10\"><strong>: $kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td colspan=\"10\"><strong>: $kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td colspan=\"9\"> <strong>: $kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td colspan=\"2\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td colspan=\"9\"><strong>:$kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"left\"><strong>Latar belakang perubahan/dianggarkan pendapatan dalam APBD :</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Pergeseran Anggaran Pendapatan <br>$nm_perangkat_daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td width=\"7%\" rowspan=\"3\"  align=\"center\"><b>Kode Rekening</b></td>                            
                            <td width=\"31%\" rowspan=\"3\"  align=\"center\"><b>Uraian</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Setelah Pergeseran</b></td>
                            <td width=\"20%\" colspan=\"2\"  align=\"center\"><b>Bertambah/(Berkurang)</b></td>        
                        </tr>
 
                        <tr>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\"  align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"15%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">(Rp.)</td>
                            <td width=\"5%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">%</td>
                        </tr>                            
    
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>

                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9) </td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td colspan=\"12\" style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";
                $angg_n1 = 'nilai';
                $angg_n2 = 'nilai_sempurna';
                $rangg_n1 = 'total';        
                $rangg_n2 = 'total_sempurna';
                $v1 = 'volume1';
                $v2 = 'volume_sempurna1';
                $s1 = 'satuan1';
                $s2 = 'satuan_sempurna1';
                $h1 = 'harga1';
                $h2 = 'harga_sempurna1';
                
                $sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,6)='00.001' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.001'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga,SUM(a.$angg_n2) AS nilai2,
                            '3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$rangg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$rangg_n2) AS nilai2,
                            '6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,6)='00.001' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,
                            a.$v1 AS volume,a.$s1 AS satuan,a.$h1 AS harga,a.$rangg_n1 AS nilai,
                            a.$v2 AS volume2,a.$s2 AS satuan2,a.$h2 AS harga2,a.$rangg_n2 AS nilai2,
                            '6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,6)='00.001' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                
                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                                                                                 
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        
                        if($rek==' '){ 
                            $uraian='- ' .$row->nama;
                            $volum=$row->volume;
                            $volum2=$row->volume2;                            
                        }else{
                            $uraian=$row->nama;
                            $volum=' ';
                            $volum2=' ';
                        }
                        
                        $sat=$row->satuan;
                        $sat2=$row->satuan2;

                        $nila = $row->nilai;
                        $nila2 = $row->nilai2;
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nila2;
                        }
                        
                        $selisih = $this->rp_minus($nila2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nila2 - $nila)/$nila)*100);
                        }else{
                            if($nila2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 

                        
                        $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                        $hrg2= empty($row->harga2) || $row->harga2 == 0 ? '' :number_format($row->harga2,2,',','.');

                        $nila= number_format($nila,"2",",",".");
                        $nila2= number_format($nila2,"2",",",".");
                        
                        if (strlen($row->rek1)>6) {
                            $bold = "";
                            $fontr = "font-size: ".$font." px;";                        
                        }else{
                            $bold = "font-weight:bold;";
                            $fontr = "font-size: ".$font1." px;";
                        }

                        $cRet    .= " <tr>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$reke</td>                                     
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" > $uraian </td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                     </tr>
                                     ";
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" lign=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>

                                     ";
                    
                }



            
                    $totp=number_format($totp,"2",",",".");
                    $totp2=number_format($totp2,"2",",",".");

                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


        $cRet    .= "</table>";
     //$tanggaltt = $this->tanggal_format_indonesia($tgltt);
     $tanggaltt = $this->tukd_model->tanggal_format_indonesia($tgltt);
     if($ttdsetda == '0'){
         $jdlnip3 = '';
         $jabatan3 = '';
         $nama3 = '';
         $pangkat3 = '';
         $nip3='';        
     }else{   
         $jdlnip3 = 'Menyetujui,';
         $jabatan3 = 'Sekretaris';
         $nama3 = 'Dr. M. Zeet Hamdy Assovie, MTM';
         $pangkat3 = 'Pembina Utama';
         $nip3='19620815 1991031011';
     }

     $qtriw = " SELECT distinct isnull( a.triw1_sempurna,0) AS triw1,isnull( a.triw2_sempurna,0) AS triw2,isnull( a.triw3_sempurna,0) 
                                AS triw3,isnull( a.triw4_sempurna,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triwa1 = number_format($triw1,2,',','.');
        $triwa2= number_format($triw2,2,',','.');
        $triwa3= number_format($triw3,2,',','.');
        $triwa4= number_format($triw4,2,',','.');
        $totala = number_format($total,2,',','.');

     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;border-left: solid 1px black;font-size:10 px;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"4\">";

                             $cRet .=" 
                                            <tr>
                                                <td width=\"70%\" colspan=\"2\">
                                                <td width=\"30%\" align=\"center\">
                                            </tr>

                                            <tr>

                                                <td width=\"15%\" align=\"left\" valign=\"top\">
                                                    <br>Rencana Penarikan Dana per Triwulan
                                                    <br>
                                                    <br>Triwulan I
                                                    <br>Triwulan II
                                                    <br>Triwulan III
                                                    <br>Triwulan IV
                                                    <br>
                                                    <br>Jumlah
                                                </td>

                                                <td width=\"35%\" align=\"left\" valign=\"top\">
                                                    <br> <br> 
                                                    <br>: $triwa1
                                                    <br>: $triwa2
                                                    <br>: $triwa3
                                                    <br>: <u>$triwa4&nbsp;&nbsp;</u>+
                                                    <br>
                                                    <br>&nbsp;$totala
                                                </td>
                                                <td width=\"30%\" align=\"center\">
                                                <br><br><br><br><br><br><br><br><br>
												<br>$daerah, $tanggaltt <br>
                                                $jdlnip1   
                                                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1
                                                </td>
                                            </tr>  
                                </table>";                                       
        $cRet    .= "</table>"; 


      

        
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-1 Pergeseran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',3);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-1-pergeseran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

function ctk_dppa21_sempurna(){
        $data['page_title']= 'Cetak DPA 2.1 Pergeseran';
        $this->template->set('title', 'Cetak DPA 2.1 Pergeseran');   
        $this->template->load('template','anggaran/rka/ctk_dppa21_sempurna',$data) ; 
    }


        function preview_dppa21_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        
        $nm_perangkat_daerah_kap ='SATUAN KERJA PERANGKAT DAERAH';
        $nm_perangkat_daerah ='Satuan Kerja Perangkat Daerah';
        $nm_perangkat_daerah_singkat ='SKPD';
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $tglt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1); 
        $ttd2 = str_replace('a',' ',$ttd2);        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' and kode='agr' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan1 = str_replace('PENGGUNA','',$jabatan1);
                    $jabatan1 = str_replace('ANGGARAN','',$jabatan1);
                    $jabatan1 = str_replace('Pengguna','',$jabatan1);
                    $jabatan1 = str_replace('Anggaran','',$jabatan1);
 
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2' and kode='agr'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan2 = str_replace('PENGGUNA','',$jabatan2);
                    $jabatan2 = str_replace('ANGGARAN','',$jabatan2);

                    $jabatan2 = str_replace('Pengguna','',$jabatan2);
                    $jabatan2 = str_replace('Anggaran','',$jabatan2);
 
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td colspan=\"2\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN<br>$nm_perangkat_daerah_kap</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA $nm_perangkat_daerah_singkat</strong></td>
                         <td colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"6\" align=\"center\"><strong>FORMULIR <br>DPA - $nm_perangkat_daerah_singkat <br>2.1</strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " ";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"left\"><strong>Latar belakang pergeseran/dianggarkan dalam pergeseran APBD</strong></td>
                    </tr>          
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pergeseran Belanja Tidak Langsung $nm_perangkat_daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >

                     <tr>
                        <td rowspan=\"3\"  width=\"5%\" align=\"center\"><b>KODE REKENING</b></td>                            
                        <td rowspan=\"3\"  width=\"21%\" align=\"center\"><b>Uraian</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Setelah Pergeseran</b></td>
                        <td colspan=\"2\"  width=\"15%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                     </tr>
                        <tr>
                            <td colspan=\"3\" width=\"19%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"3\" width=\"19%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"10%\" align=\"center\">(Rp.)</td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"5%\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
                            
                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10-6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"12\"></td>
                         </tr>
                     </tfoot>   
                        ";
/*
                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id a";
*/

            IF ($id == 'ppkd'){                    
                $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,                         
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan, 
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_sempurna1 AS volume_sempurna1,
                            a.satuan1 AS satuan,
                            a.satuan_sempurna1 AS satuan_sempurna1,
                            a.harga1  AS harga,
                            a.harga_sempurna1 AS harga_sempurna1,
                            a.total AS nilai,
                            a.total_sempurna AS nilai_sempurna,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            '' AS satuan,
                            '' AS satuan_sempurna,
                            0  AS harga,
                            0 AS harga_sempurna,
                            a.total AS nilai,
                            a.total_sempurna AS nilai_sempurna,
                            '6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002'
                            ) 
                        a ORDER BY a.rek1,a.id";
            }else{
                if($id == 'ppkd1'){
                    $sql1="SELECT * FROM(
                            SELECT
                                0 header,
                                0 no_po,
                                LEFT (a.kd_rek5, 1) AS rek1,
                                LEFT (a.kd_rek5, 1) AS rek,
                                b.nm_rek1 AS nama,
                                0 AS volume,
                                0 as volume_sempurna,
                                ' ' AS satuan,
                                ' ' AS satuan_sempurna,
                                0 AS harga,
                                0 AS harga_sempurna,
                                SUM (a.nilai) AS nilai,
                                SUM (a.nilai_sempurna) AS nilai_sempurna,
                                '1' AS id
                            FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT
                0 header,
                0 no_po,
                LEFT (a.kd_rek5, 2) AS rek1,
                LEFT (a.kd_rek5, 2) AS rek,
                b.nm_rek2 AS nama,
                0 AS volume,
                0 AS volume_sempurna,
                ' ' AS satuan,
                ' ' AS satuan_sempurna,
                0 AS harga,
                0 AS harga_sempurna,
                SUM (a.nilai) AS nilai,
                SUM (a.nilai_sempurna) AS nilai_sempurna,
                '2' AS id
                            FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT
                    0 header,
                    0 no_po,
                    LEFT (a.kd_rek5, 3) AS rek1,
                    LEFT (a.kd_rek5, 3) AS rek,
                    b.nm_rek3 AS nama,
                    0 AS volume,
                    0 AS volume_sempurna,
                    ' ' AS satuan,
                    ' ' AS satuan_sempurna,
                    0 AS harga,
                    0 AS harga_sempurna,
                    SUM (a.nilai) AS nilai,
                    SUM (a.nilai_sempurna) AS nilai_sempurna,
                    '3' AS id           
                            FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT
                        0 header,
                        0 no_po,
                        LEFT (a.kd_rek5, 5) AS rek1,
                        LEFT (a.kd_rek5, 5) AS rek,
                        b.nm_rek4 AS nama,
                        0 AS volume,
                        0 AS volume_sempurna,
                        ' ' AS satuan,
                        ' ' AS satuan_sempurna,
                        0 AS harga,
                        0 AS harga_sempurna,
                        SUM (a.nilai) AS nilai,
                        SUM (a.nilai_sempurna) AS nilai_sempurna,
                        '4' AS id
                    
                            FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                        SELECT
                            0 header,
                            0 no_po,
                            a.kd_rek5 AS rek1,
                            a.kd_rek5 AS rek,
                            b.nm_rek5 AS nama,
                            0 AS volume,
                            0 AS volume_sempurna,
                            ' ' AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM (a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '5' AS id
                                                    


                            FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
                            union all
                            
                            SELECT * FROM (SELECT
                                        b.header,
                                        b.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        ' ' AS rek,
                                        b.uraian AS nama,
                                        0 AS volume,
                                        0 AS volume_sempurna,
                                        ' ' AS satuan,
                                        ' ' AS satuan_sempurna,
                                        0 AS harga,
                                        0 AS harga_sempurna,
                                        SUM (a.total) AS nilai,
                                        SUM (a.total_sempurna) AS nilai_sempurna,
                                        '6' AS id
                                    
                            FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,6)='00.002' and substring(a.no_trdrka,34,3) not in ('514','515')
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        
                            UNION ALL 
                            SELECT
                                    0 header,
                                    a.no_urut [no_po],
                                    RIGHT (a.no_trdrka, 7) AS rek1,
                                    '' AS rek,
                                    a.penerima + ' ,alamat:' + a.alamat AS nama,
                                    0 AS volume,
                                    0 AS volume_sempurna,
                                    '' AS satuan,
                                    '' AS satuan_sempurna,
                                    0 AS harga,
                                    0 AS harga_sempurna,
                                    a.total AS nilai,
                                    a.total_sempurna AS nilai_sempurna,
                                    '6' AS id
                                
                            FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) in ('514','515')
                            union all
                            SELECT
                                        a.header,
                                        a.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        '' AS rek,
                                        a.uraian AS nama,
                                        a.volume1 AS volume,
                                        a.volume_sempurna1 AS volume_sempurna1,
                                        a.satuan1 AS satuan,
                                        a.satuan_sempurna1 AS satuan_sempurna1,
                                        a.harga1 AS harga,
                                        a.harga_sempurna1 AS harga_sempurna1,
                                        a.total AS nilai,
                                        a.total_sempurna AS nilai_sempurna,
                                        '6' AS id
                                    
                            
                            FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) not in ('514','515') 
                            ) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
                }else{
                    $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan,
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_sempurna,
                            ' 'AS satuan, 
                            ' ' AS satuan_sempurna,
                            0 AS harga,
                            0 AS harga_sempurna,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_sempurna) AS nilai_sempurna,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_sempurna1 AS volume_sempurna1,
                            a.satuan1 AS satuan,
                            a.satuan_sempurna1 AS satuan_sempurna1,
                            a.harga1  AS harga,
                            a.harga_sempurna1 AS harga_sempurna1,
                            a.total AS nilai,
                            a.total_sempurna AS nilai_sempurna,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' ) 
                        a ORDER BY a.rek1,a.id";
                }
            }       

                $totp = 0;
                $totps = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                        $volume_sempurna=$row->volume_sempurna;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                        $volume_sempurna=' ';
                    }
                    
                    if ($reke<>''){
                        $volum='';
                        $volume_sempurna='';
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                        $volume_sempurna=empty($row->volume_sempurna) || $row->volume_sempurna == 0 ? '' :number_format($row->volume_sempurna,2,',','.');
                    }
                    
                    $sat=$row->satuan;
                    $satuan_sempurna=$row->satuan_sempurna;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $hrg_sempurna= empty($row->harga_sempurna) || $row->harga_sempurna == 0 ? '' :number_format($row->harga_sempurna,2,',','.');
                    $nil_ = $row->nilai;
                    $nil_se_ = $row->nilai_sempurna;
                    $nila= number_format($row->nilai,"2",",",".");
                    $nilai_sempurna= number_format($row->nilai_sempurna,"2",",",".");
                    
                    $ab = $nil_se_ - $nil_;
                    $jml1 = $this->rp_minus($ab);
                    
                    if($nil_ != 0 AND $nil_se_ !=0){
                        $persen = (($nil_se_-$nil_)/$nil_)*100;
                        $persen1 = $this->rp_minus($persen);
                    }else if($nil_ == 0 AND $nil_se_ ==0){
                        $persen = 0;
                        $persen1 = $this->rp_minus($persen);
                    } else {
                        $persen = 100;
                        $persen1 = $this->rp_minus($persen);
                    }
                    
                    
                    
                    if (strlen($row->rek1)==2){
                       $totp = $totp + $row->nilai;
                       $totps = $totps + $row->nilai_sempurna;
                    }
                    
                    

                    
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" > $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volume_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$satuan_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nilai_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$jml1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$satuan_sempurna</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg_sempurna</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nilai_sempurna</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jml1</strong></td>
                                      <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persen1</strong></td>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     
                                     </tr>
                                     ";
                    
                }


                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                             </tr>";
      

                   $totp= number_format($totp,"2",",",".");
                   $totps= number_format($totps,"2",",",".");
                   
    $qtriw = "SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_sempurna,0) AS triwa1,isnull( a.triw2_sempurna,0) AS triwa2,isnull( a.triw3_sempurna,0) AS triwa3,isnull( a.triw4_sempurna,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,6)='00.002' AND $a$skpd$b='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id'";

        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
                            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
                            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
                            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
            $triwa3= 0;
            $triwa4= 0;
            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
        $triwa3= number_format($triwa3,2,',','.');
        $triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totps</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
                    //$tanggaltt = $this->tanggal_format_indonesia($tglt);
                    $tanggaltt = $this->tukd_model->tanggal_format_indonesia($tglt);
                    $cRet .="   <tr>
                                    <td  width=\"100%\" align=\"left\" colspan=\"12\">
                                        <table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\"><br>Rencana Penarikan Dana per Triwulan
                                                <td width=\"40%\" align=\"center\"><br>$daerah, $tanggaltt
                                            </tr>
                                            <tr>
                                                <td width=\"10%\" align=\"left\">Triwulan I<br>
                                                    Triwulan II<br>
                                                    Triwulan III<br>
                                                    Triwulan IV<br>
                                                    <br> 
                                                    Total<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\">: Rp $triwa1<br>
                                                    : Rp $triwa2<br>
                                                    : Rp $triwa3<br>
                                                    : <u>Rp $triwa4&nbsp;&nbsp;</u>+<br>
                                                    <br> 
                                                    : Rp $totala<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\">$jdlnip1  
                                                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1 
                                                </td>
                                            </tr>
                                        </table>
                                    </td>       
                                </tr></table>";



        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-21-Pergeseran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-21-Pergeseran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }



function ctk_dppa22_sempurna(){
        $data['page_title']= 'Cetak DPA 2 Pergeseran';
        $this->template->set('title', 'Cetak DPA 2 Pergeseran');   
        $this->template->load('template','anggaran/rka/ctk_dppa22_sempurna',$data) ; 
    }
    
      function preview_dppa22_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        $nm_perangkat_daerah_kap ='SATUAN KERJA PERANGKAT DAERAH';
        $nm_perangkat_daerah ='Satuan Kerja Perangkat Daerah';
        $nm_perangkat_daerah_singkat ='SKPD';
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $tgltt= $_REQUEST['tgl_ttd'];

        $ttd1 = str_replace('a',' ',$ttd1); 
        $ttd2 = str_replace('a',' ',$ttd2);     
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' and kode='agr' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;

                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                    $jabatan2 = str_replace('PENGGUNA','',$jabatan2);
                    $jabatan2 = str_replace('ANGGARAN','',$jabatan2);
                    $jabatan2 = str_replace('KUASA','',$jabatan2);


                    $jabatan2 = str_replace('Pengguna','',$jabatan2);
                    $jabatan2 = str_replace('Anggaran','',$jabatan2);
                    $jabatan2 = str_replace('Kuasa','',$jabatan2);

                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        


     
        
        $cRet='';

     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"66%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN <br>$nm_perangkat_daerah_kap</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPA - $nm_perangkat_daerah_singkat<br>2</strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>";        

      


       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td > <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA LANGSUNG BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }else{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr>
                            <td width=\"10%\" rowspan=\"2\" colspan=\"2\" align=\"center\"><b>Kode<br>Program/Kegiatan</b></td>  
                            <td width=\"25%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"11%\" rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                           
                            <td width=\"6%\"  rowspan=\"2\" colspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"22%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td width=\"15%\" colspan=\"2\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Sebelum Pergeseran</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Setelah Pergeseran</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">(Rp)</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">%</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\"  colspan=\"2\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>

                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" colspan=\"2\"  align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7 = 5-6</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8</td>
                         </tr>
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"10\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT 
                            a.kd_program AS prog,
                            a.kd_program AS prog1,
                            a.kd_program AS giat,
                            a.nm_program AS uraian,
                            ' ' AS lokasi,
                            ' ' AS target,
                            '' [sumber_dana],
                            isnull(sum(nilai),0) [susun],isnull(sum(nilai_sempurna),0) [nilai2]
                        FROM
                            trdrka x
                        LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
                        AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                            RIGHT (a.kd_program, 2) <> '00'
                        AND $a x.kd_skpd$b = left('$id',7)
                        GROUP BY
                            a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                                a.kd_program AS prog,
                                ' ' AS prog1,
                                a.kd_kegiatan AS giat,
                                a.nm_kegiatan AS uraian,
                                a.lokasi AS lokasi,
                                a.tk_kel_sempurna AS target,
                                isnull(x.sumber,'') [sumber_dana],
                                isnull(sum(nilai),0) [susun],isnull(sum(nilai_sempurna),0) [nilai2] 
                            FROM
                                trdrka x
                                LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
                            WHERE
                                RIGHT(a.kd_program,2)<>'00' AND
                                $a x.kd_skpd$b=left('$id',7)
                            GROUP BY
                                a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel_sempurna,a.triw1,a.triw2,a.triw3,a.triw4,x.sumber 
                                            ORDER BY prog,giat  
                        ";
  //echo($sql1);

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giat=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $nilai = $row->susun;
                    $nilai2 = $row->nilai2;
                    $selisih = $nilai2-$nilai;
                    if($nilai != 0){
                        $persen = (($nilai2-$nilai)/$nilai)*100;
                    }else{
                        $persen = 100;
                    } 
                    //iif(apbdsusun <> 0 ,((abs(apbdubah-apbdsusun))/apbdsusun)*100,100) 
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $totnilai = $totnilai +  $nilai;
                        $tnilai2 = $tnilai2 + $nilai2;
                        $tselisih = $tselisih + $selisih;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $nilai1 = number_format($nilai,2,',','.');
                    $nilai2a = number_format($nilai2,2,',','.');
                    $selisih = $this->rp_minus($selisih);
                    $persen = $this->rp_minus($persen);

                      $cRet    .= " <tr>                                 
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  colspan=\"2\" >$giat</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                  
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\" colspan=\"2\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai2a</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$persen</td>
                                    </tr> 
                                    
                                   
                                    ";
 
                }

                if($totnilai != 0){
                    $tpersen = (($tnilai2-$totnilai)/$totnilai)*100;
                }else{
                    $tpersen = 100;
                } 
 
                $totnilai = number_format($totnilai,2,',','.');
                $tnilai2 = number_format($tnilai2,2,',','.');
                $tselisih = $this->rp_minus($tselisih);
                $tpersen = $this->rp_minus($tpersen);
                
                 $cRet    .= " <tr >
                                    <td colspan=\"6\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totnilai</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tnilai2</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tselisih</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tpersen</td>
                                </tr>
                                 ";
            

 
//$tanggaltt = $this->tanggal_format_indonesia($tgltt);
$tanggaltt = $this->tukd_model->tanggal_format_indonesia($tgltt);


                             $cRet .="<tr>
                                        <td colspan=\"10\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"center\">$daerah, $tanggaltt</td>
                                                </tr>
                                                <tr>
                                                    <td align=\"center\" valign=\"top\">
                                                        <p></p>
                                                        
                                                        <br>
                                                        <br>
                                                        <br><b><ins></ins></b>
                                                        <br>
                                                        <br> 
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\" valign=\"top\">&nbsp;&nbsp;
                                                        &nbsp;&nbsp;&nbsp;
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b>&nbsp;&nbsp;&nbsp;&nbsp;</b>
                                                        <br>&nbsp;&nbsp;&nbsp;&nbsp;
                                                        <br>&nbsp;&nbsp;&nbsp;
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\">$jdlnip1  
                                                        <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><u>$nama1</u></b>
                                                        <br>$nip1 
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";


        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-2 Pergeseran</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-22-pergeseran.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

function dpa221_sempurna()
    {   
    $this->index2('0','ms_skpd','kd_skpd','nm_skpd','DPA 21 PERGESERAN','dpa221_sempurna','');
    }



    function daftar_kegiatan1_sempu($offset=0)
    {
        $id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
        
        $total_rows = $this->rka_model->get_count($id);
  
        // pagination        
 
        $config['base_url']     = site_url("rka/daftar_kegiatan1_sempurna/$id");
        $config['total_rows']   = $total_rows;
        $config['per_page']     = '10';
        $config['uri_segment']  = 3;
        $config['num_links']    = 5;
        $config['full_tag_open'] = '<ul class="page-navi">';
        $config['full_tag_close'] = '</ul>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="current">';
        $config['cur_tag_close'] = '</li>';
        $config['prev_link'] = '&lt;';
        $config['prev_tag_open'] = '<li>';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&gt;';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_link'] = 'Last';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['first_link'] = 'First';
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $limit                  = $config['per_page'];  
        $offset                 = $this->uri->segment(4);  
        $offset                 = ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
          
        if(empty($offset))  
        {  
            $offset=0;  
        }
    
        $data['list']       = $this->rka_model->getAll_sempurna($limit, $offset,$id);
        $data['num']        = $offset;
        $data['total_rows'] = $total_rows;
        $data['kode_skpd'] = $id;
        
                $this->pagination->initialize($config);
        
        $this->template->set('title', 'Master Data kegiatan');
        $this->template->load('template', 'anggaran/rka/list_dpa_sempurna', $data);
    }


    function preview_dpa221_sempurna(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $statttd = $this->uri->segment(6);
        $tang= $_REQUEST['tgl_ttd'];
        $tanggal = $this->tukd_model->tanggal_format_indonesia($tang);
        $tanggalhariini = date('d - M - Y');
        $ttdppkd=  str_replace('123456789',' ',$_REQUEST['ttd1']);
        $ttdpa= str_replace('123456789',' ',$_REQUEST['ttd2']);
        
        $nm_perangkat_daerah_kap ='SATUAN KERJA PERANGKAT DAERAH';
        $nm_perangkat_daerah ='Satuan Kerja Perangkat Daerah';
        $nm_perangkat_daerah_singkat ='SKPD';
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }

                $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($date);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        if($statttd==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdppkd' AND KODE='agr'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdpa'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
                
        $sqltp="SELECT SUM(nilai) AS totb,SUM(nilai_sempurna) AS totb_geser FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",",",".");
                   $totp_2  =number_format($rowb->totb_geser,"2",",",".");
                }        
        $cRet='';


        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.waktu_giat,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,
                a.tu_mas,a.tu_kel,a.tu_has,a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_sempurna,a.tu_mas_sempurna,a.tu_kel_sempurna,a.tu_has_sempurna,
                a.tk_capai_sempurna,a.tk_mas_sempurna,a.tk_kel_sempurna,a.tk_has_sempurna,a.lokasi,d.sumber,a.ang_lalu FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd,f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_sempurna,a.tu_mas_sempurna,a.tu_kel_sempurna,a.tu_has_sempurna,
                a.tk_capai_sempurna,a.tk_mas_sempurna,a.tk_kel_sempurna,a.tk_has_sempurna,a.waktu_giat,d.sumber,a.ang_lalu";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tk_has  = $roworg->tk_has;
                    $tu_capai= $roworg->tu_capai;
                    $tu_mas = $roworg->tu_mas;
                    $tu_kel = $roworg->tu_kel;
                    $tu_has = $roworg->tu_has;
                    $tk_capai = $roworg->tk_capai;
                    $tk_mas = $roworg->tk_mas;
                    $tk_kel = $roworg->tk_kel;
                    $tk_has_sempurna  = $roworg->tk_has_sempurna;
                    $tu_capai_sempurna= $roworg->tu_capai_sempurna;
                    $tu_mas_sempurna = $roworg->tu_mas_sempurna;
                    $tu_has_sempurna = $roworg->tu_has_sempurna;
                    $tu_kel_sempurna = $roworg->tu_kel_sempurna;
                    $tk_capai_sempurna = $roworg->tk_capai_sempurna;
                    $tk_mas_sempurna = $roworg->tk_mas_sempurna;
                    $tk_kel_sempurna = $roworg->tk_kel_sempurna;
                    $org = substr($kd_skpd,0,7);
                    $waktu_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;
                    $ang_lalu=$roworg->ang_lalu;
                    
                }
                $ang_lalu  =number_format($ang_lalu,"2",",",".");
        
        $k2 = substr($id,0,7);
        $k3 = substr($kd_prog,-2,2);
        $k4 = substr($kd_giat,19,3);
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN</strong></td>
                         <td colspan=\"6\" align=\"center\"><strong>NOMOR DPA $nm_perangkat_daerah_singkat</strong></td>
                         <td rowspan=\"4\" colspan=\"3\" align=\"center\"><strong>&nbsp;<br>FORMULIR<br>DPA - $nm_perangkat_daerah_singkat<br>2.1</strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>$nm_perangkat_daerah_kap</strong></td>
                         <td align=\"center\">$kd_urusan</td>
                         <td align=\"center\">$k2</td>
                         <td align=\"center\">$k3</td>
                         <td align=\"center\">$k4</td>
                         <td colspan=\"2\" align=\"center\">5</td>
                      
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Urusan Pemerintahan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_urusan - $nm_urusan</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Organisasi</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$org - $nm_org</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Program</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_prog - $nm_prog</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_giat - $nm_giat<br></td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Lokasi Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$lokasi</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n-1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;Rp. $ang_lalu</td>
                         </tr>     
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n 1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;Rp. $totp_2</td>
                         </tr>  
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n+1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp; </td>
                         </tr>  
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Waktu Pelaksanaan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$waktu_giat</td>
                         </tr>                             
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;\" align=\"left\">Sumber Dana</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;\" align=\"left\">:&nbsp;$sumber</td>
                         </tr>
                        
                    ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>
                 </table>";


        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                <thead>                       
                        <tr><td rowspan=\"2\" colspan=\"2\" width=\"20%\" align=\"center\"><b>Indikator</b></td>                            
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Tolak Ukur Kerja </b></td>
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Target Kinerja</b></td>
                        </tr>
                        <tr>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Pergeseran</b></td>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Pergeseran</b></td>                            
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Dampak Sasaran</td> 
                            <td colspan=\"3\" align=\"center\">$tu_capai</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai</td>
                            <td colspan=\"3\" align=\"center\">$tu_capai_sempurna</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai_sempurna</td>
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Hasil Program</td>
                            <td colspan=\"3\" align=\"center\">$tu_has</td>
                            <td colspan=\"2\" align=\"center\">$tk_has</td>
                            <td colspan=\"3\" align=\"center\">$tu_has_sempurna</td>
                            <td colspan=\"2\" align=\"center\">$tk_has_sempurna</td>
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Keluaran Kegiatan</td>
                            <td colspan=\"3\" align=\"center\">$tu_kel</td>
                            <td colspan=\"2\" align=\"center\">$tk_kel</td>
                            <td colspan=\"3\" align=\"center\">$tu_kel_sempurna</td>
                            <td colspan=\"2\" align=\"center\">$tk_kel_sempurna</td>
                        </tr>  
                     </thead>
                ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"12\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERGESERAN ANGGARAN BELANJA LANGSUNG<br>PROGRAM DAN PERKEGIATAN $nm_perangkat_daerah_kap</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Setelah Pergeseran</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">12</td>                        
                        </tr> 
                     </thead>

                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_sempurna),0) AS nilai_u,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE /*( a.nilai != 0) and */a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_sempurna),0) AS nilai_u,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE /*( a.nilai != 0) and */a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_sempurna),0) AS nilai_u,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE /*( a.nilai != 0) and */a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_sempurna),0) AS nilai_u,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE /*( a.nilai != 0) and */a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_sempurna),0) AS nilai_u,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE /*( a.nilai != 0) and */a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume_u,' ' AS satuan_u, 0 AS harga_u,isnull(SUM(a.total_sempurna),0) AS nilai_u,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' 
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume_u,a.satuan_sempurna1 AS satuan_u, a.harga_sempurna1 AS harga_u,
                        a.total_sempurna AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null) /*and (a.total_sempurna != 0 or total !=0)*/
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
               //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.'); 
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    $volum_u= empty($row->volume_u) || $row->volume_u == 0 ? '' :number_format($row->volume_u,2,',','.');                   
                    $nila= number_format($row->nilai,"2",".",",");                    
               //     $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;\" align=\"right\">&nbsp;</td>
                                                                  </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_sempurna) as totp_u FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>
                                </tr>";
                 }                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Penarikan Dana per Triwulan</td>
                            </tr>";
                 
               
                          
        $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1_sempurna AS triw1,triw2_sempurna AS triw2,triw3_sempurna AS triw3,triw4_sempurna AS triw4 
				,(triw1_sempurna+triw2_sempurna+triw3_sempurna+triw4_sempurna) AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
        $qtriw1=$this->db->query($qtriw);
                 foreach ($qtriw1->result() as $rowtriw)
                {
                    $resttriw1= empty($rowtriw->triw1) || $rowtriw->triw1 == 0 ? '' :number_format($rowtriw->triw1,2,',','.');
                    $resttriw2= empty($rowtriw->triw2) || $rowtriw->triw2 == 0 ? '' :number_format($rowtriw->triw2,2,',','.');
                    $resttriw3= empty($rowtriw->triw3) || $rowtriw->triw3 == 0 ? '' :number_format($rowtriw->triw3,2,',','.');
                    $resttriw4= empty($rowtriw->triw4) || $rowtriw->triw4 == 0 ? '' :number_format($rowtriw->triw4,2,',','.');                    
                    $resttriw5= empty($rowtriw->jumlah) || $rowtriw->jumlah == 0 ? '' :number_format($rowtriw->jumlah,2,',','.');                    
                }


               $cRet .="<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">
                                <table border=\"0\">
                                <tr>
                                <td width=\"150px\" align=\"left\">&nbsp;<br>
                                &nbsp;<br>
                                Triwulan I<br>
                                Triwulan II<br>
                                Triwulan III<br>
                                Triwulan IV <br>
                                &nbsp;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah    
                                </td>
                                <td width=\"100px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                Rp<br>
                                &nbsp;<br>
                                Rp  
                                </td>
                                <td width=\"200px\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                $resttriw1<br>
                                $resttriw2<br>
                                $resttriw3<br>
                                $resttriw4<br>
                                ---------------------------------------------<br>
                                $resttriw5                          
                                </td>
                                <td width=\"650px\"  colspan=\"3\" align=\"right\">&nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                <br>
                                &nbsp;  
                                </td>
                                <td width=\"400px\" colspan=\"3\" align=\"center\">
                                $daerah, $tanggal 
                                <br>
                                Mengesahkan,
                                <br>
                                $jabatan
                                &nbsp;<br>
                                <br><br><br>&nbsp;
                                <u>$nama</u><br>
                                NIP.$nip
                                </td>
                              <td>&nbsp;</td>
                              </tr>
                              </table></td></tr>
                                ";
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 0;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221-$nm_giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 3;
             $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'1');
        break;
        
        }
        
                
    }

    function cs_kegi_sempurna($skpd) {
        //$skpd   = $this->input->post('skpd');
        $sql = "select kd_kegiatan,''nm_kegiatan from trdrka where  left(kd_skpd,7)=left('$skpd',7) 
                group by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan']  
                        );
                        $ii++;
        }
           
        echo json_encode($result);
            $query1->free_result();
    }

function cetak_anggaran_kas_sempurna($skpd='',$cetak=''){
        $data['page_title']= 'ANGGARAN KAS PENYEMPURNAAN';
        $this->template->set('title', 'ANGGARAN KAS PENYEMPURNAAN');   
        $this->template->load('template','anggaran/rka/cetak_anggaran_kas_sempurna',$data) ; 
    }

   function preview_anggaran_kas_sempurna($skpd='',$cetak=0){
        
       $cell = $this->uri->segment(5);
       $ang_t=0;
       $jan_t=0;
       $feb_t=0;
       $mar_t=0;
       $apr_t=0;
       $mei_t=0;
       $jun_t=0;
       $jul_t=0;
       $ags_t=0;
       $sep_t=0;
       $okt_t=0;
       $nov_t=0;
       $des_t=0;
       
       $jtriw1=0;
       $jtriw2=0;
       $jtriw3=0;
       $jtriw4=0;
       
       
       $id     = $skpd;
            $qrskpd = $this->db->query("select upper(nm_skpd) as cnmskpd from ms_skpd where kd_skpd='$id'");

       $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $ttd1 = str_replace('a',' ',$ttd1);
        $ttd2 = str_replace('a',' ',$ttd2);
       $tgl= $_REQUEST['tgl_ttd'];
       $tanggalttd = $this->tanggal_format_indonesia($tgl);
       
       foreach( $qrskpd->result() as $qrskpd ){
            $nmskpd = $qrskpd->cnmskpd; 
       }
        
        
       $qrorg = $this->db->query("select kd_org,nm_org from ms_organisasi where left(kd_org,7)=left('$id',7)");
       
       foreach( $qrorg->result() as $qrorg ){
            $kd_org = $qrorg->kd_org;
            $nm_org = $qrorg->nm_org;
             
       }

       
       $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang,daerah FROM sclient where kd_skpd='4.02.02.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                    $kota =  $rowsc->daerah;
                }
        

       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }
        
         if ($ttd2<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
        
        $cRet='<META http-equiv="X-UA-Compatible" content="IE=8"/>';
        $cRet1='';
        $cRet2='';
      
            $cRet .="<table style=\"border-collapse:collapse;font-size:20px;font-weight:bold;\" width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td align=\"center\">$kab</td>
                             
                        </tr>
                         <tr>
                             <td align=\"center\">ANGGARAN KAS PENGELUARAN</td>
                        </tr>
                        
                        <tr>
                             <td align=\"center\">TAHUN ANGGARAN $thn</td>
                        </tr>
    
                        <tr>
                             <td>&nbsp;</td>
                        </tr>
                   </table>";  

        if($id!=0){
            
            $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:12px;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td width=\"10%\" >Organisasi</td>
                             <td width=\"2%\">:</td>
                             <td width=\"88%\">$kd_org - $nm_org</td>
                        </tr>
    
                        <tr>
                             <td>Sub Unit Organisasi</td>
                             <td>:</td>
                             <td>$skpd - $nmskpd</td>
                        </tr>
                        <tr>
                            <td colspan=\"3\">&nbsp;</td>
                        </tr>
                    </table>";  
        }

        $font = 8;
        $font1 = $font-1;
        $nttriw = 'trdskpd';
        $nilai = 'nilai_sempurna';
        $cRet .= "<table style=\"border-collapse:collapse; font-size=$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead>                       
                        <tr>
                            <td rowspan=\"2\" width=\"9%\" align=\"center\"><b>Kode</b></td>                            
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Uraian</b></td>                            
                            <td rowspan=\"2\" width=\"8%\" align=\"center\"><b>Jumlah <br>(Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan I (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan II (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan III (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan IV (Rp.)</b></td>
                            </tr>
                        <tr>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jan</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Feb</td>                             
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mar</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Apr</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mei</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jun</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jul</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Ags</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Sep</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Okt</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Nov</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Des</td>
                        </tr>
                        <tr>
                             <td  style=\"font-weight:bold;\" align=\"center\">1</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">2</td>                             
                             <td  style=\"font-weight:bold;\" align=\"center\">3</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">4</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">5</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">6</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">7</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">8</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">9</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">10</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">11</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">12</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">13</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">14</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">15</td>
                        </tr>    
                            
                     </thead>                    
                        <tr><td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>                            
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                        </tr>
                        <tfoot sytle=\"display:table-footer-group;\" border=\"1\">
                            <tr>
                                <td colspan=\"15\"></td> 
                            </tr>                 
                       </tfoot>
  
                        <tbody>
                        ";
                        
                                      
      
                // Pendapatan & Penerimaan Pendapatan
                // 0 = keseluruhan 
                if($id != 0){                             
                     $sql="SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and (right(b.kd_kegiatan,6)='00.001' or right(b.kd_kegiatan,6)='00.003')
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan ";
                }else{

                     $sql="select kd_skpd = case nm_kegiatan 
                            when 'Pendapatan' then '' 
                            when 'Penerimaan Pembiayaan' then 'BUD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Pendapatan' then '0.00.0.00.00.00.00.04' 
                            when 'Penerimaan Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,6)='00.001' or right(b.kd_kegiatan,6)='00.003' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            ) as c group by c.nm_kegiatan
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=12) AS des  
                            FROM trdrka b 
                            join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                            where (right(b.kd_kegiatan,6)='00.001' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                    
                }
                  $qtpend = $this->db->query($sql);
                  $num_rowpend = $qtpend->num_rows();
                    
                    
                    $ang_t=0;
                    $ang_tpend=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1pend = 0;
                    $jtriw2pend = 0;
                    $jtriw3pend = 0;
                    $jtriw4pend = 0;
                    
                    if ($num_rowpend>0){
                        foreach ($qtpend->result() as $row){
                            $cskpdcek = ($row->kd_skpd);
                            $kode = ($row->kd_kegiatan);
                            $nama=$row->nm_kegiatan;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            
                          if($cskpdcek=='' || $cskpdcek=='BUD'){                            
                                $ang_tpend=$ang_tpend+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1pend = $jtriw1pend + ($jan+$feb+$mar);
                                $jtriw2pend = $jtriw2pend + ($apr+$mei+$jun);
                                $jtriw3pend = $jtriw3pend + ($jul+$ags+$sep);
                                $jtriw4pend = $jtriw4pend + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }
                            
                            $ckode = substr($kode,-5);

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\" >$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pendapatan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowpend==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tpend,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
                    
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Pendapatan & Pembiayaan Penerimaan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1pend,2,',','.');
                    $jtriw2_t = number_format($jtriw2pend,2,',','.');
                    $jtriw3_t = number_format($jtriw3pend,2,',','.');
                    $jtriw4_t = number_format($jtriw4pend,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Alokasi Kas yang tersedia untuk pengeluran</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" >$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                                                     
                  
                  
                 //Belanja Tidak Langsung
                if($id==0){
                    $sql="select kd_skpd = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '' 
                            when 'Pengeluaran Pembiayaan' then 'BUD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '0.00.0.00.00.00.00.51' 
                            when 'Pengeluaran Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,6)='00.02' or  right(b.kd_kegiatan,5)='00.62') 
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            )as c group by c.nm_kegiatan                         
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.$nilai),0) [total],
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=1) AS jan,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=2) AS feb,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=3) AS mar,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=4) AS apr,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=5) AS mei,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=6) AS jun,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=7) AS jul,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=8) AS ags,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=9) AS sep,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=10) AS okt,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=11) AS nov,
                                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=12) AS des  
                                                    FROM trdrka b 
                                                    join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                                                    where (right(b.kd_kegiatan,6)='00.002') 
                                                    GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                }else{                    
                    $sql="SELECT '' kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                        FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and (right(b.kd_kegiatan,6)='00.002' or  right(b.kd_kegiatan,5)='00.62') 
                        GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan";
                }         
                  $qtbtl = $this->db->query($sql);
                  $num_rowbtl = $qtbtl->num_rows();
                    
                    
                    $ang_tbtl=0;
                    $ang_t=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1btl = 0;
                    $jtriw2btl = 0;
                    $jtriw3btl = 0;
                    $jtriw4btl = 0;
                    
                    
                    if ($num_rowbtl>0){
                        foreach ($qtbtl->result() as $row){
                            $cskpdcek = ltrim($row->kd_skpd);
                            $nama=$row->nm_kegiatan;
                            $kode = ($row->kd_kegiatan);
                            //$ang=$row->total;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            
                            if($cskpdcek=='' || $cskpdcek=='BUD'){ 
                                $ang_tbtl=$ang_tbtl+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1btl = $jtriw1btl + ($jan+$feb+$mar);
                                $jtriw2btl = $jtriw2btl + ($apr+$mei+$jun);
                                $jtriw3btl = $jtriw3btl + ($jul+$ags+$sep);
                                $jtriw4btl = $jtriw4btl + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\">$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Tidak Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowbtl==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tbtl,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
          
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Bulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1btl,2,',','.');
                    $jtriw2_t = number_format($jtriw2btl,2,',','.');
                    $jtriw3_t = number_format($jtriw3btl,2,',','.');
                    $jtriw4_t = number_format($jtriw4btl,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
                 
                //Sisa Kas BTL
                $ang_t = $this->rp_minus($ang_tpend - $ang_tbtl);
                $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1btl);
                $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2btl);
                $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3btl);
                $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4btl);

                $cRet    .= " <tr><td></td> 
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Sisa Kas setelah dikurangi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                            </tr>";                                                     
              
                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
            
                //BL
                if($id==0){
                    $where1 = '';
                }else{
                    $where1 = "left(b.kd_skpd,7)=left('$id',7) and ";
                }    
                $sql="  select kd_skpd,isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                        isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                        isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                            SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where $where1 SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan
                        ) c group by kd_skpd";
                    $qtbl = $this->db->query($sql);
                    $num_rowbl = $qtbl->num_rows();

                    $ang_tbl=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1bl = 0;
                    $jtriw2bl = 0;
                    $jtriw3bl = 0;
                    $jtriw4bl = 0;

                     
                    if($num_rowbl>0){
                        foreach ($qtbl->result() as $row){
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            $ang_tbl=$ang_tbl+$ang;
        
                            $jan_t=$jan_t+$jan;
                            $feb_t=$feb_t+$feb;
                            $mar_t=$mar_t+$mar;
        
                            $apr_t=$apr_t+$apr;
                            $mei_t=$mei_t+$mei;
                            $jun_t=$jun_t+$jun;
        
                            $jul_t=$jul_t+$jul;
                            $ags_t=$ags_t+$ags;
                            $sep_t=$sep_t+$sep;
        
                            $okt_t=$okt_t+$okt;
                            $nov_t=$nov_t+$nov;
                            $des_t=$des_t+$des;

                            $jtriw1bl = $jtriw1bl + ($jan+$feb+$mar);
                            $jtriw2bl = $jtriw2bl + ($apr+$mei+$jun);
                            $jtriw3bl = $jtriw3bl + ($jul+$ags+$sep);
                            $jtriw4bl = $jtriw4bl + ($okt+$nov+$des);
                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 



                            $cRet    .= "<tr><td></td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";
                         }                        
                    }else{
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                        
                    }
               
                 //rincian    
                 if($id==0){
                     $sql1="select * from(
                                select kd_skpd,kd_skpd [kd_kegiatan],nm_skpd [nm_kegiatan],isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c group by kd_skpd,nm_skpd
                            union all
                            select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                            isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                            isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                            union all
                            SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";                 
                 }else{
                     $sql1="select * from(
                                select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                                ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                                union all
                                SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";
                }                 
                $query = $this->db->query($sql1);

                    $ang_t=0;
                    $ang_t2=0;
                    $jan_t2=0;
                    $feb_t2=0;
                    $mar_t2=0;
                    $apr_t2=0;
                    $mei_t2=0;
                    $jun_t2=0;
                    $jul_t2=0;
                    $ags_t2=0;
                    $sep_t2=0;
                    $okt_t2=0;
                    $nov_t2=0;
                    $des_t2=0;
                    $jtriw1_t = 0;
                    $jtriw2_t = 0;
                    $jtriw3_t = 0;
                    $jtriw4_t = 0;

                                                                    
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan;
                    $nama=$row->nm_kegiatan;
                    
                    $jan=$row->jan;
                    $feb=$row->feb;
                    $mar=$row->mar;
                    $apr=$row->apr;
                    $mei=$row->mei;
                    $jun=$row->jun;
                    $jul=$row->jul;
                    $ags=$row->ags;
                    $sep=$row->sep;
                    $okt=$row->okt;
                    $nov=$row->nov;
                    $des=$row->des;
                    $ang = number_format($jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des,"2",",",".");
                   
                    if(strlen($kode)<=18){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size: '.$font1.' px;';
                    }else{
                        $bold='';
                        $fontr = 'font-size: '.$font.' px;';
                    }

                    $jan=number_format($jan,"2",",",".");
                    $feb=number_format($feb,"2",",",".");
                    $mar=number_format($mar,"2",",",".");
                    $apr=number_format($apr,"2",",",".");
                    $mei=number_format($mei,"2",",",".");
                    $jun=number_format($jun,"2",",",".");
                    $jul=number_format($jul,"2",",",".");
                    $ags=number_format($ags,"2",",",".");
                    $sep=number_format($sep,"2",",",".");
                    $okt=number_format($okt,"2",",",".");
                    $nov=number_format($nov,"2",",",".");
                    $des=number_format($des,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;$bold $fontr \" >$kode </td>                            
                                        <td style=\"vertical-align:top;$bold $fontr \" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$des</td>
                                    </tr>
                                     ";
                  }  
                  
                    $ang_t2=number_format($ang_tbl,"2",",",".");
                    $jan_t2=number_format($jan_t,"2",",",".");
                    $feb_t2=number_format($feb_t,"2",",",".");
                    $mar_t2=number_format($mar_t,"2",",",".");
                    $apr_t2=number_format($apr_t,"2",",",".");
                    $mei_t2=number_format($mei_t,"2",",",".");
                    $jun_t2=number_format($jun_t,"2",",",".");
                    $jul_t2=number_format($jul_t,"2",",",".");
                    $ags_t2=number_format($ags_t,"2",",",".");
                    $sep_t2=number_format($sep_t,"2",",",".");
                    $okt_t2=number_format($okt_t,"2",",",".");
                    $nov_t2=number_format($nov_t,"2",",",".");
                    $des_t2=number_format($des_t,"2",",",".");
                                      
                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Bulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t2</td>
                                    </tr>";
                                             
                    $jtriw1_t = number_format($jtriw1bl,2,',','.');
                    $jtriw2_t = number_format($jtriw2bl,2,',','.');
                    $jtriw3_t = number_format($jtriw3bl,2,',','.');
                    $jtriw4_t = number_format($jtriw4bl,2,',','.');

                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Triwulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                    </tr>";  

                  $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
        
                    //sisa kas bl
                    $ang_t = $this->rp_minus($ang_tpend - $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Langsung Per Triwulan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tbtl + $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1btl + $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2btl + $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3btl + $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4btl + $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tpend - ($ang_tbtl + $ang_tbl));
                    $jtriw1_t = $this->rp_minus($jtriw1pend - ($jtriw1btl + $jtriw1bl));
                    $jtriw2_t = $this->rp_minus($jtriw2pend - ($jtriw2btl + $jtriw2bl));
                    $jtriw3_t = $this->rp_minus($jtriw3pend - ($jtriw3btl + $jtriw3bl));
                    $jtriw4_t = $this->rp_minus($jtriw4pend - ($jtriw4btl + $jtriw4bl));
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  

 
 
            $cRet .="<tr>
                        <td colspan=\"15\" width=\"100%\">                          
                            <table border=\"0\" width=\"100%\">
                                <tr>                                
                                    <td width=\"30%\">&nbsp;</td>
                                    <td width=\"20%\" align=\"center\">Mengetahui
                                        <br>$jabatan2
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
                                        <br><b><u>$nama2</u></b>
                                        <br>$pangkat2 
                                        <br>$nip2 
                                    </td>                               
                                    <td width=\"30%\">&nbsp;</td>
                                    <td width=\"20%\" align=\"center\">$kota,$tanggalttd
                                        <br>$jabatan1
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
                                        <br><b><u>$nama1</u></b>
                                        <br>$pangkat1 
                                        <br>$nip1 
                                    </td>
                                </tr>
                            </table>
                        </td>
                 </tr>
                 </tbody>
                 
               ";
        
            
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        if ($id==0){
            $id = 'Keseluruhan'; 
        }
            $judul  = 'Anggaran_Kas_'.$id;//'Anggaran_KAS_'.$id;
        $this->template->set('title', 'CETAK PERDA REALISASI LAMPIRAN V');        
        switch($cetak) {
        case 0;  
                echo ("<title>A</title>");
                echo($cRet);
            break;
        case 1;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);

             $this->_mpdf('',$cRet,5,3,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);
            
            $this->_mpdf('',$cRet,5,3,10,'1','','',$judul);        

/*
        header ("Cache-Control: must-revalidate, post-check=0, pre-check=0");
        header('Content-Type: application/octetstream');
        header("Content-Transfer-Encoding: Binary");
        header("Content-length: ".filesize($data));
        header("Content-disposition: attachment; filename= $judul.pdf");
        readfile("$data");  
        break;
*/
        } 
    }
    
    function preview_anggaran_kas_sempurna_ro($skpd='',$cetak=0){

    	
        
       $cell = $this->uri->segment(5);
       $ang_t=0;
       $jan_t=0;
       $feb_t=0;
       $mar_t=0;
       $apr_t=0;
       $mei_t=0;
       $jun_t=0;
       $jul_t=0;
       $ags_t=0;
       $sep_t=0;
       $okt_t=0;
       $nov_t=0;
       $des_t=0;
       
       $jtriw1=0;
       $jtriw2=0;
       $jtriw3=0;
       $jtriw4=0;
       
       
       $id     = $skpd;
            $qrskpd = $this->db->query("select upper(nm_skpd) as cnmskpd from ms_skpd where kd_skpd='$id'");

       $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $ttd1 = str_replace('a',' ',$ttd1);
        $ttd2 = str_replace('a',' ',$ttd2);
       $tgl= $_REQUEST['tgl_ttd'];
       $tanggalttd = $this->tanggal_format_indonesia($tgl);
       
       foreach( $qrskpd->result() as $qrskpd ){
            $nmskpd = $qrskpd->cnmskpd; 
       }
        
        
       $qrorg = $this->db->query("select kd_org,nm_org from ms_organisasi where left(kd_org,7)=left('$id',7)");
       
       foreach( $qrorg->result() as $qrorg ){
            $kd_org = $qrorg->kd_org;
            $nm_org = $qrorg->nm_org;
             
       }

       
       $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang,daerah FROM sclient where kd_skpd='4.02.02.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                    $kota =  $rowsc->daerah;
                }
        

       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }
        
         if ($ttd2<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
            
         $kkd_program     = '';
         $knm_program     = '';
         $kkd_kegiatan    = '';
         $kkd_kegiatan1   = '';
         $knm_kegiatan    = '';
            
         $init_kegiatan = $_REQUEST['tgiat'];   
         $sqlsc = "select substring(b.kd_program,17,2) as kd_program,b.nm_program,substring(a.kd_kegiatan,20,3) as kd_kegiatan,a.kd_kegiatan as kd_kegiatan1,a.nm_kegiatan from m_giat a 
left join m_prog b on  b.kd_program = a.kd_program
left join trdskpd_ro c on c.kd_kegiatan = a.kd_kegiatan
where c.kd_kegiatan='$init_kegiatan'
group by b.kd_program,b.nm_program,a.kd_kegiatan,a.nm_kegiatan";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $kkd_program     = $rowsc->kd_program;
                    $knm_program     = $rowsc->nm_program;
                    $kkd_kegiatan    = $rowsc->kd_kegiatan;
                    $kkd_kegiatan1    = $rowsc->kd_kegiatan1;
                    $knm_kegiatan    = $rowsc->nm_kegiatan;
                }
        
        $cRet='<META http-equiv="X-UA-Compatible" content="IE=8"/>';
        $cRet1='';
        $cRet2='';
      
            $cRet .="<table style=\"border-collapse:collapse;font-size:20px;font-weight:bold;\" width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td align=\"center\">$kab</td>
                             
                        </tr>
                         <tr>
                             <td align=\"center\">ANGGARAN KAS PERGESERAN</td>
                        </tr>
                        
                        <tr>
                             <td align=\"center\">TAHUN ANGGARAN $thn</td>
                        </tr>
    
                        <tr>
                             <td>&nbsp;</td>
                        </tr>
                   </table>";  

        if($id!=0){
            
            $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:12px;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td width=\"10%\" >Organisasi</td>
                             <td width=\"2%\">:</td>
                             <td width=\"88%\">$kd_org - $nm_org</td>
                        </tr>
    
                        <tr>
                             <td>Unit Organisasi</td>
                             <td>:</td>
                             <td>$skpd - $nmskpd</td>
                        </tr>
                        <tr>
                             <td>Program</td>
                             <td>:</td>
                             <td>$kkd_program - $knm_program</td>
                        </tr>
                        <tr>
                             <td>Kegiatan</td>
                             <td>:</td>
                             <td>$kkd_kegiatan - $knm_kegiatan</td>
                        </tr>
                        <tr>
                            <td colspan=\"3\">&nbsp;</td>
                        </tr>
                    </table>";  
        }

        $font = 8;
        $font1 = $font-1;
        $nttriw = 'trdskpd_ro';
        $nilai = 'nilai_sempurna';
        $cRet .= "<table style=\"border-collapse:collapse; font-size=$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead>                       
                        <tr>
                            <td rowspan=\"2\" width=\"9%\" align=\"center\"><b>Kode</b></td>                            
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Uraian</b></td>                            
                            <td rowspan=\"2\" width=\"8%\" align=\"center\"><b>Jumlah <br>(Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan I (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan II (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan III (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan IV (Rp.)</b></td>
                            </tr>
                        <tr>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jan</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Feb</td>                             
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mar</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Apr</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mei</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jun</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jul</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Ags</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Sep</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Okt</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Nov</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Des</td>
                        </tr>
                        <tr>
                             <td  style=\"font-weight:bold;\" align=\"center\">1</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">2</td>                             
                             <td  style=\"font-weight:bold;\" align=\"center\">3</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">4</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">5</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">6</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">7</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">8</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">9</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">10</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">11</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">12</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">13</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">14</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">15</td>
                        </tr>    
                            
                     </thead>                    
                        <tr><td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>                            
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                        </tr>
                        <tfoot sytle=\"display:table-footer-group;\" border=\"1\">
                            <tr>
                                <td colspan=\"15\"></td> 
                            </tr>                 
                       </tfoot>
  
                        <tbody>
                        ";                     
            
                //BL
                
                if($id==0){
                    $where1 = '';
                }else{
                    $where1 = "left(b.kd_skpd,7)=left('$id',7) and ";
                }    
                $sql="  select kd_skpd,isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                        isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                        isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                            SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where $where1 b.kd_kegiatan='$kkd_kegiatan1'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan
                        ) c group by kd_skpd";
                    $qtbl = $this->db->query($sql);
                    $num_rowbl = $qtbl->num_rows();
                    //SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                    $ang_tbl=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1bl = 0;
                    $jtriw2bl = 0;
                    $jtriw3bl = 0;
                    $jtriw4bl = 0;

                     
                    //if($num_rowbl>0){
                        foreach ($qtbl->result() as $row){
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            $ang_tbl=$ang_tbl+$ang;
        
                            $jan_t=$jan_t+$jan;
                            $feb_t=$feb_t+$feb;
                            $mar_t=$mar_t+$mar;
        
                            $apr_t=$apr_t+$apr;
                            $mei_t=$mei_t+$mei;
                            $jun_t=$jun_t+$jun;
        
                            $jul_t=$jul_t+$jul;
                            $ags_t=$ags_t+$ags;
                            $sep_t=$sep_t+$sep;
        
                            $okt_t=$okt_t+$okt;
                            $nov_t=$nov_t+$nov;
                            $des_t=$des_t+$des;

                            $jtriw1bl = $jtriw1bl + ($jan+$feb+$mar);
                            $jtriw2bl = $jtriw2bl + ($apr+$mei+$jun);
                            $jtriw3bl = $jtriw3bl + ($jul+$ags+$sep);
                            $jtriw4bl = $jtriw4bl + ($okt+$nov+$des);
                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 

                    }               
               
                 //rincian program kegiatan  
                 if($id==0){
                     $sql1="select * from(
                                select kd_skpd,kd_skpd [kd_kegiatan],nm_skpd [nm_kegiatan],isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where 
                                    b.kd_kegiatan='$kkd_kegiatan1'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c group by kd_skpd,nm_skpd
                            union all
                            select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                            isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                            isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                FROM trdrka b where b.kd_kegiatan='$kkd_kegiatan1'
                                GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                            union all
                            SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where b.kd_kegiatan='$kkd_kegiatan1'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";                 
                 }else{
                     $sql1="select * from(
                                select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and b.kd_kegiatan='$kkd_kegiatan1'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                                ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                                union all
                                SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                        (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and b.kd_kegiatan='$kkd_kegiatan1'
                                    GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";
                }                 
                $query = $this->db->query($sql1);

                    $ang_t=0;
                    $ang_t2=0;
                    $jan_t2=0;
                    $feb_t2=0;
                    $mar_t2=0;
                    $apr_t2=0;
                    $mei_t2=0;
                    $jun_t2=0;
                    $jul_t2=0;
                    $ags_t2=0;
                    $sep_t2=0;
                    $okt_t2=0;
                    $nov_t2=0;
                    $des_t2=0;
                    $jtriw1_t = 0;
                    $jtriw2_t = 0;
                    $jtriw3_t = 0;
                    $jtriw4_t = 0;

                                                                    
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan;
                    $nama=$row->nm_kegiatan;
                    
                    $jan=$row->jan;
                    $feb=$row->feb;
                    $mar=$row->mar;
                    $apr=$row->apr;
                    $mei=$row->mei;
                    $jun=$row->jun;
                    $jul=$row->jul;
                    $ags=$row->ags;
                    $sep=$row->sep;
                    $okt=$row->okt;
                    $nov=$row->nov;
                    $des=$row->des;
                    $ang = number_format($jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des,"2",",",".");
                   
                    $jan=number_format($jan,"2",",",".");
                    $feb=number_format($feb,"2",",",".");
                    $mar=number_format($mar,"2",",",".");
                    $apr=number_format($apr,"2",",",".");
                    $mei=number_format($mei,"2",",",".");
                    $jun=number_format($jun,"2",",",".");
                    $jul=number_format($jul,"2",",",".");
                    $ags=number_format($ags,"2",",",".");
                    $sep=number_format($sep,"2",",",".");
                    $okt=number_format($okt,"2",",",".");
                    $nov=number_format($nov,"2",",",".");
                    $des=number_format($des,"2",",",".");
                   
                    if(strlen($kode)>18){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size: '.$font1.' px;';
                        
                        $cRet    .= " <tr><td style=\"vertical-align:top;$bold $fontr \" >$kode </td>                            
                                        <td style=\"vertical-align:top;$bold $fontr \" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$des</td>
                                    </tr>
                                     ";
                    }else{
                        $bold='';
                        $fontr = 'font-size: '.$font.' px;';
                    }
                    
                  }  
                  
                  //rincian program kegiatan  
                 if($id==0){
                     $sql1="select * from(
                                select kd_skpd,kd_skpd [kd_kegiatan],nm_skpd [nm_kegiatan],isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where b.kd_kegiatan='$kkd_kegiatan1'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c group by kd_skpd,nm_skpd
                            union all
                            select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                            isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                            isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                FROM trdrka b where b.kd_kegiatan='$kkd_kegiatan1'
                                GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                            union all
                            SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.$nilai),0) [total],
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where b.kd_kegiatan='$kkd_kegiatan1'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";                 
                 }else{
                     $sql1="select * from(
                                SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5,isnull(sum(b.$nilai),0) [total],
                                   (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=1) AS jan,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=2) AS feb,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=3) AS mar,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=4) AS apr,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=5) AS mei,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=6) AS jun,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=7) AS jul,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=8) AS ags,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=9) AS sep,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=10) AS okt,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=11) AS nov,
                                    (SELECT isnull(SUM($nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND kd_rek5=b.kd_rek5 AND bulan=12) AS des  
                                      FROM trdrka b where left(b.kd_skpd,7)=left('$id',7) and b.kd_kegiatan='$kkd_kegiatan1'
                                    GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,b.kd_rek5,b.nm_rek5 
                    ) as gab order by kd_skpd,kd_kegiatan,kd_rek5";
                }                 
                $query = $this->db->query($sql1);

                    $ang_t=0;
                    $ang_t2=0;
                    $jan_t2=0;
                    $feb_t2=0;
                    $mar_t2=0;
                    $apr_t2=0;
                    $mei_t2=0;
                    $jun_t2=0;
                    $jul_t2=0;
                    $ags_t2=0;
                    $sep_t2=0;
                    $okt_t2=0;
                    $nov_t2=0;
                    $des_t2=0;
                    $jtriw1_t = 0;
                    $jtriw2_t = 0;
                    $jtriw3_t = 0;
                    $jtriw4_t = 0;

                                                                    
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan.'.'.$row->kd_rek5;
                    $nama=$row->nm_rek5;
                    
                    $jan=$row->jan;
                    $feb=$row->feb;
                    $mar=$row->mar;
                    $apr=$row->apr;
                    $mei=$row->mei;
                    $jun=$row->jun;
                    $jul=$row->jul;
                    $ags=$row->ags;
                    $sep=$row->sep;
                    $okt=$row->okt;
                    $nov=$row->nov;
                    $des=$row->des;
                    $ang = number_format($jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des,"2",",",".");
                   
                    if(strlen($kode)<=18){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size: '.$font1.' px;';
                    }else{
                        $bold='';
                        $fontr = 'font-size: '.$font.' px;';
                    }

                    $jan=number_format($jan,"2",",",".");
                    $feb=number_format($feb,"2",",",".");
                    $mar=number_format($mar,"2",",",".");
                    $apr=number_format($apr,"2",",",".");
                    $mei=number_format($mei,"2",",",".");
                    $jun=number_format($jun,"2",",",".");
                    $jul=number_format($jul,"2",",",".");
                    $ags=number_format($ags,"2",",",".");
                    $sep=number_format($sep,"2",",",".");
                    $okt=number_format($okt,"2",",",".");
                    $nov=number_format($nov,"2",",",".");
                    $des=number_format($des,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;$bold $fontr \" >$kode </td>                            
                                        <td style=\"vertical-align:top;$bold $fontr \" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$des</td>
                                    </tr>
                                     ";
                  }
                  
                    $ang_t2=number_format($ang_tbl,"2",",",".");
                    $jan_t2=number_format($jan_t,"2",",",".");
                    $feb_t2=number_format($feb_t,"2",",",".");
                    $mar_t2=number_format($mar_t,"2",",",".");
                    $apr_t2=number_format($apr_t,"2",",",".");
                    $mei_t2=number_format($mei_t,"2",",",".");
                    $jun_t2=number_format($jun_t,"2",",",".");
                    $jul_t2=number_format($jul_t,"2",",",".");
                    $ags_t2=number_format($ags_t,"2",",",".");
                    $sep_t2=number_format($sep_t,"2",",",".");
                    $okt_t2=number_format($okt_t,"2",",",".");
                    $nov_t2=number_format($nov_t,"2",",",".");
                    $des_t2=number_format($des_t,"2",",",".");
                                      
                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Per Bulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t2</td>
                                    </tr>";
                                             
                    $jtriw1_t = number_format($jtriw1bl,2,',','.');
                    $jtriw2_t = number_format($jtriw2bl,2,',','.');
                    $jtriw3_t = number_format($jtriw3bl,2,',','.');
                    $jtriw4_t = number_format($jtriw4bl,2,',','.');

                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Per Triwulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"center\">$jtriw1_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"center\">$jtriw2_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"center\">$jtriw3_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"center\">$jtriw4_t</td>
                                    </tr>";  

                  $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
        
 
            $cRet .="<tr>
                        <td colspan=\"15\" width=\"100%\">                          
                            <table border=\"0\" width=\"100%\">
                                <tr>                                
                                    <td width=\"30%\">&nbsp;</td>
                                    <td width=\"20%\" align=\"center\">Mengetahui
                                        <br>$jabatan2
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
                                        <br><b><u>$nama2</u></b>
                                        <br>$pangkat2 
                                        <br>$nip2 
                                    </td>                               
                                    <td width=\"30%\">&nbsp;</td>
                                    <td width=\"20%\" align=\"center\">$kota,$tanggalttd
                                        <br>$jabatan1
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
                                        <br><b><u>$nama1</u></b>
                                        <br>$pangkat1 
                                        <br>$nip1 
                                    </td>
                                </tr>
                            </table>
                        </td>
                 </tr>
                 </tbody>
                 
               ";
        
            
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        if ($id==0){
            $id = 'Keseluruhan'; 
        }
            $judul  = 'Anggaran_Kas_'.$id;//'Anggaran_KAS_'.$id;
        $this->template->set('title', 'CETAK PERDA REALISASI LAMPIRAN V');        
        switch($cetak) {
        case 0;  
                echo ("<title>A</title>");
                echo($cRet);
            break;
        case 1;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);

             $this->_mpdf('',$cRet,5,3,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);
            
            $this->_mpdf('',$cRet,5,3,10,'1','','',$judul);        

/*
        header ("Cache-Control: must-revalidate, post-check=0, pre-check=0");
        header('Content-Type: application/octetstream');
        header("Content-Transfer-Encoding: Binary");
        header("Content-length: ".filesize($data));
        header("Content-disposition: attachment; filename= $judul.pdf");
        readfile("$data");  
        break;
*/
        } 
    }
    
    
    function pgiat_ubah($cskpd='') {
        
       
         

        $cskpdd = substr($cskpd,0,7);
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_skpd,a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,status_keg FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan=b.kd_kegiatan
                 where left(a.kd_skpd,7) ='$cskpdd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') )
                 order by a.kd_kegiatan";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd'  => $resulte['kd_skpd'],  
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'status_keg'   => $resulte['status_keg']
                        );
                        $ii++;
        }
        echo json_encode($result);   
    }   


         function ctk_dpa0_ubah(){
        $data['page_title']= 'Cetak DPPA 0 Perubahan';
        $this->template->set('title', 'Cetak DPPA 0 Perubahan');   
        $this->template->load('template','anggaran/rka/ctk_dpa0_ubah',$data) ; 
    }

    //dpa 0 ubah

    function preview_dpa0_ubah(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        $ttd1x= $this->uri->segment(8);
        $ttd2x= $this->uri->segment(10);
        $statttd= $this->uri->segment(9);
        $tgl2= $this->uri->segment(7);
        $ttd_tgl = $this->tukd_model->tanggal_format_indonesia($tgl2);
        //$ttd2= $_REQUEST['ttd2'];        
    
        
         $ttd1 = str_replace('x',' ',$ttd1x);
        $ttd2 = str_replace('x',' ',$ttd2x);

     /*   if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)=left('$id',7)";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }
      */  
        
        $sqldns="SELECT a.kd_org as kd_org,a.nm_org as nm_org,a.kd_urusan as kd_u,b.nm_urusan as nm_u FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_org,7)=left('$id',7)";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_org;
            $nm_skpd  = $rowdns->nm_org;
        }
            
         
        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                    
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


        if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
        $cRet='';
     $cRet .="<table colspan=\"7\" style=\"border-collapse:collapse;font-size:14;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"2\" style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                         <td colspan=\"4\" align=\"center\" style=\"border-collapse:collapse;border-bottom: solid 1px black\"><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN<br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td rowspan=\"2\" colspan=\"2\" style=\"border-collapse:collapse;font-size:14;border-left: solid 1px black;border-bottom: solid 1px black\" align=\"center\"><strong>FORMULIR<br>DPPA - SKPD<br></strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"4\" align=\"center\"><strong>PEMERINTAH KOTA PONTIANAK<br>TAHUN ANGGARAN $thn</td>
                    </tr>
                  
                    </table>

                  ";        
                  
                 
            $cRet .="<table style=\"border-collapse:collapse;font-size:10;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:11;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td >&nbsp;</td>
                        <td colspan=\"4\">&nbsp;</td>
                        <td colspan=\"2\">&nbsp;</td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td colspan=\"4\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                        <td colspan=\"2\">&nbsp;</td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td colspan=\"4\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                         <td colspan=\"2\">&nbsp;</td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi</stong></td>
                        <td colspan=\"4\"><strong>: $kd_skpd - $nm_skpd</stong></td>
                        <td colspan=\"2\">&nbsp;</td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                        <td colspan=\"4\">&nbsp;</td>
                        <td colspan=\"2\">&nbsp;</td>
                    </tr>
                    <tr>
                     <td colspan=\"7\" style=\"border-collapse:collapse;border-left:solid 1px black;border-top:solid 1px black;font-size:14\" align=\"center\"><b>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran<br>Satuan Kerja Perangkat Daerah</b></td>
                    </tr>

                </table>";
            
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\"> 
                     <thead>

                        <tr><td rowspan=\"2\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td colspan=\"2\" rowspan=\"2\" align=\"center\"><b>URAIAN</b></td>
                            <td colspan=\"2\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td colspan=\"2\" align=\"center\"><b>BERTAMBAH/BERKURANG</b></td>
                        </tr>
                        <tr><td align=\"center\"><b>SEBELUM PERUBAHAN</b></td>                            
                            <td align=\"center\"><b>SETELAH PERUBAHAN</b></td>
                            <td align=\"center\"><b>(Rp)</b></td>
                            <td align=\"center\"><b>%</b></td>
                        </tr>    
                         <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>1</strong></td>                            
                            <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>3</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>4</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>5</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>6</strong></td>

                         </tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td colspan=\"2\" style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,1)='4' and $a b.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$this->dotrek(rtrim($row->kd_rek));
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                    $coba3u= number_format($row->nilai_ubah,"2",",",".");

                    $n=$row->nilai;
                    $n_u=$row->nilai_ubah;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");


                    if(strlen($coba1)>3){                                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba1 </td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none;border-bottom: none;\" >$coba2</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$x1$persen1$y1</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><strong>$coba1</strong></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"><strong>$coba2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba3</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba3u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$n_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$persen1$y1</strong></td>
                                    </tr>";                        
                    }
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_ubah FROM trdrka  WHERE LEFT(kd_rek5,1)='4' and $a$skpd$b='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                   $coba4u=number_format($rowp->totp_ubah,"2",",",".");
                    $cob1=$rowp->totp;
                    $surplusx1=$rowp->totp;
                    $surplusx1u=$rowp->totp_ubah;

                    $totp_a=$rowp->totp;
                    $totpu_u=$rowp->totp_ubah;
                    $totp_s = $totpu_u - $totp_a;
                    if ($totp_s < 0){
                        $x1="("; $n_s=$totp_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totp_selisih = number_format($totp_s,"2",".",",");
                    if ($totp_a==0){
                        $per1totp=0;
                    }else{
                    $per1totp   = ($totp_s!=0)?($totp_s / $totp_a ) * 100:0;
                    }
                    $persen1totp = number_format($per1totp,"2",".",",");


                    if ($cob1!=0){                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba4</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba4u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totp$y1</strong></td></tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";
                    } 
                 }     

                 
         
         
               $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$this->dotrek(rtrim($row1->kd_rek));
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    $coba7u= number_format($row1->nilai_ubah,"2",",",".");

                    $n2=$row1->nilai;
                    $n2_u=$row1->nilai_ubah;
                    $n2_s = $n2_u - $n2;
                    if ($n2_s < 0){
                        $x1="("; $n2_s=$n2_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n2_selisih = number_format($n2_s,"2",".",",");
                    if ($n2==0){
                        $per1=0;
                    }else{
                    $per1   = ($n2_s!=0)?($n2_s / $n2 ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");

                    if(strlen($coba5)>3){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba5</td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: none ;border-bottom: none;\" >$coba6</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$n2_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$persen1$y1</td>
                                     </tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><strong>$coba5</strong></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" ><strong>$coba6</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$n2_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$persen1$y1</strong></td></tr>";                                                    
                    }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_ubah FROM trdrka WHERE (LEFT(kd_rek5,1)='5') and $a$skpd$b='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                   $coba8u=number_format($rowb->totb_ubah,"2",",",".");
                    $cob=$rowb->totb;
                    $surplusx=$rowb->totb;
                    $surplusxu=$rowb->totb_ubah;

                    $totb_a=$rowb->totb;
                    $totbu_u=$rowb->totb_ubah;
                    $totb_s = $totbu_u - $totb_a;
                    if ($totb_s < 0){
                        $x1="("; $totb_s=$totb_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totp_selisih = number_format($totb_s,"2",".",",");
                    if ($totb_a==0){
                        $per1totb=0;
                    }else{
                    $per1totb   = ($totb_s!=0)?($totb_s / $totb_a ) * 100:0;
                    }
                    $persen1totb = number_format($per1totb,"2",".",",");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\"><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba8</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$coba8u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totb$y1</strong></td>
                                </tr>";
                 } 
                  
                  $suplus=$surplusx1-$surplusx; 
                  if ($suplus < 0){
                    $x1="(";
                    $suplus=$suplus*-1;
                    $y1=")";}
                  else {
                    $x1="";
                    $y1="";}
                $surp=number_format($suplus,2,',','.'); 

                $suplusu=$surplusx1u-$surplusxu; 
                  if ($suplusu < 0){
                    $x1u="(";
                    $suplusu=$suplusu*-1;
                    $y1u=")";}
                  else {
                    $x1u="";
                    $y1u="";}
                 $surpu=number_format($suplusu,2,',','.');  


                    $totsurp_a=$suplus;
                    $totsurp_u=$suplusu;
                    $totsurp_s = $totsurp_u - $totsurp_a;
                    if ($totsurp_s < 0){
                        $x1="("; $totsurp_s=$totsurp_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totsurp_selisih = number_format($totsurp_s,"2",".",",");
                    if ($totsurp_a==0){
                        $per1totsurp=0;
                    }else{
                    $per1totsurp   = ($totsurp_s!=0)?($totsurp_s / $totsurp_a ) * 100:0;
                    }
                    $persen1totsurp = number_format($per1totsurp,"2",".",",");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\"  style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" ><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$surp$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1u$surpu$y1u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totsurp_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totsurp$y1</strong></td>
                                     </tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";

                    if ($id == 'ppkd'){
                        //PENERIMAAN PEMBIAYAAN
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     </tr>";
        
                       $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            $coba7u= number_format($row1->nilai_ubah,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpen = $row1->nilai;
                                $totpenu = $row1->nilai_ubah;
                            }

                    $totpen_a=$row1->nilai;
                    $totpen_u=$row1->nilai_ubah;
                    $totpen_s = $totpen_u - $totpen_a;
                    if ($totpen_s < 0){
                        $x1="("; $totpen_s=$totpen_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totpen_selisih = number_format($totpen_s,"2",".",",");
                    if ($totpen_a==0){
                        $per1totpen=0;
                    }else{
                    $per1totpen   = ($totpen_s!=0)?($totpen_s / $totpen_a ) * 100:0;
                    }
                    $persen1totpen = number_format($per1totpen,"2",".",",");
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7u</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$totpen_selisih$y1</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$persen1totpen$y1</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7</strong>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$coba7u</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$totpen_selisih$y1</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><strong>$x1$persen1totpen$y1</strong></td></tr>";                                                    
                            }
                        }
                    
                        $totpen1=number_format($totpen,"2",",",".");
                        $totpen1u=number_format($totpenu,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"><strong>JUMLAH PENERIMAAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totpen1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totpen1u</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$totpen_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$x1$persen1totpen$y1</strong></td></tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";                    

                        //PENGELUARAN PEMBIAYAAN
        
                        $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,6)='00.003') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=$this->dotrek(rtrim($row1->kd_rek));
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            $coba7u= number_format($row1->nilai_ubah,"2",",",".");
                            if (strlen($coba5)==1){
                                $totpeng = $row1->nilai;
                                 $totpengu = $row1->nilai_ubah;
                            }
                    $totpeng_a=$row1->nilai;
                    $totpeng_u=$row1->nilai_ubah;
                    $totpeng_s = $totpeng_u - $totpeng_a;
                    if ($totpeng_s < 0){
                        $x1="("; $totpeng_s=$totpeng_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totpeng_selisih = number_format($totpeng_s,"2",".",",");
                    if ($totpeng_a==0){
                        $per1totpeng=0;
                    }else{
                    $per1totpeng   = ($totpeng_s!=0)?($totpeng_s / $totpeng_a ) * 100:0;
                    }
                    $persen1totpeng = number_format($per1totpeng,"2",".",",");
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$coba5</td>                                     
                                             <td colspan=\"2\" style=\"vertical-align:top;border-top: none ;border-bottom: none;\" >$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$coba7u</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$totpeng_selisih$y1</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" align=\"right\">$x1$persen1totpeng$y1</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" ><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"  align=\"right\"><strong>$coba7</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"  align=\"right\"><strong>$coba7u</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"  align=\"right\"><strong>$x1$totpeng_selisih$y1</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"  align=\"right\"><strong>$x1$persen1totpeng$y1</strong></td></tr>";                                                    
                            }
                        }
                        
                        $jbiaya = $totpen - $totpeng;
                        $jbiayau = $totpenu - $totpengu;
                        
                         $jbiayax = $this->rp_minus($jbiaya);
                         $jbiayaux = $this->rp_minus($jbiayau);
                        

                    $totjbiaya_a=$jbiaya;
                    $totjbiaya_u=$jbiayau;
                    $totjbiaya_s = $totjbiaya_u - $totjbiaya_a;
                    if ($totjbiaya_s < 0){
                        $x1="("; $totjbiaya_s=$totjbiaya_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $totjbiaya_selisih = number_format($totjbiaya_s,"2",".",",");
                    if ($totjbiaya_a==0){
                        $per1totjbiaya=0;
                    }else{
                    $per1totjbiaya   = ($totjbiaya_s!=0)?($totjbiaya_s / $totjbiaya_a ) * 100:0;
                    }
                    $persen1totjbiaya = number_format($per1totjbiaya,"2",".",",");

                       $totpeng=number_format($totpeng,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PENGELUARAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totpeng</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totpengu</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$x1$totjbiaya_selisih$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$x1$persen1totjbiaya$y1</strong></td>
                                     </tr>";
                     //perbaiki totpeng dan jbiaya
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td></tr>";
                                                         
                       $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td colspan=\"2\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$jbiayax</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$jbiayaux</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$x1$persen1totjbiaya$y1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$x1$persen1totjbiaya$y1</strong></td></tr>";


                    }
                    
  
   
                    
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Perubahan Anggaran<br>Satuan Kerja Perangkat Daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td colspan=\"5\" style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td width=\"4%\" style=\"text-align: center;\"><strong>1</strong> </td>
                                <td width=\"23%\" style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>3</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>4</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>5</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>6</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
       //Pendapatan
                    $qtriw = " SELECT isnull( a.triw1_ubah,0) AS triw1,isnull( a.triw2_ubah,0) AS triw2,isnull( a.triw3_ubah,0) 
                                AS triw3,isnull( a.triw4_ubah,0) AS triw4  FROM trskpd a join (select kd_kegiatan from trdrka a 
                                where $a a.$skpd$b=LEFT('$id',7) group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b=LEFT('$id',7)";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total= $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3+ $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                    
                    $qtriw = " SELECT isnull(sum(t1),0) triw1,isnull(sum(t2),0) triw2, isnull(sum(t3),0) triw3, isnull(sum(t4),0) triw4 from (
                            select a.kd_kegiatan, a.kd_rek5, a.kd_skpd,
                            (select sum(nilai_ubah) from trdskpd_ro WHERE (bulan BETWEEN 1 and 3) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t1,
                            (select sum(nilai_ubah) from trdskpd_ro WHERE (bulan BETWEEN 4 and 6) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t2,
                            (select sum(nilai_ubah) from trdskpd_ro WHERE (bulan BETWEEN 7 and 9) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t3,
                            (select sum(nilai_ubah) from trdskpd_ro WHERE (bulan BETWEEN 10 and 12) and kd_kegiatan=a.kd_kegiatan and kd_rek5=a.kd_rek5) t4
                            from trdskpd_ro a inner join (select kd_kegiatan from trdrka GROUP BY kd_kegiatan) b
        on a.kd_kegiatan=b.kd_kegiatan
                            GROUP BY a.kd_kegiatan, a.kd_rek5,a.kd_skpd)oke
                            WHERE left(kd_rek5,1)='5' and left(kd_skpd,7)=left('$id',7)
                            "; //echo($qtriw);
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT '3.1' as kode,'Pengeluaran Pembiayaan' as uraian,w.triw1,x.triw2,y.triw3,z.triw4,total.total from
(select isnull(sum(nilai_ubah),0) as triw1 from trdskpd_ro where left(kd_rek5,2) ='71' and bulan in('1','2','3') and kd_skpd='$id')w,
(select isnull(sum(nilai_ubah),0) as triw2 from trdskpd_ro where left(kd_rek5,2) ='71' and bulan in('4','5','6') and kd_skpd='$id')x,
(select isnull(sum(nilai_ubah),0) as triw3 from trdskpd_ro where left(kd_rek5,2) ='71' and bulan in('7','8','9') and kd_skpd='$id')y,
(select isnull(sum(nilai_ubah),0) as triw4 from trdskpd_ro where left(kd_rek5,2) ='71' and bulan in('10','11','12') and kd_skpd='$id')z,
(select isnull(sum(nilai_ubah),0) as total from trdskpd_ro where left(kd_rek5,2) ='71' and kd_skpd='$id')total";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  select '3.2' as kode,'Pengeluaran Pembiayaan' as uraian,w.triw1,x.triw2,y.triw3,z.triw4,total.total from
(select isnull(sum(nilai_ubah),0) as triw1 from trdskpd_ro where left(kd_rek5,2) ='72' and bulan in('1','2','3') and kd_skpd='$id')w,
(select isnull(sum(nilai_ubah),0) as triw2 from trdskpd_ro where left(kd_rek5,2) ='72' and bulan in('4','5','6') and kd_skpd='$id')x,
(select isnull(sum(nilai_ubah),0) as triw3 from trdskpd_ro where left(kd_rek5,2) ='72' and bulan in('7','8','9') and kd_skpd='$id')y,
(select isnull(sum(nilai_ubah),0) as triw4 from trdskpd_ro where left(kd_rek5,2) ='72' and bulan in('10','11','12') and kd_skpd='$id')z,
(select isnull(sum(nilai_ubah),0) as total from trdskpd_ro where left(kd_rek5,2) ='72' and kd_skpd='$id')total";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
                        $triw3= 0;
                        $triw4= 0;
                        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
                    $triw3= number_format($triw3,2,',','.');
                    $triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                                                      
  
                                    

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
                                <table border=\"0\" width=\"100%\">
                                <tr>
                                <td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
                                <br>&nbsp;
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;<br>
                                &nbsp;  
                                </td>
                                <td width=\"30%\" align=\"center\">$daerah, $ttd_tgl 
                                <br>$jabatan1
                                <p>&nbsp;</p>		
                                &nbsp;<br>
                                &nbsp;<br>
                                <br><strong><ins><u>$nama1</u></ins></strong>
                                <br>$nip1 
                                </td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0-Perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0-Perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

    function preview_coverdppa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $idd = substr($id,0,7).".00";
        $sqlorg="SELECT kd_skpd,nm_skpd FROM ms_skpd WHERE kd_skpd='$idd'";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_skpd;                    
                    $nm_org= $rowdns->nm_skpd;
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; margin-top: 200px;\" width=\"80%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                    </tbody>
                </table>";

        $cRet .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                    <tr>
                        <td width=\"20%\" align=\"center\" style=\"font-weight: bold;\">Kode</td> 
                        <td width=\"60%\" align=\"center\" style=\"font-weight: bold;\">Nama Formulir</td>
                    </tr>
                    </thead>
                    <tbody align=\"left\">
                    <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD</strong></td> 
                        <td width=\"60%\" >Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Satuan Kerja Perangkat Daerah</td>                    
                    </tr>
                    <tr>
                    <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD 1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Perubahan Anggaran Pendapatan Perangkat Daerah </td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD 2</strong></td> 
                        <td width=\"60%\" >Rekapitulasi Belanja menurut Program dan Kegiatan Perangkat Daerah</td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD 2.1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Anggaran Program dan  Kegiatan Perangkat Daerah </td>                    
                    </tr>                                                                           <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD 3.1</strong></td> 
                        <td width=\"60%\" >Rincian Penerimaan Pembiayaan Daerah </td>                    
                    </tr> 
                    </tr>                                                                           <tr>
                        <td width=\"20%\" ><strong>DPPA - SKPD 3.2</strong></td> 
                        <td width=\"60%\" >Rincian Pengeluaran Pembiayaan Daerah </td>                    
                    </tr>     
                                                                                              
                    </tbody>
                </table>";
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','no');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }    
// end dpa 0 ubah


//DPPA 1
    function ctk_dppa1_ubah(){
        $data['page_title']= 'Cetak DPPA 1 Perubahan';
        $this->template->set('title', 'Cetak DPPA 1 Perubahan');   
        $this->template->load('template','anggaran/rka/ctk_dppa1_ubah',$data) ; 
    }


     function preview_dppa1_ubah(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttdsetda = $this->uri->segment(7);
        
        $ttd1= $_REQUEST['ttd1'];   
        $ttd2= $_REQUEST['ttd2'];
        $tgltt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1);
        $ttd2 = str_replace('a',' ',$ttd2);
        $cttx= $_REQUEST['cttx'];
        
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($cttx==1 ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                 $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"50\" height=\"50\" /></td>
                        <td  colspan=\"8\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                        <td  colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPPA - SKPD 1<br></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;border-bottom: hidden;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong> </td>
                    </tr>    
                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td colspan=\"10\"><strong>: $kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td colspan=\"10\"><strong>: $kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td colspan=\"9\"> <strong>: $kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td colspan=\"2\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td colspan=\"9\"><strong>:$kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"left\"><strong>Latar belakang perubahan/dianggarkan pendapatan dalam APBD :</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Perubahan Anggaran Pendapatan <br>Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td width=\"7%\" rowspan=\"3\"  align=\"center\"><b>Kode Rekening </b></td>                            
                            <td width=\"31%\" rowspan=\"3\"  align=\"center\"><b>Uraian</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Sebelum</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Setelah</b></td>
                            <td width=\"20%\" colspan=\"2\"  align=\"center\"><b>Bertambah/(Berkurang)</b></td>        
                        </tr>
 
                        <tr>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\"  align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"15%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">(Rp.)</td>
                            <td width=\"5%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">%</td>
                        </tr>                            
    
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>

                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9) </td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td colspan=\"12\" style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";
                $angg_n1 = 'nilai';
                $angg_n2 = 'nilai_ubah';
                $rangg_n1 = 'total';        
                $rangg_n2 = 'total_ubah';
                $v1 = 'volume1';
                $v2 = 'volume_ubah1';
                $s1 = 'satuan1';
                $s2 = 'satuan_ubah1';
                $h1 = 'harga1';
                $h2 = 'harga_ubah1';
                
                $sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,6)='00.001' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.001'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga,SUM(a.$angg_n2) AS nilai2,
                            '3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.001' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$rangg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$rangg_n2) AS nilai2,
                            '6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,6)='00.001' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,
                            a.$v1 AS volume,a.$s1 AS satuan,a.$h1 AS harga,a.$rangg_n1 AS nilai,
                            a.$v2 AS volume2,a.$s2 AS satuan2,a.$h2 AS harga2,a.$rangg_n2 AS nilai2,
                            '6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,6)='00.001' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                
                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                                                                                 
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        
                        if($rek==' '){ 
                            $uraian=' ' .$row->nama;
                            $volum=$row->volume;
                            $volum2=$row->volume2;                            
                        }else{
                            $uraian=$row->nama;
                            $volum=' ';
                            $volum2=' ';
                        }
                        
                        $sat=$row->satuan;
                        $sat2=$row->satuan2;

                        $nila = $row->nilai;
                        $nila2 = $row->nilai2;
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nila2;
                        }
                        
                        $selisih = $this->rp_minus($nila2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nila2 - $nila)/$nila)*100);
                        }else{
                            if($nila2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 

                        
                        $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                        $hrg2= empty($row->harga2) || $row->harga2 == 0 ? '' :number_format($row->harga2,2,',','.');

                        $nila= number_format($nila,"2",",",".");
                        $nila2= number_format($nila2,"2",",",".");
                        
                        if (strlen($row->rek1)>6) {
                            $bold = "";
                            $fontr = "font-size: ".$font." px;";                        
                        }else{
                            $bold = "font-weight:bold;";
                            $fontr = "font-size: ".$font1." px;";
                        }

                        $cRet    .= " <tr>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$reke</td>                                     
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" > $uraian </td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                     </tr>
                                     ";
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" lign=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>

                                     ";
                    
                }



            
                    $totp=number_format($totp,"2",",",".");
                    $totp2=number_format($totp2,"2",",",".");

                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


        $cRet    .= "</table>";
     $tanggaltt = $this->tukd_model->tanggal_format_indonesia($tgltt);
     if($ttdsetda == '0'){
         $jdlnip3 = '';
         $jabatan3 = '';
         $nama3 = '';
         $pangkat3 = '';
         $nip3='';        
     }else{   
         $jdlnip3 = 'Menyetujui,';
         $jabatan3 = 'Sekretaris';
         $nama3 = 'Dr. M. Zeet Hamdy Assovie, MTM';
         $pangkat3 = 'Pembina Utama';
         $nip3='19620815 1991031011';
     }

     $qtriw = " SELECT distinct isnull( a.triw1_ubah,0) AS triw1,isnull( a.triw2_ubah,0) AS triw2,isnull( a.triw3_ubah,0) 
                                AS triw3,isnull( a.triw4_ubah,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,6)='00.001' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triwa1 = number_format($triw1,2,',','.');
        $triwa2= number_format($triw2,2,',','.');
        $triwa3= number_format($triw3,2,',','.');
        $triwa4= number_format($triw4,2,',','.');
        $totala = number_format($total,2,',','.');

     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;border-left: solid 1px black;font-size:10 px;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"4\">";

                                  $cRet .=" 
                                            <tr>
                                                <td width=\"70%\" colspan=\"2\"><br>Rencana Penarikan Dana per Triwulan
                                                <td width=\"30%\" align=\"center\">
                                            </tr>

                                            <tr>

                                                <td width=\"15%\" align=\"left\" valign=\"top\">
                                                    <br>
                                                    <br>Triwulan I
                                                    <br>Triwulan II
                                                    <br>Triwulan III
                                                    <br>Triwulan IV
                                                    <br>
                                                    <br>Jumlah
                                                </td>

                                                <td width=\"35%\" align=\"left\" valign=\"top\">
                                                    <br> 
                                                    <br>: $triwa1
                                                    <br>: $triwa2
                                                    <br>: $triwa3
                                                    <br>: <u>$triwa4&nbsp;&nbsp;</u>+
                                                    <br>
                                                    <br>&nbsp;$totala
                                                </td>
                                                <td width=\"30%\" align=\"center\"><br><br><br><br><br><br><br><br><br><br><br>$daerah, $tanggaltt<br>$jabatan1   
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1
                                                </td>
                                            </tr>  
                                </table>";                                       
        $cRet    .= "</table>"; 
 

        
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-1 perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',3);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-1-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }


//DPPA 21 perubahan
    function ctk_dppa21_ubah(){
        $data['page_title']= 'Cetak DPPA 2.1 Perubahan';
        $this->template->set('title', 'Cetak DPPA 2.1 Perubahan');   
        $this->template->load('template','anggaran/rka/ctk_dppa21_ubah',$data) ; 
    }



    function preview_dppa21_ubah(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);

       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $cttx= $_REQUEST['cttx'];
        $tglt= $_REQUEST['tgl_ttd'];
        $ttd1 = str_replace('a',' ',$ttd1); 
        $ttd2 = str_replace('a',' ',$ttd2);        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

            if ($cttx==1){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
 
                }
        }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
 $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;

        }
        }        
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td colspan=\"2\" style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPPA SKPD</strong></td>
                         <td colspan=\"3\" style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"6\" align=\"center\"><strong>FORMULIR DPPA - <br>SKPD - 2.1</strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"9\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\" width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Latar belakang perubahan/dianggarkan dalam perubahan APBD</strong></td>
                    </tr>          
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"12\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Perubahan Anggaran Belanja Tidak Langsung Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >

                     <tr>
                        <td rowspan=\"3\"  width=\"5%\" align=\"center\"><b>KODE REKENING</b></td>                            
                        <td rowspan=\"3\"  width=\"21%\" align=\"center\"><b>Uraian</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                        <td colspan=\"4\"  width=\"30%\" align=\"center\"><b>Setelah Perubahan</b></td>
                        <td colspan=\"2\"  width=\"15%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                     </tr>
                        <tr>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"10%\" align=\"center\">(Rp.)</td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"5%\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
                            
                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10-6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"12\"></td>
                         </tr>
                     </tfoot>   
                        ";
/*
                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id a";
*/

            IF ($id == 'ppkd'){                    
                $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,                         
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan, 
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_ubah1 AS volume_ubah1,
                            a.satuan1 AS satuan,
                            a.satuan_ubah1 AS satuan_ubah1,
                            a.harga1  AS harga,
                            a.harga_ubah1 AS harga_ubah1,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            0 AS volume_ubah,
                            '' AS satuan,
                            '' AS satuan_ubah,
                            0  AS harga,
                            0 AS harga_ubah,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002'
                            ) 
                        a ORDER BY a.rek1,a.id";
            }else{
                if($id == 'ppkd1'){
                    $sql1="SELECT * FROM(
                            SELECT
                                0 header,
                                0 no_po,
                                LEFT (a.kd_rek5, 1) AS rek1,
                                LEFT (a.kd_rek5, 1) AS rek,
                                b.nm_rek1 AS nama,
                                0 AS volume,
                                0 as volume_ubah,
                                ' ' AS satuan,
                                ' ' AS satuan_ubah,
                                0 AS harga,
                                0 AS harga_ubah,
                                SUM (a.nilai) AS nilai,
                                SUM (a.nilai_ubah) AS nilai_ubah,
                                '1' AS id
                            FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT
                0 header,
                0 no_po,
                LEFT (a.kd_rek5, 2) AS rek1,
                LEFT (a.kd_rek5, 2) AS rek,
                b.nm_rek2 AS nama,
                0 AS volume,
                0 AS volume_ubah,
                ' ' AS satuan,
                ' ' AS satuan_ubah,
                0 AS harga,
                0 AS harga_ubah,
                SUM (a.nilai) AS nilai,
                SUM (a.nilai_ubah) AS nilai_ubah,
                '2' AS id
                            FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT
                    0 header,
                    0 no_po,
                    LEFT (a.kd_rek5, 3) AS rek1,
                    LEFT (a.kd_rek5, 3) AS rek,
                    b.nm_rek3 AS nama,
                    0 AS volume,
                    0 AS volume_ubah,
                    ' ' AS satuan,
                    ' ' AS satuan_ubah,
                    0 AS harga,
                    0 AS harga_ubah,
                    SUM (a.nilai) AS nilai,
                    SUM (a.nilai_ubah) AS nilai_ubah,
                    '3' AS id           
                            FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT
                        0 header,
                        0 no_po,
                        LEFT (a.kd_rek5, 5) AS rek1,
                        LEFT (a.kd_rek5, 5) AS rek,
                        b.nm_rek4 AS nama,
                        0 AS volume,
                        0 AS volume_ubah,
                        ' ' AS satuan,
                        ' ' AS satuan_ubah,
                        0 AS harga,
                        0 AS harga_ubah,
                        SUM (a.nilai) AS nilai,
                        SUM (a.nilai_ubah) AS nilai_ubah,
                        '4' AS id
                    
                            FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                        SELECT
                            0 header,
                            0 no_po,
                            a.kd_rek5 AS rek1,
                            a.kd_rek5 AS rek,
                            b.nm_rek5 AS nama,
                            0 AS volume,
                            0 AS volume_ubah,
                            ' ' AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM (a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id
                                                    


                            FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
                            union all
                            
                            SELECT * FROM (SELECT
                                        b.header,
                                        b.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        ' ' AS rek,
                                        b.uraian AS nama,
                                        0 AS volume,
                                        0 AS volume_ubah,
                                        ' ' AS satuan,
                                        ' ' AS satuan_ubah,
                                        0 AS harga,
                                        0 AS harga_ubah,
                                        SUM (a.total) AS nilai,
                                        SUM (a.total_ubah) AS nilai_ubah,
                                        '6' AS id
                                    
                            FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,6)='00.002' and substring(a.no_trdrka,34,3) not in ('514','515')
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        
                            UNION ALL 
                            SELECT
                                    0 header,
                                    a.no_urut [no_po],
                                    RIGHT (a.no_trdrka, 7) AS rek1,
                                    '' AS rek,
                                    a.penerima + ' ,alamat:' + a.alamat AS nama,
                                    0 AS volume,
                                    0 AS volume_ubah,
                                    '' AS satuan,
                                    '' AS satuan_ubah,
                                    0 AS harga,
                                    0 AS harga_ubah,
                                    a.total AS nilai,
                                    a.total_ubah AS nilai_ubah,
                                    '6' AS id
                                
                            FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) in ('514','515')
                            union all
                            SELECT
                                        a.header,
                                        a.no_po,
                                        RIGHT (a.no_trdrka, 7) AS rek1,
                                        '' AS rek,
                                        a.uraian AS nama,
                                        a.volume1 AS volume,
                                        a.volume_ubah1 AS volume_ubah1,
                                        a.satuan1 AS satuan,
                                        a.satuan_ubah1 AS satuan_ubah1,
                                        a.harga1 AS harga,
                                        a.harga_ubah1 AS harga_ubah1,
                                        a.total AS nilai,
                                        a.total_ubah AS nilai_ubah,
                                        '6' AS id
                                    
                            
                            FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' and 
                            substring(no_trdrka,34,3) not in ('514','515') 
                            ) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
}else{
                    $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
                            0 as volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,6)='00.002' AND LEFT(a.kd_skpd,7)=left('$id',7) GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,6)='00.002' AND 
                            LEFT(a.kd_skpd,7)=left('$id',7) GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,6)='00.002' AND LEFT(a.kd_skpd,7)=left('$id',7) 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan,
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,6)='00.002' AND LEFT(a.kd_skpd,7)=left('$id',7) GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
                            0 AS volume_ubah,
                            ' 'AS satuan, 
                            ' ' AS satuan_ubah,
                            0 AS harga,
                            0 AS harga_ubah,
                            SUM(a.nilai) AS nilai,
                            SUM (a.nilai_ubah) AS nilai_ubah,
                            '5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,6)='00.002' AND LEFT(a.kd_skpd,7)=left('$id',7) GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.volume_ubah1 AS volume_ubah1,
                            a.satuan1 AS satuan,
                            a.satuan_ubah1 AS satuan_ubah1,
                            a.harga1  AS harga,
                            a.harga_ubah1 AS harga_ubah1,
                            a.total AS nilai,
                            a.total_ubah AS nilai_ubah,
                            '6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,6)='00.002' ) 
                        a ORDER BY a.rek1,a.id";
                }            }       

                $totp = 0;
                $totps = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
               
                                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                        $volume_ubah=$row->volume_ubah;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                        $volume_ubah=' ';
                    }
                    
                    if ($reke<>''){
                        $volum='';
                        $volume_ubah='';
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                        $volume_ubah=empty($row->volume_ubah) || $row->volume_ubah == 0 ? '' :number_format($row->volume_ubah,2,',','.');
                    }
                    
                    $sat=$row->satuan;
                    $satuan_ubah=$row->satuan_ubah;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $hrg_ubah= empty($row->harga_ubah) || $row->harga_ubah == 0 ? '' :number_format($row->harga_ubah,2,',','.');
                    $nil_ = $row->nilai;
                    $nil_se_ = $row->nilai_ubah;
                    $nila= number_format($row->nilai,"2",",",".");
                    $nilai_ubah= number_format($row->nilai_ubah,"2",",",".");
                    
                    $ab = $nil_se_ - $nil_;
                    $jml1 = $this->rp_minus($ab);
                    
                    if($nil_ != 0 AND $nil_se_ !=0){
                        $persen = (($nil_se_-$nil_)/$nil_)*100;
                        $persen1 = $this->rp_minus($persen);
                    }else if($nil_ == 0 AND $nil_se_ ==0){
                        $persen = 0;
                        $persen1 = $this->rp_minus($persen);
                    } else {
                        $persen = 100;
                        $persen1 = $this->rp_minus($persen);
                    }
                    
                    
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                       $totps = $totps +  $row->nilai_ubah;
                       $totp_tot = $totp-$totps;
                    }
                    
                    

                    
                    if (strlen($row->rek1)>6) {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" > $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volume_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$satuan_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nilai_ubah</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$jml1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$satuan_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nilai_ubah</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jml1</strong></td>
                                      <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persen1</strong></td>
                                     ";
                    }
                }
                      }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     
                                     </tr>
                                     ";
                    
                }


                   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                             </tr>";
      
                   $totpx=number_format($totp,"2",",",".");
                   $totpsx=number_format($totps,"2",",",".");
                   $totpsx_tot=number_format($totp_tot,"2",",",".");
                   
                   
      $qtriw = "SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_ubah,0) AS triwa1,isnull( a.triw2_ubah,0) AS triwa2,isnull( a.triw3_ubah,0) AS triwa3,isnull( a.triw4_ubah,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,6)='00.002' AND left(kd_Skpd,7)=left('$id',7)
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,6)='00.002' AND left(kd_skpd,7)=left('$id',7)";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
                            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
                            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
                            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
                            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
                            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
                            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
            $triw3= 0;
            $triw4= 0;
            $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
            $triwa3= 0;
            $triwa4= 0;
            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
        $triw3= number_format($triw3,2,',','.');
        $triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
        $triwa3= number_format($triwa3,2,',','.');
        $triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totpx</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totpsx</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong> $totpsx_tot</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
                                      $tanggaltt = $this->tukd_model->tanggal_format_indonesia($tglt);
                    $cRet .="   <tr>
                                    <td  width=\"100%\" align=\"left\" colspan=\"12\">
                                        <table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\"><br>Rencana Penarikan Dana per Triwulan
                                                <td width=\"40%\" align=\"center\"><br>$daerah, $tanggaltt
                                            </tr>
                                            <tr>
                                                <td width=\"10%\" align=\"left\">Triwulan I<br>
                                                    Triwulan II<br>
                                                    Triwulan III<br>
                                                    Triwulan IV<br>
                                                    <br> 
                                                    Total<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\">: Rp $triwa1<br>
                                                    : Rp $triwa2<br>
                                                    : Rp $triwa3<br>
                                                    : <u>Rp $triwa4&nbsp;&nbsp;</u>+<br>
                                                    <br> 
                                                    : Rp $totala<br>  
                                                </td>
                                                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                    <br>&nbsp;
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    &nbsp;  
                                                </td>
                                                <td width=\"40%\" align=\"center\">$jabatan1  
                                                    <p>&nbsp;</p>
                                                    &nbsp;<br>
                                                    &nbsp;<br>
                                                    <br><b><u>$nama1</u></b>
                                                    <br>$nip1 
                                                </td>
                                            </tr>
                                        </table>
                                    </td>       
                                </tr></table>";



        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-21-perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-21-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
//End DPPA 21 Perubahan


    //DPPA 22 Ubah 
    function ctk_dppa22_ubah(){
        $data['page_title']= 'Cetak DPPA 2 Perubahan';
        $this->template->set('title', 'Cetak DPPA 2 Perubahan');   
        $this->template->load('template','anggaran/rka/ctk_dppa22_ubah',$data) ; 
    }
    
      function preview_dppa22_ubah(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $cttx= $_REQUEST['cttx'];
        $tgltt= $_REQUEST['tgl_ttd'];

        $ttd1 = str_replace('a',' ',$ttd1); 
        $ttd2 = str_replace('a',' ',$ttd2);     
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($cttx==1 ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;

                }
        }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                  $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;                }
                
            }

     
        
        $cRet='';

     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.png\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"66%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPPA - SKPD <br><h3>2</h3></strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>";        

      


       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td > <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode<br>Program dan Kegiatan</b></td>
 
                            <td width=\"20%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"11%\"  rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:9px;\"  align=\"center\"><b>Target Kinerja (Kuantitatif)</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"22%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td width=\"15%\" colspan=\"2\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Sebelum</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Setelah</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">(Rp)</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">%</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>                            
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8=6-7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">9</td>

                         </tr>
                     </thead>
                   
                        ";

                $sql1="SELECT 
                            a.kd_program AS prog,
                            a.kd_program AS prog1,
                            a.kd_program AS giat,
                            a.nm_program AS uraian,
                            ' ' AS lokasi,
                            ' ' AS target,
                            '' [sumber_dana],
                            isnull(sum(nilai),0) [susun],isnull(sum(nilai_ubah),0) [nilai2]
                        FROM
                            trdrka x
                        LEFT JOIN trskpd a ON left(a.kd_skpd,7) = left(x.kd_skpd,7)
                        AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                            RIGHT (a.kd_program, 2) <> '00'
                        AND $a x.kd_skpd$b = '$id'
                        GROUP BY
                            a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                                a.kd_program AS prog,
                                ' ' AS prog1,
                                a.kd_kegiatan AS giat,
                                a.nm_kegiatan AS uraian,
                                a.lokasi AS lokasi,
                                a.tk_kel_ubah AS target,
                                isnull(x.sumber1_ubah,'') [sumber_dana],
                                isnull(sum(nilai),0) [susun],isnull(sum(nilai_ubah),0) [nilai2] 
                            FROM
                                trdrka x
                                LEFT JOIN trskpd a ON left(a.kd_skpd,7)=left(x.kd_skpd,7) AND x.kd_kegiatan=a.kd_kegiatan
                            WHERE
                                RIGHT(a.kd_program,2)<>'00' AND
                                $a x.kd_skpd$b='$id'
                            GROUP BY
                                a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel_ubah,a.triw1,a.triw2,a.triw3,a.triw4,x.sumber1_ubah 
                                            ORDER BY prog,giat  
                        ";
              

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giat=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $nilai = $row->susun;
                    $nilai2 = $row->nilai2;
                    $selisih = $nilai2-$nilai;
                    if($nilai != 0){
                        $persen = (($nilai2-$nilai)/$nilai)*100;
                    }else{
                        $persen = 100;
                    } 
                    //iif(apbdsusun <> 0 ,((abs(apbdubah-apbdsusun))/apbdsusun)*100,100) 
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $totnilai = $totnilai +  $nilai;
                        $tnilai2 = $tnilai2 + $nilai2;
                        $tselisih = $tselisih + $selisih;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $nilai1 = number_format($nilai,2,',','.');
                    $nilai2a = number_format($nilai2,2,',','.');
                    $selisih = $this->rp_minus($selisih);
                    $persen = $this->rp_minus($persen);

                      $cRet    .= " <tr>                                  
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$giat</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$target</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai2a</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$persen</td>
                                    </tr> 
                                    
                                   
                                    ";
 
                }

                if($totnilai != 0){
                    $tpersen = (($tnilai2-$totnilai)/$totnilai)*100;
                }else{
                    $tpersen = 100;
                } 
 
                $totnilai = number_format($totnilai,2,',','.');
                $tnilai2 = number_format($tnilai2,2,',','.');
                $tselisih = $this->rp_minus($tselisih);
                $tpersen = $this->rp_minus($tpersen);
                
                 $cRet    .= " <tr>
                                    <td colspan=\"5\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totnilai</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tnilai2</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tselisih</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tpersen</td>
                                </tr>
                                 ";
            

 
$tanggaltt = $this->tukd_model->tanggal_format_indonesia($tgltt);


                             $cRet .="<tr>
                                        <td colspan=\"9\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"center\">$daerah, $tanggaltt</td>
                                                </tr>
                                                <tr>
                                                    <td align=\"center\" valign=\"top\">
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><ins></ins></b>
                                                        <br>
                                                        <br> 
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\" valign=\"top\">&nbsp;&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b>&nbsp;&nbsp;&nbsp;&nbsp;</b>
                                                        <br>&nbsp;&nbsp;&nbsp;&nbsp;
                                                        <br>&nbsp;&nbsp;&nbsp;
                                                    </td>
                                                    <td>&emsp;</td>
                                                    <td align=\"center\">$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><u>$nama1</u></b>
                                                        <br>$nip1 
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";

        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-22 perubahan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA-22-perubahan.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//END DPPA 22 ubah


    function dpa221_ubah(){
    $skpd     = $this->session->userdata('kdskpd');
    $id         =  $this->session->userdata('pcNama');

    if($id=='anggaran'){       
        $this->index2('0','ms_skpd','kd_skpd','nm_skpd','DPA 2.1 PERUBAHAN','dpa221_ubah','');
    }else{   
        $this->index2('0','ms_skpd','kd_skpd','nm_skpd','DPA 2.1 PERUBAHAN','dpa221_ubah',$skpd);
        } 
    }



function daftar_kegiatan1_ubah1($offset=0)
    {
        $id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
        
        $total_rows = $this->rka_model->get_count($id);
  
        // pagination        
 
        $config['base_url']     = site_url("rka/daftar_kegiatan1_ubah/$id");
        $config['total_rows']   = $total_rows;
        $config['per_page']     = '10';
        $config['uri_segment']  = 3;
        $config['num_links']    = 5;
        $config['full_tag_open'] = '<ul class="page-navi">';
        $config['full_tag_close'] = '</ul>';
        $config['num_tag_open'] = '<li>';
        $config['num_tag_close'] = '</li>';
        $config['cur_tag_open'] = '<li class="current">';
        $config['cur_tag_close'] = '</li>';
        $config['prev_link'] = '&lt;';
        $config['prev_tag_open'] = '<li>';
        $config['prev_tag_close'] = '</li>';
        $config['next_link'] = '&gt;';
        $config['next_tag_open'] = '<li>';
        $config['next_tag_close'] = '</li>';
        $config['last_link'] = 'Last';
        $config['last_tag_open'] = '<li>';
        $config['last_tag_close'] = '</li>';
        $config['first_link'] = 'First';
        $config['first_tag_open'] = '<li>';
        $config['first_tag_close'] = '</li>';
        $limit                  = $config['per_page'];  
        $offset                 = $this->uri->segment(4);  
        $offset                 = ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
          
        if(empty($offset))  
        {  
            $offset=0;  
        }
    
        $data['list']       = $this->rka_model->getAll($limit, $offset,$id);
        $data['num']        = $offset;
        $data['total_rows'] = $total_rows;
        $data['kode_skpd'] = $id;
        
                $this->pagination->initialize($config);
        
        $this->template->set('title', 'Master Data kegiatan');
        $this->template->load('template', 'anggaran/rka/list_dpa_ubah-cetak_semua', $data);
   
    }


   function preview_dpa221_ubah(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $statttd = $this->uri->segment(6);
        $tang= $_REQUEST['tgl_ttd'];
        $tanggal = $this->tukd_model->tanggal_format_indonesia($tang);
        $tanggalhariini = date('d - M - Y');
        $ttdppkd=  str_replace('123456789',' ',$_REQUEST['ttd1']);
        $ttdpa= str_replace('123456789',' ',$_REQUEST['ttd2']);
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }

                $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($date);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        if($statttd==0){
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdppkd'";
                 }else{
        $sqlttd1="SELECT TOP 1 nama as nm,nip as nip,jabatan as jab FROM ms_ttd where nip='$ttdpa'";
                }
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.waktu_giat,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,
                a.tu_mas,a.tu_kel,a.tu_has,a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.lokasi,d.sumber, a.sasaran_giat FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd,f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_ubah,a.tu_mas_ubah,a.tu_kel_ubah,a.tu_has_ubah,
                a.tk_capai_ubah,a.tk_mas_ubah,a.tk_kel_ubah,a.tk_has_ubah,a.waktu_giat,d.sumber,a.sasaran_giat";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    //$nm_giatx  = str_replace('/',' ',$roworg->nm_kegiatan);
                    $lokasi  = $roworg->lokasi;
                    $sasaran_giat  = $roworg->sasaran_giat;
                    $tk_has  = $roworg->tk_has;
                    $tu_capai= $roworg->tu_capai;
                    $tu_mas = $roworg->tu_mas;
                    $tu_kel = $roworg->tu_kel;
                    $tu_has = $roworg->tu_has;
                    $tk_capai = $roworg->tk_capai;
                    $tk_mas = $roworg->tk_mas;
                    $tk_kel = $roworg->tk_kel;
                    $tk_has_ubah  = $roworg->tk_has_ubah;
                    $tu_capai_ubah= $roworg->tu_capai_ubah;
                    $tu_mas_ubah = $roworg->tu_mas_ubah;
                    $tu_has_ubah = $roworg->tu_has_ubah;
                    $tu_kel_ubah = $roworg->tu_kel_ubah;
                    $tk_capai_ubah = $roworg->tk_capai_ubah;
                    $tk_mas_ubah = $roworg->tk_mas_ubah;
                    $tk_kel_ubah = $roworg->tk_kel_ubah;
                    $org = substr($kd_skpd,0,7);
                    $waktu_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;
                    
                }
                
                
        
            $sqlorgx="SELECT 0 header, 0 no_po,LEFT (a.kd_rek5, 1) AS rek1,LEFT (a.kd_rek5, 1) AS rek,b.nm_rek1 AS nama,
            0 AS volume,' ' AS satuan,0 AS harga,SUM (a.nilai) AS nilai,0 AS volume_u,' ' AS satuan_u,0 AS harga_u,
            isnull(SUM(a.nilai_ubah), 0) AS nilai_u,'1' AS id
            FROM
            trdrka a
            INNER JOIN ms_rek1 b ON LEFT (a.kd_rek5, 1) = b.kd_rek1
            WHERE
            a.kd_kegiatan = '$giat'
            AND LEFT (a.kd_skpd, 7) = LEFT ('$id', 7)
            GROUP BY
            LEFT (a.kd_rek5, 1),
            nm_rek1";

                 $sqlorgx1=$this->db->query($sqlorgx);
                 foreach ($sqlorgx1->result() as $roworgx)
                {
                    $nilai_murni = $roworgx->nilai;
                    $nila_mux= number_format($roworgx->nilai,"2",".",",");
                        
                    $nilai_ub = $roworgx->nilai_u;
                    $nila_ux= number_format($roworgx->nilai_u,"2",".",",");
                }
        


        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN</strong></td>
                         <td colspan=\"6\" align=\"center\"><strong>NOMOR DPPA SKPD</strong></td>
                         <td rowspan=\"4\" colspan=\"3\" align=\"center\"><strong>&nbsp;<br>FORMULIR<br>DPPA - SKPD<br>2.1  </strong></td>
                    </tr>
                    <tr>
                         <td colspan=\"3\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td align=\"center\">$kd_urusan</td>
                         <td colspan=\"2\" align=\"center\">$org</td>
                         <td align=\"center\">00</td>
                         <td colspan=\"2\" align=\"center\">5</td>

                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td colspan=\"9\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Urusan Pemerintahan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_urusan - $nm_urusan</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Organisasi</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$org - $nm_org</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Program</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_prog - $nm_prog</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$kd_giat - $nm_giat<br></td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Lokasi Kegiatan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$lokasi</td>
                         </tr>
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n-1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;Rp. </td>
                         </tr>     
                        <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n 1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;Rp. $nila_ux</td>
                         </tr>  
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Jumlah Tahun n+1</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;Rp. </td>
                         </tr>  
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;border-bottom: none;\" align=\"left\">Waktu Pelaksanaan</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;border-bottom: none;\" align=\"left\">:&nbsp;$waktu_giat</td>
                         </tr> 
                         <tr>
                            <td colspan=\"3\" style=\"border-right:none;border-top: none;\" align=\"left\">Sumber Dana</td>                            
                            <td colspan=\"9\" style=\"border-left:none;border-top: none;\" align=\"left\">:&nbsp;$sumber</td>
                         </tr>





                        
                    ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"center\">Indikator & Tolak Ukur Kinerja Belanja </td>
                 </tr>
                 </table>";


        $cRet .="<table style=\"border-collapse:collapse;font-size:12px;\" width=\"100%\" align=\"left\" border=\"1\">
                <thead>                       
                        <tr><td rowspan=\"2\" colspan=\"2\" width=\"20%\" align=\"center\"><b>Indikator</b></td>                            
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Tolak Ukur Kerja </b></td>
                            <td colspan=\"5\" width=\"80%\" align=\"center\"><b>Target Kinerja</b></td>
                        </tr>
                        <tr>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Pergeseran</b></td>
                            <td colspan=\"3\" align=\"center\"><b>Sebelum Pergeseran</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Setelah Pergeseran</b></td>                            
                        </tr>
				</thead>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Dampak Sasaran</td> 
                            <td colspan=\"3\" align=\"center\">$tu_capai</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai</td>
                            <td colspan=\"3\" align=\"center\">$tu_capai_ubah</td>
                            <td colspan=\"2\" align=\"center\">$tk_capai_ubah</td>
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Hasil Program</td>
                            <td colspan=\"3\" align=\"center\">$tu_has</td>
                            <td colspan=\"2\" align=\"center\">$tk_has</td>
                            <td colspan=\"3\" align=\"center\">$tu_has_ubah</td>
                            <td colspan=\"2\" align=\"center\">$tk_has_ubah</td>
                        </tr>
                         <tr>
                            <td colspan=\"2\" align=\"center\">Keluaran Kegiatan</td>
                            <td colspan=\"3\" align=\"center\">$tu_kel</td>
                            <td colspan=\"2\" align=\"center\">$tk_kel</td>
                            <td colspan=\"3\" align=\"center\">$tu_kel_ubah</td>
                            <td colspan=\"2\" align=\"center\">$tk_kel_ubah</td>
                        </tr> 
           
                ";
        $cRet .= "<tr>
                    <td colspan=\"12\" align=\"left\">Kelompok Sasaran Kegiatan : $sasaran_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"12\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN BELANJA <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">12</td>                        
                        </tr> 
                     </thead>

                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.nilai_ubah),0) AS nilai_u,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume_u,' ' AS satuan_u, 0 AS harga_u,isnull(SUM(a.total_ubah),0) AS nilai_u,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' 
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u, a.harga_ubah1 AS harga_u,
                        a.total_ubah AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null)
                        and (a.total_ubah != 0 or a.total !=0)
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
               //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.'); 
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    $volum_u= empty($row->volume_u) || $row->volume_u == 0 ? '' :number_format($row->volume_u,2,',','.');                   
                    $nila= number_format($row->nilai,"2",".",",");                    
               //     $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;\" align=\"right\">&nbsp;</td>
                                                                  </tr>";
                 $n_per1sel=0;                                                                  
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totpa=$rowp->totp;
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_ua=$rowp->totp_u;
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   $selx=$totp_ua-$totpa;
                   
                   
                   if ($selx < 0){
                        $x1sel="("; $selx=$selx*-1; $y1sel=")";}
                    else {
                        $x1sel=""; $y1sel="";}

                    $sel=number_format($selx,"2",".",",");
                    
                    $n_sel = number_format($sel,"2",".",",");
                    if ($rowp->totp==0){
                        $per1sel=0;
                    }else{
                    $per1sel   = ($sel!=0)?($selx / $rowp->totp ) * 100:0;
                    $n_per1sel = number_format($per1sel,"2",".",",");
                    }
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1sel$sel$y1sel</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1sel$n_per1sel$y1sel</td>
                                </tr>";
                 }
                                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Penarikan Dana per Triwulan</td>
                            </tr>";
                 
               
                          
        $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1_ubah AS triw1,triw2_ubah AS triw2,triw3_ubah AS triw3,triw4_ubah AS triw4 ,(triw1_ubah+triw2_ubah+triw3_ubah+triw4_ubah) AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
        $qtriw1=$this->db->query($qtriw);
                 foreach ($qtriw1->result() as $rowtriw)
                {
                    $resttriw1= empty($rowtriw->triw1) || $rowtriw->triw1 == 0 ? '' :number_format($rowtriw->triw1,2,',','.');
                    $resttriw2= empty($rowtriw->triw2) || $rowtriw->triw2 == 0 ? '' :number_format($rowtriw->triw2,2,',','.');
                    $resttriw3= empty($rowtriw->triw3) || $rowtriw->triw3 == 0 ? '' :number_format($rowtriw->triw3,2,',','.');
                    $resttriw4= empty($rowtriw->triw4) || $rowtriw->triw4 == 0 ? '' :number_format($rowtriw->triw4,2,',','.');                    
                    $resttriw5= empty($rowtriw->jumlah) || $rowtriw->jumlah == 0 ? '' :number_format($rowtriw->jumlah,2,',','.');                    
                }


                 $cRet .= "<tr>
                                <td style='border-style: none' colspan='2' align=\"left\">
		                                Triwulan I<br>
		                                Triwulan II<br>
		                                Triwulan III<br>
		                                Triwulan IV <br><br><br><br><br><br><br><br><br><br><br>
                                </td>
                                <td style='border-style: none' colspan='1' align=\"left\">
                                	Rp.<br>
                                	Rp.<br>
                                	Rp.<br>
                                	Rp.<br>
                                	Rp.<br><br><br><br><br><br><br><br><br><br><br></td>
                                <td style='border-style: none' colspan='2' align=\"right\"><br>		                                
                                		$resttriw1<br>
		                                $resttriw2<br>
		                                $resttriw3<br>
		                                $resttriw4<br>
		                                <hr>
		                                $resttriw5  <br><br><br><br><br><br><br><br><br><br>
		                                </td>
                                <td style='border-style: none' colspan='1'  align=\"left\"></td>
                                <td style='border-style: none' colspan='6'  align=\"center\">
		                                <br><br><br><br><br><br><br><br><br><br>
		                                $daerah, $tanggal 
		                                <br>
		                                Mengesahkan,
		                                <br>
		                                $jabatan
		                                &nbsp;<br>
		                                <br><br><br>&nbsp;
		                                <u>$nama</u><br>
		                                NIP.$nip
                                </td>
                            </tr>";
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 2;
        	//echo "$cRet";
             $this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'1');
        break;
        case 1;
        	//echo "$cRet";
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 0;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221-PERUBAHAN-$giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 3;
                echo ("<title>DPPA 221</title>");
                echo($cRet);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        break;
        
        }
        
                
    }
   //end dppa 221

   
   function config_header_rinci(){
        $skpd     =  $this->input->post('kdskpd');
         $rek     =  $this->input->post('rekk');
        $angg     =  $this->input->post('angg');


        if($angg=='murni'){
            $tabs='';
        }else if($angg=='sempurna'){
            $tabs='_sempurna';
        }else if($angg=='ubah'){
            $tabs='_ubah';
        }else{
            $tabs='';
        }


//BL
        if($rek=='22'){
            $wherex = "and right(kd_kegiatan,6) not in ('00.001','00.002','00.003')";
//seluruh
        }else if($rek=='0'){
            $wherex = "";
//pendapatan
        }else if($rek=='1'){
            $wherex = "and right(kd_kegiatan,6) IN ('00.001')";
//BTL
        }else if($rek=='21'){
            $wherex = "and right(kd_kegiatan,6) IN ('00.002')";
        }else{
            $wherex = "";
        }

        $sql = "select count(*) as hasil from(
                    select a.no_trdrka,a.kd_skpd,kd_kegiatan,kd_rek5,nilai$tabs as nilai,t from trdrka a left join(
                    select no_trdrka, isnull(sum(total$tabs),0) [t] from trdpo group by no_trdrka) b on a.no_trdrka=b.no_trdrka
                    )as d where left(kd_skpd,7) =left('$skpd',7) and nilai<>t $wherex
 "; //echo "$sql";
        $query1 = $this->db->query($sql);  
        
        $test = $query1->num_rows();
        
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(        
                        'hasil' => $resulte['hasil']
                        );
                        
        }
        

        
        
        echo json_encode($result);
        $query1->free_result();   
    }   


//pindah 31-10-17
     function config_angkas_anggaran(){
        $skpd     =  $this->input->post('kdskpd');
        $rek      =  $this->input->post('rekk');
        $angg     =  $this->input->post('angg');


        if($angg=='murni'){
            $tabs='';
        }else if($angg=='sempurna'){
            $tabs='_sempurna';
        }else if($angg=='ubah'){
            $tabs='_ubah';
        }else{
            $tabs='';
        }

//BL
        if($rek=='22'){
            $wherex = "and right(kd_kegiatan,6) not in ('00.001','00.002','00.003')";
//seluruh
        }else if($rek=='0'){
            $wherex = "";
//pendapatan
        }else if($rek=='1'){
            $wherex = "and right(kd_kegiatan,6) IN ('00.001')";
//BTL
        }else if($rek=='21'){
            $wherex = "and right(kd_kegiatan,6) IN ('00.002')";
        }else{
            $wherex = "";
        }


        $sql = "SELECT count(*) as hasil from(
                    select a.kd_kegiatan,sum(a.nilai$tabs) as nilai,t from trdrka a left join(
                    select kd_kegiatan,sum(nilai$tabs) [t] from trdskpd_ro group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan group by a.kd_kegiatan,b.t 
                    union ALL
                    select a.kd_kegiatan,sum(a.nilai$tabs) as nilai,t from trdrka a left join(
                    select kd_kegiatan,0 as [t] from trdrka where kd_kegiatan not in (select kd_kegiatan from trdskpd)) b on a.kd_kegiatan=b.kd_kegiatan group by a.kd_kegiatan,b.t
                    )as d where substring(kd_kegiatan,1,7) =left('$skpd',7) $wherex and nilai<>t


 ";
        $query1 = $this->db->query($sql);  
        
        $test = $query1->num_rows();
        
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                               
                        'hasilx' => $resulte['hasil']
                        );
                    
        }
        

        
        
        echo json_encode($result);
        $query1->free_result();   
    }    
     
     
     function edit_sumber_kegi_ubah(){
        $data['page_title']= 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN';
        $this->template->set('title', 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN');   
        $this->template->load('template','anggaran/rka/edit_sumber_kegi_ubah',$data) ; 
    }
	 
     
     
     function kegi_sumber_ubah($cskpd='') {
        $lccr = $this->input->post('q');
        if($cskpd==''){
            $result[] = array(
                        'id' => 0,        
                        'kd_kegiatan' => '',  
                        'nm_kegiatan' => '',  
                        'nilai' =>  '',
                        'sumber' => '',
                        'ket_sumber' => ''
                        );
        }else{
            $query1 = "select DISTINCT kd_kegiatan,nm_kegiatan,sum(nilai_ubah) as nilai,
                       case when sumber2_ubah is null then sumber1_ubah
                        else sumber1_ubah+'  '+sumber2_ubah end as sumber,
                        case when (sumber2_ubah is null or sumber2_ubah =' ')then '1'
                        else '2' end as ket_sumber
                        from trdrka where left(kd_skpd,7) = left('$cskpd',7)
                        group by kd_kegiatan,nm_kegiatan,sumber1_ubah,sumber2_ubah order by kd_kegiatan";  
            
            $query2=$this->db->query($query1);

            $result = array();
            $ii = 0;
            foreach($query2->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan'],  
                            'nilai' =>  number_format($resulte['nilai'],"2",".",","),
                            'sumber' => $resulte['sumber'],
                            'ket_sumber'=> $resulte['ket_sumber']
                            );
                            $ii++;
            }                            
        }

        echo json_encode($result);
           
    }

 function update_sumber_kegi_ubah(){
        $ckegi   = $this->input->post('kegi');
        $sumber   = $this->input->post('csumber1');
        /*
        $npad   = $this->input->post('snpad');
        $ndak   = $this->input->post('sndak');
        $ndaknf = $this->input->post('sndaknf');
        $ndau = $this->input->post('sndau');
        $ndbhp = $this->input->post('sndbhp');
        $ndid = $this->input->post('sndid');
        */
        $nangg = 'nilai_ubah';
        
 //      $asg = $this->rka_model->q_update_sumber_kegi($ckegi,$sumber,$nangg,$npad,$ndak,$ndaknf,$ndau,$ndbhp,$ndid);

          $asg = $this->rka_model->q_update_sumber_kegi_ubah($ckegi,$sumber,$nangg);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
    }
    
	function preview_rka2_permen_33(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $tgl2 = $this->uri->segment(7);
        $tgl_ttd2 = $this->tukd_model->tanggal_format_indonesia($tgl2);
        $ttd1x = $this->uri->segment(8);
        $statttd = $this->uri->segment(9);
        //$statttd = $this->uri->segment(11);        //$ttd1= $_REQUEST['ttd1'];
        //$ttd2= $_REQUEST['ttd2'];
                
         $ttd1 = str_replace('x',' ',$ttd1x);
        //$ttd2 = str_replace('x',' ',$ttd2x);
        
        $sql_trhrka="SELECT top 1 status_rancang,statu, tgl_dpa_rancang FROM trhrka where left(kd_skpd,7)=left('$id',7)";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= $rowsc->tgl_dpa_rancang;
            $status= $rowsc->status_rancang;

        }
            
            $judulrka = 'RENCANA KERJA DAN ANGGARAN';
            $n_trdrka  =   '_rancang';
            $kdrka ='RKA';
        


        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,left(a.kd_skpd,7) as kd_skp,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id' and right(kd_skpd,2)='00'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_skp;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
              
      if($statttd==1){       
       $sqlttd1="SELECT nama as nm,nip as nip,'Kepala '+(select nm_skpd from ms_skpd where kd_skpd='$id'+'.00') as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabb = strtolower($rowttd->jab);
                    $jabbs = ucwords($jabb);	
                    $jabatan1  = empty($jabbs) ? '': $jabbs;
                }
       
       }else{         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabb = strtolower($rowttd->jab);
                    $jabbs = ucwords($jabb);	
                    $jabatan1  = empty($jabbs) ? '': $jabbs;
                }
        }  
                  
 
        $cRet='';

 $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"></td>
                         <td width=\"66%\" colspan=\"9\" align=\"center\" ><strong>$judulrka</strong></td> 
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" align=\"center\"><strong>FORMULIR</h3></strong></td>
                    </tr>
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"></td>
                         <td width=\"66%\" colspan=\"9\" align=\"center\" ><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td> 
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" align=\"center\"><strong>$kdrka - SKPD</strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td colspan=\"9\" align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" align=\"center\"><strong><h3>2</h3></strong></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td colspan=\"9\" align=\"center\" style=\"border-right: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td style=\"border-right: solid 1px black;\">&nbsp;</td>
                    </tr>

                  </table>
                  <table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                  <tr>
                        <td ><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td colspan=\"10\" align=\"left\" ><strong>: $kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>";        

      

       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $sql1="select left(a.kd_skpd,7) kd_skpd,left(a.kd_kegiatan,4) as urusan,b.nm_urusan from trdrka a left join ms_urusan b on left(kd_kegiatan,4)=b.kd_urusan where left(kd_skpd,7) =left('$id',7) AND LEFT(a.kd_skpd,4) = LEFT (b.kd_urusan, 4)
              group by left(kd_kegiatan,4),left(kd_skpd,7),nm_urusan";
                 
                 
                 $query = $this->db->query($sql1);
                                                  
                foreach ($query->result() as $row)
                {
                    $urus=$row->urusan;
                    $nm_urus=$row->nm_urusan;
       $Xret1.="
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td colspan=\"10\" align=\"left\"><strong>: $urus - $nm_urus</strong></td>
                    </tr>

                    ";
                }
       $Xret2.= "<tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td colspan=\"10\" align=\"left\"> <strong>: $kd_skpd - $nm_skpd</strong></td>
                    </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"11\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>"; 
                     if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }           
        

        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td colspan=\"2\" align=\"center\"><b>Kode</b></td>  
                            <td rowspan=\"4\" align=\"center\" valign=\"middle\"><b>Uraian</b></td>
							<td rowspan=\"4\" align=\"center\" valign=\"middle\"><b>Lokasi</b></td>
							<td rowspan=\"4\" align=\"center\" valign=\"middle\"><b>Sumber<br>Dana</b></td>
                            <td colspan=\"12\" align=\"center\"><b>Jumlah</b></td>
                        </tr>
						<tr>
							<td rowspan=\"3\" align=\"center\"><b>Program</b></td>  
                            <td rowspan=\"3\" align=\"center\"><b>Kegiatan</b></td>
							<td colspan=\"11\" align=\"center\"><b>Tahun n</b></td>
							<td rowspan=\"3\" align=\"center\"><b>Tahun n+1</b></td>						
                        </tr>
						<tr>
							<td colspan=\"6\" align=\"center\" valign=\"middle\"><b>Belanja Operasi</b></td>
							<td align=\"center\" valign=\"middle\"><b>Belanja<br>Modal</b></td>
							<td align=\"center\" valign=\"middle\"><b>Belanja<br>Tak Terduga</b></td>
                            <td colspan=\"2\" align=\"center\"><b>Belanja Transfer</b></td>
							<td rowspan=\"2\" align=\"center\"><b>Jumlah</b></td>
                        </tr>
						<tr>
							<td align=\"center\"><b>Belanja<br>Pegawai</b></td>
							<td align=\"center\"><b>Belanja<br>Barang&Jasa</b></td>
							<td align=\"center\"><b>Belanja<br>Bunga</b></td>
							<td align=\"center\"><b>Belanja<br>Subsidi</b></td>
							<td align=\"center\"><b>Belanja<br>Hibah</b></td>
							<td align=\"center\"><b>Belanja<br>Bantuan<br>Sosial</b></td>
							<td align=\"center\"><b>Belanja<br>Modal</b></td>
							<td align=\"center\"><b>Belanja<br>Tidak<br>Terduga</b></td>
							<td align=\"center\"><b>Belanja<br>Bagi<br>Hasil</b></td>
							<td align=\"center\"><b>Belanja<br>Bantuan<br>Keuangan</b></td>
						
						</tr>
						<tr>
							<td width=\"5%\" align=\"center\"><b>1</b></td>
							<td width=\"5%\" align=\"center\"><b>2</b></td>
							<td width=\"9%\" align=\"center\"><b>3</b></td>
							<td width=\"5%\" align=\"center\"><b>4</b></td>
							<td width=\"5%\" align=\"center\"><b>5</b></td>
							<td width=\"5%\" align=\"center\"><b>6</b></td>
							<td width=\"5%\" align=\"center\"><b>7</b></td>
							<td width=\"5%\" align=\"center\"><b>8</b></td>
							<td width=\"5%\" align=\"center\"><b>9</b></td>
							<td width=\"5%\" align=\"center\"><b>10</b></td>
							<td width=\"5%\" align=\"center\"><b>11</b></td>
							<td width=\"5%\" align=\"center\"><b>12</b></td>
							<td width=\"5%\" align=\"center\"><b>13</b></td>
							<td width=\"5%\" align=\"center\"><b>14</b></td>
							<td width=\"5%\" align=\"center\"><b>15</b></td>
							<td width=\"5%\" align=\"center\"><b>16</b></td>
							<td width=\"5%\" align=\"center\"><b>17</b></td>
						</tr>
                        
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"11\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT *,
b_pegawai+b_barang+b_bunga+b_subsidi+b_hibah+b_bansos+b_modal+b_takterduga+
b_bagi+b_bantuan_keuangan as total from(


select kd_program kode,(select nm_program from m_prog where x.kd_program=kd_program) nm_program, '' sumber, '' lokasi,
sum(b_pegawai) b_pegawai,sum(b_barang) b_barang,sum(b_bunga) b_bunga,
sum(b_subsidi) b_subsidi,sum(b_hibah) b_hibah,sum(b_bansos) b_bansos,sum(b_modal) b_modal,
sum(b_takterduga) b_takterduga,sum(b_bagi) b_bagi,sum(b_bantuan_keuangan) b_bantuan_keuangan
 from(
select left(kd_kegiatan,18) kd_program,'' nm_kegiatan,
case when left(kd_rek5,3)=511 then nilai else 0 end as b_pegawai,
case when left(kd_rek5,3)=512 then nilai else 0 end as b_barang,
case when left(kd_rek5,3)=513 then nilai else 0 end as b_bunga,
case when left(kd_rek5,3)=514 then nilai else 0 end as b_subsidi,
case when left(kd_rek5,3)=515 then nilai else 0 end as b_hibah,
case when left(kd_rek5,3)=516 then nilai else 0 end as b_bansos,
case when left(kd_rek5,2)=52 then nilai else 0 end as b_modal,
case when left(kd_rek5,3)=531 then nilai else 0 end as b_takterduga,
case when left(kd_rek5,3)=541 then nilai else 0 end as b_bagi,
case when left(kd_rek5,3)=542 then nilai else 0 end as b_bantuan_keuangan
from trdrka
)x
group by kd_program
union ALL
select kd_kegiatan,nm_kegiatan, (select top 1 sumber from trdrka WHERE kd_kegiatan=x.kd_kegiatan and sumber <> '')	sumber, (select  lokasi from trskpd WHERE kd_kegiatan=x.kd_kegiatan) lokasi, sum(b_pegawai) b_pegawai,sum(b_barang) b_barang,sum(b_bunga) b_bunga,
sum(b_subsidi) b_subsidi,sum(b_hibah) b_hibah,sum(b_bansos) b_bansos,sum(b_modal) b_modal,
sum(b_takterduga) b_takterduga,sum(b_bagi) b_bagi,sum(b_bantuan_keuangan) b_bantuan_keuangan
 from(
select kd_kegiatan,nm_kegiatan, sumber,
case when left(kd_rek5,3)=511 then nilai else 0 end as b_pegawai,
case when left(kd_rek5,3)=512 then nilai else 0 end as b_barang,
case when left(kd_rek5,3)=513 then nilai else 0 end as b_bunga,
case when left(kd_rek5,3)=514 then nilai else 0 end as b_subsidi,
case when left(kd_rek5,3)=515 then nilai else 0 end as b_hibah,
case when left(kd_rek5,3)=516 then nilai else 0 end as b_bansos,
case when left(kd_rek5,2)=52 then nilai else 0 end as b_modal,
case when left(kd_rek5,3)=531 then nilai else 0 end as b_takterduga,
case when left(kd_rek5,3)=541 then nilai else 0 end as b_bagi,
case when left(kd_rek5,3)=542 then nilai else 0 end as b_bantuan_keuangan
from trdrka)x
group by kd_kegiatan,nm_kegiatan
)x
where kode like '%$id%'
order by kode


                        ";

  

                
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $kode=rtrim($row->kode);
                    $nm_program=rtrim($row->nm_program);
                    $sumber=$row->sumber;
                    $lokasi=$row->lokasi;
                    $b_pegawai=number_format($row->b_pegawai,2,',','.');
                    $b_barang=number_format($row->b_barang,2,',','.');
                    $b_bunga=number_format($row->b_bunga,2,',','.');
                    $b_subsidi=number_format($row->b_subsidi,2,',','.');
					$b_hibah=number_format($row->b_hibah,2,',','.');
					$b_bansos=number_format($row->b_bansos,2,',','.');
					$b_modal=number_format($row->b_modal,2,',','.');
					$b_takterduga=number_format($row->b_takterduga,2,',','.');
					$b_bagi=number_format($row->b_bagi,2,',','.');
					$b_bantuan_keuangan=number_format($row->b_bantuan_keuangan,2,',','.');
					$total=number_format($row->total,2,',','.');

                   
                    $length_kode=strlen($kode);
					
                    if($length_kode== '18'){
						$kodex = $kode;
						$kodey = "";
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                    }else{
						$kodex = "";
						$kodey = $kode;
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                   

                      $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  colspan=\"2\" align=\"left\">$kode</td>								
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$nm_program</td>
										<td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
										<td style=\"vertical-align:top;$latas $lbawah $bold \" >$sumber</td>
										<td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_pegawai</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_barang</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_bunga</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_subsidi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_hibah</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_bansos</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_modal</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_takterduga</td>
										<td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_bagi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$b_bantuan_keuangan</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$total</td>
										<td style=\"vertical-align:top;$latas $lbawah $bold \" >&nbsp;</td>
                                    </tr> 
                                    
                                   
                                    ";

 
                }

       
	   $sql12="select *,tot_b_pegawai+tot_b_barang+tot_b_bunga+tot_b_subsidi+tot_b_hibah+tot_b_bansos+tot_b_modal+tot_b_takterduga+
tot_b_bagi+tot_b_bantuan_keuangan as tot_total from(
	   select sum(tot_b_pegawai) tot_b_pegawai,sum(tot_b_barang) tot_b_barang,sum(tot_b_bunga) tot_b_bunga,
sum(tot_b_subsidi) tot_b_subsidi,sum(tot_b_hibah) tot_b_hibah,sum(tot_b_bansos) tot_b_bansos,sum(tot_b_modal) tot_b_modal,
sum(tot_b_takterduga) tot_b_takterduga,sum(tot_b_bagi) tot_b_bagi,sum(tot_b_bantuan_keuangan) tot_b_bantuan_keuangan
 from(
select kd_skpd,
case when left(kd_rek5,3)=511 then nilai else 0 end as tot_b_pegawai,
case when left(kd_rek5,3)=512 then nilai else 0 end as tot_b_barang,
case when left(kd_rek5,3)=513 then nilai else 0 end as tot_b_bunga,
case when left(kd_rek5,3)=514 then nilai else 0 end as tot_b_subsidi,
case when left(kd_rek5,3)=515 then nilai else 0 end as tot_b_hibah,
case when left(kd_rek5,3)=516 then nilai else 0 end as tot_b_bansos,
case when left(kd_rek5,2)=52 then nilai else 0 end as tot_b_modal,
case when left(kd_rek5,3)=531 then nilai else 0 end as tot_b_takterduga,
case when left(kd_rek5,3)=541 then nilai else 0 end as tot_b_bagi,
case when left(kd_rek5,3)=542 then nilai else 0 end as tot_b_bantuan_keuangan
from trdrka)x
where kd_skpd like '%$id%')x

                        ";
				$queryx = $this->db->query($sql12);
				foreach ($queryx->result() as $row)
                {
					
				$tot_b_pegawai = number_format($row->tot_b_pegawai,2,',','.');
                $tot_b_barang =  number_format($row->tot_b_barang,2,',','.');
                $tot_b_bunga =  number_format($row->tot_b_bunga,2,',','.');
                $tot_b_subsidi =  number_format($row->tot_b_subsidi,2,',','.');
                $tot_b_hibah =  number_format($row->tot_b_hibah,2,',','.');
				$tot_b_bansos =  number_format($row->tot_b_bansos,2,',','.');
				$tot_b_modal =  number_format($row->tot_b_modal,2,',','.');
				$tot_b_takterduga =  number_format($row->tot_b_takterduga,2,',','.');
				$tot_b_bagi =  number_format($row->tot_b_bagi,2,',','.');
				$tot_b_bantuan_keuangan =  number_format($row->tot_b_bantuan_keuangan,2,',','.');
				$tot_total =  number_format($row->tot_total,2,',','.');
				

                   
                    
					
                
            
				$cRet    .= "
				<tr>
									<td    colspan=\"5\" align=\"right\">Total</td>								
										<td   align=\"right\"> $tot_b_pegawai</td>
                                        <td   align=\"right\"> $tot_b_barang</td>
                                        <td   align=\"right\"> $tot_b_bunga</td>
                                        <td   align=\"right\"> $tot_b_subsidi</td>
                                        <td   align=\"right\"> $tot_b_hibah</td>
                                        <td   align=\"right\"> $tot_b_bansos</td>
                                        <td   align=\"right\"> $tot_b_modal</td>
                                        <td   align=\"right\"> $tot_b_takterduga</td>
										<td   align=\"right\"> $tot_b_bagi</td>
                                        <td   align=\"right\"> $tot_b_bantuan_keuangan</td>
                                        <td   align=\"right\">$tot_total</td>
										<td   >&nbsp;</td>
                                    </tr> 
                                    
                                   
                                    ";
 
				}


                             $cRet .="<tr>
                                        <td colspan=\"17\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"50%\" colspan=\"2\">&emsp;</td>
                                                    <td width=\"10%\" >&emsp;</td>
                                                    <td width=\"40%\" align=\"center\">
                                                    $daerah,$tgl_ttd2</td>
                                                </tr>
                                                <tr>
                                                    <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td width=\"40%\" align=\"center\" valign=\"top\">
                                                        <br>
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><ins></ins></b>
                                                        <br>
                                                        <br> 
                                                    </td>
                                                    <td align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        &nbsp;  
                                                    </td>
                                                    <td align=\"center\">$jdlnip1  
                                                        <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
                                                        &nbsp;<br>
                                                        &nbsp;<br>
                                                        <br><b><u>$nama1</u></b>
                                                        <br>$nip1 
                                                    </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";

        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report RKA-22</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             //$this->_mpdf('',$cRet,10,10,10,'1');
            $this->_mpdf_down('RKA22',$nm_org,$cRet,10,10,10,'0');
        break;
        case 2;        

            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= RKA22.xls");
            echo($cRet);
        break;
        
        }    
    }
//end

    function edit_sumber_kegi_sempurna(){
        $data['page_title']= 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN';
        $this->template->set('title', 'INPUT SUMBER DANA ANGGARAN PER KEGIATAN');   
        $this->template->load('template','anggaran/rka/edit_sumber_kegi_sempurna',$data) ; 
    }

    function kegi_sumber_sempurna($cskpd='') {
        $lccr = $this->input->post('q');
        if($cskpd==''){
            $result[] = array(
                        'id' => 0,        
                        'kd_kegiatan' => '',  
                        'nm_kegiatan' => '',  
                        'nilai' =>  '',
                        'sumber' => '',
                        'ket_sumber' => ''
                        );
        }else{
            $query1 = "select DISTINCT kd_kegiatan,nm_kegiatan,sum(nilai_sempurna) as nilai,
                       case when sumber2_su is null then sumber1_su
                        else sumber1_su+'  '+sumber2_su end as sumber,
                        case when (sumber2_su is null or sumber2_su =' ')then '1'
                        else '2' end as ket_sumber
                        from trdrka where left(kd_skpd,7) = left('$cskpd',7)
                        group by kd_kegiatan,nm_kegiatan,sumber1_su,sumber2_su order by kd_kegiatan";  
            
            $query2=$this->db->query($query1);

            $result = array();
            $ii = 0;
            foreach($query2->result_array() as $resulte)
            { 
               
                $result[] = array(
                            'id' => $ii,        
                            'kd_kegiatan' => $resulte['kd_kegiatan'],  
                            'nm_kegiatan' => $resulte['nm_kegiatan'],  
                            'nilai' =>  number_format($resulte['nilai'],"2",".",","),
                            'sumber' => $resulte['sumber'],
                            'ket_sumber'=> $resulte['ket_sumber']
                            );
                            $ii++;
            }                            
        }

        echo json_encode($result);
           
    }

    function update_sumber_kegi_sempurna(){
        $ckegi   = $this->input->post('kegi');
        $sumber   = $this->input->post('csumber1');
        $nangg = 'nilai_sempurna';
          $asg = $this->rka_model->q_update_sumber_kegi_sempurna($ckegi,$sumber,$nangg);
        if($asg){
            echo '1';
        }else{
            echo '0';
        }
    }


   function rka_dppa(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $anggaran=$this->uri->segment(5);

        if($anggaran=="1"){
        	$n_ang = "nilai";
        	$t_ang = "total";
        	$v_ang = "volume1";
        	$s_ang = "satuan1";
        	$h_ang = "harga1";
        }else if($anggaran=="2"){
        	$n_ang = "nilai_sempurna";
        	$t_ang = "total_sempurna";
        	$v_ang = "volume_sempurna1";
        	$s_ang = "satuan_sempurna1";
        	$h_ang = "harga_sempurna1";
        }else if($anggaran=="3"){
        	$n_ang = "nilai_ubah";
        	$t_ang = "total_ubah";
        	$v_ang = "volume_ubah1";
        	$s_ang = "satuan_ubah1";
        	$h_ang = "harga_ubah1";
        }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='4.02.01.00'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {         
                    $tgl=$rowsc->tgl_rka;
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.waktu_giat,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,
                a.tu_mas,a.tu_kel,a.tu_has,a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_sempurna,a.tu_mas_sempurna,a.tu_kel_sempurna,a.tu_has_sempurna,
                a.tk_capai_sempurna,a.tk_mas_sempurna,a.tk_kel_sempurna,a.tk_has_sempurna,a.lokasi,d.sumber,a.ang_lalu FROM trskpd a 
                INNER JOIN ms_program b ON a.kd_program=b.KD_PROGRAM
                INNER JOIN ms_sub_kegiatan c ON a.kd_sub_kegiatan=c.KD_sub_KEGIATAN
                INNER JOIN trdrka d ON a.kd_sub_kegiatan=d.kd_sub_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd,f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.tu_capai_sempurna,a.tu_mas_sempurna,a.tu_kel_sempurna,a.tu_has_sempurna,
                a.tk_capai_sempurna,a.tk_mas_sempurna,a.tk_kel_sempurna,a.tk_has_sempurna,a.waktu_giat,d.sumber,a.ang_lalu";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                }
  
        $cRet="<table width='100%'>
        		<tr>
        			<td>
        				Organisasi
        				<br>Kegiatan
        				<br>Tahun Anggaran
        			</td>
        			<td>
        				: $kd_skpd - $nm_skpd
        				<br>: $kd_giat - $nm_giat
        				<br>: $thn
        			</td>
        		</tr>
        </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td bgcolor=\"#CCCCCC\" align=\"center\">12</td>                        
                        </tr> 
                     </thead>

                    
                     
                        ";
                $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.$n_ang),0) AS nilai_u,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE (a.$n_ang != 0 or a.nilai != 0) and a.kd_kegiatan='$giat' AND left(a.kd_skpd,7)=left('$id',7) 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                         UNION ALL 
                         SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.$n_ang),0) AS nilai_u,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE (a.$n_ang != 0 or a.nilai != 0) and a.kd_kegiatan='$giat'
                        and left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                         UNION ALL  
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.$n_ang),0) AS nilai_u,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE (a.$n_ang != 0 or a.nilai != 0) and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.$n_ang),0) AS nilai_u,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE (a.$n_ang != 0 or a.nilai != 0) and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                         UNION ALL 
                         SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,0 AS volume_u,' 'AS satuan_u, 0 AS harga_u,isnull(SUM(a.$n_ang),0) AS nilai_u,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE (a.$n_ang != 0 or a.nilai != 0) and a.kd_kegiatan='$giat'
                        AND left(a.kd_skpd,7)=left('$id',7)  GROUP BY a.kd_rek5,b.nm_rek5
                         UNION ALL 
                         SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                        0 AS harga,SUM(a.total) AS nilai,0 AS volume_u,' ' AS satuan_u, 0 AS harga_u,isnull(SUM(a.$t_ang),0) AS nilai_u,'6' AS id 
                        FROM trdpo a
                        LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                        WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(a.no_trdrka,12,22)='$giat'
                        GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1' 
                        UNION ALL
                        SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.$v_ang AS volume,a.$s_ang AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume_u,a.satuan_sempurna1 AS satuan_u, a.$h_ang AS harga_u,
                        a.$t_ang AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,7)=left('$id',7) AND SUBSTRING(no_trdrka,12,22)='$giat' AND (header='0' or header is null) and (a.$t_ang != 0 or total !=0)
                        ) a ORDER BY a.rek1,a.id,a.no_po";
                 

                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
               //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.'); 
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    $volum_u= empty($row->volume_u) || $row->volume_u == 0 ? '' :number_format($row->volume_u,2,',','.');                   
                    $nila= number_format($row->nilai,"2",".",",");                    
               //     $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                        $x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    if ($n==0){
                        $per1=0;
                    }else{
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0;
                    }
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;\" align=\"right\">&nbsp;</td>
                                                                  </tr>";
                 $n_per1sel=0;                                                                  
                 $sqltp="SELECT SUM(nilai) AS totp,sum($n_ang) as totp_u FROM trdrka WHERE kd_kegiatan='$giat' AND left(kd_skpd,7)=left('$id',7)";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totpa=$rowp->totp;
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_ua=$rowp->totp_u;
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   $selx=$totp_ua-$totpa;
                   
                   
                   if ($selx < 0){
                        $x1sel="("; $selx=$selx*-1; $y1sel=")";}
                    else {
                        $x1sel=""; $y1sel="";}

                    $sel=number_format($selx,"2",".",",");
                    
                    $n_sel = number_format($selx,"2",".",",");
                    if ($rowp->totp==0){
                        $per1sel=0;
                    }else{
                    $per1sel   = ($sel!=0)?($selx / $rowp->totp ) * 100:0;
                    $n_per1sel = number_format($per1sel,"2",".",",");
                    }
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\">TOTAL</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$x1sel$sel$y1sel</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$x1sel$n_per1sel$y1sel</td>
                                </tr>";
                 }
                 
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $cetak=3;
        switch($cetak) {        
        case 0;
        	echo "$cRet";
             //$this->_mpdf_down($giat,$nm_giat,$cRet,10,10,10,'1');
        break;
        case 1;
        	echo "$cRet";
            //$this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221-PERUBAHAN-$giat.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
         case 3;
                echo ("<title>Lap Anggaran OPD</title>");
                echo($cRet);
                //$this->_mpdf('',$cRet,10,10,10,'1');
        //$this->template->load('template','anggaran/rka/perda1',$data);
        break;
        
        }
        
                
    }



  function simpan_rincian_dpo(){
        $id=$this->session->userdata('pcNama');
        $header  =$this->input->post('header');
        $kode  =$this->input->post('kode');
        $kd_kegiatan=$this->input->post('kd_kegiatan');      
        $kd_rek5=$this->input->post('kd_rek5');      
        $no_po=$this->input->post('no_po');      
        $no_trdrka=$this->input->post('no_trdrka');      
        $uraian=$this->input->post('uraian');      
        $volume1=$this->input->post('volume1');      
        $volume1_sempurna1=$this->input->post('volume1_sempurna1');      
        $volume_ubah1=$this->input->post('volume_ubah1');      
        $satuan1=$this->input->post('satuan1');      
        $satuan_sempurna1=$this->input->post('satuan_sempurna1');      
        $satuan_ubah1=$this->input->post('satuan_ubah1');      
        $harga1=$this->input->post('harga1');
        $harga_sempurna1=$this->input->post('harga_sempurna1'); 
        $harga_ubah1=$this->input->post('harga_ubah1');      
        $total=$this->input->post('total');      
        $total_sempurna=$this->input->post('total_sempurna');
        $total_ubah=$this->input->post('total_ubah'); 
        $kode_unik=$this->input->post('unik');  

        if($no_po==''){
            $unik=$this->db->query("SELECT isnull(max(cast(no_po as int)),0)+1 as nopo from trdpo where no_trdrka='$no_trdrka'")->row();            
            $no_po=$unik->nopo;
        }


        $unik=$this->db->query("SELECT isnull(max(cast(unik as int)),0)+1 as oke from trdpo")->row();
        $kd_sisb=$unik->oke;

        $sql ="INSERT into trdpo(header,kode,kd_kegiatan,kd_rek5,no_po,no_trdrka,uraian,volume1,volume_sempurna1,volume_ubah1,satuan1,satuan_sempurna1,satuan_ubah1,harga1,harga_sempurna1,harga_ubah1,total,total_sempurna,total_ubah,unik)
                        values ('$header','$kode','$kd_kegiatan','$kd_rek5','$no_po','$no_trdrka','$uraian','$volume1','$volume1_sempurna1','$volume_ubah1','$satuan1','$satuan_sempurna1','$satuan_ubah1','$harga1','$harga_sempurna1','$harga_ubah1','$total','$total_sempurna','$total_ubah','$kd_sisb')"; 
        
        $this->db->query($sql);
        $query1 = $this->db->query("UPDATE trdrka set 
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka)-nsumber2_ubah-nsumber3_ubah
                                    ,username='$id',last_update=getdate() where no_trdrka='$no_trdrka' ");          
        $query1 = $this->db->query("UPDATE trdrka set nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate() where no_trdrka='$no_trdrka' ");  
        echo $query1 = $this->db->query("UPDATE trskpd set total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ),
                                    username1='$id',last_update=getdate() where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) "); 

    }

   function update_rincian_dpo(){
        $id=$this->session->userdata('pcNama');
        $header  =$this->input->post('header');
        $kode  =$this->input->post('kode');
        $kd_kegiatan=$this->input->post('kd_kegiatan');      
        $kd_rek5=$this->input->post('kd_rek5');      
        $no_po=$this->input->post('no_po');      
        $no_trdrka=$this->input->post('no_trdrka');      
        $uraian=$this->input->post('uraian');        
        $volume_ubah1=$this->input->post('volume_ubah1');       
        $satuan_ubah1=$this->input->post('satuan_ubah1');      
        $harga_ubah1=$this->input->post('harga_ubah1');      
        $total_ubah=$this->input->post('total_ubah'); 
        $unik=$this->input->post('unik');  



                    $sql="UPDATE trdpo set 
                        header='$header',
                        kode='$kode',
                        uraian='$uraian',
                        volume_ubah1='$volume_ubah1',
                        satuan_ubah1='$satuan_ubah1',
                        harga_ubah1='$harga_ubah1',
                        total_ubah='$total_ubah'
                        where unik='$unik' and no_trdrka='$no_trdrka'";
        
         $this->db->query($sql);

        
        $query1 = $this->db->query("
            UPDATE trdrka set nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka)-nsumber2_ubah-nsumber3_ubah,
            username='$id',last_update=getdate() where no_trdrka='$no_trdrka' ");  
        echo $query1 = $this->db->query("UPDATE trskpd set total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ),
                                    username1='$id',last_update=getdate() where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ");    

}

   function hapus_rincian_dpo(){
        $id=$this->session->userdata('pcNama');        
        $kode_unik  =$this->input->post('kode_unik');
        $skpd  =$this->input->post('skpd');
        $kd_kegiatan  =$this->input->post('giat');
        $norka  =$this->input->post('norka');

        $sql="DELETE trdpo where unik='$kode_unik' and no_trdrka='$norka'";
        
        $this->db->query($sql);
     
        $query1 = $this->db->query("
            UPDATE trdrka set 
            nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nilai_sempurna = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_su = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            username='$id',last_update=getdate() where no_trdrka='$norka' ");  
        echo $query1 = $this->db->query("
            UPDATE trskpd set 
            total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$skpd',7)),
            total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$skpd',7)),
            username1='$id',last_update=getdate() where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$skpd',7) ");    

}

  function simpan_rincian_dpo_geser(){
        $id=$this->session->userdata('pcNama');
        $header  =$this->input->post('header');
        $kode  =$this->input->post('kode');
        $kd_kegiatan=$this->input->post('kd_kegiatan');      
        $kd_rek5=$this->input->post('kd_rek5');      
        $no_po=$this->input->post('no_po');      
        $no_trdrka=$this->input->post('no_trdrka');      
        $uraian=$this->input->post('uraian');      
        $volume1=$this->input->post('volume1');      
        $volume1_sempurna1=$this->input->post('volume1_sempurna1');      
        $volume_ubah1=$this->input->post('volume_ubah1');      
        $satuan1=$this->input->post('satuan1');      
        $satuan_sempurna1=$this->input->post('satuan_sempurna1');      
        $satuan_ubah1=$this->input->post('satuan_ubah1');      
        $harga1=$this->input->post('harga1');
        $harga_sempurna1=$this->input->post('harga_sempurna1'); 
        $harga_ubah1=$this->input->post('harga_ubah1');      
        $total=$this->input->post('total');      
        $total_sempurna=$this->input->post('total_sempurna');
        $total_ubah=$this->input->post('total_ubah'); 
        $kode_unik=$this->input->post('unik');  

        if($no_po==''){
            $unik=$this->db->query("SELECT isnull(max(cast(no_po as int)),0)+1 as nopo from trdpo where no_trdrka='$no_trdrka'")->row();            
            $no_po=$unik->nopo;
        }


        $unik=$this->db->query("SELECT isnull(max(cast(unik as int)),0)+1 as oke from trdpo")->row();
        $kd_sisb=$unik->oke;

        $sql ="INSERT into trdpo(header,kode,kd_kegiatan,kd_rek5,no_po,no_trdrka,uraian,volume1,volume_sempurna1,volume_ubah1,satuan1,satuan_sempurna1,satuan_ubah1,harga1,harga_sempurna1,harga_ubah1,total,total_sempurna,total_ubah,unik)
                        values ('$header','$kode','$kd_kegiatan','$kd_rek5','$no_po','$no_trdrka','$uraian','$volume1','$volume1_sempurna1','$volume_ubah1','$satuan1','$satuan_sempurna1','$satuan_ubah1','$harga1','$harga_sempurna1','$harga_ubah1','$total','$total_sempurna','$total_ubah','$kd_sisb')"; 
        
        $this->db->query($sql);
        $query1 = $this->db->query("UPDATE trdrka set 
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_su = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nilai_sempurna = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            username='$id',last_update=getdate() where no_trdrka='$no_trdrka'");          
       
        echo $query1 = $this->db->query("UPDATE trskpd set 
            total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ),
            total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ),
            username1='$id',last_update=getdate() where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) "); 

    }

   function update_rincian_dpo_geser(){
        $id=$this->session->userdata('pcNama');
        $header  =$this->input->post('header');
        $kode  =$this->input->post('kode');
        $kd_kegiatan=$this->input->post('kd_kegiatan');      
        $kd_rek5=$this->input->post('kd_rek5');      
        $no_po=$this->input->post('no_po');      
        $no_trdrka=$this->input->post('no_trdrka');      
        $uraian=$this->input->post('uraian');        
        $volume_sempurna1=$this->input->post('volume_sempurna1');       
        $satuan_sempurna1=$this->input->post('satuan_sempurna1');      
        $harga_sempurna1=$this->input->post('harga_sempurna1');      
        $total_sempurna=$this->input->post('total_sempurna'); 
        $unik=$this->input->post('unik');  



                    $sql="UPDATE trdpo set 
                        header='$header',
                        kode='$kode',
                        uraian='$uraian',
                        volume_ubah1='$volume_sempurna1',
                        satuan_ubah1='$satuan_sempurna1',
                        harga_ubah1='$harga_sempurna1',
                        total_ubah='$total_sempurna',
                        volume_sempurna1='$volume_sempurna1',
                        satuan_sempurna1='$satuan_sempurna1',
                        harga_sempurna1='$harga_sempurna1',
                        total_sempurna='$total_sempurna'
                        where unik='$unik' and no_trdrka='$no_trdrka'";
        
         $this->db->query($sql);

        
        $query1 = $this->db->query("
            UPDATE trdrka set 
            nilai_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nilai_sempurna = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_ubah = (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            nsumber1_su = (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
            username='$id',last_update=getdate() where no_trdrka='$no_trdrka' ");  
        echo $query1 = $this->db->query("UPDATE trskpd set 
            total_ubah= (select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7)),
            total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ),
            username1='$id',last_update=getdate() where kd_kegiatan='$kd_kegiatan' and left(kd_skpd,7)=left('$no_trdrka',7) ");    

}










    
}